import k from"./CurrencyInput.68661cc8.js";import x from"./FullScreenLayout.0d0fe126.js";import{_ as L,r as b}from"./index.8a58b007.js";import{A as N,i as F,ar as C,l as I,k as O,u as T,t as B,Q as f,x as h,f as E,q as z,w as y,ae as q}from"./vuetify.65d833ec.js";import{S as u,e as s,x as d,k as r,g as o,J as c,I as D,f as m,j as M,G as V,z as J}from"./@vue.ee679632.js";import"./vue-currency-input.92e6c86a.js";import"./vuex.0eb68a2c.js";import"./date-fns.d38e1d55.js";import"./vue-atomic-docs.4f3653eb.js";import"./vue-router.ec64e966.js";import"./axios.eca6faa7.js";import"./axios-cache-interceptor.0956cad0.js";import"./cache-parser.124ebbb8.js";import"./fast-defer.b34f24de.js";import"./object-code.c2755e43.js";import"./@fortawesome.2cecc5e3.js";import"./@awesome.me.7dae7d79.js";const U={components:{CurrencyInput:k,FullScreenLayout:x},beforeRouteEnter(e,t,g){g(p=>{t.name==="pricingModelIndex"&&(p.pricingModelIndexLink=t)})},data(){return{isPricingGroupLoading:!0,isStandingOffersLoading:!0,isPricingModelLoading:!0,isSaving:!1,isValid:!1,pricingModelIndexLink:{name:"pricingModelIndex"},pricingModel:{},standingOffers:[]}},computed:{isNew(){return this.$route.name==="newPricingModel"},title(){return this.isNew?"New Pricing Model":"Edit: "+this.pricingModel.name}},created(){this.initializePricingData()},methods:{async initializePricingData(){this.isNew?await this.initializeNewPricingModel():await this.fetchPricingModel(),await this.fetchStandingOffers()},async fetchPricingModel(){try{this.isPricingModelLoading=!0;const e=await this.$store.dispatch("inventory/getPricingModel",this.$route.params.pricingModelId);this.pricingModel=JSON.parse(JSON.stringify(e))}catch(e){console.error("Error getting pricing model:",e),this.$store.dispatch("app/setSnackbar",{message:"Failed to get pricing model: "+e.message,color:"error"})}finally{this.isPricingModelLoading=!1}},async initializeNewPricingModel(){try{this.isPricingModelLoading=!0;const e=await this.$store.dispatch("inventory/getPricingGroupsByPricingModelType",this.$route.params.type),t=JSON.parse(JSON.stringify(e));this.pricingModel={type:this.$route.params.type,prices:t.reduce((g,{name:p})=>({...g,[p]:0}),{}),promotions:[]}}catch(e){console.error("Error setting new pricing model:",e),this.$store.dispatch("app/setSnackbar",{message:"Failed to set new pricing model: "+e.message,color:"error"})}finally{this.isPricingModelLoading=!1}},async fetchStandingOffers(){try{this.standingOffers=await this.$store.dispatch("inventory/getStandingOffers",this.pricingModel.type)}catch(e){console.error("Error getting standing offers:",e),this.$store.dispatch("app/setSnackbar",{message:"Failed to get standing offers: "+e.message,color:"error"})}},async save(){try{this.isSaving=!0,this.isNew?await this.$store.dispatch("inventory/postPricingModel",this.pricingModel):await this.$store.dispatch("inventory/putPricingModel",this.pricingModel),this.navigateToPricingModelIndex(),this.$store.dispatch("app/setSnackbar",{message:"Pricing model saved",color:"success"})}catch(e){console.error("Error saving pricing model:",e),this.$store.dispatch("app/setSnackbar",{message:"Failed to save pricing model: "+e.message,color:"error"})}finally{this.isSaving=!1}},required:b,autoSelectPriceField(e){e.target.select()},navigateToPricingModelIndex(e){e?this.$router.replace(this.pricingModelIndexLink):this.$router.push(this.pricingModelIndexLink)}}},G={key:2};function R(e,t,g,p,i,a){const P=u("CurrencyInput"),S=u("VBtnSecondary"),v=u("VBtnPrimary"),_=u("FullScreenLayout");return s(),d(_,null,{header:r(()=>[o(N,null,{title:r(()=>[c(D(a.title),1)]),_:1})]),footer:r(()=>[o(C,null,{default:r(()=>[o(S,{loading:i.isSaving,class:"mr-4",onClick:t[3]||(t[3]=n=>a.navigateToPricingModelIndex())},{default:r(()=>[c(" Cancel ")]),_:1},8,["loading"]),o(F),o(v,{loading:i.isSaving,onClick:t[4]||(t[4]=n=>a.save())},{default:r(()=>[c(" Save ")]),_:1},8,["loading"])]),_:1})]),default:r(()=>[o(z,{loading:i.isPricingModelLoading||i.isSaving},{default:r(()=>[o(I,{modelValue:i.isValid,"onUpdate:modelValue":t[2]||(t[2]=n=>i.isValid=n),disabled:i.isSaving,"validate-on":"blur"},{default:r(()=>[o(O,null,{default:r(()=>[o(T,{modelValue:i.pricingModel.name,"onUpdate:modelValue":t[0]||(t[0]=n=>i.pricingModel.name=n),label:"Name",autofocus:a.isNew},null,8,["modelValue","autofocus"])]),_:1}),o(B,null,{default:r(()=>[o(f,{class:"pl-0"},{default:r(()=>[c(" Prices ")]),_:1}),i.isPricingModelLoading?J("",!0):(s(),d(h,{key:0},{default:r(()=>[(s(!0),m(V,null,M(i.pricingModel.prices,(n,l)=>(s(),d(y,{key:l,cols:"12",sm:"4",lg:"3"},{default:r(()=>[o(P,{modelValue:i.pricingModel.prices[l],"onUpdate:modelValue":w=>i.pricingModel.prices[l]=w,modelModifiers:{lazy:!0},label:l,density:"compact",rules:[a.required],onFocus:a.autoSelectPriceField},null,8,["modelValue","onUpdate:modelValue","label","rules","onFocus"])]),_:2},1024))),128))]),_:1})),o(E),o(f,{class:"pl-0"},{default:r(()=>[c(" Promotions ")]),_:1}),i.standingOffers.length?(s(),d(h,{key:1},{default:r(()=>[(s(!0),m(V,null,M(i.standingOffers,n=>(s(),d(y,{key:n.code,cols:"12",sm:"4",lg:"3"},{default:r(()=>[o(q,{modelValue:i.pricingModel.promotions,"onUpdate:modelValue":t[1]||(t[1]=l=>i.pricingModel.promotions=l),density:"compact","hide-details":"","true-icon":"$vuetify.icons.checkSquare","false-icon":"$vuetify.icons.square",label:n.name,value:n.code},null,8,["modelValue","label","value"])]),_:2},1024))),128))]),_:1})):(s(),m("p",G," No Promotions "))]),_:1})]),_:1},8,["modelValue","disabled"])]),_:1},8,["loading"])]),_:1})}const ae=L(U,[["render",R]]);export{ae as default};
