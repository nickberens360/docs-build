import x from"./MeruDataTable.80a372ee.js";import{_ as j,b as d}from"./index.8a58b007.js";import{a as M,c as L}from"./vuex.0eb68a2c.js";import z from"./DesignEditDialog.75a94713.js";import R from"./ProductClassPicker.8e08848e.js";import $ from"./ProductImage.3e5aeb25.js";import Y from"./DefaultLayout.61d229e4.js";import{S as y,e as r,x as D,k as i,g as s,L as T,M as P,J as m,E as h,z as k,f as g,I as p,s as q,F as J,j as W,G as H,m as Q,p as X,aj as Z,ak as ee}from"./@vue.ee679632.js";import{a6 as te,a2 as se,a3 as ie,c as G,d as N,x as E,w as C,i as V,a7 as ae,n as F,u as le,aj as K,az as ne,q as _,f as oe,aw as de,t as re,p as ce,W as ue,a as me,V as pe,e as ge}from"./vuetify.65d833ec.js";import{b as A,e as he}from"./lodash-es.d99d4c8c.js";import"./date-fns.d38e1d55.js";import"./vue-atomic-docs.4f3653eb.js";import"./vue-router.ec64e966.js";import"./axios.eca6faa7.js";import"./axios-cache-interceptor.0956cad0.js";import"./cache-parser.124ebbb8.js";import"./fast-defer.b34f24de.js";import"./object-code.c2755e43.js";import"./@fortawesome.2cecc5e3.js";import"./@awesome.me.7dae7d79.js";import"./DesignHeader.6c26595d.js";import"./DesignTranslationsTable.f0057ebc.js";import"./KeySkuTable.3aca98d2.js";import"./ImageUploader.2bd27848.js";import"./CurrencyInput.68661cc8.js";import"./vue-currency-input.92e6c86a.js";import"./CarKeyInfo.689cfd0c.js";const fe=["KE","CK"],ye={components:{MeruDataTable:x,ProductImage:$,DesignEditDialog:z,ProductClassPicker:R,DefaultLayout:Y},data:()=>({designs:[],uncommittedDesigns:[],productClasses:{},loading:!0,selectedProductClass:void 0,selectedDesignCode:void 0,editDialogOpen:!1,changesSheetOpen:!1,search:"",tableFilter:{pricingGroup:[],deprecationStatus:{title:"Non-Deprecated",value:!1},keyType:[]},filterOptions:{pricingGroup:{K:[]},keyType:[]},headers:{Keys:[{title:"Design Code",key:"designCode",width:120},{title:"Preview",key:"firstSku",sortable:!1,width:120},{title:"Name",key:"name",width:290},{title:"Pricing Group",key:"pricingGroup.name",sortable:!1,width:250},{title:"Deprecated",key:"deprecated",sortable:!1,width:160,align:"center"}],Auto:[{title:"Design Code",key:"designCode",width:120},{title:"Preview",key:"firstSku",sortable:!1,width:120},{title:"Key Type",key:"keyType",sortable:!0,width:250},{title:"Deprecated",key:"deprecated",sortable:!1,width:160,align:"center"}]}}),computed:{...M({environment:"app/getEnvConfigs"}),allDesigns(){return[...this.designs,...this.uncommittedNew]},completeUncommittedDesigns(){const e=this.uncommittedExisting.map(t=>t.id);return[...this.uncommittedNew,...this.designs.filter(t=>e.includes(t.id))]},uncommittedNew(){return this.uncommittedDesigns.filter(e=>e.id===void 0)},uncommittedExisting(){return this.uncommittedDesigns.filter(e=>e.id!==void 0)},selectedDesigns(){return this.allDesigns.filter(e=>this.selectedProductClass.productClasses.includes(e.productClass)&&(this.tableFilter.deprecationStatus.value===null||this.tableFilter.deprecationStatus.value===e.deprecated)&&(this.selectedProductClass.name!=="Auto"||!this.tableFilter.keyType.length||this.tableFilter.keyType.includes(e.keyType))&&(this.selectedProductClass.name!=="Keys"||!this.tableFilter.pricingGroup.length||this.tableFilter.pricingGroup.findIndex(t=>e.pricingGroup&&e.pricingGroup.id===t.id)!==-1))},selectedDesign(){return this.selectedDesignCode&&this.allDesigns.find(e=>e.designCode===this.selectedDesignCode)}},created(){Promise.all([d.getProductClasses(),d.getAllDesigns(),d.getAllStagedDesignChanges()]).then(([e,t,o])=>{fe.forEach(n=>this.productClasses[n]=e.data[n]),this.uncommittedDesigns=o.data,this.designs=t.data,this.uncommittedExisting.forEach(n=>this.updateExistingDesign(n))}).catch(e=>console.error(e)).finally(()=>{this.loading=!1}),d.getPricingGroupsByProductClass("KE").then(({data:e})=>this.filterOptions.pricingGroup=e),d.getCarKeyTypes().then(({data:e})=>this.filterOptions.keyType=e)},methods:{...L({updateSKUs:"inventory/updateSKUs"}),handleTabChange(e){this.selectedProductClass=e,this.search=""},resetFilter(e){this.tableFilter[e]=[]},resetDesign(e){const t=this.uncommittedDesigns.findIndex(l=>l.designCode===e),o=this.uncommittedDesigns[t].skus!==void 0?this.uncommittedDesigns[t].skus:[];this.uncommittedDesigns.splice(t,1);const n=this.designs.findIndex(l=>l.designCode===e),u=this.designs[n];u&&d.getDesign(u.id).then(({data:l})=>{var b;const w={...A(l,["id","pricingGroup","designCode","productClass"]),name:this.getDefaultDesignName(l),keyType:((b=l==null?void 0:l.carKeyDesign)==null?void 0:b.keyType)||void 0,firstSku:l.skus[0].sku,deprecated:l.skus.every(v=>v.deprecated)};this.designs.splice(n,1,w)}),d.stageDesign(this.uncommittedDesigns),o.length&&d.deleteStagedSkuImages(o.map(({sku:l})=>l)),this.uncommittedDesigns.length||(this.changesSheetOpen=!1)},mergeDesigns(e,t){return he(e,t)},getDefaultDesignName(e){var t,o;return(o=(t=e==null?void 0:e.names)==null?void 0:t.find(n=>n.locale==="en"))==null?void 0:o.name},createDesign(){this.editDialogOpen=!0},async dialogClosed(e){if(e){const t=this.uncommittedDesigns.findIndex(o=>o.designCode===e.designCode);if(t===-1)this.uncommittedDesigns.push({...e});else{const o=(e.skus||[]).map(u=>u.sku),n=(this.uncommittedDesigns[t].skus||[]).map(u=>u.sku).filter(u=>!o.includes(u));n&&await d.deleteStagedSkuImages(n),this.uncommittedDesigns.splice(t,1,e)}this.updateExistingDesign(e),d.stageDesign(this.uncommittedDesigns,e).then(()=>{this.editDialogOpen=!1,this.selectedDesignCode=null})}else this.editDialogOpen=!1,this.selectedDesignCode=null},editDesign(e){if(this.changesSheetOpen){this.changesSheetOpen=!1,setTimeout(this.editDesign.bind(null,e),300);return}this.selectedDesignCode=e,this.editDialogOpen=!0},filterDesignsByType(e){return this.allDesigns.filter(t=>t.pricingGroup.type===e)},updateExistingDesign(e){const t=this.designs.findIndex(n=>n.id===e.id),o=this.designs[t];if(o){const n=e.names&&(e.names.find(l=>l.locale==="en")||{}).name;n&&(e.name=n);const u={...A(o,["designCode","name","pricingGroup","productClass"])};this.designs.splice(t,1,this.mergeDesigns(u,e))}},commitDesignChanges(){this.loading=!0;const e=()=>{this.$store.dispatch("app/setSnackbar",{message:"Failed to Update Catalog",color:"error"})},t=()=>{d.getAllDesigns().then(({data:n})=>this.designs=n),this.changesSheetOpen=!1,this.uncommittedDesigns=[],this.$store.dispatch("app/setSnackbar",{message:"Updated Catalog"})},o=()=>{this.updateSKUs([]),this.loading=!1};this.uncommittedExisting.length&&this.uncommittedNew.length?d.patchDesigns(this.uncommittedExisting).then(()=>{d.postDesigns(this.uncommittedNew,!0).then(t).catch(e).finally(o)}).catch(e):this.uncommittedExisting.length?d.patchDesigns(this.uncommittedExisting,!0).then(t).catch(e).finally(o):this.uncommittedNew.length&&d.postDesigns(this.uncommittedNew,!0).then(t).catch(e).finally(o)}}},S=e=>(Z("data-v-1e0b41d8"),e=e(),ee(),e),Ce={class:"d-flex align-center justify-space-between"},De=S(()=>h("div",{class:"my-2 flex-shrink-1"}," You have uncommitted changes ",-1)),ke={key:0},be={key:1},Ve={key:2},_e={key:0},Se={key:1},we={key:2},ve={key:0},Te=S(()=>h("div",{class:"mx-4 text-h5"}," Uncommitted Changes ",-1)),Pe=S(()=>h("div",{class:"mx-4 text-body-2"}," Continue making changes, and then commit. ",-1)),Ee={style:{"white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}},Fe=S(()=>h("br",null,null,-1));function Ie(e,t,o,n,u,l){const w=y("ProductClassPicker"),b=y("ProductImage"),v=y("MeruDataTable"),U=y("DesignEditDialog"),I=y("VBtnSecondary"),O=y("VBtnPrimary"),B=y("DefaultLayout");return r(),D(B,null,{default:i(()=>[s(K,{class:"pt-0"},{default:i(()=>[s(te,null,{default:i(()=>[T(s(se,{variant:"tonal",color:"warning",class:"mb-4 w-100"},{prepend:i(()=>[s(ie,null,{default:i(()=>[s(G,{class:"mr-4 mt-1",size:"large",color:"warning"},{default:i(()=>[m(" $sync ")]),_:1})]),_:1})]),default:i(()=>[h("div",Ce,[De,s(N,{variant:"flat",color:"warning",class:"ml-4",onClick:t[0]||(t[0]=a=>e.changesSheetOpen=!e.changesSheetOpen)},{default:i(()=>[m(" View ")]),_:1})])]),_:1},512),[[P,!!e.uncommittedDesigns.length]])]),_:1}),s(E,{class:"text-right pb-3"},{default:i(()=>[s(C,{cols:"6"},{default:i(()=>[s(w,{"show-only":["Keys","Auto"],class:"mt-4",onChange:l.handleTabChange},null,8,["onChange"])]),_:1}),s(V),s(C,null,{default:i(()=>[s(V),s(ae,null,{default:i(()=>[Object.keys(e.productClasses).length?T((r(),D(N,{key:0,color:"primary",onClick:l.createDesign},{default:i(()=>[m(" New Design ")]),_:1},8,["onClick"])),[[P,e.selectedProductClass.name==="Keys"]]):k("",!0)]),_:1})]),_:1})]),_:1}),e.loading?k("",!0):(r(),D(E,{key:0,class:"pb-3"},{default:i(()=>[s(C,{cols:"12",sm:"3"},{default:i(()=>[s(F,{modelValue:e.tableFilter.deprecationStatus,"onUpdate:modelValue":t[1]||(t[1]=a=>e.tableFilter.deprecationStatus=a),class:"mr-4",label:"Deprecation Status","hide-details":"","return-object":"",items:[{title:"All",value:null},{title:"Non-Deprecated",value:!1},{title:"Deprecated",value:!0}]},null,8,["modelValue"])]),_:1}),e.selectedProductClass&&e.selectedProductClass.name==="Keys"?(r(),D(C,{key:0,cols:"12",sm:"4"},{default:i(()=>[s(F,{modelValue:e.tableFilter.pricingGroup,"onUpdate:modelValue":t[2]||(t[2]=a=>e.tableFilter.pricingGroup=a),class:"nowrap mr-4",multiple:"",label:"Pricing Group",clearable:"",placeholder:"All","hide-details":"",items:e.filterOptions.pricingGroup,"item-title":a=>a.name,"return-object":""},{selection:i(({item:a,index:c})=>[c===0?(r(),g("span",ke,p(a.title),1)):c<2?(r(),g("span",be,", "+p(a.title),1)):c===2?(r(),g("span",Ve,", \u2026")):k("",!0)]),_:1},8,["modelValue","items","item-title"])]),_:1})):e.selectedProductClass&&e.selectedProductClass.name==="Auto"?(r(),D(C,{key:1,cols:"12",sm:"4"},{default:i(()=>[T(s(F,{modelValue:e.tableFilter.keyType,"onUpdate:modelValue":t[3]||(t[3]=a=>e.tableFilter.keyType=a),class:"nowrap mr-4",multiple:"",label:"Key Type",clearable:"",placeholder:"All","hide-details":"",items:e.filterOptions.keyType,"item-title":e.tableFilter.keyType.title,"return-object":""},{selection:i(({item:a,index:c})=>[c===0?(r(),g("span",_e,p(a.title),1)):c<2?(r(),g("span",Se,", "+p(a.title),1)):c===2?(r(),g("span",we,", \u2026")):k("",!0)]),_:1},8,["modelValue","items","item-title"]),[[P,e.selectedProductClass&&e.selectedProductClass.name==="Auto"]])]),_:1})):k("",!0),s(V),s(C,{cols:"12",sm:"4",class:"text-right"},{default:i(()=>[s(le,{modelValue:e.search,"onUpdate:modelValue":t[4]||(t[4]=a=>e.search=a),class:"pr-4","append-inner-icon":"$search",label:"search","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1}))]),_:1}),s(_,{flat:""},{default:i(()=>[s(v,{class:"pointer",loading:e.loading,search:e.search,headers:e.selectedProductClass&&e.selectedProductClass.name==="Auto"?e.headers.Auto:e.headers.Keys,hover:"",items:l.selectedDesigns},{item:i(({item:a,props:c})=>[s(ne,q(c,{class:{"bg-meru-deprecated":a.deprecated},"cell-props":{height:"66"},onClick:f=>l.editDesign(a.designCode)}),{["item.firstSku"]:i(({item:f})=>[s(b,{sku:f.firstSku,"product-type":f.productClass,width:120,"max-height":50,class:"my-2"},null,8,["sku","product-type"])]),["item.name"]:i(({item:f})=>[h("a",{class:"font-weight-bold text-meru-anchor-link",onClick:t[5]||(t[5]=J(()=>{},["prevent"]))},p(f.name),1)]),["item.deprecated"]:i(({item:f})=>[f.deprecated?(r(),g("span",ve,"Deprecated")):k("",!0)]),_:2},1040,["class","onClick"])]),_:1},8,["loading","search","headers","items"])]),_:1}),s(U,{"existing-design-codes":l.allDesigns.map(a=>a.designCode),"product-classes":e.productClasses,"selected-product-class":e.selectedProductClass,"dialog-open":e.editDialogOpen,design:l.selectedDesign,"is-new":!e.selectedDesignCode,onUpdate:l.dialogClosed},null,8,["existing-design-codes","product-classes","selected-product-class","dialog-open","design","is-new","onUpdate"]),s(de,{modelValue:e.changesSheetOpen,"onUpdate:modelValue":t[7]||(t[7]=a=>e.changesSheetOpen=a),inset:"",scrollable:""},{default:i(()=>[s(_,{class:"pt-4"},{default:i(()=>[Te,Pe,s(oe,{class:"ma-4"}),s(K,{style:{"padding-bottom":"80px",overflow:"auto"}},{default:i(()=>[s(E,{class:"align-stretch"},{default:i(()=>[(r(!0),g(H,null,W(l.completeUncommittedDesigns,a=>(r(),D(C,{key:a.id,cols:"12",md:"6",lg:"4"},{default:i(()=>[s(_,{height:"100%"},{default:i(()=>[s(re,{class:"d-flex justify-space-between align-center"},{default:i(()=>[h("div",Ee,[m(p(a.designCode),1),Fe,h("b",null,p(a.name),1)]),s(b,{sku:a.firstSku,"product-type":a.productClass,"max-width":120,class:"my-2 mr-2",cover:""},null,8,["sku","product-type"])]),_:2},1024),s(ce,null,{default:i(()=>[s(ue,null,{activator:i(({props:c})=>[s(I,Q(X(c)),{default:i(()=>[m(p(a.id!==void 0?"Reset":"Delete"),1)]),_:2},1040)]),default:i(()=>[s(me,{density:"compact"},{default:i(()=>[s(pe,{onClick:c=>l.resetDesign(a.designCode)},{prepend:i(()=>[s(G,{size:"small",color:"warning"},{default:i(()=>[m(" $exclamationTriangle ")]),_:1})]),default:i(()=>[s(ge,null,{default:i(()=>[m(p(a.id!==void 0?"Reset Changes to":"Delete")+' "'+p(a.name)+'"',1)]),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024),s(V),s(O,{onClick:c=>l.editDesign(a.designCode)},{default:i(()=>[m(" View ")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),s(_,{flat:"",rounded:"0",color:"surface-light",height:"64",class:"d-flex align-center justify-end px-4 w-100 position-absolute bottom-0"},{default:i(()=>[s(I,{onClick:t[6]||(t[6]=a=>e.changesSheetOpen=!1)},{default:i(()=>[m(" Cancel ")]),_:1}),s(V),s(O,{loading:e.loading,onClick:l.commitDesignChanges},{default:i(()=>[m(" Commit ")]),_:1},8,["loading","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const lt=j(ye,[["render",Ie],["__scopeId","data-v-1e0b41d8"]]);export{lt as default};
