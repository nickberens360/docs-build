import x from"./MeruDataTable-jf3gvfqw.js";import{_ as j,b as d}from"./index-LK9MQE2L.js";import{c as L,m as M}from"./vuex-D3TwipD2.js";import R from"./DesignEditDialog-imTgrDFz.js";import z from"./ProductClassPicker-BdRrg4hV.js";import $ from"./ProductImage-CvO1b8Ha.js";import Y from"./DefaultLayout-DdfUBm6-.js";import{C as D,i,e as s,s as k,N as T,O as P,B as g,J as c,_ as y,b as h,H as p,p as N,E as H,g as J,F as W,A as r}from"./@vue-DNrUJgob.js";import{a6 as q,a2 as Q,b as G,a3 as X,d as I,x as _,w as C,i as V,a7 as Z,p as O,u as ee,aj as K,az as te,l as w,f as se,aw as ie,t as le,r as ne,W as ae,e as oe,V as de,a as re}from"./vuetify-BgnNF2O3.js";import{b as A,e as ue}from"./lodash-es-Bp4BxrA1.js";import"./date-fns-2ylUqVpG.js";import"./@babel-BTTPuEuv.js";import"./vue-component-docs-plugin-BnqcuvvC.js";import"./vue-router-BVOKdCCq.js";import"./axios-xsH4HHeE.js";import"./axios-cache-interceptor-DgAMPFM2.js";import"./cache-parser-DXYp_BCq.js";import"./fast-defer-9MI9za_P.js";import"./object-code-SBtdq8jY.js";import"./@fortawesome-BWcQmPY7.js";import"./@awesome.me-Btqfd-fw.js";import"./DesignHeader-GnzJqmd0.js";import"./DesignTranslationsTable-ChCKNKpo.js";import"./KeySkuTable-DxkWhcJJ.js";import"./ImageUploader-DHpKRUIg.js";import"./CurrencyInput-CGI9Mz8R.js";import"./vue-currency-input-D7Z-DvZH.js";import"./CarKeyInfo-JM3NJ4fD.js";const me=["KE","CK"],ce={components:{MeruDataTable:x,ProductImage:$,DesignEditDialog:R,ProductClassPicker:z,DefaultLayout:Y},data:()=>({designs:[],uncommittedDesigns:[],productClasses:{},loading:!0,selectedProductClass:void 0,selectedDesignCode:void 0,editDialogOpen:!1,changesSheetOpen:!1,search:"",tableFilter:{pricingGroup:[],deprecationStatus:{title:"Non-Deprecated",value:!1},keyType:[]},filterOptions:{pricingGroup:{K:[]},keyType:[]},headers:{Keys:[{title:"Design Code",key:"designCode",width:120},{title:"Preview",key:"firstSku",sortable:!1,width:120},{title:"Name",key:"name",width:290},{title:"Pricing Group",key:"pricingGroup.name",sortable:!1,width:250},{title:"Deprecated",key:"deprecated",sortable:!1,width:160,align:"center"}],Auto:[{title:"Design Code",key:"designCode",width:120},{title:"Preview",key:"firstSku",sortable:!1,width:120},{title:"Key Type",key:"keyType",sortable:!0,width:250},{title:"Deprecated",key:"deprecated",sortable:!1,width:160,align:"center"}]}}),computed:{...M({environment:"app/getEnvConfigs"}),allDesigns(){return[...this.designs,...this.uncommittedNew]},completeUncommittedDesigns(){const e=this.uncommittedExisting.map(t=>t.id);return[...this.uncommittedNew,...this.designs.filter(t=>e.includes(t.id))]},uncommittedNew(){return this.uncommittedDesigns.filter(e=>e.id===void 0)},uncommittedExisting(){return this.uncommittedDesigns.filter(e=>e.id!==void 0)},selectedDesigns(){return this.allDesigns.filter(e=>this.selectedProductClass.productClasses.includes(e.productClass)&&(this.tableFilter.deprecationStatus.value===null||this.tableFilter.deprecationStatus.value===e.deprecated)&&(this.selectedProductClass.name!=="Auto"||!this.tableFilter.keyType.length||this.tableFilter.keyType.includes(e.keyType))&&(this.selectedProductClass.name!=="Keys"||!this.tableFilter.pricingGroup.length||this.tableFilter.pricingGroup.findIndex(t=>e.pricingGroup&&e.pricingGroup.id===t.id)!==-1))},selectedDesign(){return this.selectedDesignCode&&this.allDesigns.find(e=>e.designCode===this.selectedDesignCode)}},created(){Promise.all([d.getProductClasses(),d.getAllDesigns(),d.getAllStagedDesignChanges()]).then(([e,t,o])=>{me.forEach(a=>this.productClasses[a]=e.data[a]),this.uncommittedDesigns=o.data,this.designs=t.data,this.uncommittedExisting.forEach(a=>this.updateExistingDesign(a))}).catch(e=>console.error(e)).finally(()=>{this.loading=!1}),d.getPricingGroupsByProductClass("KE").then(({data:e})=>this.filterOptions.pricingGroup=e),d.getCarKeyTypes().then(({data:e})=>this.filterOptions.keyType=e)},methods:{...L({updateSKUs:"inventory/updateSKUs"}),handleTabChange(e){this.selectedProductClass=e,this.search=""},resetFilter(e){this.tableFilter[e]=[]},resetDesign(e){const t=this.uncommittedDesigns.findIndex(n=>n.designCode===e),o=this.uncommittedDesigns[t].skus!==void 0?this.uncommittedDesigns[t].skus:[];this.uncommittedDesigns.splice(t,1);const a=this.designs.findIndex(n=>n.designCode===e),m=this.designs[a];m&&d.getDesign(m.id).then(({data:n})=>{var b;const S={...A(n,["id","pricingGroup","designCode","productClass"]),name:this.getDefaultDesignName(n),keyType:((b=n==null?void 0:n.carKeyDesign)==null?void 0:b.keyType)||void 0,firstSku:n.skus[0].sku,deprecated:n.skus.every(v=>v.deprecated)};this.designs.splice(a,1,S)}),d.stageDesign(this.uncommittedDesigns),o.length&&d.deleteStagedSkuImages(o.map(({sku:n})=>n)),this.uncommittedDesigns.length||(this.changesSheetOpen=!1)},mergeDesigns(e,t){return ue(e,t)},getDefaultDesignName(e){var t,o;return(o=(t=e==null?void 0:e.names)==null?void 0:t.find(a=>a.locale==="en"))==null?void 0:o.name},createDesign(){this.editDialogOpen=!0},async dialogClosed(e){if(e){const t=this.uncommittedDesigns.findIndex(o=>o.designCode===e.designCode);if(t===-1)this.uncommittedDesigns.push({...e});else{const o=(e.skus||[]).map(m=>m.sku),a=(this.uncommittedDesigns[t].skus||[]).map(m=>m.sku).filter(m=>!o.includes(m));a&&await d.deleteStagedSkuImages(a),this.uncommittedDesigns.splice(t,1,e)}this.updateExistingDesign(e),d.stageDesign(this.uncommittedDesigns,e).then(()=>{this.editDialogOpen=!1,this.selectedDesignCode=null})}else this.editDialogOpen=!1,this.selectedDesignCode=null},editDesign(e){if(this.changesSheetOpen){this.changesSheetOpen=!1,setTimeout(this.editDesign.bind(null,e),300);return}this.selectedDesignCode=e,this.editDialogOpen=!0},filterDesignsByType(e){return this.allDesigns.filter(t=>t.pricingGroup.type===e)},updateExistingDesign(e){const t=this.designs.findIndex(a=>a.id===e.id),o=this.designs[t];if(o){const a=e.names&&(e.names.find(n=>n.locale==="en")||{}).name;a&&(e.name=a);const m={...A(o,["designCode","name","pricingGroup","productClass"])};this.designs.splice(t,1,this.mergeDesigns(m,e))}},commitDesignChanges(){this.loading=!0;const e=()=>{this.$store.dispatch("app/setSnackbar",{message:"Failed to Update Catalog",color:"error"})},t=()=>{d.getAllDesigns().then(({data:a})=>this.designs=a),this.changesSheetOpen=!1,this.uncommittedDesigns=[],this.$store.dispatch("app/setSnackbar",{message:"Updated Catalog"})},o=()=>{this.updateSKUs([]),this.loading=!1};this.uncommittedExisting.length&&this.uncommittedNew.length?d.patchDesigns(this.uncommittedExisting).then(()=>{d.postDesigns(this.uncommittedNew,!0).then(t).catch(e).finally(o)}).catch(e):this.uncommittedExisting.length?d.patchDesigns(this.uncommittedExisting,!0).then(t).catch(e).finally(o):this.uncommittedNew.length&&d.postDesigns(this.uncommittedNew,!0).then(t).catch(e).finally(o)}}},pe={class:"d-flex align-center justify-space-between"},ge={key:0},he={key:1},fe={key:2},ye={key:0},Ce={key:1},De={key:2},ke={key:0},be={style:{"white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}};function Ve(e,t,o,a,m,n){const S=y("ProductClassPicker"),b=y("ProductImage"),v=y("MeruDataTable"),U=y("DesignEditDialog"),E=y("VBtnSecondary"),F=y("VBtnPrimary"),B=y("DefaultLayout");return r(),D(B,null,{default:i(()=>[s(K,{class:"pt-0"},{default:i(()=>[s(q,null,{default:i(()=>[T(s(Q,{variant:"tonal",color:"warning",class:"mb-4 w-100"},{prepend:i(()=>[s(X,null,{default:i(()=>[s(I,{class:"mr-4 mt-1",size:"large",color:"warning"},{default:i(()=>t[8]||(t[8]=[c(" $sync ")])),_:1,__:[8]})]),_:1})]),default:i(()=>[g("div",pe,[t[10]||(t[10]=g("div",{class:"my-2 flex-shrink-1"}," You have uncommitted changes ",-1)),s(G,{variant:"flat",color:"warning",class:"ml-4",onClick:t[0]||(t[0]=l=>e.changesSheetOpen=!e.changesSheetOpen)},{default:i(()=>t[9]||(t[9]=[c(" View ")])),_:1,__:[9]})])]),_:1},512),[[P,!!e.uncommittedDesigns.length]])]),_:1}),s(_,{class:"text-right pb-3"},{default:i(()=>[s(C,{cols:"6"},{default:i(()=>[s(S,{"show-only":["Keys","Auto"],class:"mt-4",onChange:n.handleTabChange},null,8,["onChange"])]),_:1}),s(V),s(C,null,{default:i(()=>[s(V),s(Z,null,{default:i(()=>[Object.keys(e.productClasses).length?T((r(),D(G,{key:0,color:"primary",onClick:n.createDesign},{default:i(()=>t[11]||(t[11]=[c(" New Design ")])),_:1,__:[11]},8,["onClick"])),[[P,e.selectedProductClass.name==="Keys"]]):k("",!0)]),_:1})]),_:1})]),_:1}),e.loading?k("",!0):(r(),D(_,{key:0,class:"pb-3"},{default:i(()=>[s(C,{cols:"12",sm:"3"},{default:i(()=>[s(O,{modelValue:e.tableFilter.deprecationStatus,"onUpdate:modelValue":t[1]||(t[1]=l=>e.tableFilter.deprecationStatus=l),class:"mr-4",label:"Deprecation Status","hide-details":"","return-object":"",items:[{title:"All",value:null},{title:"Non-Deprecated",value:!1},{title:"Deprecated",value:!0}]},null,8,["modelValue"])]),_:1}),e.selectedProductClass&&e.selectedProductClass.name==="Keys"?(r(),D(C,{key:0,cols:"12",sm:"4"},{default:i(()=>[s(O,{modelValue:e.tableFilter.pricingGroup,"onUpdate:modelValue":t[2]||(t[2]=l=>e.tableFilter.pricingGroup=l),class:"nowrap mr-4",multiple:"",label:"Pricing Group",clearable:"",placeholder:"All","hide-details":"",items:e.filterOptions.pricingGroup,"item-title":l=>l.name,"return-object":""},{selection:i(({item:l,index:u})=>[u===0?(r(),h("span",ge,p(l.title),1)):u<2?(r(),h("span",he,", "+p(l.title),1)):u===2?(r(),h("span",fe,", …")):k("",!0)]),_:1},8,["modelValue","items","item-title"])]),_:1})):e.selectedProductClass&&e.selectedProductClass.name==="Auto"?(r(),D(C,{key:1,cols:"12",sm:"4"},{default:i(()=>[T(s(O,{modelValue:e.tableFilter.keyType,"onUpdate:modelValue":t[3]||(t[3]=l=>e.tableFilter.keyType=l),class:"nowrap mr-4",multiple:"",label:"Key Type",clearable:"",placeholder:"All","hide-details":"",items:e.filterOptions.keyType,"item-title":e.tableFilter.keyType.title,"return-object":""},{selection:i(({item:l,index:u})=>[u===0?(r(),h("span",ye,p(l.title),1)):u<2?(r(),h("span",Ce,", "+p(l.title),1)):u===2?(r(),h("span",De,", …")):k("",!0)]),_:1},8,["modelValue","items","item-title"]),[[P,e.selectedProductClass&&e.selectedProductClass.name==="Auto"]])]),_:1})):k("",!0),s(V),s(C,{cols:"12",sm:"4",class:"text-right"},{default:i(()=>[s(ee,{modelValue:e.search,"onUpdate:modelValue":t[4]||(t[4]=l=>e.search=l),class:"pr-4","append-inner-icon":"$search",label:"search","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1}))]),_:1}),s(w,{flat:""},{default:i(()=>[s(v,{class:"pointer",loading:e.loading,search:e.search,headers:e.selectedProductClass&&e.selectedProductClass.name==="Auto"?e.headers.Auto:e.headers.Keys,hover:"",items:n.selectedDesigns},{item:i(({item:l,props:u})=>[s(te,N(u,{class:{"bg-meru-deprecated":l.deprecated},"cell-props":{height:"66"},onClick:f=>n.editDesign(l.designCode)}),{"item.firstSku":i(({item:f})=>[s(b,{sku:f.firstSku,"product-type":f.productClass,width:120,"max-height":50,class:"my-2"},null,8,["sku","product-type"])]),"item.name":i(({item:f})=>[g("a",{class:"font-weight-bold text-meru-anchor-link",onClick:t[5]||(t[5]=H(()=>{},["prevent"]))},p(f.name),1)]),"item.deprecated":i(({item:f})=>[f.deprecated?(r(),h("span",ke,"Deprecated")):k("",!0)]),_:2},1040,["class","onClick"])]),_:1},8,["loading","search","headers","items"])]),_:1}),s(U,{"existing-design-codes":n.allDesigns.map(l=>l.designCode),"product-classes":e.productClasses,"selected-product-class":e.selectedProductClass,"dialog-open":e.editDialogOpen,design:n.selectedDesign,"is-new":!e.selectedDesignCode,onUpdate:n.dialogClosed},null,8,["existing-design-codes","product-classes","selected-product-class","dialog-open","design","is-new","onUpdate"]),s(ie,{modelValue:e.changesSheetOpen,"onUpdate:modelValue":t[7]||(t[7]=l=>e.changesSheetOpen=l),inset:"",scrollable:""},{default:i(()=>[s(w,{class:"pt-4"},{default:i(()=>[t[17]||(t[17]=g("div",{class:"mx-4 text-h5"}," Uncommitted Changes ",-1)),t[18]||(t[18]=g("div",{class:"mx-4 text-body-2"}," Continue making changes, and then commit. ",-1)),s(se,{class:"ma-4"}),s(K,{style:{"padding-bottom":"80px",overflow:"auto"}},{default:i(()=>[s(_,{class:"align-stretch"},{default:i(()=>[(r(!0),h(W,null,J(n.completeUncommittedDesigns,l=>(r(),D(C,{key:l.id,cols:"12",md:"6",lg:"4"},{default:i(()=>[s(w,{height:"100%"},{default:i(()=>[s(le,{class:"d-flex justify-space-between align-center"},{default:i(()=>[g("div",be,[c(p(l.designCode),1),t[12]||(t[12]=g("br",null,null,-1)),g("b",null,p(l.name),1)]),s(b,{sku:l.firstSku,"product-type":l.productClass,"max-width":120,class:"my-2 mr-2",cover:""},null,8,["sku","product-type"])]),_:2},1024),s(ne,null,{default:i(()=>[s(ae,null,{activator:i(({props:u})=>[s(E,N({ref_for:!0},u),{default:i(()=>[c(p(l.id!==void 0?"Reset":"Delete"),1)]),_:2},1040)]),default:i(()=>[s(oe,{density:"compact"},{default:i(()=>[s(de,{onClick:u=>n.resetDesign(l.designCode)},{prepend:i(()=>[s(I,{size:"small",color:"warning"},{default:i(()=>t[13]||(t[13]=[c(" $exclamationTriangle ")])),_:1,__:[13]})]),default:i(()=>[s(re,null,{default:i(()=>[c(p(l.id!==void 0?"Reset Changes to":"Delete")+' "'+p(l.name)+'"',1)]),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024),s(V),s(F,{onClick:u=>n.editDesign(l.designCode)},{default:i(()=>t[14]||(t[14]=[c(" View ")])),_:2,__:[14]},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),s(w,{flat:"",rounded:"0",color:"surface-light",height:"64",class:"d-flex align-center justify-end px-4 w-100 position-absolute bottom-0"},{default:i(()=>[s(E,{onClick:t[6]||(t[6]=l=>e.changesSheetOpen=!1)},{default:i(()=>t[15]||(t[15]=[c(" Cancel ")])),_:1,__:[15]}),s(V),s(F,{loading:e.loading,onClick:n.commitDesignChanges},{default:i(()=>t[16]||(t[16]=[c(" Commit ")])),_:1,__:[16]},8,["loading","onClick"])]),_:1})]),_:1,__:[17,18]})]),_:1},8,["modelValue"])]),_:1})}const Qe=j(ce,[["render",Ve],["__scopeId","data-v-1e0b41d8"]]);export{Qe as default};
