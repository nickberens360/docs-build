import{o as R}from"./cache-parser.124ebbb8.js";import{e as W}from"./fast-defer.b34f24de.js";import{r as B}from"./object-code.c2755e43.js";var y={d:(e,t)=>{for(var a in t)y.o(t,a)&&!y.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},f={};y.d(f,{h4:()=>l,UN:()=>q,uu:()=>F,Kd:()=>b,ZF:()=>z,nv:()=>S,p:()=>D,E7:()=>L,NQ:()=>k,xK:()=>H,G6:()=>J,LN:()=>K,Bw:()=>x,Ad:()=>C,$k:()=>U,v8:()=>Z,Jk:()=>P,tI:()=>X,iS:()=>M});const N=(e=>{var t={};return y.d(t,e),t})({parse:()=>R}),l=Object.freeze({IfModifiedSince:"if-modified-since",LastModified:"last-modified",IfNoneMatch:"if-none-match",CacheControl:"cache-control",Pragma:"pragma",ETag:"etag",Expires:"expires",Age:"age",XAxiosCacheEtag:"x-axios-cache-etag",XAxiosCacheLastModified:"x-axios-cache-last-modified",XAxiosCacheStaleIfError:"x-axios-cache-stale-if-error"}),k=e=>{if(!e)return"not enough headers";const t=e[l.CacheControl];if(t){const{noCache:i,noStore:r,maxAge:o,maxStale:n,immutable:s,staleWhileRevalidate:c}=(0,N.parse)(String(t));if(i||r)return"dont cache";if(s)return{cache:31536e6};if(o!==void 0){const h=e[l.Age];return{cache:h?1e3*(o-Number(h)):1e3*o,stale:n!==void 0?1e3*n:c!==void 0?1e3*c:void 0}}}const a=e[l.Expires];if(a){const i=Date.parse(String(a))-Date.now();return i>=0?{cache:i}:"dont cache"}return"not enough headers"},G=(e=>{var t={};return y.d(t,e),t})({deferred:()=>W});function L(e){return e?t=>e(t)||t===304:t=>t>=200&&t<300||t===304}function C(e="get",t=[]){return e=e.toLowerCase(),t.some(a=>a===e)}function M(e,t){var a;t.headers||(t.headers={});const{etag:i,modifiedSince:r}=t.cache;if(i){const o=i===!0?(a=e.data)===null||a===void 0?void 0:a.headers[l.ETag]:i;o&&(t.headers[l.IfNoneMatch]=o)}r&&(t.headers[l.IfModifiedSince]=r===!0?e.data.headers[l.LastModified]||new Date(e.createdAt).toUTCString():r.toUTCString())}function D(e,t){return e.status===304&&t?(e.cached=!0,e.data=t.data,e.status=t.status,e.statusText=t.statusText,e.headers=Object.assign(Object.assign({},t.headers),e.headers),t):{data:e.data,status:e.status,statusText:e.statusText,headers:e.headers}}function J(e){const t=async a=>{var i,r,o,n,s,c,h,d,v,m,p,g,A,E,O;if(a.id=e.generateKey(a),a.cache===!1||(a.cache=Object.assign(Object.assign({},e.defaults.cache),a.cache),a.cache.cacheTakeover&&((i=(m=a.headers)[p=l.CacheControl])!==null&&i!==void 0||(m[p]="no-cache"),(r=(g=a.headers)[A=l.Pragma])!==null&&r!==void 0||(g[A]="no-cache"),(o=(E=a.headers)[O=l.Expires])!==null&&o!==void 0||(E[O]="0")),!C(a.method,a.cache.methods)))return a;let u=await e.storage.get(a.id,a);const I=a.cache.override;e:if(u.state==="empty"||u.state==="stale"||I){if(e.waiting[a.id]&&!I&&(u=await e.storage.get(a.id,a),u.state!=="empty"))break e;return e.waiting[a.id]=(0,G.deferred)(),e.waiting[a.id].catch(()=>{}),await e.storage.set(a.id,{state:"loading",previous:I?u.data?"stale":"empty":u.state,data:u.data,createdAt:I&&!u.createdAt?Date.now():u.createdAt},a),u.state==="stale"&&M(u,a),a.validateStatus=L(a.validateStatus),(u.state==="stale"||u.data)&&await((s=(n=a.cache).hydrate)===null||s===void 0?void 0:s.call(n,u)),a}let w;if(u.state==="loading"){const T=e.waiting[a.id];if(!T)return u.data&&await((h=(c=a.cache).hydrate)===null||h===void 0?void 0:h.call(c,u)),a;try{w=await T}catch{return u.data&&await((v=(d=a.cache).hydrate)===null||v===void 0?void 0:v.call(d,u)),t(a)}}else w=u.data;return a.adapter=function(){return Promise.resolve({config:a,data:w.data,headers:w.headers,status:w.status,statusText:w.statusText,cached:!0,id:a.id})},a};return{onFulfilled:t,apply:()=>e.interceptors.request.use(t)}}async function P(e,t){var a;if(typeof t=="function")return t(e);const{statusCheck:i,responseMatch:r,containsHeaders:o}=t;if(i&&!await i(e.status)||r&&!await r(e))return!1;if(o){for(const[n,s]of Object.entries(o))if(!await s((a=e.headers[n.toLowerCase()])!==null&&a!==void 0?a:e.headers[n]))return!1}return!0}async function X(e,t,a){if(typeof a=="function")return a(t);for(const[i,r]of Object.entries(a)){if(r==="delete"){await e.remove(i,t.config);continue}const o=await e.get(i,t.config);if(o.state==="loading")continue;const n=await r(o,t);n!=="delete"?n!=="ignore"&&await e.set(i,n,t.config):await e.remove(i,t.config)}}function K(e){const t=async(r,o)=>{var n;await e.storage.remove(r,o),(n=e.waiting[r])===null||n===void 0||n.reject(),delete e.waiting[r]},a=async r=>{var o;if(!(r!=null&&r.config))throw r;r.id=r.config.id,(o=r.cached)!==null&&o!==void 0||(r.cached=!1);const n=r.config,s=n.cache;if(r.cached)return r;if(!s)return r.cached=!1,r;if(s.update&&await X(e.storage,r,s.update),!C(n.method,s.methods))return r;const c=await e.storage.get(r.id,n);if(c.state!=="loading")return r;if(!c.data&&!await P(r,s.cachePredicate))return await t(r.id,n),r;for(const g of Object.keys(r.headers))g.startsWith("x-axios-cache")&&delete r.headers[g];s.etag&&s.etag!==!0&&(r.headers[l.XAxiosCacheEtag]=s.etag),s.modifiedSince&&(r.headers[l.XAxiosCacheLastModified]=s.modifiedSince===!0?"use-cache-timestamp":s.modifiedSince.toUTCString());let h,d=s.ttl||-1;if(s.interpretHeader){const g=e.headerInterpreter(r.headers);if(g==="dont cache")return await t(r.id,n),r;g!=="not enough headers"&&(typeof g=="number"?d=g:(d=g.cache,h=g.stale))}const v=D(r,c.data);typeof d=="function"&&(d=await d(r)),s.staleIfError&&(r.headers[l.XAxiosCacheStaleIfError]=String(d));const m={state:"cached",ttl:d,staleTtl:h,createdAt:Date.now(),data:v},p=e.waiting[r.id];return p&&(p.resolve(m.data),delete e.waiting[r.id]),await e.storage.set(r.id,m,n),r},i=async r=>{var o;if(!r.isAxiosError)throw r;const n=r.config,s=n.id,c=n.cache,h=r.response;if(!c||!s||!C(n.method,c.methods))throw r;const d=await e.storage.get(s,n);if(d.state!=="loading"||d.previous!=="stale")throw await t(s,n),r;if(c.staleIfError){const v=String(h==null?void 0:h.headers[l.CacheControl]),m=v&&(0,N.parse)(v).staleIfError,p=typeof c.staleIfError=="function"?await c.staleIfError(h,d,r):c.staleIfError===!0&&m?1e3*m:c.staleIfError;if(p===!0||typeof p=="number"&&d.createdAt+p>Date.now())return(o=e.waiting[s])===null||o===void 0||o.resolve(d.data),delete e.waiting[s],await e.storage.set(s,{state:"stale",createdAt:Date.now(),data:d.data},n),{cached:!0,config:n,id:s,data:d.data.data,headers:d.data.headers,status:d.data.status,statusText:d.data.statusText}}throw r};return{onFulfilled:a,onRejected:i,apply:()=>e.interceptors.response.use(a,i)}}const U=e=>!!e&&!!e["is-storage"];function $(e){const t=e.data.headers;return l.ETag in t||l.LastModified in t||l.XAxiosCacheEtag in t||l.XAxiosCacheLastModified in t}function S(e){return!String(e.data.headers[l.CacheControl]).includes("must-revalidate")&&(!!$(e)||e.state==="cached"&&e.staleTtl!==void 0&&Math.abs(Date.now()-(e.createdAt+e.ttl))<=e.staleTtl)}function x(e){return e.ttl!==void 0&&e.createdAt+e.ttl<=Date.now()}function b({set:e,find:t,remove:a}){return{"is-storage":1,set:e,remove:a,get:async(i,r)=>{let o=await t(i,r);if(!o)return{state:"empty"};if(o.state==="empty"||o.state==="loading")return o;if(o.state==="cached"){if(!x(o))return o;if(!S(o))return await a(i,r),{state:"empty"};o={state:"stale",createdAt:o.createdAt,data:o.data,ttl:o.staleTtl!==void 0?o.staleTtl+o.ttl:void 0},await e(i,o,r)}return x(o)?$(o)?o:(await a(i,r),{state:"empty"}):o}}}function F(e=!1,t=!1,a=!1){const i=b({set:(r,o)=>{if(a){let n=Object.keys(i.data);if(n.length>=a)for(i.cleanup(),n=Object.keys(i.data);n.length>=a;)delete i.data[n.shift()]}i.data[r]=e==="double"?typeof structuredClone=="function"?structuredClone(o):JSON.parse(JSON.stringify(o)):o},remove:r=>{delete i.data[r]},find:r=>{const o=i.data[r];return e&&o!==void 0?typeof structuredClone=="function"?structuredClone(o):JSON.parse(JSON.stringify(o)):o}});return i.data=Object.create(null),i.cleanup=()=>{const r=Object.keys(i.data);let o,n,s=-1;for(;++s<r.length;)n=r[s],o=i.data[n],o.state!=="empty"?o.state==="cached"&&x(o)&&!S(o)&&i.remove(n):i.remove(n)},t&&(i.cleaner=setInterval(i.cleanup,t)),i}const Q=(e=>{var t={};return y.d(t,e),t})({hash:()=>B}),j=/^\/|\/$/g;function q(e){return t=>{if(t.id)return t.id;const a=e(t);return typeof a=="string"||typeof a=="number"?`${a}`:`${(0,Q.hash)(a)}`}}const H=q(({baseURL:e="",url:t="",method:a="get",params:i,data:r})=>(e&&(e=e.replace(j,"")),t&&(t=t.replace(j,"")),a&&(a=a.toLowerCase()),{url:e+(e&&t?"/":"")+t,params:i,method:a,data:r}));function Z(e,t={}){var a,i,r,o,n,s;const c=e;if(c.defaults.cache)throw new Error("setupCache() should be called only once");if(c.storage=t.storage||F(),!U(c.storage))throw new Error("Use buildStorage() function");return c.waiting=t.waiting||{},c.generateKey=t.generateKey||H,c.headerInterpreter=t.headerInterpreter||k,c.requestInterceptor=t.requestInterceptor||J(c),c.responseInterceptor=t.responseInterceptor||K(c),c.debug=t.debug,c.defaults.cache={update:t.update||{},ttl:(a=t.ttl)!==null&&a!==void 0?a:3e5,methods:t.methods||["get","head"],cachePredicate:t.cachePredicate||{statusCheck:h=>[200,203,300,301,302,404,405,410,414,501].includes(h)},etag:(i=t.etag)===null||i===void 0||i,modifiedSince:(r=t.modifiedSince)!==null&&r!==void 0?r:t.etag===!1,interpretHeader:(o=t.interpretHeader)===null||o===void 0||o,cacheTakeover:(n=t.cacheTakeover)===null||n===void 0||n,staleIfError:(s=t.staleIfError)===null||s===void 0||s,override:!1,hydrate:void 0},c.requestInterceptor.apply(),c.responseInterceptor.apply(),c}function z(e,t="axios-cache-"){return b({find:a=>{const i=e.getItem(t+a);return i?JSON.parse(i):void 0},remove:a=>{e.removeItem(t+a)},set:(a,i)=>{const r=()=>e.setItem(t+a,JSON.stringify(i));try{return r()}catch{const n=Object.entries(e).filter(s=>s[0].startsWith(t)).map(s=>[s[0],JSON.parse(s[1])]);for(const s of n)s[1].state==="cached"&&x(s[1])&&!S(s[1])&&e.removeItem(s[0]);try{return r()}catch{const c=n.sort((h,d)=>(h[1].createdAt||0)-(d[1].createdAt||0));for(const h of c){e.removeItem(h[0]);try{return r()}catch{}}}e.removeItem(t+a)}}})}f.h4;f.UN;f.uu;f.Kd;f.ZF;f.nv;f.p;f.E7;f.NQ;f.xK;f.G6;f.LN;f.Bw;f.Ad;f.$k;var te=f.v8;f.Jk;f.tI;f.iS;export{te as F};
