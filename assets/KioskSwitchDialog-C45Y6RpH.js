import{b as _,a as C}from"./vuex-BwOdvJvI.js";import{C as m,i as s,e as t,J as n,b as k,g as S,F as x,E as F,D as I,s as h,H as T,_ as K,p as U,A as d}from"./@vue-mGKKYCuj.js";import{_ as M}from"./index-AG15HfzG.js";import{m as B,R as A,S as g,f as c,t as N,a5 as O,a6 as y,F as P,Z as V,n as D,x as f,w as p,u as R,b,r as X,l as E,d as J,k as W}from"./vuetify-BymGJ7fC.js";import"./date-fns-Cq_iz7V_.js";import"./@babel-BTTPuEuv.js";import"./vue-component-docs-plugin-CX_tIU2Y.js";import"./vue-router-CgUA7A7W.js";import"./axios-xsH4HHeE.js";import"./axios-cache-interceptor-DgAMPFM2.js";import"./cache-parser-DXYp_BCq.js";import"./fast-defer-9MI9za_P.js";import"./object-code-SBtdq8jY.js";import"./@fortawesome-C0fAH5tI.js";import"./@awesome.me-Btqfd-fw.js";const Z={props:{tagMachinesOnly:{type:Boolean,default:!1},disableAutoOpen:{type:Boolean,default:!1}},data(){return{selectedKiosk:"",dialog:!1,tab:null,kioskId:"",valid:!1,notFound:!1,validMachineTypes:["PX","ID","FS","FJ","TX","KX","QZ","PS"],warningMessages:{notFound:"Kiosk not found, review the serial number and try again.",notAllowed:"Kiosk type not allowed"},message:""}},computed:{...C("kiosk",["userKiosks","loading"]),color(){return!this.disableAutoOpen&&Object.keys(this.selectedKiosk).length===0?"error":"primary-lighten-2"},filteredUserKiosks(){let i=this.tagMachinesOnly?this.userKiosks.filter(e=>this.validMachineTypes.indexOf(e.machineType)>-1):this.userKiosks;return i.sort(function(e,l){var r=e.serialNumber.toUpperCase(),o=l.serialNumber.toUpperCase();return r<o?-1:r>o?1:0}),i},hasKiosk(){return this.filteredUserKiosks.length>0}},watch:{selectedKiosk:function(i){this.setSelectedKiosk(i),this.dialog=!1;const e=this.$route.params.kiosk,l=this.$route.path,o=(e?l.replace(/\/[^/]*$/,""):l)+"/"+i.serialNumber;o!=l&&this.$router.push({path:o})},$route(i){const e=i.params.kiosk;e!=this.selectedKiosk.serialNumber&&this.loadKiosk(e)},dialog:function(){this.dialog==!1&&(this.valid=!0,this.tab=0,this.kioskId="",this.notFound=!1)}},beforeMount(){const i=this.$route.params.kiosk;i&&this.loadKiosk(i)},mounted(){!!!this.$route.params.kiosk&&!this.disableAutoOpen&&(this.dialog=!0)},methods:{..._("kiosk",["setCurrentSelectedKioskCC"]),setSelectedKiosk(i){this.setCurrentSelectedKioskCC(i)},async loadKiosk(i){let l=(await this.userKiosksPromise()).find(r=>r.serialNumber==i);if(l)this.selectedKiosk=l;else{let r;try{r=await this.fetchKiosk(i),r&&(this.selectedKiosk=r.data)}catch{this.dialog=!0,this.message=this.warningMessages.notFound,this.notFound=!0,this.tab=1,this.kioskId=this.$route.params.kiosk}}},async fetchKiosk(i){return await this.$store.dispatch("kiosk/loadOtherKiosk",{serialNumber:i})},userKiosksPromise(){return this.userKiosks.length>0?Promise.resolve(this.userKiosks):new Promise(i=>{const e=this.$watch("userKiosks",l=>{i(l),e()})})},async getKioskById(){const i=await this.$refs.form.validate();if(this.valid&&i.valid){let e;try{e=await this.fetchKiosk(this.kioskId)}catch{this.message=this.warningMessages.notFound,this.notFound=!0}e&&(!this.tagMachinesOnly||this.validMachineTypes.indexOf(e.data.machineType)>-1?(this.selectedKiosk=e.data,this.valid=!0,this.tab=0,this.kioskId=""):(this.notFound=!0,this.message=this.warningMessages.notAllowed))}}}},j={key:0},q={key:1};function z(i,e,l,r,o,u){const v=K("VRadioSmall"),w=K("VBtnSecondary");return d(),m(W,{modelValue:o.dialog,"onUpdate:modelValue":e[7]||(e[7]=a=>o.dialog=a),scrollable:"","max-width":"400px"},{activator:s(({props:a})=>[t(b,U({variant:"text",color:u.color,class:"ml-2"},a),{default:s(()=>[t(J,{size:"small",start:""},{default:s(()=>e[8]||(e[8]=[n(" $vuetify.icons.exchange ")])),_:1,__:[8]}),i.$vuetify.display.smAndUp?(d(),k("span",j,"Select Kiosk")):h("",!0)]),_:2},1040,["color"])]),default:s(()=>[t(E,null,{default:s(()=>[t(B,null,{default:s(()=>e[9]||(e[9]=[n("Select Kiosk")])),_:1,__:[9]}),t(A,{modelValue:o.tab,"onUpdate:modelValue":e[0]||(e[0]=a=>o.tab=a),color:"primary",class:"text-primary-darken-3","show-arrows":""},{default:s(()=>[t(g,{key:"mine"},{default:s(()=>e[10]||(e[10]=[n(" My Kiosk ")])),_:1,__:[10]}),t(g,{key:"other"},{default:s(()=>e[11]||(e[11]=[n(" Other Kiosks ")])),_:1,__:[11]})]),_:1},8,["modelValue"]),t(c),t(N,{style:{height:"300px"},class:"mb-3"},{default:s(()=>[t(O,{modelValue:o.tab,"onUpdate:modelValue":e[5]||(e[5]=a=>o.tab=a)},{default:s(()=>[t(y,null,{default:s(()=>[u.hasKiosk?(d(),m(P,{key:0,modelValue:o.selectedKiosk,"onUpdate:modelValue":e[1]||(e[1]=a=>o.selectedKiosk=a),inline:!1},{default:s(()=>[(d(!0),k(x,null,S(u.filteredUserKiosks,a=>(d(),m(v,{key:a.id,label:a.serialNumber,value:a},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):(d(),k("div",q,[t(V,{type:"error",icon:"$vuetify.icons.exclamationTriangle",variant:"outlined",border:"start",align:"center"},{default:s(()=>e[12]||(e[12]=[n(" You don't have any assigned kiosks ")])),_:1,__:[12]})]))]),_:1}),t(y,null,{default:s(()=>[t(D,{ref:"form",modelValue:o.valid,"onUpdate:modelValue":e[3]||(e[3]=a=>o.valid=a),onSubmit:e[4]||(e[4]=F(()=>{},["prevent"]))},{default:s(()=>[t(f,null,{default:s(()=>[t(p,null,{default:s(()=>[t(R,{modelValue:o.kioskId,"onUpdate:modelValue":e[2]||(e[2]=a=>o.kioskId=a),label:"Kiosk Serial Number",rules:[a=>!!a.toString()||"Required"],onKeypress:I(u.getKioskById,["enter"])},null,8,["modelValue","rules","onKeypress"])]),_:1})]),_:1}),t(f,null,{default:s(()=>[t(p,{align:"center"},{default:s(()=>[t(b,{color:"primary",onClick:u.getKioskById},{default:s(()=>e[13]||(e[13]=[n(" find ")])),_:1,__:[13]},8,["onClick"])]),_:1})]),_:1}),t(f,null,{default:s(()=>[t(p,null,{default:s(()=>[o.notFound?(d(),m(V,{key:0,type:"warning",icon:"$vuetify.icons.exclamationTriangle",variant:"outlined",border:"start",align:"center"},{default:s(()=>[n(T(o.message),1)]),_:1})):h("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(c),t(X,{class:"align-self-center"},{default:s(()=>[t(w,{onClick:e[6]||(e[6]=a=>o.dialog=!1)},{default:s(()=>e[14]||(e[14]=[n(" Cancel ")])),_:1,__:[14]})]),_:1})]),_:1})]),_:1},8,["modelValue"])}const de=M(Z,[["render",z]]);export{de as default};
