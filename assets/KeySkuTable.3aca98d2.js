import x from"./MeruDataTable.80a372ee.js";import{a as z}from"./vuex.0eb68a2c.js";import{s as j,r as F,k as L,b as G,_ as W}from"./index.8a58b007.js";import H from"./ImageUploader.2bd27848.js";import J from"./CurrencyInput.68661cc8.js";import O from"./ProductImage.3e5aeb25.js";import{S as k,e as n,f as u,g as l,k as t,J as d,z as m,E as r,I as f,m as S,p as C,x as g,B as $,G as U,j as D,s as X,L as Y,M as Z}from"./@vue.ee679632.js";import{U as M,T as ee,d as h,s as V,c as y,u as w,n as B,q as Q,k as te,t as ae,aj as le,x as T,w as c,l as se,p as ie,i as oe,r as de,v as K}from"./vuetify.65d833ec.js";import"./date-fns.d38e1d55.js";import"./vue-atomic-docs.4f3653eb.js";import"./vue-router.ec64e966.js";import"./axios.eca6faa7.js";import"./axios-cache-interceptor.0956cad0.js";import"./cache-parser.124ebbb8.js";import"./fast-defer.b34f24de.js";import"./object-code.c2755e43.js";import"./@fortawesome.2cecc5e3.js";import"./@awesome.me.7dae7d79.js";import"./vue-currency-input.92e6c86a.js";const ne={components:{MeruDataTable:x,ProductImage:O,ImageUploader:H,CurrencyInput:J},props:{loading:Boolean,design:{type:Object,default:()=>({})},machineTypes:{type:Array,default:()=>[]}},emits:["reset-sku-image","new-image","add-sku","delete-sku","toggle-deprecation-status"],data:()=>({lazyKeyImage:new URL("/assets/KE.13180650.png",self.location).href,showDialog:!1,tabIdx:void 0,formIsValid:void 0,replaceImageSku:null,newSku:{sku:"",primaryQty:"",secondaryQty:"",imgData:"",compatibleMachines:[],standardCost:null},skuValidationErrors:[],hasBeenValidated:!1,test:void 0}),computed:{...z({environment:"app/getEnvConfigs"}),activeSkus(){return this.design.skus&&this.design.skus.filter(a=>!a.deprecated)||[]},deprecatedSkus(){return this.design.skus&&this.design.skus.filter(a=>a.deprecated)||[]},skuValidationRules(){return j(this.design.designCode)}},watch:{showDialog(a){a&&this.design.skus.length&&(this.newSku.compatibleMachines=this.design.skus[this.design.skus.length-1].compatibleMachines)}},methods:{required:F,selectAll(a,s=!0){s&&a.target.select()},validate(){return this.hasBeenValidated=!0,this.design.skus.length>0},isBarcode(a){return a.substr(3,2)==="BC"},getKeyway(a){return L[a.substr(1,2)]},resetSkuImage(a){this.$emit("reset-sku-image",a)},replaceImageInline(a){this.replaceImageSku=a,this.$refs.upload.click()},onNewImage(a){this.$emit("new-image",{file:a,sku:this.replaceImageSku}),this.replaceImageSku=null},cancelAddSku(){this.showDialog=!1,this.$refs.form.reset(),this.$refs.uploader.reset()},async addSku(a){a.target.blur();const s=await this.$refs.uploader.validate();if(!(this.formIsValid&&s))return;this.showDialog=!1;const{compatibleMachines:p,standardCost:I}=this.newSku,v={sku:this.newSku.sku.toUpperCase(),compatibleMachines:p,standardCost:I,imgData:this.newSku.imgData,designId:this.design.id,primaryQty:this.newSku.primaryQty,secondaryQty:this.newSku.secondaryQty};this.$emit("add-sku",v),this.$refs.form.reset(),this.$refs.uploader.reset(),this.tabIdx=0},deleteSku(a){this.$emit("delete-sku",a)},positiveInteger(a){return!a||/^\d+$/.test(a)||"must be a positive integer"},validateSkuUnique(a){a&&a.length===15?G.checkSkuExistence(this.newSku.sku).then(({data:s})=>{this.skuValidationErrors=s.exists?["sku already exists"]:[]}):this.skuValidationErrors=[]}}},re={style:{position:"relative"}},ue={key:0,class:"d-flex justify-end"},me=r("span",null,"Barcode: inferred from sku",-1),ce=r("span",null,"Keyway: inferred from sku",-1),pe={key:1},ke={key:0},fe={class:"d-flex align-center justify-space-between"},ge=r("span",null,"Replace Image",-1),ye=r("span",null,"Reset Sku",-1),he=r("span",null,"Delete Sku",-1),Ve={key:0,class:"text-center text-caption text-error"},we={key:0};function be(a,s,p,I,v,o){const _=k("CurrencyInput"),A=k("ProductImage"),N=k("MeruDataTable"),q=k("ImageUploader"),P=k("VBtnSecondary"),R=k("VBtnPrimary");return n(),u("div",re,[l(ee,{modelValue:a.tabIdx,"onUpdate:modelValue":s[0]||(s[0]=e=>a.tabIdx=e),"show-arrows":"","mobile-breakpoint":1},{default:t(()=>[l(M,null,{default:t(()=>[d("Active SKUs")]),_:1}),l(M,null,{default:t(()=>[d("Deprecated SKUs")]),_:1})]),_:1},8,["modelValue"]),a.tabIdx===0?(n(),u("div",ue,[l(h,{color:"primary",onClick:s[1]||(s[1]=e=>a.showDialog=!0)},{default:t(()=>[d(" Add Sku ")]),_:1})])):m("",!0),l(N,{"no-data-text":`No ${["Active","Deprecated"][a.tabIdx]} SKUs`,loading:p.loading,"disable-pagination":"","hide-default-footer":"","disable-sort":"",headers:[{title:"SKU",key:"sku",minWidth:200},{title:"Std Cost",key:"standardCost",width:150},{title:"BC",key:"bc"},{title:"Primary",key:"primary",width:50},{title:"Secondary",key:"secondary",width:50},{title:"Image",key:"image"},{title:"Keyway",key:"keyway"},{title:"Compatible Machines",key:"compatibleMachines",minWidth:150},{title:"Actions",key:"actions"}],items:[o.activeSkus,o.deprecatedSkus][a.tabIdx]},{["column.bc"]:t(({column:e})=>[l(V,{location:"top"},{activator:t(({props:i})=>[r("span",S(C(i)),[d(f(e.title),1),l(y,{size:"small",class:"ml-1 text-primary-lighten-3",style:{position:"relative",bottom:"1px"}},{default:t(()=>[d("$questionCircle")]),_:1})],16)]),default:t(()=>[me]),_:2},1024)]),["column.keyway"]:t(({column:e})=>[l(V,{location:"top"},{activator:t(({props:i})=>[r("span",S(C(i)),[d(f(e.title),1),l(y,{size:"small",class:"ml-1 text-primary-lighten-3",style:{position:"relative",bottom:"1px"}},{default:t(()=>[d("$questionCircle")]),_:1})],16)]),default:t(()=>[ce]),_:2},1024)]),["item.standardCost"]:t(({item:e})=>[l(_,{modelValue:e.standardCost,"onUpdate:modelValue":i=>e.standardCost=i,modelModifiers:{lazy:!0},options:{allowNegative:!1,precision:4},placeholder:"none",onFocus:o.selectAll},null,8,["modelValue","onUpdate:modelValue","onFocus"])]),["item.bc"]:t(({item:e})=>[o.isBarcode(e.sku)?(n(),g(y,{key:0,style:{"vertical-align":"bottom"}},{default:t(()=>[d(" $vuetify.icons.barcode ")]),_:1})):(n(),u("span",pe,"N/A"))]),["item.primary"]:t(({item:e})=>[l(w,{modelValue:e.primaryQty,"onUpdate:modelValue":i=>e.primaryQty=i,rules:[o.required,o.positiveInteger]},null,8,["modelValue","onUpdate:modelValue","rules"])]),["item.secondary"]:t(({item:e})=>[l(w,{modelValue:e.secondaryQty,"onUpdate:modelValue":i=>e.secondaryQty=i,rules:[o.positiveInteger]},null,8,["modelValue","onUpdate:modelValue","rules"])]),["item.image"]:t(({item:e})=>[l(A,{src:e.imgData&&e.imgData.previewURL||a.environment.skuImageBaseUrl+(e.imgData?"tmp/":"")+e.sku+"?"+e.imageHash,"product-type":e.productClass,width:"190px",height:"80px",class:"my-2"},null,8,["src","product-type"])]),["item.keyway"]:t(({item:e})=>[r("span",{class:$(o.getKeyway(e.sku)?"":"text-error font-weight-bold")},f(o.getKeyway(e.sku)||"Unknown"),3)]),["item.compatibleMachines"]:t(({item:e})=>[l(B,{modelValue:e.compatibleMachines,"onUpdate:modelValue":i=>e.compatibleMachines=i,class:"my-2",variant:"outlined",multiple:"","hide-details":"",items:p.machineTypes,"item-title":i=>i.desc,"item-value":i=>i.code},{selection:t(({index:i})=>[i===0?(n(),u("span",ke,[(n(!0),u(U,null,D([...e.compatibleMachines].sort(),(b,E)=>(n(),g(K,{key:E},{default:t(()=>[d(f(b),1)]),_:2},1024))),128))])):m("",!0)]),_:2},1032,["modelValue","onUpdate:modelValue","items","item-title","item-value"])]),["item.actions"]:t(({item:e})=>[r("div",fe,[l(V,{location:"bottom"},{activator:t(({props:i})=>[l(h,{icon:"",onClick:b=>o.replaceImageInline(e.sku)},{default:t(()=>[l(y,S(C(i)),{default:t(()=>[d(" $image ")]),_:2},1040)]),_:2},1032,["onClick"])]),default:t(()=>[ge]),_:2},1024),e.imgData&&e.skuId!==void 0?(n(),g(V,{key:0,location:"bottom"},{activator:t(({props:i})=>[l(h,{icon:"",onClick:b=>o.resetSkuImage(e.sku)},{default:t(()=>[l(y,S(C(i)),{default:t(()=>[d(" $undo ")]),_:2},1040)]),_:2},1032,["onClick"])]),default:t(()=>[ye]),_:2},1024)):m("",!0),e.skuId===void 0?(n(),g(V,{key:1,location:"bottom"},{activator:t(({props:i})=>[l(h,X(i,{icon:"",onClick:b=>o.deleteSku(e)}),{default:t(()=>[l(y,null,{default:t(()=>[d("$trash")]),_:1})]),_:2},1040,["onClick"])]),default:t(()=>[he]),_:2},1024)):m("",!0),e.skuId!==void 0?(n(),g(h,{key:2,variant:"outlined",onClick:i=>a.$emit("toggle-deprecation-status",e)},{default:t(()=>[d(f(e.deprecated?"Restore":"Deprecate"),1)]),_:2},1032,["onClick"])):m("",!0)])]),footer:t(()=>[a.hasBeenValidated&&!p.design.skus.length?(n(),u("div",Ve," must be at least one SKU ")):m("",!0)]),_:2},1032,["no-data-text","loading","items"]),l(de,{modelValue:a.showDialog,"onUpdate:modelValue":s[9]||(s[9]=e=>a.showDialog=e)},{default:t(()=>[l(Q,{flat:"",rounded:"0",color:"surface-light"},{default:t(()=>[l(te,null,{default:t(()=>[d("Add a Sku")]),_:1}),l(ae,null,{default:t(()=>[l(Q,{flat:"",color:"surface"},{default:t(()=>[l(le,null,{default:t(()=>[l(T,{class:"align-stretch"},{default:t(()=>[l(c,{cols:"12",sm:"6"},{default:t(()=>[l(se,{ref:"form",modelValue:a.formIsValid,"onUpdate:modelValue":s[7]||(s[7]=e=>a.formIsValid=e)},{default:t(()=>[l(T,null,{default:t(()=>[l(c,{cols:"12"},{default:t(()=>[l(w,{modelValue:a.newSku.sku,"onUpdate:modelValue":[s[2]||(s[2]=e=>a.newSku.sku=e),o.validateSkuUnique],class:"text-uppercase",autofocus:"",label:"New SKU",rules:[o.required,...o.skuValidationRules],"error-messages":a.skuValidationErrors,counter:15},null,8,["modelValue","rules","error-messages","onUpdate:modelValue"])]),_:1}),l(c,{cols:"6"},{default:t(()=>[l(w,{modelValue:a.newSku.primaryQty,"onUpdate:modelValue":s[3]||(s[3]=e=>a.newSku.primaryQty=e),modelModifiers:{number:!0},type:"number",label:"Primary Qty",rules:[o.required,o.positiveInteger]},null,8,["modelValue","rules"])]),_:1}),l(c,{cols:"6"},{default:t(()=>[l(w,{modelValue:a.newSku.secondaryQty,"onUpdate:modelValue":s[4]||(s[4]=e=>a.newSku.secondaryQty=e),modelModifiers:{number:!0},type:"number",label:"Secondary Qty",rules:[o.positiveInteger]},null,8,["modelValue","rules"])]),_:1}),l(c,{cols:"6"},{default:t(()=>[l(B,{modelValue:a.newSku.compatibleMachines,"onUpdate:modelValue":s[5]||(s[5]=e=>a.newSku.compatibleMachines=e),multiple:"","hide-details":"",label:"Compatible Machines",items:p.machineTypes,"item-title":e=>e.desc,"item-value":e=>e.code},{selection:t(({index:e})=>[e===0?(n(),u("span",we,[(n(!0),u(U,null,D([...a.newSku.compatibleMachines].sort(),i=>(n(),g(K,{key:i},{default:t(()=>[d(f(i),1)]),_:2},1024))),128))])):m("",!0)]),_:1},8,["modelValue","items","item-title","item-value"])]),_:1}),l(c,{cols:"6"},{default:t(()=>[l(_,{modelValue:a.newSku.standardCost,"onUpdate:modelValue":s[6]||(s[6]=e=>a.newSku.standardCost=e),modelModifiers:{lazy:!0},options:{allowNegative:!1,precision:4},label:"Standard Cost",placeholder:"none","hide-details":"",onFocus:o.selectAll},null,8,["modelValue","onFocus"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(c,{cols:"12",sm:"6"},{default:t(()=>[l(q,{ref:"uploader",rules:[o.required],accept:"image/jpeg,image/png",height:"150",width:"380",onNewImage:s[8]||(s[8]=e=>a.newSku.imgData=e)},null,8,["rules"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l(ie,{class:"pb-4 pt-0 px-4"},{default:t(()=>[l(P,{onClick:o.cancelAddSku},{default:t(()=>[d(" Cancel ")]),_:1},8,["onClick"]),l(oe),l(R,{disabled:!a.formIsValid,class:"ml-2",light:"",onClick:o.addSku},{default:t(()=>[d(" Add ")]),_:1},8,["disabled","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),Y(r("input",{ref:"upload",accept:"image/jpeg,image/png",type:"file",onChange:s[10]||(s[10]=e=>o.onNewImage(e.target.files[0]))},null,544),[[Z,!1]])])}const ze=W(ne,[["render",be]]);export{ze as default};
