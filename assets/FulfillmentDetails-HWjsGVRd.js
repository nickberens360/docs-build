import{_ as le,E as ne,F as ae,D as oe,n as de,G,j as me,r as ue}from"./index-LK9MQE2L.js";import ce from"./CompleteServiceForm--Q5d7X13.js";import fe from"./MarkAsForm-DDbkyxos.js";import pe from"./PrintPickLabel-D0hzfgH7.js";import ye from"./TransponderInfo-4slC5Blh.js";import{m as ge}from"./vuex-D3TwipD2.js";import ke from"./DetailsHeader-B_x98Ur9.js";import he from"./ExceptionForm-C_mj-RQh.js";import ve from"./OrderItemsPreview-BcnShyfq.js";import Se from"./CommentBox-DKHcTYPh.js";import _e from"./LabelledValue-Dt6irdcv.js";import be from"./ScanImageLink-CJ6p7w2L.js";import Ce from"./FullScreenLayout-C65u71bY.js";import Ie from"./ScanGraphHomeKey-Diw3bVcH.js";import Oe from"./ScanGraphCarKey-Dp1FTbBp.js";import{a1 as Fe,w as c,x as v,A as H,X as xe,n as Ve,u as Ae,d as Ke,ay as I,i as Pe,b as Me,ar as Ee}from"./vuetify-BgnNF2O3.js";import{m as Te,I as we}from"./date-fns-2ylUqVpG.js";import{C as d,i as s,B as g,b,s as m,e as t,_ as o,J as k,H as U,F as De,g as Le,A as a}from"./@vue-DNrUJgob.js";import"./vue-component-docs-plugin-BnqcuvvC.js";import"./vue-router-BVOKdCCq.js";import"./axios-xsH4HHeE.js";import"./axios-cache-interceptor-DgAMPFM2.js";import"./cache-parser-DXYp_BCq.js";import"./fast-defer-9MI9za_P.js";import"./object-code-SBtdq8jY.js";import"./@fortawesome-BWcQmPY7.js";import"./@awesome.me-Btqfd-fw.js";import"./@babel-BTTPuEuv.js";import"./ConfirmDialog-BdnzEXkJ.js";import"./PrintTeleporter-BFqk3Ikm.js";import"./PickLabel-CVXYlvTb.js";import"./BarcodeGenerator-DjF3cJwR.js";import"./bwip-js-DL1APdek.js";import"./ProductImage-CvO1b8Ha.js";import"./chart.js-DhSGZZEs.js";import"./@kurkle-D8fDXNIl.js";import"./vue-chartjs-DmBR38zn.js";import"./chartjs-plugin-annotation-DYYg84GY.js";import"./lodash-es-Bp4BxrA1.js";const Be={components:{SkuResolutionEditor:de,CustomerShippingAddress:oe,PrintPickLabel:pe,CompleteServiceForm:ce,MarkAsForm:fe,TransponderInfo:ye,DetailsHeader:ke,ExceptionForm:he,OrderItemsPreview:ve,CommentBox:Se,LabelledValue:_e,ScanImageLink:be,TrackingItem:ae,TrackingNumberForm:ne,FullScreenLayout:Ce,ScanGraphHomeKey:Ie,ScanGraphCarKey:Oe},beforeRouteEnter(i,e,f){f(h=>{e.name==="fulfillmentIndex"&&(h.fulfillmentIndexLink=e)})},props:{sessionId:{type:String,default:void 0}},data(){return{isFetchingOrder:!1,isAddingComment:!1,isMarkingAsCut:!1,requiredRule:ue,isKeyKrafterFormValid:!1,isSendingPin:!1,keyKrafterPin:"",isExceptionOverlayOpen:!1,isSubmittingException:!1,isMarkingAsOverlayOpen:!1,isCompleteServiceOverlayOpen:!1,isSubmittingCompleteServiceForm:!1,markAsActionType:"cut",fulfillmentIndexLink:{name:"fulfillmentIndex"}}},computed:{...ge("order",["icCards","orderDetails","shipmentActivity"]),order(){return this.orderDetails||{}},orderCategory(){var i;return((i=(this.order.items||[]).find(e=>e.category))==null?void 0:i.category)||"endless-aisle-key"},keyway(){var i,e,f,h;return this.orderCategory==="endless-aisle-key"?(h=(f=(e=(i=this.order.items)==null?void 0:i[0])==null?void 0:e.keyInfo)==null?void 0:f.blade)==null?void 0:h.keyway:void 0},kisVersion(){return this.orderCategory==="endless-aisle-key"?`V${this.order.session.kisVersion}`:void 0},transactionDate(){var f;let i="";const e=(f=this.order.payment)==null?void 0:f.timestamp;return e&&(i=Te(we(e),"E MM/dd/yyyy h:mm a")),i},scanId(){var i,e;return(e=(i=(this.order.items||[]).find(f=>{var h;return(h=f.keyInfo)==null?void 0:h.scanId}))==null?void 0:i.keyInfo)==null?void 0:e.scanId},comments(){return(this.order.activity||[]).filter(({type:i})=>i==="Comment")},isLoadingActive(){return this.isFetchingOrder||this.isSendingPin||this.isSubmittingException||this.isMarkingAsCut||this.isAddingComment||this.isSubmittingCompleteServiceForm},itemsToFulfill(){return me(this.order)},remoteSku(){var i;return G((i=this.order.items)==null?void 0:i[0]).remote},carKeySku(){var i;return G((i=this.order.items)==null?void 0:i[0]).key},isPrintableStage(){var e;return["pending-print","pending-pick","pending-cut","pending-programming","pending-ship"].includes((e=this.order)==null?void 0:e.stage)},preferredIcCards(){return this.order.items[0].keyInfo.blade.cards||[]}},mounted(){this.sessionId?this.fetchOrderDetails():this.navigateToFulfillmentIndex(!0),this.isCompleteServiceOverlayOpen=this.$route.query.completeService==="true"},methods:{async fetchOrderDetails(){this.isFetchingOrder=!0;try{await this.$store.dispatch("order/fetchOrderDetails",this.sessionId),await this.$store.dispatch("order/fetchOrderIcCards")}catch{this.displayErrorMessage("Failed to load order details")}this.isFetchingOrder=!1},navigateToFulfillmentIndex(i){i?this.$router.replace(this.fulfillmentIndexLink):this.$router.push(this.fulfillmentIndexLink)},async addComment(i){this.isAddingComment=!0;try{await this.$store.dispatch("order/addComment",i)}catch{this.displayErrorMessage("Failed to add comment")}this.isAddingComment=!1},async handleMarkAsSubmit(i){const e=i.actionType==="cut"?"markAsCut":"markAsProgrammed";try{await this.$store.dispatch(`order/${e}`,i.formData),this.displaySuccessMessage(`Successfully marked as ${i.actionType}`)}catch{this.displayErrorMessage(`Failed to mark as ${i.actionType}`)}this.isMarkingAsOverlayOpen=!1},handleMarkAsClick(i){this.markAsActionType=i,this.isMarkingAsOverlayOpen=!0},async sendToKeyKrafter(){this.isSendingPin=!0;try{await this.$store.dispatch("order/endlessKeyCopy",this.keyKrafterPin),this.$refs.keyKrafterForm.reset()}catch{this.displayErrorMessage("Failed to send PIN")}this.isSendingPin=!1},async handleRaisedException(i){this.isSubmittingException=!0;try{await this.$store.dispatch("order/escalate",i),await this.fetchOrderDetails(),this.isExceptionOverlayOpen=!1}catch{this.displayErrorMessage("Failed to raise exception")}this.isSubmittingException=!1},async handleCompleteServiceSubmit(i){this.isSubmittingCompleteServiceForm=!0;try{await this.$store.dispatch("order/completeService",i),this.isCompleteServiceOverlayOpen=!1,this.displaySuccessMessage("Successfully completed service")}catch{this.displayErrorMessage("Failed to complete service")}this.isSubmittingCompleteServiceForm=!1},handlePrintSubmit(i){i.result==="successful"&&this.fetchOrderDetails()},displaySuccessMessage(i){this.$store.dispatch("app/setSnackbar",{message:i})},displayErrorMessage(i){this.$store.dispatch("app/setSnackbar",{message:i,color:"error"})}}},Ne={class:"position-relative"},Re={key:0,class:"fulfillment-details__content"},Ge={class:"fulfillment-details__info-box fulfillment-details__info-box--bordered"},He={key:0},Ue={class:"d-flex align-center"},je={class:"d-flex align-center"},qe={class:"fulfillment-details__info-box fulfillment-details__info-box--bordered"},Je={key:1},Xe={class:"fulfillment-details__info-box"},Ye={class:"d-flex mr-6"},ze={class:"fulfillment-details__scan-graph"};function Qe(i,e,f,h,n,r){const j=o("DetailsHeader"),p=o("LabelledValue"),O=o("SkuResolutionEditor"),C=o("ScanImageLink"),q=o("CustomerShippingAddress"),J=o("TrackingItem"),X=o("TrackingNumberForm"),Y=o("ScanGraphHomeKey"),z=o("ScanGraphCarKey"),_=o("VBtnPrimary"),Q=o("OrderItemsPreview"),W=o("VBtnSecondary"),Z=o("CommentBox"),$=o("TransponderInfo"),ee=o("CompleteServiceForm"),re=o("MarkAsForm"),te=o("ExceptionForm"),ie=o("PrintPickLabel"),se=o("FullScreenLayout");return a(),d(se,{class:"fulfillment-details"},{header:s(()=>[n.isFetchingOrder?m("",!0):(a(),d(j,{key:0,stage:r.order.stage,"transaction-id":r.order.transactionId,class:"fulfillment-details__header",onCloseOrderDialog:e[0]||(e[0]=l=>r.navigateToFulfillmentIndex())},null,8,["stage","transaction-id"]))]),footer:s(()=>[t(Ee,null,{default:s(()=>{var l,u;return[t(Pe),r.isPrintableStage&&!n.isFetchingOrder?(a(),d(ie,{key:0,orders:r.order,"is-reprintable":"",class:"mr-2",onPrintProcessComplete:r.handlePrintSubmit},null,8,["orders","onPrintProcessComplete"])):m("",!0),(u=(l=r.order)==null?void 0:l.session)!=null&&u.sessionId?(a(),d(Me,{key:1,variant:"outlined",color:"primary",class:"mr-2",to:{name:"orderDetails",params:{order:r.order.session.sessionId}}},{default:s(()=>e[23]||(e[23]=[k(" Order Details ")])),_:1,__:[23]},8,["to"])):m("",!0),r.order.stage==="pending-service"?(a(),d(_,{key:2,class:"mr-2","prepend-icon":"$solidCheck",onClick:e[16]||(e[16]=y=>n.isCompleteServiceOverlayOpen=!0)},{default:s(()=>e[24]||(e[24]=[k(" Complete Service ")])),_:1,__:[24]})):m("",!0),t(_,{class:"mr-2","prepend-icon":"$envelope",onClick:e[17]||(e[17]=y=>r.handleMarkAsClick("cut"))},{default:s(()=>e[25]||(e[25]=[k(" Mark as cut ")])),_:1,__:[25]}),r.order.stage==="pending-programming"?(a(),d(_,{key:3,"prepend-icon":"$binary",onClick:e[18]||(e[18]=y=>r.handleMarkAsClick("programmed"))},{default:s(()=>e[26]||(e[26]=[k(" Mark as Programmed ")])),_:1,__:[26]})):m("",!0)]}),_:1})]),default:s(()=>[g("div",Ne,[t(Fe,{active:r.isLoadingActive,"rounded-bar":"",absolute:""},null,8,["active"])]),r.order.transactionId&&!n.isFetchingOrder?(a(),b("div",Re,[t(v,null,{default:s(()=>[t(c,{cols:"12",md:"6",lg:"3"},{default:s(()=>{var l,u;return[g("div",Ge,[(l=r.order)!=null&&l.vehicle?(a(),b("div",He,[t(v,null,{default:s(()=>[t(c,null,{default:s(()=>{var y;return[t(p,{label:"Make",value:(y=r.order.vehicle)==null?void 0:y.make},null,8,["value"])]}),_:1}),t(c,null,{default:s(()=>{var y;return[t(p,{label:"Year",value:(y=r.order.vehicle)==null?void 0:y.year},null,8,["value"])]}),_:1})]),_:1}),t(p,{label:"Model",value:(u=r.order.vehicle)==null?void 0:u.model},null,8,["value"]),t(v,null,{default:s(()=>[t(c,null,{default:s(()=>[t(p,{label:"Key SKU"},{default:s(()=>[g("div",Ue,[k(U(r.carKeySku)+" ",1),t(O,{class:"ml-2"})])]),_:1})]),_:1}),r.remoteSku?(a(),d(c,{key:0},{default:s(()=>[t(p,{label:"Remote SKU"},{default:s(()=>[g("div",je,[k(U(r.remoteSku)+" ",1),t(O,{"sku-type":"remote",class:"ml-2"})])]),_:1})]),_:1})):m("",!0)]),_:1})])):m("",!0),r.keyway?(a(),d(p,{key:1,label:"Keyway",value:r.keyway},null,8,["value"])):m("",!0),r.kisVersion?(a(),d(p,{key:2,label:"KIS",value:r.kisVersion},null,8,["value"])):m("",!0)])]}),_:1}),t(c,{cols:"12",md:"6",lg:"4"},{default:s(()=>[g("div",qe,[r.transactionDate?(a(),d(p,{key:0,label:"Transaction Date",value:r.transactionDate},null,8,["value"])):m("",!0),t(p,{label:"Scan ID",value:r.scanId||"N/A"},null,8,["value"]),r.scanId?(a(),b("div",Je,[t(C,{"image-type":"left","scan-id":r.scanId,class:"mr-4"},null,8,["scan-id"]),t(C,{"image-type":"right","scan-id":r.scanId,class:"mr-4"},null,8,["scan-id"]),t(C,{"image-type":"heatmap","scan-id":r.scanId},null,8,["scan-id"])])):m("",!0)])]),_:1}),t(c,{cols:"12",md:"5"},{default:s(()=>{var l;return[g("div",Xe,[t(p,{label:"Ship To",value:((l=r.order.shippingAddress)==null?void 0:l.name)||"Ship to name not provided"},null,8,["value"]),g("div",Ye,[t(p,{label:"Shipping Address",class:"position-relative"},{default:s(()=>[t(q,{"shipping-address":r.order.shippingAddress,"easy-copy":""},null,8,["shipping-address"])]),_:1})]),g("div",null,[(a(!0),b(De,null,Le(i.shipmentActivity,u=>(a(),d(J,{key:u.identifier,"tracking-number":u.identifier,timestamp:u.timestamp,class:"mb-1"},null,8,["tracking-number","timestamp"]))),128)),t(X,{"no-order-refresh":"",variant:"compact",onTrackingNumberAdded:e[1]||(e[1]=u=>r.fetchOrderDetails())})])])]}),_:1})]),_:1}),t(v,null,{default:s(()=>[t(c,{cols:"12",md:"7"},{default:s(()=>[g("div",ze,[t(H,{class:"pl-4",color:"primary-lighten-2",height:"32"},{default:s(()=>e[19]||(e[19]=[k(" Tooling ")])),_:1,__:[19]}),r.orderCategory==="endless-aisle-key"&&r.scanId?(a(),d(Y,{key:0,"scan-id":r.scanId},null,8,["scan-id"])):r.orderCategory==="car-key"&&r.scanId?(a(),d(z,{key:1,"scan-id":r.scanId,"ic-cards":i.icCards,"preferred-cards":r.preferredIcCards},null,8,["scan-id","ic-cards","preferred-cards"])):(a(),d(xe,{key:2,height:"300"},{default:s(()=>e[20]||(e[20]=[g("div",{class:"h-100 d-flex justify-center align-center"}," Graph Not Available ",-1)])),_:1,__:[20]})),t(H,{color:"surface-variant",height:"48",class:"d-flex justify-end px-4"},{default:s(()=>[t(Ve,{ref:"keyKrafterForm",modelValue:n.isKeyKrafterFormValid,"onUpdate:modelValue":e[4]||(e[4]=l=>n.isKeyKrafterFormValid=l),class:"fulfillment-details__key-krafter-form"},{default:s(()=>[t(Ae,{modelValue:n.keyKrafterPin,"onUpdate:modelValue":e[3]||(e[3]=l=>n.keyKrafterPin=l),label:"PIN",variant:"solo",density:"compact","hide-details":"",rules:[n.requiredRule]},{append:s(()=>[t(_,{disabled:!n.isKeyKrafterFormValid,loading:n.isSendingPin,onClick:e[2]||(e[2]=l=>r.sendToKeyKrafter())},{default:s(()=>e[21]||(e[21]=[k(" Send to Key Krafter ")])),_:1,__:[21]},8,["disabled","loading"])]),_:1},8,["modelValue","rules"])]),_:1},8,["modelValue"])]),_:1})])]),_:1}),t(c,{cols:"12",md:"5"},{default:s(()=>{var l,u,y,F;return[t(v,null,{default:s(()=>[t(c,null,{default:s(()=>[r.order.items?(a(),d(Q,{key:0,items:r.itemsToFulfill,class:"fulfillment-details__order-items-box"},null,8,["items"])):m("",!0)]),_:1})]),_:1}),t(v,null,{default:s(()=>[t(c,null,{default:s(()=>[t(Z,{comments:r.comments,loading:n.isAddingComment,height:"160px",class:"fulfillment-details__comment-box",onCommentAdded:e[6]||(e[6]=S=>r.addComment(S))},{"footer-left":s(()=>[t(W,{density:"comfortable",onClick:e[5]||(e[5]=S=>n.isExceptionOverlayOpen=!0)},{default:s(()=>[t(Ke,{icon:"$circleExclamation",class:"mr-1"}),e[22]||(e[22]=k(" Raise Exception "))]),_:1,__:[22]})]),_:1},8,["comments","loading"])]),_:1})]),_:1}),(y=(u=(l=r.order.items)==null?void 0:l[0])==null?void 0:u.keyInfo)!=null&&y.transponder&&((F=r.order)!=null&&F.vehicle)?(a(),d(v,{key:0},{default:s(()=>[t(c,null,{default:s(()=>{var S,x,V,A,K,P,M,E,T,w,D,L,B,N,R;return[t($,{transponder:(V=(x=(S=r.order.items)==null?void 0:S[0])==null?void 0:x.keyInfo)==null?void 0:V.transponder,"tag-type":(M=(P=(K=(A=r.order.items)==null?void 0:A[0])==null?void 0:K.keyInfo)==null?void 0:P.transponder)==null?void 0:M.tagType,"tag-id":(D=(w=(T=(E=r.order.items)==null?void 0:E[0])==null?void 0:T.keyInfo)==null?void 0:w.transponder)==null?void 0:D.tagId,"tag-sub-id":(R=(N=(B=(L=r.order.items)==null?void 0:L[0])==null?void 0:B.keyInfo)==null?void 0:N.transponder)==null?void 0:R.tagSubId},null,8,["transponder","tag-type","tag-id","tag-sub-id"])]}),_:1})]),_:1})):m("",!0)]}),_:1})]),_:1})])):m("",!0),t(I,{modelValue:n.isCompleteServiceOverlayOpen,"onUpdate:modelValue":e[9]||(e[9]=l=>n.isCompleteServiceOverlayOpen=l),persistent:"","content-class":"h-100 w-100 d-flex justify-center align-center"},{default:s(()=>[t(ee,{loading:n.isSubmittingCompleteServiceForm||n.isFetchingOrder,onCancel:e[7]||(e[7]=l=>n.isCompleteServiceOverlayOpen=!1),onSubmit:e[8]||(e[8]=l=>r.handleCompleteServiceSubmit(l))},null,8,["loading"])]),_:1},8,["modelValue"]),t(I,{modelValue:n.isMarkingAsOverlayOpen,"onUpdate:modelValue":e[12]||(e[12]=l=>n.isMarkingAsOverlayOpen=l),persistent:"","content-class":"h-100 w-100 d-flex justify-center align-center"},{default:s(()=>[t(re,{"action-type":n.markAsActionType,onCancel:e[10]||(e[10]=l=>n.isMarkingAsOverlayOpen=!1),onSubmit:e[11]||(e[11]=l=>r.handleMarkAsSubmit(l))},null,8,["action-type"])]),_:1},8,["modelValue"]),t(I,{modelValue:n.isExceptionOverlayOpen,"onUpdate:modelValue":e[15]||(e[15]=l=>n.isExceptionOverlayOpen=l),persistent:"","content-class":"h-100 w-100 d-flex justify-center align-center"},{default:s(()=>[t(te,{onCancel:e[13]||(e[13]=l=>n.isExceptionOverlayOpen=!1),onSubmit:e[14]||(e[14]=l=>r.handleRaisedException(l))})]),_:1},8,["modelValue"])]),_:1})}const Dr=le(Be,[["render",Qe],["__scopeId","data-v-e43fba68"]]);export{Dr as default};
