import{_ as ae,n as le,y as ne,E as oe,F as de,r as me,j as ce,G}from"./index.8a58b007.js";import ue from"./CompleteServiceForm.f3a0042c.js";import pe from"./MarkAsForm.ea40b767.js";import fe from"./PrintPickLabel.d9bd3ac5.js";import ye from"./TransponderInfo.69bc7098.js";import{a as ge}from"./vuex.0eb68a2c.js";import he from"./DetailsHeader.5287640a.js";import ke from"./ExceptionForm.8881358b.js";import ve from"./OrderItemsPreview.3dccb904.js";import _e from"./CommentBox.0773ee59.js";import Se from"./LabelledValue.57c82805.js";import be from"./ScanImageLink.83bc38a5.js";import Ce from"./FullScreenLayout.0d0fe126.js";import Ie from"./ScanGraphHomeKey.dc06ba70.js";import Oe from"./ScanGraphCarKey.5d703c71.js";import{f as xe,p as Fe}from"./date-fns.d38e1d55.js";import{i as Ve,d as Ae,ar as Ke,a1 as Pe,w as u,x as v,A as j,X as Ee,l as Me,u as Te,c as we,ay as I}from"./vuetify.65d833ec.js";import{S as o,e as n,x as d,k as s,z as m,g as i,J as h,E as g,f as b,I as U,G as De,j as Le,aj as Be,ak as Ne}from"./@vue.ee679632.js";import"./vue-atomic-docs.4f3653eb.js";import"./vue-router.ec64e966.js";import"./axios.eca6faa7.js";import"./axios-cache-interceptor.0956cad0.js";import"./cache-parser.124ebbb8.js";import"./fast-defer.b34f24de.js";import"./object-code.c2755e43.js";import"./@fortawesome.2cecc5e3.js";import"./@awesome.me.7dae7d79.js";import"./ConfirmDialog.060a100c.js";import"./PrintTeleporter.0f903a0b.js";import"./PickLabel.e8c579b7.js";import"./BarcodeGenerator.39689fa5.js";import"./bwip-js.88a7b0d7.js";import"./ProductImage.3e5aeb25.js";import"./chart.js.00f608ba.js";import"./@kurkle.1fd9dacb.js";import"./vue-chartjs.b3d57c2d.js";import"./chartjs-plugin-annotation.e3ca55a0.js";import"./lodash-es.d99d4c8c.js";const Re={components:{SkuResolutionEditor:le,CustomerShippingAddress:ne,PrintPickLabel:fe,CompleteServiceForm:ue,MarkAsForm:pe,TransponderInfo:ye,DetailsHeader:he,ExceptionForm:ke,OrderItemsPreview:ve,CommentBox:_e,LabelledValue:Se,ScanImageLink:be,TrackingItem:oe,TrackingNumberForm:de,FullScreenLayout:Ce,ScanGraphHomeKey:Ie,ScanGraphCarKey:Oe},beforeRouteEnter(t,e,p){p(k=>{e.name==="fulfillmentIndex"&&(k.fulfillmentIndexLink=e)})},props:{sessionId:{type:String,default:void 0}},data(){return{isFetchingOrder:!1,isAddingComment:!1,isMarkingAsCut:!1,requiredRule:me,isKeyKrafterFormValid:!1,isSendingPin:!1,keyKrafterPin:"",isExceptionOverlayOpen:!1,isSubmittingException:!1,isMarkingAsOverlayOpen:!1,isCompleteServiceOverlayOpen:!1,isSubmittingCompleteServiceForm:!1,markAsActionType:"cut",fulfillmentIndexLink:{name:"fulfillmentIndex"}}},computed:{...ge("order",["icCards","orderDetails","shipmentActivity"]),order(){return this.orderDetails||{}},orderCategory(){var t;return((t=(this.order.items||[]).find(e=>e.category))==null?void 0:t.category)||"endless-aisle-key"},keyway(){var t,e,p,k;return this.orderCategory==="endless-aisle-key"?(k=(p=(e=(t=this.order.items)==null?void 0:t[0])==null?void 0:e.keyInfo)==null?void 0:p.blade)==null?void 0:k.keyway:void 0},kisVersion(){return this.orderCategory==="endless-aisle-key"?`V${this.order.session.kisVersion}`:void 0},transactionDate(){var p;let t="";const e=(p=this.order.payment)==null?void 0:p.timestamp;return e&&(t=xe(Fe(e),"E MM/dd/yyyy h:mm a")),t},scanId(){var t,e;return(e=(t=(this.order.items||[]).find(p=>{var k;return(k=p.keyInfo)==null?void 0:k.scanId}))==null?void 0:t.keyInfo)==null?void 0:e.scanId},comments(){return(this.order.activity||[]).filter(({type:t})=>t==="Comment")},isLoadingActive(){return this.isFetchingOrder||this.isSendingPin||this.isSubmittingException||this.isMarkingAsCut||this.isAddingComment||this.isSubmittingCompleteServiceForm},itemsToFulfill(){return ce(this.order)},remoteSku(){var t;return G((t=this.order.items)==null?void 0:t[0]).remote},carKeySku(){var t;return G((t=this.order.items)==null?void 0:t[0]).key},isPrintableStage(){var e;return["pending-print","pending-pick","pending-cut","pending-programming","pending-ship"].includes((e=this.order)==null?void 0:e.stage)},preferredIcCards(){return this.order.items[0].keyInfo.blade.cards||[]}},mounted(){this.sessionId?this.fetchOrderDetails():this.navigateToFulfillmentIndex(!0),this.isCompleteServiceOverlayOpen=this.$route.query.completeService==="true"},methods:{async fetchOrderDetails(){this.isFetchingOrder=!0;try{await this.$store.dispatch("order/fetchOrderDetails",this.sessionId),await this.$store.dispatch("order/fetchOrderIcCards")}catch{this.displayErrorMessage("Failed to load order details")}this.isFetchingOrder=!1},navigateToFulfillmentIndex(t){t?this.$router.replace(this.fulfillmentIndexLink):this.$router.push(this.fulfillmentIndexLink)},async addComment(t){this.isAddingComment=!0;try{await this.$store.dispatch("order/addComment",t)}catch{this.displayErrorMessage("Failed to add comment")}this.isAddingComment=!1},async handleMarkAsSubmit(t){const e=t.actionType==="cut"?"markAsCut":"markAsProgrammed";try{await this.$store.dispatch(`order/${e}`,t.formData),this.displaySuccessMessage(`Successfully marked as ${t.actionType}`)}catch{this.displayErrorMessage(`Failed to mark as ${t.actionType}`)}this.isMarkingAsOverlayOpen=!1},handleMarkAsClick(t){this.markAsActionType=t,this.isMarkingAsOverlayOpen=!0},async sendToKeyKrafter(){this.isSendingPin=!0;try{await this.$store.dispatch("order/endlessKeyCopy",this.keyKrafterPin),this.$refs.keyKrafterForm.reset()}catch{this.displayErrorMessage("Failed to send PIN")}this.isSendingPin=!1},async handleRaisedException(t){this.isSubmittingException=!0;try{await this.$store.dispatch("order/escalate",t),await this.fetchOrderDetails(),this.isExceptionOverlayOpen=!1}catch{this.displayErrorMessage("Failed to raise exception")}this.isSubmittingException=!1},async handleCompleteServiceSubmit(t){this.isSubmittingCompleteServiceForm=!0;try{await this.$store.dispatch("order/completeService",t),this.isCompleteServiceOverlayOpen=!1,this.displaySuccessMessage("Successfully completed service")}catch{this.displayErrorMessage("Failed to complete service")}this.isSubmittingCompleteServiceForm=!1},handlePrintSubmit(t){t.result==="successful"&&this.fetchOrderDetails()},displaySuccessMessage(t){this.$store.dispatch("app/setSnackbar",{message:t})},displayErrorMessage(t){this.$store.dispatch("app/setSnackbar",{message:t,color:"error"})}}},Ge=t=>(Be("data-v-e43fba68"),t=t(),Ne(),t),je={class:"position-relative"},Ue={key:0,class:"fulfillment-details__content"},He={class:"fulfillment-details__info-box fulfillment-details__info-box--bordered"},qe={key:0},ze={class:"d-flex align-center"},Je={class:"d-flex align-center"},Xe={class:"fulfillment-details__info-box fulfillment-details__info-box--bordered"},Ye={key:1},Qe={class:"fulfillment-details__info-box"},We={class:"d-flex mr-6"},Ze={class:"fulfillment-details__scan-graph"},$e=Ge(()=>g("div",{class:"h-100 d-flex justify-center align-center"}," Graph Not Available ",-1));function er(t,e,p,k,l,r){const H=o("DetailsHeader"),f=o("LabelledValue"),O=o("SkuResolutionEditor"),C=o("ScanImageLink"),q=o("CustomerShippingAddress"),z=o("TrackingItem"),J=o("TrackingNumberForm"),X=o("ScanGraphHomeKey"),Y=o("ScanGraphCarKey"),S=o("VBtnPrimary"),Q=o("OrderItemsPreview"),W=o("VBtnSecondary"),Z=o("CommentBox"),$=o("TransponderInfo"),ee=o("CompleteServiceForm"),re=o("MarkAsForm"),te=o("ExceptionForm"),ie=o("PrintPickLabel"),se=o("FullScreenLayout");return n(),d(se,{class:"fulfillment-details"},{header:s(()=>[l.isFetchingOrder?m("",!0):(n(),d(H,{key:0,stage:r.order.stage,"transaction-id":r.order.transactionId,class:"fulfillment-details__header",onCloseOrderDialog:e[0]||(e[0]=a=>r.navigateToFulfillmentIndex())},null,8,["stage","transaction-id"]))]),footer:s(()=>[i(Ke,null,{default:s(()=>{var a,c;return[i(Ve),r.isPrintableStage&&!l.isFetchingOrder?(n(),d(ie,{key:0,orders:r.order,"is-reprintable":"",class:"mr-2",onPrintProcessComplete:r.handlePrintSubmit},null,8,["orders","onPrintProcessComplete"])):m("",!0),(c=(a=r.order)==null?void 0:a.session)!=null&&c.sessionId?(n(),d(Ae,{key:1,variant:"outlined",color:"primary",class:"mr-2",to:{name:"orderDetails",params:{order:r.order.session.sessionId}}},{default:s(()=>[h(" Order Details ")]),_:1},8,["to"])):m("",!0),r.order.stage==="pending-service"?(n(),d(S,{key:2,class:"mr-2","prepend-icon":"$solidCheck",onClick:e[16]||(e[16]=y=>l.isCompleteServiceOverlayOpen=!0)},{default:s(()=>[h(" Complete Service ")]),_:1})):m("",!0),i(S,{class:"mr-2","prepend-icon":"$envelope",onClick:e[17]||(e[17]=y=>r.handleMarkAsClick("cut"))},{default:s(()=>[h(" Mark as cut ")]),_:1}),r.order.stage==="pending-programming"?(n(),d(S,{key:3,"prepend-icon":"$binary",onClick:e[18]||(e[18]=y=>r.handleMarkAsClick("programmed"))},{default:s(()=>[h(" Mark as Programmed ")]),_:1})):m("",!0)]}),_:1})]),default:s(()=>[g("div",je,[i(Pe,{active:r.isLoadingActive,"rounded-bar":"",absolute:""},null,8,["active"])]),r.order.transactionId&&!l.isFetchingOrder?(n(),b("div",Ue,[i(v,null,{default:s(()=>[i(u,{cols:"12",md:"6",lg:"3"},{default:s(()=>{var a,c;return[g("div",He,[(a=r.order)!=null&&a.vehicle?(n(),b("div",qe,[i(v,null,{default:s(()=>[i(u,null,{default:s(()=>{var y;return[i(f,{label:"Make",value:(y=r.order.vehicle)==null?void 0:y.make},null,8,["value"])]}),_:1}),i(u,null,{default:s(()=>{var y;return[i(f,{label:"Year",value:(y=r.order.vehicle)==null?void 0:y.year},null,8,["value"])]}),_:1})]),_:1}),i(f,{label:"Model",value:(c=r.order.vehicle)==null?void 0:c.model},null,8,["value"]),i(v,null,{default:s(()=>[i(u,null,{default:s(()=>[i(f,{label:"Key SKU"},{default:s(()=>[g("div",ze,[h(U(r.carKeySku)+" ",1),i(O,{class:"ml-2"})])]),_:1})]),_:1}),r.remoteSku?(n(),d(u,{key:0},{default:s(()=>[i(f,{label:"Remote SKU"},{default:s(()=>[g("div",Je,[h(U(r.remoteSku)+" ",1),i(O,{"sku-type":"remote",class:"ml-2"})])]),_:1})]),_:1})):m("",!0)]),_:1})])):m("",!0),r.keyway?(n(),d(f,{key:1,label:"Keyway",value:r.keyway},null,8,["value"])):m("",!0),r.kisVersion?(n(),d(f,{key:2,label:"KIS",value:r.kisVersion},null,8,["value"])):m("",!0)])]}),_:1}),i(u,{cols:"12",md:"6",lg:"4"},{default:s(()=>[g("div",Xe,[r.transactionDate?(n(),d(f,{key:0,label:"Transaction Date",value:r.transactionDate},null,8,["value"])):m("",!0),i(f,{label:"Scan ID",value:r.scanId||"N/A"},null,8,["value"]),r.scanId?(n(),b("div",Ye,[i(C,{"image-type":"left","scan-id":r.scanId,class:"mr-4"},null,8,["scan-id"]),i(C,{"image-type":"right","scan-id":r.scanId,class:"mr-4"},null,8,["scan-id"]),i(C,{"image-type":"heatmap","scan-id":r.scanId},null,8,["scan-id"])])):m("",!0)])]),_:1}),i(u,{cols:"12",md:"5"},{default:s(()=>{var a;return[g("div",Qe,[i(f,{label:"Ship To",value:((a=r.order.shippingAddress)==null?void 0:a.name)||"Ship to name not provided"},null,8,["value"]),g("div",We,[i(f,{label:"Shipping Address",class:"position-relative"},{default:s(()=>[i(q,{"shipping-address":r.order.shippingAddress,"easy-copy":""},null,8,["shipping-address"])]),_:1})]),g("div",null,[(n(!0),b(De,null,Le(t.shipmentActivity,c=>(n(),d(z,{key:c.identifier,"tracking-number":c.identifier,timestamp:c.timestamp,class:"mb-1"},null,8,["tracking-number","timestamp"]))),128)),i(J,{"no-order-refresh":"",variant:"compact",onTrackingNumberAdded:e[1]||(e[1]=c=>r.fetchOrderDetails())})])])]}),_:1})]),_:1}),i(v,null,{default:s(()=>[i(u,{cols:"12",md:"7"},{default:s(()=>[g("div",Ze,[i(j,{class:"pl-4",color:"primary-lighten-2",height:"32"},{default:s(()=>[h(" Tooling ")]),_:1}),r.orderCategory==="endless-aisle-key"&&r.scanId?(n(),d(X,{key:0,"scan-id":r.scanId},null,8,["scan-id"])):r.orderCategory==="car-key"&&r.scanId?(n(),d(Y,{key:1,"scan-id":r.scanId,"ic-cards":t.icCards,"preferred-cards":r.preferredIcCards},null,8,["scan-id","ic-cards","preferred-cards"])):(n(),d(Ee,{key:2,height:"300"},{default:s(()=>[$e]),_:1})),i(j,{color:"surface-variant",height:"48",class:"d-flex justify-end px-4"},{default:s(()=>[i(Me,{ref:"keyKrafterForm",modelValue:l.isKeyKrafterFormValid,"onUpdate:modelValue":e[4]||(e[4]=a=>l.isKeyKrafterFormValid=a),class:"fulfillment-details__key-krafter-form"},{default:s(()=>[i(Te,{modelValue:l.keyKrafterPin,"onUpdate:modelValue":e[3]||(e[3]=a=>l.keyKrafterPin=a),label:"PIN",variant:"solo",density:"compact","hide-details":"",rules:[l.requiredRule]},{append:s(()=>[i(S,{disabled:!l.isKeyKrafterFormValid,loading:l.isSendingPin,onClick:e[2]||(e[2]=a=>r.sendToKeyKrafter())},{default:s(()=>[h(" Send to Key Krafter ")]),_:1},8,["disabled","loading"])]),_:1},8,["modelValue","rules"])]),_:1},8,["modelValue"])]),_:1})])]),_:1}),i(u,{cols:"12",md:"5"},{default:s(()=>{var a,c,y,x;return[i(v,null,{default:s(()=>[i(u,null,{default:s(()=>[r.order.items?(n(),d(Q,{key:0,items:r.itemsToFulfill,class:"fulfillment-details__order-items-box"},null,8,["items"])):m("",!0)]),_:1})]),_:1}),i(v,null,{default:s(()=>[i(u,null,{default:s(()=>[i(Z,{comments:r.comments,loading:l.isAddingComment,height:"160px",class:"fulfillment-details__comment-box",onCommentAdded:e[6]||(e[6]=_=>r.addComment(_))},{"footer-left":s(()=>[i(W,{density:"comfortable",onClick:e[5]||(e[5]=_=>l.isExceptionOverlayOpen=!0)},{default:s(()=>[i(we,{icon:"$circleExclamation",class:"mr-1"}),h(" Raise Exception ")]),_:1})]),_:1},8,["comments","loading"])]),_:1})]),_:1}),((y=(c=(a=r.order.items)==null?void 0:a[0])==null?void 0:c.keyInfo)==null?void 0:y.transponder)&&((x=r.order)==null?void 0:x.vehicle)?(n(),d(v,{key:0},{default:s(()=>[i(u,null,{default:s(()=>{var _,F,V,A,K,P,E,M,T,w,D,L,B,N,R;return[i($,{transponder:(V=(F=(_=r.order.items)==null?void 0:_[0])==null?void 0:F.keyInfo)==null?void 0:V.transponder,"tag-type":(E=(P=(K=(A=r.order.items)==null?void 0:A[0])==null?void 0:K.keyInfo)==null?void 0:P.transponder)==null?void 0:E.tagType,"tag-id":(D=(w=(T=(M=r.order.items)==null?void 0:M[0])==null?void 0:T.keyInfo)==null?void 0:w.transponder)==null?void 0:D.tagId,"tag-sub-id":(R=(N=(B=(L=r.order.items)==null?void 0:L[0])==null?void 0:B.keyInfo)==null?void 0:N.transponder)==null?void 0:R.tagSubId},null,8,["transponder","tag-type","tag-id","tag-sub-id"])]}),_:1})]),_:1})):m("",!0)]}),_:1})]),_:1})])):m("",!0),i(I,{modelValue:l.isCompleteServiceOverlayOpen,"onUpdate:modelValue":e[9]||(e[9]=a=>l.isCompleteServiceOverlayOpen=a),persistent:"","content-class":"h-100 w-100 d-flex justify-center align-center"},{default:s(()=>[i(ee,{loading:l.isSubmittingCompleteServiceForm||l.isFetchingOrder,onCancel:e[7]||(e[7]=a=>l.isCompleteServiceOverlayOpen=!1),onSubmit:e[8]||(e[8]=a=>r.handleCompleteServiceSubmit(a))},null,8,["loading"])]),_:1},8,["modelValue"]),i(I,{modelValue:l.isMarkingAsOverlayOpen,"onUpdate:modelValue":e[12]||(e[12]=a=>l.isMarkingAsOverlayOpen=a),persistent:"","content-class":"h-100 w-100 d-flex justify-center align-center"},{default:s(()=>[i(re,{"action-type":l.markAsActionType,onCancel:e[10]||(e[10]=a=>l.isMarkingAsOverlayOpen=!1),onSubmit:e[11]||(e[11]=a=>r.handleMarkAsSubmit(a))},null,8,["action-type"])]),_:1},8,["modelValue"]),i(I,{modelValue:l.isExceptionOverlayOpen,"onUpdate:modelValue":e[15]||(e[15]=a=>l.isExceptionOverlayOpen=a),persistent:"","content-class":"h-100 w-100 d-flex justify-center align-center"},{default:s(()=>[i(te,{onCancel:e[13]||(e[13]=a=>l.isExceptionOverlayOpen=!1),onSubmit:e[14]||(e[14]=a=>r.handleRaisedException(a))})]),_:1},8,["modelValue"])]),_:1})}const Nr=ae(Re,[["render",er],["__scopeId","data-v-e43fba68"]]);export{Nr as default};
