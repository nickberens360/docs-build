import A from"./MeruDataTable-jf3gvfqw.js";import{b as L,a as y,m as T}from"./vuex-D3TwipD2.js";import j from"./ItemSize-CrvyCW-T.js";import F from"./ProductImage-CvO1b8Ha.js";import K from"./CatalogMenu-DMu3teF5.js";import N from"./DefaultLayout-DdfUBm6-.js";import{_ as G}from"./index-LK9MQE2L.js";import{w as r,f as Q,b as k,d as C,v as Z,A as M,ax as q,k as B,l as S,m as w,t as D,aj as U,x as h,n as H,u as V,r as J,ar as W}from"./vuetify-BgnNF2O3.js";import{C as I,i as t,e as s,_ as c,B as o,J as n,H as u,b,s as g,x as Y,f as X,p as $,A as p}from"./@vue-DNrUJgob.js";import"./date-fns-2ylUqVpG.js";import"./@babel-BTTPuEuv.js";import"./vue-component-docs-plugin-BnqcuvvC.js";import"./vue-router-BVOKdCCq.js";import"./axios-xsH4HHeE.js";import"./axios-cache-interceptor-DgAMPFM2.js";import"./cache-parser-DXYp_BCq.js";import"./fast-defer-9MI9za_P.js";import"./object-code-SBtdq8jY.js";import"./@fortawesome-BWcQmPY7.js";import"./@awesome.me-Btqfd-fw.js";const ee={components:{MeruDataTable:A,ProductImage:F,ItemSize:j,CatalogMenu:K,DefaultLayout:N},data(){return{toggle_filters_global:"ALL",dialogCRUD:!1,dialogDEL:!1,editedIndex:-1,skuSearchRules:[i=>Object.keys(i||{}).length!==0||"SKU is required"],searchTrunkTable:null,skuModel:{},skuExists:!1,expanded:[],singleExpand:!1,editedItem:{skuModel:{},sku:"",description:"",size:"M",numberPerBox:0,numberOfBoxes:0,singles:0,total:0,expectedTotal:0,modified:{isModified:!1,transaction:""}},defaultItem:{skuModel:{},sku:"",description:"",size:"M",numberPerBox:0,numberOfBoxes:0,singles:0,total:0,expectedTotal:0,modified:{isModified:!1,transaction:""}},headers:[{sortable:!0,title:"Status",key:"modified.transaction"},{sortable:!0,title:"SKU",key:"sku"},{sortable:!0,title:"Description",key:"description"},{sortable:!1,title:"Size",key:"size"},{sortable:!1,title:"Total",key:"expectedTotal"},{sortable:!1,title:"Actions",key:"actions"}],timestamp:"",allItems:[],kioskSkus:[],loading:!0,valid:!1}},computed:{...y("inventory",["skusById"]),...T("inventory",["getSKUs"]),...T("user",["getUserTrunkStock"]),...y("user",["user"]),...T({environment:"app/getEnvConfigs"}),...y("app",["snackbar"]),items(){switch(this.toggle_filters_global){case"ALL":return this.allItems;case"KE":case"TG":return this.allItems.filter(i=>i.skuModel.productClass==this.toggle_filters_global);default:return this.allItems.filter(i=>!["KE","TG"].includes(i.skuModel.productClass))}},catalogMenuProductClasses(){return this.toggle_filters_global==="ALL"?[]:this.toggle_filters_global!=="Other"?[this.toggle_filters_global]:[]},excludedCatalogMenuProductClasses(){return this.toggle_filters_global==="Other"?["KE","TG"]:[]},formTitle(){return this.editedIndex===-1?"New Item":"Edit Item"},getTotalFromBox(){return this.editedItem.numberOfBoxes&&this.skuModel&&this.skuModel.defaultItemsPerBox?this.editedItem.numberOfBoxes*this.skuModel.defaultItemsPerBox:""},getRowTotalBySingles(){let i=parseInt(this.getTotalFromBox)||0;return(parseInt(this.editedItem.singles)||0)+i},getExpected(){return this.editedIndex===-1?this.getRowTotalBySingles:this.editedItem.expectedTotal},getDifference(){return this.getRowTotalBySingles-this.getExpected},hasSkuModel(){return Object.keys(this.skuModel).length!==0},isSnackbarActive(){return this.snackbar.isShown}},beforeMount(){this.loadInitialData()},methods:{...L("user",["postUserTrunkStock"]),getRowDiff(i,e){var f=e-i;return(f>0?"+":"")+f},deleteItem(i){this.editedIndex=this.allItems.indexOf(i),this.skuModel=Object.assign({},i.skuModel),this.editedItem=Object.assign({},i),this.editedItem.numberOfBoxes=0,this.editedItem.singles=0,this.editedItem.total=0,this.dialogDEL=!0},editItem(i){this.editedIndex=this.allItems.indexOf(i),this.skuModel=Object.assign({},i.skuModel),this.editedItem=Object.assign({},i),this.dialogCRUD=!0,this.$refs&&this.$refs.form&&this.$refs.form.resetValidation()},validateQty(){let i=this.editedIndex===-1?1:0;return[e=>(i==1?this.getRowTotalBySingles>0:e>=i)||i+" or more",e=>!!e.toString()||"Required",e=>parseInt(e)==e||"Whole #",e=>parseInt(e)>=0||"0 or more",()=>this.getRowTotalBySingles<1e7||"Too many"]},async validate(i){let{valid:e}=await this.$refs.form.validate();e&&this.valid&&i&&this.save()},setBoxInputToZero(i){i!=""?this.editedItem.numberOfBoxes=parseInt(i):this.editedItem.numberOfBoxes="0",this.validate(!1)},setIndividualInputToZero(i){i!=""?this.editedItem.singles=parseInt(i):this.editedItem.singles="0",this.validate(!1)},save(){this.loading=!0,this.editedItem.total=this.getRowTotalBySingles;const i={inventory:[{skuId:this.skuModel.skuId,singles:parseInt(this.editedItem.singles)+this.editedItem.numberOfBoxes*this.skuModel.defaultItemsPerBox,boxes:[]}],stockId:this.user.id,username:this.user.username,timestamp:this.timestamp};this.postUserTrunkStock(i).then(e=>{this.loading=!1,this.editedItem.expectedTotal=this.editedItem.total;const f=this.editedItem.total==0;e.status==200&&(this.editedItem.modified.isModified=!0,this.editedIndex==-1?(this.editedItem.skuModel=this.skuModel,this.allItems.push(this.editedItem)):f?this.allItems.splice(this.editedIndex,1):Object.assign(this.allItems[this.editedIndex],this.editedItem),this.editedItem.modified.transaction="Updated",this.$store.dispatch("app/setSnackbar",{message:f?"Item removed":"Item saved"})),this.reset()}),this.dialogCRUD=!1,this.dialogDEL=!1},processItemsData(i){this.timestamp=i.timestamp;const e=24*60*60*1e3;this.allItems=i.inventory.flatMap(m=>{const d=this.skusById[m.skuId],a=new Date(m.lastCountTime).getTime()>=new Date().getTime()-3*e;return d&&{skuModel:d,sku:d.sku,skuId:m.skuId,description:d.description,size:d.size,numberPerBox:d.defaultItemsPerBox,numberOfBoxes:parseInt(m.estimated.total/d.defaultItemsPerBox),singles:m.estimated.total%d.defaultItemsPerBox,expectedTotal:m.estimated.total,total:m.estimated.total,modified:{isModified:!!a,transaction:a?"Updated":""}}}),this.kioskSkus=this.kioskSkus.filter(m=>!m.deprecated||this.allItems.find(d=>d&&d.skuId==m.skuId));const f=this.allItems.filter(m=>m!=null);this.allItems=Object.assign([],f)},cancel(){this.$refs&&this.$refs.form&&this.$refs.form.resetValidation(),this.dialogCRUD=!1,this.dialogDEL=!1,this.$store.dispatch("app/setSnackbar",{message:"Canceled",color:"error"}),this.reset()},reset(){this.skuExists=!1,setTimeout(()=>{this.editedItem=Object.assign({},this.defaultItem),this.editedIndex=-1,this.skuModel={}},300)},expandRow(i){if(this.expanded[0]===i.skuModel.sku){this.expanded=[];return}this.expanded=[],this.expanded.push(i.skuModel.sku)},skuChanged(i){this.skuExists=!1;let e=i&&this.items.find(f=>f.skuModel.skuId===(i==null?void 0:i.skuId));e?(this.editedIndex=this.allItems.indexOf(e),this.editedItem=e,this.skuExists=!0):(this.$refs.form&&this.$refs.form.resetValidation(),this.editedIndex=-1,this.editedItem=Object.assign({},this.defaultItem))},setOn(){this.$refs.form&&this.$refs.form.resetValidation(),this.editedIndex==-1&&(this.editedItem=Object.assign({},this.defaultItem)),this.dialogCRUD=!0},async loadInitialData(){this.loading=!0;try{const i=[];i.push(this.$store.dispatch("inventory/loadSKUs")),this.getUserTrunkStock.length===0&&i.push(this.$store.dispatch("user/loadUserTrunkStock")),await Promise.all(i),this.kioskSkus=this.getSKUs,this.processItemsData(this.getUserTrunkStock),this.loading=!1}catch{this.$store.dispatch("app/setSnackbar",{message:"Failed to load data, refresh page to try again.",color:"error",timeout:-1}),this.loading=!1}}}};const te={class:"text-h6"},se={class:"text-h5"},le={key:0},ie=["v-model"],de=["v-model"],ae={key:0},oe={class:"font-weight-medium"},ne={key:0},re={key:0},ue={class:"font-weight-black"},me={class:"text-primary-lighten-3"},fe=["colspan"],ge={class:"pa-3 bg-surface-bright"};function pe(i,e,f,m,d,a){const _=c("VBtnSecondary"),v=c("VBtnPrimary"),O=c("CatalogMenu"),E=c("ItemSize"),P=c("ProductImage"),R=c("MeruDataTable"),z=c("DefaultLayout");return p(),I(z,null,{default:t(()=>[s(h,null,{default:t(()=>[s(r,{cols:"12"},{default:t(()=>[s(R,{expanded:d.expanded,"onUpdate:expanded":e[14]||(e[14]=l=>d.expanded=l),headers:d.headers,items:a.items,"items-per-page":"15",loading:d.loading,"loading-text":"Loading... Please wait",search:d.searchTrunkTable,class:"mb-10","fixed-header":"","show-expand":"",hover:"","single-expand":d.singleExpand,"item-value":"skuModel.sku","expand-icon":"$vuetify.icons.angleDown","mobile-breakpoint":700,"header-props":{sortIcon:"$vuetify.icons.arrowUp"}},{top:t(()=>[s(M,{color:"surface"},{default:t(()=>[g("",!0),s(q,{modelValue:d.toggle_filters_global,"onUpdate:modelValue":e[0]||(e[0]=l=>d.toggle_filters_global=l),mandatory:"force",disabled:d.loading},{default:t(()=>[s(k,{value:"ALL",variant:"text",size:"small"},{default:t(()=>e[16]||(e[16]=[n(" All ")])),_:1,__:[16]}),s(k,{value:"KE",variant:"text",size:"small"},{default:t(()=>e[17]||(e[17]=[n(" Keys ")])),_:1,__:[17]}),s(k,{value:"TG",variant:"text",size:"small"},{default:t(()=>e[18]||(e[18]=[n(" Tags ")])),_:1,__:[18]}),s(k,{value:"Other",variant:"text",size:"small"},{default:t(()=>e[19]||(e[19]=[n(" Other ")])),_:1,__:[19]})]),_:1},8,["modelValue","disabled"]),e[38]||(e[38]=o("div",{class:"flex-grow-1"},null,-1)),s(B,{modelValue:d.dialogDEL,"onUpdate:modelValue":e[1]||(e[1]=l=>d.dialogDEL=l),"max-width":"700px",persistent:""},{default:t(()=>[s(S,null,{default:t(()=>[s(w,null,{default:t(()=>e[20]||(e[20]=[o("span",{class:"text-h5"},"Delete Item?",-1)])),_:1,__:[20]}),s(D,null,{default:t(()=>[s(U,null,{default:t(()=>[s(h,null,{default:t(()=>[s(r,{cols:"12",align:"center"},{default:t(()=>[o("div",te,u(d.editedItem.skuModel.allSearchableFields),1),e[21]||(e[21]=o("div",{class:"text-caption"}," All quantities will be set to 0 ",-1))]),_:1,__:[21]})]),_:1}),s(h,null,{default:t(()=>[s(r,{align:"end"},{default:t(()=>[s(_,{onClick:a.cancel},{default:t(()=>e[22]||(e[22]=[n(" Cancel ")])),_:1,__:[22]},8,["onClick"])]),_:1}),s(r,null,{default:t(()=>[s(v,{onClick:a.save},{default:t(()=>e[23]||(e[23]=[n(" Yes ")])),_:1,__:[23]},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(B,{modelValue:d.dialogCRUD,"onUpdate:modelValue":e[12]||(e[12]=l=>d.dialogCRUD=l),"max-width":"700px",persistent:"",fullscreen:i.$vuetify.display.smAndDown},{activator:t(({props:l})=>[s(v,$({class:"mb-2",loading:a.isSnackbarActive||d.loading,disabled:a.isSnackbarActive||d.loading},l,{onClick:a.setOn}),{default:t(()=>e[24]||(e[24]=[n(" New Item ")])),_:2,__:[24]},1040,["loading","disabled","onClick"])]),default:t(()=>[s(S,null,{default:t(()=>[s(w,null,{default:t(()=>[o("span",se,u(a.formTitle),1)]),_:1}),s(D,null,{default:t(()=>[s(U,null,{default:t(()=>[s(H,{ref:"form",modelValue:d.valid,"onUpdate:modelValue":e[9]||(e[9]=l=>d.valid=l),class:"pb-6"},{default:t(()=>[s(h,null,{default:t(()=>[s(r,{cols:"12",sm:"12",md:"12"},{default:t(()=>[s(O,{modelValue:d.skuModel,"onUpdate:modelValue":[e[2]||(e[2]=l=>d.skuModel=l),a.skuChanged],"product-classes":a.catalogMenuProductClasses,rules:d.skuSearchRules,"excluded-product-classes":a.excludedCatalogMenuProductClasses},X({_:2},[d.skuExists?{name:"details",fn:t(()=>[e[25]||(e[25]=o("p",{class:"text-warning font-weight-bold"}," Item already exists in trunk ",-1))]),key:"0"}:void 0]),1032,["modelValue","product-classes","rules","excluded-product-classes","onUpdate:modelValue"])]),_:1})]),_:1}),s(h,null,{default:t(()=>[s(r,{cols:"12",sm:"2",md:"2",lg:"2"},{default:t(()=>{var l;return[e[26]||(e[26]=o("div",{class:"label"}," Qty. Per Box ",-1)),(l=d.skuModel)!=null&&l.defaultItemsPerBox?(p(),b("div",le,u(d.skuModel.defaultItemsPerBox),1)):g("",!0)]}),_:1,__:[26]}),s(r,{cols:"12",sm:"3",md:"3",lg:"3"},{default:t(()=>[s(V,{modelValue:d.editedItem.numberOfBoxes,"onUpdate:modelValue":[e[3]||(e[3]=l=>d.editedItem.numberOfBoxes=l),a.setBoxInputToZero],label:"Num. of Boxes",type:"number",min:"0",disabled:!a.hasSkuModel,rules:a.validateQty(),onChange:e[4]||(e[4]=l=>a.validate(!1)),onFocus:e[5]||(e[5]=l=>l.target.select())},null,8,["modelValue","disabled","rules","onUpdate:modelValue"])]),_:1}),i.$vuetify.display.smAndDown?g("",!0):(p(),I(r,{key:0,cols:"12",sm:"1",md:"1",lg:"1",align:"center","align-self":"center"},{default:t(()=>e[27]||(e[27]=[n(" = ")])),_:1,__:[27]})),s(r,{cols:"12",sm:"2",md:"2",lg:"2"},{default:t(()=>[e[28]||(e[28]=o("div",{class:"label"}," Box Totals ",-1)),o("div",null,u(a.getTotalFromBox),1)]),_:1,__:[28]})]),_:1}),s(h,null,{default:t(()=>[s(r,{cols:"12",sm:"2",md:"2",lg:"2"},{default:t(()=>[s(V,{modelValue:d.editedItem.singles,"onUpdate:modelValue":[e[6]||(e[6]=l=>d.editedItem.singles=l),a.setIndividualInputToZero],label:"Singles",type:"number",min:"0",disabled:!a.hasSkuModel,rules:a.validateQty(),onChange:e[7]||(e[7]=l=>a.validate(!1)),onFocus:e[8]||(e[8]=l=>l.target.select())},null,8,["modelValue","disabled","rules","onUpdate:modelValue"])]),_:1}),s(r,{cols:"12",sm:"10",md:"10",lg:"10","justify-self":"end",justify:"end"},{default:t(()=>[s(h,{"no-gutters":"","justify-self":"end",justify:"end"},{default:t(()=>[s(r,{sm:"2",md:"2",lg:"2"},{default:t(()=>[e[29]||(e[29]=o("div",{class:"label"}," Total ",-1)),o("div",null,u(a.getRowTotalBySingles===0?"":a.getRowTotalBySingles),1)]),_:1,__:[29]}),s(r,{sm:"2",md:"2",lg:"2"},{default:t(()=>[e[30]||(e[30]=o("div",{class:"label"}," Expected ",-1)),o("div",{"v-model":d.editedItem.expectedTotal},u(a.getExpected),9,ie)]),_:1,__:[30]}),s(r,{sm:"2",md:"2",lg:"2"},{default:t(()=>[e[31]||(e[31]=o("div",{class:"label"}," Difference ",-1)),o("div",{"v-model":a.getDifference},u(a.getDifference),9,de)]),_:1,__:[31]})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),i.$vuetify.display.smAndDown?g("",!0):(p(),I(J,{key:0},{default:t(()=>[s(_,{onClick:a.cancel},{default:t(()=>e[32]||(e[32]=[n(" Cancel ")])),_:1,__:[32]},8,["onClick"]),e[34]||(e[34]=o("div",{class:"flex-grow-1"},null,-1)),s(v,{disabled:!d.valid,onClick:e[10]||(e[10]=l=>a.validate(!0))},{default:t(()=>e[33]||(e[33]=[n(" Save ")])),_:1,__:[33]},8,["disabled"])]),_:1,__:[34]}))]),_:1}),i.$vuetify.display.smAndDown?(p(),I(W,{key:0,height:"64"},{default:t(()=>[s(_,{onClick:a.cancel},{default:t(()=>e[35]||(e[35]=[n(" Cancel ")])),_:1,__:[35]},8,["onClick"]),e[37]||(e[37]=o("div",{class:"flex-grow-1"},null,-1)),s(k,{color:"primary",disabled:!d.valid,onClick:e[11]||(e[11]=l=>a.validate(!0))},{default:t(()=>e[36]||(e[36]=[n(" Save ")])),_:1,__:[36]},8,["disabled"])]),_:1,__:[37]})):g("",!0)]),_:1},8,["modelValue","fullscreen"])]),_:1,__:[38]}),s(M,{color:"surface"},{default:t(()=>[s(V,{modelValue:d.searchTrunkTable,"onUpdate:modelValue":e[13]||(e[13]=l=>d.searchTrunkTable=l),"append-inner-icon":"$vuetify.icons.search",label:"search","single-line":"","hide-details":"",clearable:"",disabled:d.loading,"clear-icon":"$vuetify.icons.times","persistent-hint":""},null,8,["modelValue","disabled"])]),_:1})]),"header.size":t(({column:l})=>[o("tr",null,[d.toggle_filters_global=="TG"?(p(),b("th",ae,[o("span",oe,u(l.title),1)])):g("",!0)])]),"item.data-table-expand":t(({item:l})=>[s(k,{icon:"",class:Y({"v-data-table__expand-icon--active":d.expanded[0]===l.skuModel.sku}),variant:"flat",onClick:x=>a.expandRow(l)},{default:t(()=>[s(C,null,{default:t(()=>e[39]||(e[39]=[n(" $angleDown ")])),_:1,__:[39]})]),_:2},1032,["class","onClick"])]),"item.sku":t(({item:l})=>[n(u(l.skuModel.sku),1)]),"item.description":t(({item:l})=>[n(u(l.skuModel.description),1)]),"item.modified.transaction":t(({item:l})=>[l.modified.isModified?(p(),b("div",ne,[s(Z,{color:"surface-bright",size:"x-small",variant:"flat"},{default:t(()=>[s(C,{start:"",size:"x-small",color:"success",icon:"$vuetify.icons.check"}),n(" "+u(l.modified.transaction),1)]),_:2},1024)])):g("",!0)]),"item.size":t(({item:l})=>[d.toggle_filters_global=="TG"?(p(),b("div",re,[s(E,{"selected-size":l.skuModel.size},null,8,["selected-size"])])):g("",!0)]),"item.numberOfBoxes":t(({item:l})=>[o("span",ue,u(l.numberOfBoxes),1),o("span",me,"of "+u(l.numberPerBox),1)]),"item.diff":t(({item:l})=>[n(u(a.getRowDiff(l.expectedTotal,l.total)),1)]),"item.actions":t(({item:l})=>[s(k,{color:"info",icon:"$vuetify.icons.edit",size:"x-small",class:"mr-3",onClick:x=>a.editItem(l)},null,8,["onClick"]),s(C,{size:"small",color:"error-lighten-2",onClick:x=>a.deleteItem(l)},{default:t(()=>e[40]||(e[40]=[n(" $vuetify.icons.trash ")])),_:2,__:[40]},1032,["onClick"])]),"expanded-row":t(({columns:l,item:x})=>[o("td",{colspan:l.length},[o("div",ge,[s(P,{sku:x.skuModel.sku,"product-type":x.skuModel.productClass,width:"250"},null,8,["sku","product-type"])]),s(Q)],8,fe)]),_:2},1032,["expanded","headers","items","loading","search","single-expand"])]),_:1})]),_:1})]),_:1})}const Pe=G(ee,[["render",pe],["__scopeId","data-v-49931630"]]);export{Pe as default};
