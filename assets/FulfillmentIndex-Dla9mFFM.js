import B from"./SearchFormFieldset-B0Hj3kv8.js";import U from"./SearchFormInput-dGgQLNML.js";import A from"./SearchFormRow-DzURwVUk.js";import L from"./MeruDataTable-jf3gvfqw.js";import M from"./SearchForm-Bsxklmov.js";import K from"./DefaultLayout-DdfUBm6-.js";import q from"./PrintPickLabel-D0hzfgH7.js";import N from"./StageChip-BefCQc9-.js";import{u as O}from"./tableQueryParams-BJUPd67r.js";import{_ as Q,e as R,c as E,o as j,x as G}from"./index-LK9MQE2L.js";import{c as J,a as z}from"./vuex-D3TwipD2.js";import{a1 as H,A as W,i as Y,d as X,ab as Z,O as b,b as $,aA as ee}from"./vuetify-BgnNF2O3.js";import{m as P,I as T}from"./date-fns-2ylUqVpG.js";import{C as h,i,e as r,B as o,_ as m,s as S,b as _,g as te,F as se,J as k,H as c,x as ae,A as p}from"./@vue-DNrUJgob.js";import"./@babel-BTTPuEuv.js";import"./vue-component-docs-plugin-BnqcuvvC.js";import"./vue-router-BVOKdCCq.js";import"./axios-xsH4HHeE.js";import"./axios-cache-interceptor-DgAMPFM2.js";import"./cache-parser-DXYp_BCq.js";import"./fast-defer-9MI9za_P.js";import"./object-code-SBtdq8jY.js";import"./@fortawesome-BWcQmPY7.js";import"./@awesome.me-Btqfd-fw.js";import"./DatePicker-BuTbACp2.js";import"./@vuepic-Coh5ezXU.js";import"./ResultsLimitMenu-P4cTAkLT.js";import"./ConfirmDialog-BdnzEXkJ.js";import"./PrintTeleporter-BFqk3Ikm.js";import"./PickLabel-CVXYlvTb.js";import"./BarcodeGenerator-DjF3cJwR.js";import"./bwip-js-DL1APdek.js";const re={components:{PrintPickLabel:q,MeruDataTable:L,SearchForm:M,SearchFormFieldset:B,SearchFormInput:U,SearchFormRow:A,StageChip:N,DefaultLayout:K},setup(){const{filters:e,sortBy:t,pagination:l}=O({initialSortBy:[{key:"timestamp",order:"desc"}],initialFilters:{transactionId:"",carKeys:!0,endlessAisle:!0,stages:[]},initialPagination:{itemsPerPage:10,page:1}}),{mdAndDown:a,smAndUp:n}=ee();return{sortBy:t,filters:e,pagination:l,mdAndDown:a,smAndUp:n}},data(){return{isSearching:!1,tickets:[],selectedTicketsToPrint:[],selectableStage:"pending-print",headers:[{title:"Stage",value:"stage",sortable:!0},{title:"Transaction ID",value:"transactionId",sortable:!0},{title:"Received",value:"timestamp",sortable:!0},{title:"Category",value:"category"},{title:"SKU",value:"sku"},{title:"QTY",value:"quantity"},{title:"Ships To",value:"shipToCustomer"},{title:"",value:"actions"}],stageItems:G}},computed:{...z("orders",["skipInitialPrintConfirmation"]),formattedTickets(){return this.tickets.map(e=>(e.hasMultipleSkus=e.items.length>1,e.formattedDate=this.getFormattedDate(e.timestamp),e.formattedTime=this.getFormattedTime(e.timestamp),e.totalQuantity=this.getQuantity(e),e.category=this.getCategory(e),e.categoryImageUrl=this.getCategoryImageSource(e.category),e.displayedSku=this.getDisplayedSku(e),e.selectable=this.getIsPendingPrintTicket(e),e))},filteredTickets(){let e=[],t=this.formattedTickets;return this.filters.carKeys&&e.push("car-key"),this.filters.endlessAisle&&e.push("endless-aisle-key"),t=t.filter(l=>l.items.some(a=>e.includes(a.category))),this.filters.transactionId&&(t=t.filter(l=>l.transactionId.toLowerCase().includes(this.filters.transactionId.toLowerCase()))),this.filters.stages.length&&(t=t.filter(l=>this.filters.stages.includes(l.stage))),t},filteredStageItems(){return this.stageItems.filter(e=>this.tickets.some(t=>t.stage===e.value))},hasPendingPrintTickets(){return this.tickets.some(e=>this.getIsPendingPrintTicket(e))}},mounted(){this.searchTickets()},methods:{...J("orders",["setSkipInitialPrintConfirmation"]),getOrderStageName:E,getOrderStageColor:R,async searchTickets(){this.isSearching=!0;try{const{data:e}=await j.fetchOrdersNeedingFulfillment();this.tickets=e}catch{this.$store.dispatch("app/setSnackbar",{message:"Failed to load fulfillment tickets",color:"error"})}finally{this.isSearching=!1}},getCategory(e){var t;return(t=e.items[0])==null?void 0:t.category},getDisplayedSku(e){var t;return e.hasMultipleSkus?"Multiple SKUs":(t=e.items[0])==null?void 0:t.hillmanSku},getIsPendingPrintTicket(e){return e.stage===this.selectableStage},getQuantity(e){var t;return e.hasMultipleSkus?e.items.reduce((l,a)=>l+a.quantity,0):(t=e.items[0])==null?void 0:t.quantity},getFormattedDate(e){return P(T(e),"EEE, MMM dd, yyyy")},getFormattedTime(e){return P(T(e),"h:mm a")},getCategoryImageSource(e){return e==="car-key"?new URL("/assets/car-key-BSKSGyvu.svg",import.meta.url).href:new URL("/assets/endless-aisle-key-BGx-GJnj.svg",import.meta.url).href},async handlePrintConfirmation(e){await this.searchTickets(),e.result==="successful"?this.selectedTicketsToPrint=[]:this.selectedTicketsToPrint=e.failedOrders.map(t=>t.order)}}},ie={class:"px-4"},oe={class:"item-category__image-container"},le={class:"font-weight-bold"},ne=["colspan"],me={class:"item-category__image-container"};function de(e,t,l,a,n,d){const g=m("SearchFormInput"),y=m("SearchFormFieldset"),x=m("SearchFormRow"),w=m("SearchForm"),C=m("PrintPickLabel"),I=m("StageChip"),V=m("VBtnPrimary"),v=m("MeruDataTable"),F=m("DefaultLayout");return p(),h(F,{"no-content-padding":"",class:"fulfillment-index"},{default:i(()=>[r(H,{indeterminate:"",active:n.isSearching,absolute:"","rounded-bar":"",color:"primary-darken-1"},null,8,["active"]),r(w,{"form-data":a.filters},{default:i(()=>[r(x,null,{default:i(()=>[r(y,{"col-props":{cols:12,sm:6,lg:3},"show-border-bottom":a.mdAndDown},{default:i(()=>[r(g,{modelValue:a.filters.transactionId,"onUpdate:modelValue":t[0]||(t[0]=s=>a.filters.transactionId=s),"prepend-icon":a.smAndUp?"filter":void 0,"col-props":{cols:12},"input-type":"VTextField",label:"Transaction ID"},null,8,["modelValue","prepend-icon"])]),_:1},8,["show-border-bottom"]),r(y,{"col-props":{cols:12,sm:6,lg:4},"show-border-bottom":a.mdAndDown},{default:i(()=>[r(g,{modelValue:a.filters.stages,"onUpdate:modelValue":t[1]||(t[1]=s=>a.filters.stages=s),"input-type":"VSelect",label:"Stage",items:d.filteredStageItems,multiple:""},null,8,["modelValue","items"])]),_:1},8,["show-border-bottom"]),r(y,{class:"d-flex align-center justify-start","col-props":{cols:12,sm:8,md:10,lg:3},"row-props":{class:"flex-nowrap"}},{default:i(()=>[r(g,{modelValue:a.filters.carKeys,"onUpdate:modelValue":t[2]||(t[2]=s=>a.filters.carKeys=s),label:"Car Key","input-type":"VCheckbox",color:"primary-darken-1","hide-details":"",density:"compact",class:"d-inline-block flex-grow-0 mr-4"},null,8,["modelValue"]),r(g,{modelValue:a.filters.endlessAisle,"onUpdate:modelValue":t[3]||(t[3]=s=>a.filters.endlessAisle=s),"input-type":"VCheckbox",label:"Endless Aisle",color:"primary-darken-1","hide-details":"",density:"compact",class:"d-inline-block flex-grow-0"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["form-data"]),o("div",ie,[d.hasPendingPrintTickets?(p(),h(W,{key:0,color:"blue-grey-lighten-5",class:"px-4 mt-4"},{default:i(()=>[t[9]||(t[9]=o("p",{class:"px-4 text-caption font-italic font-weight-medium text-primary"}," * Select pending print orders to print labels ",-1)),r(Y),r(C,{orders:n.selectedTicketsToPrint,onPrintProcessComplete:d.handlePrintConfirmation,onPrintCanceled:t[4]||(t[4]=s=>n.selectedTicketsToPrint=[])},null,8,["orders","onPrintProcessComplete"])]),_:1,__:[9]})):S("",!0)]),r(v,{"sort-by":a.sortBy,"onUpdate:sortBy":t[5]||(t[5]=s=>a.sortBy=s),"items-per-page":a.pagination.itemsPerPage,"onUpdate:itemsPerPage":t[6]||(t[6]=s=>a.pagination.itemsPerPage=s),page:a.pagination.page,"onUpdate:page":t[7]||(t[7]=s=>a.pagination.page=s),modelValue:n.selectedTicketsToPrint,"onUpdate:modelValue":t[8]||(t[8]=s=>n.selectedTicketsToPrint=s),"return-object":"","item-value":"transactionId",headers:n.headers,items:d.filteredTickets,loading:n.isSearching,"loading-text":"Loading Tickets",class:"elevation-0 on-surface-high-contrast-text","expand-icon":"$vuetify.icons.angleDown","show-expand":"","is-using-query-params":"","item-selectable":"selectable","show-select":d.hasPendingPrintTickets},{"item.data-table-expand":i(({item:s,isExpanded:u,internalItem:f,toggleExpand:D})=>[s.hasMultipleSkus?(p(),h($,{key:0,color:"primary-lighten-2",icon:"$angleDown",class:ae({"v-data-table__expand-icon--active":u(f)}),variant:"text",onClick:ce=>D(f)},null,8,["class","onClick"])):S("",!0)]),"item.stage":i(({item:s})=>[r(I,{stage:s.stage},null,8,["stage"])]),"item.category":i(({item:s})=>[o("div",oe,[r(b,{src:s.categoryImageUrl,class:"d-block","max-width":"100%"},null,8,["src"])])]),"item.sku":i(({item:s})=>[o("span",null,c(s.displayedSku),1),s.hasMultipleSkus?(p(),h(Z,{key:0,color:"primary",content:s.items.length,class:"ml-2",inline:""},null,8,["content"])):S("",!0)]),"item.quantity":i(({item:s})=>[k(c(s.totalQuantity),1)]),"item.timestamp":i(({item:s})=>[o("span",le,c(s.formattedDate),1),t[10]||(t[10]=k()),o("span",null,c(s.formattedTime),1)]),"item.shipToCustomer":i(({item:s})=>[r(X,{color:"primary-darken-1",icon:s.shipToCustomer?"$user":"$personWrenchSolid"},null,8,["icon"])]),"item.actions":i(({item:s})=>[r(V,{to:{name:"fulfillmentDetails",params:{sessionId:s.sessionId}}},{default:i(()=>t[11]||(t[11]=[k(" Details ")])),_:2,__:[11]},1032,["to"])]),"expanded-row":i(({item:s})=>[(p(!0),_(se,null,te(s.items,(u,f)=>(p(),_("tr",{key:f,colspan:n.headers.length},[t[12]||(t[12]=o("td",{colspan:"3",class:"expanded-row__place-holder"},null,-1)),o("td",null,[o("div",me,[r(b,{src:d.getCategoryImageSource(u.category),class:"d-block","max-width":"100%"},null,8,["src"])])]),o("td",null,c(u.hillmanSku),1),o("td",null,c(u.quantity),1),t[13]||(t[13]=o("td",{colspan:"3",class:"expanded-row__place-holder"},null,-1))],8,ne))),128))]),_:2},1032,["sort-by","items-per-page","page","modelValue","headers","items","loading","show-select"])]),_:1})}const je=Q(re,[["render",de],["__scopeId","data-v-82d54938"]]);export{je as default};
