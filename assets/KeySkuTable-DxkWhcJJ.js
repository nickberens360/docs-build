import E from"./MeruDataTable-jf3gvfqw.js";import{m as F}from"./vuex-D3TwipD2.js";import{_ as z,r as j,b as L,k as H,s as O}from"./index-LK9MQE2L.js";import W from"./ImageUploader-DHpKRUIg.js";import G from"./CurrencyInput-CGI9Mz8R.js";import J from"./ProductImage-CvO1b8Ha.js";import{b as u,e as s,s as m,N as Y,i as a,J as r,B as n,C as f,k as h,l as C,p as $,H as g,F as _,g as D,x as X,_ as y,A as d,O as Z}from"./@vue-DNrUJgob.js";import{U as M,T as ee,b as V,s as w,d as c,p as B,u as b,l as Q,m as te,t as ae,aj as le,x as T,w as p,n as se,r as ie,i as oe,k as re,v as A}from"./vuetify-BgnNF2O3.js";import"./date-fns-2ylUqVpG.js";import"./@babel-BTTPuEuv.js";import"./vue-component-docs-plugin-BnqcuvvC.js";import"./vue-router-BVOKdCCq.js";import"./axios-xsH4HHeE.js";import"./axios-cache-interceptor-DgAMPFM2.js";import"./cache-parser-DXYp_BCq.js";import"./fast-defer-9MI9za_P.js";import"./object-code-SBtdq8jY.js";import"./@fortawesome-BWcQmPY7.js";import"./@awesome.me-Btqfd-fw.js";import"./vue-currency-input-D7Z-DvZH.js";const de={components:{MeruDataTable:E,ProductImage:J,ImageUploader:W,CurrencyInput:G},props:{loading:Boolean,design:{type:Object,default:()=>({})},machineTypes:{type:Array,default:()=>[]}},emits:["reset-sku-image","new-image","add-sku","delete-sku","toggle-deprecation-status"],data:()=>({lazyKeyImage:new URL("/assets/KE-DYw-PaQ0.png",import.meta.url).href,showDialog:!1,tabIdx:void 0,formIsValid:void 0,replaceImageSku:null,newSku:{sku:"",primaryQty:"",secondaryQty:"",imgData:"",compatibleMachines:[],standardCost:null},skuValidationErrors:[],hasBeenValidated:!1,test:void 0}),computed:{...F({environment:"app/getEnvConfigs"}),activeSkus(){return this.design.skus&&this.design.skus.filter(l=>!l.deprecated)||[]},deprecatedSkus(){return this.design.skus&&this.design.skus.filter(l=>l.deprecated)||[]},skuValidationRules(){return O(this.design.designCode)}},watch:{showDialog(l){l&&this.design.skus.length&&(this.newSku.compatibleMachines=this.design.skus[this.design.skus.length-1].compatibleMachines)}},methods:{required:j,selectAll(l,t=!0){t&&l.target.select()},validate(){return this.hasBeenValidated=!0,this.design.skus.length>0},isBarcode(l){return l.substr(3,2)==="BC"},getKeyway(l){return H[l.substr(1,2)]},resetSkuImage(l){this.$emit("reset-sku-image",l)},replaceImageInline(l){this.replaceImageSku=l,this.$refs.upload.click()},onNewImage(l){this.$emit("new-image",{file:l,sku:this.replaceImageSku}),this.replaceImageSku=null},cancelAddSku(){this.showDialog=!1,this.$refs.form.reset(),this.$refs.uploader.reset()},async addSku(l){l.target.blur();const t=await this.$refs.uploader.validate();if(!(this.formIsValid&&t))return;this.showDialog=!1;const{compatibleMachines:k,standardCost:v}=this.newSku,I={sku:this.newSku.sku.toUpperCase(),compatibleMachines:k,standardCost:v,imgData:this.newSku.imgData,designId:this.design.id,primaryQty:this.newSku.primaryQty,secondaryQty:this.newSku.secondaryQty};this.$emit("add-sku",I),this.$refs.form.reset(),this.$refs.uploader.reset(),this.tabIdx=0},deleteSku(l){this.$emit("delete-sku",l)},positiveInteger(l){return!l||/^\d+$/.test(l)||"must be a positive integer"},validateSkuUnique(l){l&&l.length===15?L.checkSkuExistence(this.newSku.sku).then(({data:t})=>{this.skuValidationErrors=t.exists?["sku already exists"]:[]}):this.skuValidationErrors=[]}}},ne={style:{position:"relative"}},ue={key:0,class:"d-flex justify-end"},me={key:1},pe={key:0},ke={class:"d-flex align-center justify-space-between"},fe={key:0,class:"text-center text-caption text-error"},ge={key:0};function ye(l,t,k,v,I,o){const U=y("CurrencyInput"),K=y("ProductImage"),N=y("MeruDataTable"),P=y("ImageUploader"),R=y("VBtnSecondary"),q=y("VBtnPrimary");return d(),u("div",ne,[s(ee,{modelValue:l.tabIdx,"onUpdate:modelValue":t[0]||(t[0]=e=>l.tabIdx=e),"show-arrows":"","mobile-breakpoint":1},{default:a(()=>[s(M,null,{default:a(()=>t[11]||(t[11]=[r("Active SKUs")])),_:1,__:[11]}),s(M,null,{default:a(()=>t[12]||(t[12]=[r("Deprecated SKUs")])),_:1,__:[12]})]),_:1},8,["modelValue"]),l.tabIdx===0?(d(),u("div",ue,[s(V,{color:"primary",onClick:t[1]||(t[1]=e=>l.showDialog=!0)},{default:a(()=>t[13]||(t[13]=[r(" Add Sku ")])),_:1,__:[13]})])):m("",!0),s(N,{"no-data-text":`No ${["Active","Deprecated"][l.tabIdx]} SKUs`,loading:k.loading,"disable-pagination":"","hide-default-footer":"","disable-sort":"",headers:[{title:"SKU",key:"sku",minWidth:200},{title:"Std Cost",key:"standardCost",width:150},{title:"BC",key:"bc"},{title:"Primary",key:"primary",width:50},{title:"Secondary",key:"secondary",width:50},{title:"Image",key:"image"},{title:"Keyway",key:"keyway"},{title:"Compatible Machines",key:"compatibleMachines",minWidth:150},{title:"Actions",key:"actions"}],items:[o.activeSkus,o.deprecatedSkus][l.tabIdx]},{"column.bc":a(({column:e})=>[s(w,{location:"top"},{activator:a(({props:i})=>[n("span",h(C(i)),[r(g(e.title),1),s(c,{size:"small",class:"ml-1 text-primary-lighten-3",style:{position:"relative",bottom:"1px"}},{default:a(()=>t[14]||(t[14]=[r("$questionCircle")])),_:1,__:[14]})],16)]),default:a(()=>[t[15]||(t[15]=n("span",null,"Barcode: inferred from sku",-1))]),_:2,__:[15]},1024)]),"column.keyway":a(({column:e})=>[s(w,{location:"top"},{activator:a(({props:i})=>[n("span",h(C(i)),[r(g(e.title),1),s(c,{size:"small",class:"ml-1 text-primary-lighten-3",style:{position:"relative",bottom:"1px"}},{default:a(()=>t[16]||(t[16]=[r("$questionCircle")])),_:1,__:[16]})],16)]),default:a(()=>[t[17]||(t[17]=n("span",null,"Keyway: inferred from sku",-1))]),_:2,__:[17]},1024)]),"item.standardCost":a(({item:e})=>[s(U,{modelValue:e.standardCost,"onUpdate:modelValue":i=>e.standardCost=i,modelModifiers:{lazy:!0},options:{allowNegative:!1,precision:4},placeholder:"none",onFocus:o.selectAll},null,8,["modelValue","onUpdate:modelValue","onFocus"])]),"item.bc":a(({item:e})=>[o.isBarcode(e.sku)?(d(),f(c,{key:0,style:{"vertical-align":"bottom"}},{default:a(()=>t[18]||(t[18]=[r(" $vuetify.icons.barcode ")])),_:1,__:[18]})):(d(),u("span",me,"N/A"))]),"item.primary":a(({item:e})=>[s(b,{modelValue:e.primaryQty,"onUpdate:modelValue":i=>e.primaryQty=i,rules:[o.required,o.positiveInteger]},null,8,["modelValue","onUpdate:modelValue","rules"])]),"item.secondary":a(({item:e})=>[s(b,{modelValue:e.secondaryQty,"onUpdate:modelValue":i=>e.secondaryQty=i,rules:[o.positiveInteger]},null,8,["modelValue","onUpdate:modelValue","rules"])]),"item.image":a(({item:e})=>[s(K,{src:e.imgData&&e.imgData.previewURL||l.environment.skuImageBaseUrl+(e.imgData?"tmp/":"")+e.sku+"?"+e.imageHash,"product-type":e.productClass,width:"190px",height:"80px",class:"my-2"},null,8,["src","product-type"])]),"item.keyway":a(({item:e})=>[n("span",{class:X(o.getKeyway(e.sku)?"":"text-error font-weight-bold")},g(o.getKeyway(e.sku)||"Unknown"),3)]),"item.compatibleMachines":a(({item:e})=>[s(B,{modelValue:e.compatibleMachines,"onUpdate:modelValue":i=>e.compatibleMachines=i,class:"my-2",variant:"outlined",multiple:"","hide-details":"",items:k.machineTypes,"item-title":i=>i.desc,"item-value":i=>i.code},{selection:a(({index:i})=>[i===0?(d(),u("span",pe,[(d(!0),u(_,null,D([...e.compatibleMachines].sort(),(S,x)=>(d(),f(A,{key:x},{default:a(()=>[r(g(S),1)]),_:2},1024))),128))])):m("",!0)]),_:2},1032,["modelValue","onUpdate:modelValue","items","item-title","item-value"])]),"item.actions":a(({item:e})=>[n("div",ke,[s(w,{location:"bottom"},{activator:a(({props:i})=>[s(V,{icon:"",onClick:S=>o.replaceImageInline(e.sku)},{default:a(()=>[s(c,h(C(i)),{default:a(()=>t[19]||(t[19]=[r(" $image ")])),_:2,__:[19]},1040)]),_:2},1032,["onClick"])]),default:a(()=>[t[20]||(t[20]=n("span",null,"Replace Image",-1))]),_:2,__:[20]},1024),e.imgData&&e.skuId!==void 0?(d(),f(w,{key:0,location:"bottom"},{activator:a(({props:i})=>[s(V,{icon:"",onClick:S=>o.resetSkuImage(e.sku)},{default:a(()=>[s(c,h(C(i)),{default:a(()=>t[21]||(t[21]=[r(" $undo ")])),_:2,__:[21]},1040)]),_:2},1032,["onClick"])]),default:a(()=>[t[22]||(t[22]=n("span",null,"Reset Sku",-1))]),_:2,__:[22]},1024)):m("",!0),e.skuId===void 0?(d(),f(w,{key:1,location:"bottom"},{activator:a(({props:i})=>[s(V,$(i,{icon:"",onClick:S=>o.deleteSku(e)}),{default:a(()=>[s(c,null,{default:a(()=>t[23]||(t[23]=[r("$trash")])),_:1,__:[23]})]),_:2},1040,["onClick"])]),default:a(()=>[t[24]||(t[24]=n("span",null,"Delete Sku",-1))]),_:2,__:[24]},1024)):m("",!0),e.skuId!==void 0?(d(),f(V,{key:2,variant:"outlined",onClick:i=>l.$emit("toggle-deprecation-status",e)},{default:a(()=>[r(g(e.deprecated?"Restore":"Deprecate"),1)]),_:2},1032,["onClick"])):m("",!0)])]),footer:a(()=>[l.hasBeenValidated&&!k.design.skus.length?(d(),u("div",fe," must be at least one SKU ")):m("",!0)]),_:2},1032,["no-data-text","loading","items"]),s(re,{modelValue:l.showDialog,"onUpdate:modelValue":t[9]||(t[9]=e=>l.showDialog=e)},{default:a(()=>[s(Q,{flat:"",rounded:"0",color:"surface-light"},{default:a(()=>[s(te,null,{default:a(()=>t[25]||(t[25]=[r("Add a Sku")])),_:1,__:[25]}),s(ae,null,{default:a(()=>[s(Q,{flat:"",color:"surface"},{default:a(()=>[s(le,null,{default:a(()=>[s(T,{class:"align-stretch"},{default:a(()=>[s(p,{cols:"12",sm:"6"},{default:a(()=>[s(se,{ref:"form",modelValue:l.formIsValid,"onUpdate:modelValue":t[7]||(t[7]=e=>l.formIsValid=e)},{default:a(()=>[s(T,null,{default:a(()=>[s(p,{cols:"12"},{default:a(()=>[s(b,{modelValue:l.newSku.sku,"onUpdate:modelValue":[t[2]||(t[2]=e=>l.newSku.sku=e),o.validateSkuUnique],class:"text-uppercase",autofocus:"",label:"New SKU",rules:[o.required,...o.skuValidationRules],"error-messages":l.skuValidationErrors,counter:15},null,8,["modelValue","rules","error-messages","onUpdate:modelValue"])]),_:1}),s(p,{cols:"6"},{default:a(()=>[s(b,{modelValue:l.newSku.primaryQty,"onUpdate:modelValue":t[3]||(t[3]=e=>l.newSku.primaryQty=e),modelModifiers:{number:!0},type:"number",label:"Primary Qty",rules:[o.required,o.positiveInteger]},null,8,["modelValue","rules"])]),_:1}),s(p,{cols:"6"},{default:a(()=>[s(b,{modelValue:l.newSku.secondaryQty,"onUpdate:modelValue":t[4]||(t[4]=e=>l.newSku.secondaryQty=e),modelModifiers:{number:!0},type:"number",label:"Secondary Qty",rules:[o.positiveInteger]},null,8,["modelValue","rules"])]),_:1}),s(p,{cols:"6"},{default:a(()=>[s(B,{modelValue:l.newSku.compatibleMachines,"onUpdate:modelValue":t[5]||(t[5]=e=>l.newSku.compatibleMachines=e),multiple:"","hide-details":"",label:"Compatible Machines",items:k.machineTypes,"item-title":e=>e.desc,"item-value":e=>e.code},{selection:a(({index:e})=>[e===0?(d(),u("span",ge,[(d(!0),u(_,null,D([...l.newSku.compatibleMachines].sort(),i=>(d(),f(A,{key:i},{default:a(()=>[r(g(i),1)]),_:2},1024))),128))])):m("",!0)]),_:1},8,["modelValue","items","item-title","item-value"])]),_:1}),s(p,{cols:"6"},{default:a(()=>[s(U,{modelValue:l.newSku.standardCost,"onUpdate:modelValue":t[6]||(t[6]=e=>l.newSku.standardCost=e),modelModifiers:{lazy:!0},options:{allowNegative:!1,precision:4},label:"Standard Cost",placeholder:"none","hide-details":"",onFocus:o.selectAll},null,8,["modelValue","onFocus"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),s(p,{cols:"12",sm:"6"},{default:a(()=>[s(P,{ref:"uploader",rules:[o.required],accept:"image/jpeg,image/png",height:"150",width:"380",onNewImage:t[8]||(t[8]=e=>l.newSku.imgData=e)},null,8,["rules"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),s(ie,{class:"pb-4 pt-0 px-4"},{default:a(()=>[s(R,{onClick:o.cancelAddSku},{default:a(()=>t[26]||(t[26]=[r(" Cancel ")])),_:1,__:[26]},8,["onClick"]),s(oe),s(q,{disabled:!l.formIsValid,class:"ml-2",light:"",onClick:o.addSku},{default:a(()=>t[27]||(t[27]=[r(" Add ")])),_:1,__:[27]},8,["disabled","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),Y(n("input",{ref:"upload",accept:"image/jpeg,image/png",type:"file",onChange:t[10]||(t[10]=e=>o.onNewImage(e.target.files[0]))},null,544),[[Z,!1]])])}const Re=z(de,[["render",ye]]);export{Re as default};
