import{a as S}from"./vuex-BwOdvJvI.js";import j from"./S3Image-Nx2_ROq-.js";import{A as O,_ as M}from"./index-AG15HfzG.js";import{C as w,i as a,e as t,b as p,s as g,J as s,H as h,E,B as n,_ as z,G as L,N as f,O as v,p as k,D as N,A as d}from"./@vue-mGKKYCuj.js";import{t as y,v as U,X as q,a0 as K,e as B,V as W,a as F,d as m,a1 as Y,b as u,a2 as b,Z as H,x as J,w as R,f as X,p as $,s as V,k as D,l as C,m as A,r as _,i as x,u as G,W as Z}from"./vuetify-BymGJ7fC.js";import"./date-fns-Cq_iz7V_.js";import"./@babel-BTTPuEuv.js";import"./vue-component-docs-plugin-CX_tIU2Y.js";import"./vue-router-CgUA7A7W.js";import"./axios-xsH4HHeE.js";import"./axios-cache-interceptor-DgAMPFM2.js";import"./cache-parser-DXYp_BCq.js";import"./fast-defer-9MI9za_P.js";import"./object-code-SBtdq8jY.js";import"./@fortawesome-C0fAH5tI.js";import"./@awesome.me-Btqfd-fw.js";const Q="/kiosk-images",ee=({KioskImageId:i},e)=>O().put(`${Q}/${i}`,{action:"ROTATE",rotationDirection:e}),te={components:{S3Image:j},props:{image:{type:Object,default:()=>({})},categories:{type:Array,default:()=>[]},hasApprovalPermission:Boolean},emits:["recat","rotate","delete","approvalChange"],data:()=>({isContextMenuShown:!1,contextMenuPosition:{x:void 0,y:void 0},rejectionDialogOpen:!1,deleteDialogOpen:!1,placeholders:["image is too blurry","kiosk is too far away","lighting is too dim","wrong orientation","resolution too low"],newApprovalDesc:"",relativeRotation:0,rotationRequestInProgress:!1,imgKey:0,initialAspectRatio:void 0}),computed:{...S("user",["user"]),normalizedRotation(){return this.relativeRotation%360},objectKey(){return`${this.image.serialNumber}/${this.image.imageFilename+(this.image.version?`?v=${this.image.version}`:"")}`},imageHeight(){return this.isInitialAspectRatio?void 0:this.$el.clientWidth},isInitialAspectRatio(){return this.relativeRotation%180===0},hasEditPermission(){return this.hasApprovalPermission||this.image.userId===this.user.id},thisCategory:{get(){return this.categories.find(i=>i.code===this.image.imageCategory)},set(i){this.$emit("recat",{kioskImage:this.image,imageCategory:i})}},specificCategories(){return this.categories.filter(i=>i.code!=="A")},randomPlaceholder(){return this.placeholders[Math.floor(Math.random()*this.placeholders.length)]},isRotating(){return this.relativeRotation%360!==0},approvalStatus(){switch(this.image.approvalType){case"A":return{abbr:"A",name:"Approved",color:"success"};case"R":return{abbr:"R",name:"Needs Retake",color:"error"};default:return{abbr:"U",name:"New",color:"warning"}}}},created(){this.newApprovalDesc=this.image.approvalDesc},methods:{showContextMenu(i){this.isContextMenuShown=!1,this.contextMenuPosition={x:i.clientX,y:i.clientY},this.$nextTick(()=>this.isContextMenuShown=!0)},imageLoaded(i){const{clientWidth:e,clientHeight:r}=i;this.initialAspectRatio=e/r},rotate(i){const e=i?90:-90;this.relativeRotation+=e},confirmRotation(){if(this.normalizedRotation===0)return;let i="";switch(this.normalizedRotation){case 90:case-270:i="Right";break;case 180:case-180:i="UpsideDown";break;case 270:case-90:i="Left";break}this.rotationRequestInProgress=!0,ee(this.image,i).then(({data:e})=>{this.relativeRotation=0,this.rotationRequestInProgress=!1,this.$emit("rotate",{newVersion:e,kioskImageId:this.image.KioskImageId})})},confirmDelete(){this.deleteDialogOpen=!1,this.$emit("delete",this.image)},approvalChange(i){this.rejectionDialogOpen=!1,i==="APPROVE"&&(this.newApprovalDesc=""),this.$emit("approvalChange",{action:i,kioskImage:this.image,approvalDesc:this.newApprovalDesc})},cancelReject(){this.newApprovalDesc=this.image.approvalDesc,this.rejectionDialogOpen=!1}}},ae={key:0,class:"text-warning font-weight-bold"},ie={key:1,class:"text-error font-weight-bold"},oe={key:2,class:"text-success font-weight-bold"},le={class:"position-absolute top-0 left-0 w-100 h-100"},se={class:"d-flex flex-column align-center justify-center h-100"},ne={key:1,class:"actions"},re={key:2,class:"actions"},ue={class:"d-flex align-start justify-space-between"},de={key:0,style:{"min-width":"68px"}};function me(i,e,r,pe,ge,o){const I=z("S3Image");return d(),w(Z,null,{default:a(({isHovering:c,props:P})=>[t(C,k(P,{height:"100%",class:"d-flex flex-column justify-space-between"}),{default:a(()=>[t(y,{class:"pb-0 status-msg"},{default:a(()=>[t(U,{label:"",class:"status-msg__chip font-weight-bold mb-2",size:"small",color:o.approvalStatus.color},{default:a(()=>[s(h(o.approvalStatus.name),1)]),_:1},8,["color"]),r.image.approvalType==="U"?(d(),p("p",ae," Hang tight! Pending review. ")):g("",!0),r.image.approvalType==="R"?(d(),p("p",ie,h(r.image.approvalDesc||"[ No Issue Description ]"),1)):g("",!0),r.image.approvalType==="A"?(d(),p("p",oe," Congrats! Image approved. ")):g("",!0)]),_:1}),t(q,{"aspect-ratio":i.$vuetify.display.smAndDown?void 0:3/4,class:"responsive-container",onContextmenu:E(o.showContextMenu,["prevent"])},{default:a(()=>[t(I,{height:o.imageHeight,blob:r.image.blob,bucket:"minutekey-kiosk-images","object-key":o.objectKey,"lazy-key":"samples/loadingimage.png","v-img-style":`opacity:${o.isRotating||i.rotationRequestInProgress?.7:1};transition:opacity 0.2s ease;transform: rotate(${i.relativeRotation}deg);transition: transform 0.2s ease;`,onLoad:o.imageLoaded},null,8,["height","blob","object-key","v-img-style","onLoad"]),r.image.imageFilename?(d(),w(K,{key:0,modelValue:i.isContextMenuShown,"onUpdate:modelValue":e[0]||(e[0]=l=>i.isContextMenuShown=l),style:L(`top: ${i.contextMenuPosition.y}px; left: ${i.contextMenuPosition.x}px;`),class:"position-absolute"},{default:a(()=>[t(B,{density:"compact"},{default:a(()=>[t(W,{target:"_blank",href:`https://minutekey-kiosk-images.s3.amazonaws.com/${o.objectKey}`},{append:a(()=>[t(m,{size:"small"},{default:a(()=>e[15]||(e[15]=[s(" $vuetify.icons.externalLink ")])),_:1,__:[15]})]),default:a(()=>[t(F,null,{default:a(()=>e[14]||(e[14]=[s("View Image")])),_:1,__:[14]})]),_:1},8,["href"])]),_:1})]),_:1},8,["modelValue","style"])):g("",!0),n("div",le,[n("div",se,[t(Y,null,{default:a(()=>[f(t(u,{loading:i.rotationRequestInProgress,size:"large",onClick:o.confirmRotation},{default:a(()=>[e[17]||(e[17]=s(" Apply ")),t(m,{end:""},{default:a(()=>e[16]||(e[16]=[s(" $vuetify.icons.save ")])),_:1,__:[16]})]),_:1,__:[17]},8,["loading","onClick"]),[[v,o.isRotating]])]),_:1})])]),o.hasEditPermission&&!i.rotationRequestInProgress?(d(),p("div",ne,[n("div",null,[t(b,null,{default:a(()=>[f(t(u,{size:"x-small",icon:"",onClick:e[1]||(e[1]=l=>o.rotate(!1))},{default:a(()=>[t(m,null,{default:a(()=>e[18]||(e[18]=[s("$vuetify.icons.rotateCCW")])),_:1,__:[18]})]),_:2},1536),[[v,c]])]),_:2},1024),t(b,null,{default:a(()=>[f(t(u,{size:"x-small",icon:"",onClick:e[2]||(e[2]=l=>o.rotate(!0))},{default:a(()=>[t(m,null,{default:a(()=>e[19]||(e[19]=[s("$vuetify.icons.rotateCW")])),_:1,__:[19]})]),_:2},1536),[[v,c]])]),_:2},1024)]),t(b,null,{default:a(()=>[f(t(u,{size:"x-small",icon:"",onClick:e[3]||(e[3]=l=>i.deleteDialogOpen=!0)},{default:a(()=>[t(m,null,{default:a(()=>e[20]||(e[20]=[s("$trash")])),_:1,__:[20]})]),_:2},1536),[[v,c]])]),_:2},1024)])):o.hasEditPermission?g("",!0):(d(),p("div",re,[t(b,null,{default:a(()=>[f(t(H,{color:"surface",width:"100%",icon:"$vuetify.icons.lock"},{default:a(()=>e[21]||(e[21]=[s(" Not Your Image ")])),_:2,__:[21]},1536),[[v,c]])]),_:2},1024)]))]),_:2},1032,["aspect-ratio","onContextmenu"]),t(y,{class:"pb-0"},{default:a(()=>[t(J,{class:"text-subtitle-2 mx-0 mb-0 w-100 justify-space-between"},{default:a(()=>[t(R,{class:"pa-0"},{default:a(()=>[s(h(new Date(r.image.uploadTimestampUTC).toLocaleDateString()),1)]),_:1}),t(R,{class:"pa-0 text-right"},{default:a(()=>[s(h(new Date(r.image.uploadTimestampUTC).toLocaleTimeString()),1)]),_:1})]),_:1}),t(X,{class:"my-2"}),n("div",ue,[t($,{modelValue:o.thisCategory,"onUpdate:modelValue":e[4]||(e[4]=l=>o.thisCategory=l),style:{flex:"4"},label:"Category",class:"mt-4 mr-4",disabled:!o.hasEditPermission,density:"compact",items:o.specificCategories,"item-title":l=>l.name,"item-value":l=>l},null,8,["modelValue","disabled","items","item-title","item-value"]),r.hasApprovalPermission?(d(),p("div",de,[e[26]||(e[26]=n("div",{class:"text-center text-caption"}," Approval ",-1)),t(V,{location:"bottom"},{activator:a(({props:l})=>[t(u,k(l,{size:"x-small",icon:"",elevation:0,rounded:"0",color:o.approvalStatus.abbr==="R"?"error":"",onClick:e[5]||(e[5]=T=>i.rejectionDialogOpen=!0)}),{default:a(()=>[t(m,null,{default:a(()=>e[22]||(e[22]=[s("$thumbsDown")])),_:1,__:[22]})]),_:2},1040,["color"])]),default:a(()=>[e[23]||(e[23]=n("span",null,"Request Retake",-1))]),_:1,__:[23]}),t(V,{location:"bottom"},{activator:a(({props:l})=>[t(u,k(l,{size:"x-small",icon:"",elevation:0,rounded:"0",color:o.approvalStatus.abbr==="A"?"success":"",onClick:e[6]||(e[6]=T=>o.approvalChange("APPROVE"))}),{default:a(()=>[t(m,null,{default:a(()=>e[24]||(e[24]=[s("$thumbsUp")])),_:1,__:[24]})]),_:2},1040,["color"])]),default:a(()=>[e[25]||(e[25]=n("span",null,"Approve",-1))]),_:1,__:[25]})])):g("",!0)])]),_:1}),t(D,{modelValue:i.deleteDialogOpen,"onUpdate:modelValue":e[8]||(e[8]=l=>i.deleteDialogOpen=l),"max-width":400,"onClick:outside":e[9]||(e[9]=l=>i.deleteDialogOpen=!1)},{default:a(()=>[t(C,null,{default:a(()=>[t(A,null,{default:a(()=>e[27]||(e[27]=[s("Confirm Delete")])),_:1,__:[27]}),t(y,null,{default:a(()=>e[28]||(e[28]=[n("p",null,"Are you sure you want to delete this image?",-1),n("p",null,[s(" This operation "),n("b",null,"CANNOT"),s(" be undone. The file will be deleted "),n("b",null,"IMMEDIATELY"),s(" upon clicking the red button. ")],-1)])),_:1,__:[28]}),t(_,{class:"align-baseline"},{default:a(()=>[t(x),t(u,{variant:"text",onClick:e[7]||(e[7]=l=>i.deleteDialogOpen=!1)},{default:a(()=>e[29]||(e[29]=[s(" Cancel ")])),_:1,__:[29]}),t(u,{class:"mr-4 mb-2",color:"error",variant:"flat",onClick:o.confirmDelete},{default:a(()=>e[30]||(e[30]=[s(" Destroy Image ")])),_:1,__:[30]},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(D,{modelValue:i.rejectionDialogOpen,"onUpdate:modelValue":e[13]||(e[13]=l=>i.rejectionDialogOpen=l),"max-width":400,"onClick:outside":o.cancelReject},{default:a(()=>[t(C,null,{default:a(()=>[t(A,null,{default:a(()=>e[31]||(e[31]=[s("Provide Reason")])),_:1,__:[31]}),t(y,null,{default:a(()=>[e[32]||(e[32]=n("p",null,"Why do you want to reject this image?",-1)),t(G,{modelValue:i.newApprovalDesc,"onUpdate:modelValue":e[10]||(e[10]=l=>i.newApprovalDesc=l),autofocus:"",counter:50,label:"Reason",placeholder:o.randomPlaceholder,maxlength:"50",onKeypress:e[11]||(e[11]=N(l=>o.approvalChange("REJECT"),["enter"]))},null,8,["modelValue","placeholder"])]),_:1,__:[32]}),t(_,null,{default:a(()=>[t(x),t(u,{variant:"text",onClick:o.cancelReject},{default:a(()=>e[33]||(e[33]=[s(" Cancel ")])),_:1,__:[33]},8,["onClick"]),t(u,{class:"mr-4 mb-2",color:"error",variant:"flat",onClick:e[12]||(e[12]=l=>o.approvalChange("REJECT"))},{default:a(()=>e[34]||(e[34]=[s(" Request Retake ")])),_:1,__:[34]})]),_:1})]),_:1})]),_:1},8,["modelValue","onClick:outside"])]),_:2},1040)]),_:1})}const Pe=M(te,[["render",me],["__scopeId","data-v-4baa4367"]]);export{Pe as default};
