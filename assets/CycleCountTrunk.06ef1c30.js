import j from"./MeruDataTable.80a372ee.js";import{m as T,a as C,b as A}from"./vuex.0eb68a2c.js";import F from"./ItemSize.f862e375.js";import K from"./ProductImage.3e5aeb25.js";import N from"./CatalogMenu.55226b4b.js";import G from"./DefaultLayout.61d229e4.js";import{_ as Q}from"./index.8a58b007.js";import{w as r,A as B,ax as q,d as p,r as S,q as w,k as D,t as U,aj as O,x as k,l as Z,u as V,p as J,ar as W,c as M,v as Y,f as H}from"./vuetify.65d833ec.js";import{S as _,e as h,x,k as e,g as t,z as g,J as n,E as o,I as u,s as X,i as $,f as b,B as ee,aj as te,ak as se}from"./@vue.ee679632.js";import"./date-fns.d38e1d55.js";import"./vue-atomic-docs.4f3653eb.js";import"./vue-router.ec64e966.js";import"./axios.eca6faa7.js";import"./axios-cache-interceptor.0956cad0.js";import"./cache-parser.124ebbb8.js";import"./fast-defer.b34f24de.js";import"./object-code.c2755e43.js";import"./@fortawesome.2cecc5e3.js";import"./@awesome.me.7dae7d79.js";const le={components:{MeruDataTable:j,ProductImage:K,ItemSize:F,CatalogMenu:N,DefaultLayout:G},data(){return{toggle_filters_global:"ALL",dialogCRUD:!1,dialogDEL:!1,editedIndex:-1,skuSearchRules:[s=>Object.keys(s||{}).length!==0||"SKU is required"],searchTrunkTable:null,skuModel:{},skuExists:!1,expanded:[],singleExpand:!1,editedItem:{skuModel:{},sku:"",description:"",size:"M",numberPerBox:0,numberOfBoxes:0,singles:0,total:0,expectedTotal:0,modified:{isModified:!1,transaction:""}},defaultItem:{skuModel:{},sku:"",description:"",size:"M",numberPerBox:0,numberOfBoxes:0,singles:0,total:0,expectedTotal:0,modified:{isModified:!1,transaction:""}},headers:[{sortable:!0,title:"Status",key:"modified.transaction"},{sortable:!0,title:"SKU",key:"sku"},{sortable:!0,title:"Description",key:"description"},{sortable:!1,title:"Size",key:"size"},{sortable:!1,title:"Total",key:"expectedTotal"},{sortable:!1,title:"Actions",key:"actions"}],timestamp:"",allItems:[],kioskSkus:[],loading:!0,valid:!1}},computed:{...T("inventory",["skusById"]),...C("inventory",["getSKUs"]),...C("user",["getUserTrunkStock"]),...T("user",["user"]),...C({environment:"app/getEnvConfigs"}),...T("app",["snackbar"]),items(){switch(this.toggle_filters_global){case"ALL":return this.allItems;case"KE":case"TG":return this.allItems.filter(s=>s.skuModel.productClass==this.toggle_filters_global);default:return this.allItems.filter(s=>!["KE","TG"].includes(s.skuModel.productClass))}},catalogMenuProductClasses(){return this.toggle_filters_global==="ALL"?[]:this.toggle_filters_global!=="Other"?[this.toggle_filters_global]:[]},excludedCatalogMenuProductClasses(){return this.toggle_filters_global==="Other"?["KE","TG"]:[]},formTitle(){return this.editedIndex===-1?"New Item":"Edit Item"},getTotalFromBox(){return this.editedItem.numberOfBoxes&&this.skuModel&&this.skuModel.defaultItemsPerBox?this.editedItem.numberOfBoxes*this.skuModel.defaultItemsPerBox:""},getRowTotalBySingles(){let s=parseInt(this.getTotalFromBox)||0;return(parseInt(this.editedItem.singles)||0)+s},getExpected(){return this.editedIndex===-1?this.getRowTotalBySingles:this.editedItem.expectedTotal},getDifference(){return this.getRowTotalBySingles-this.getExpected},hasSkuModel(){return Object.keys(this.skuModel).length!==0},isSnackbarActive(){return this.snackbar.isShown}},beforeMount(){this.loadInitialData()},methods:{...A("user",["postUserTrunkStock"]),getRowDiff(s,i){var f=i-s;return(f>0?"+":"")+f},deleteItem(s){this.editedIndex=this.allItems.indexOf(s),this.skuModel=Object.assign({},s.skuModel),this.editedItem=Object.assign({},s),this.editedItem.numberOfBoxes=0,this.editedItem.singles=0,this.editedItem.total=0,this.dialogDEL=!0},editItem(s){this.editedIndex=this.allItems.indexOf(s),this.skuModel=Object.assign({},s.skuModel),this.editedItem=Object.assign({},s),this.dialogCRUD=!0,this.$refs&&this.$refs.form&&this.$refs.form.resetValidation()},validateQty(){let s=this.editedIndex===-1?1:0;return[i=>(s==1?this.getRowTotalBySingles>0:i>=s)||s+" or more",i=>!!i.toString()||"Required",i=>parseInt(i)==i||"Whole #",i=>parseInt(i)>=0||"0 or more",()=>this.getRowTotalBySingles<1e7||"Too many"]},async validate(s){let{valid:i}=await this.$refs.form.validate();i&&this.valid&&s&&this.save()},setBoxInputToZero(s){s!=""?this.editedItem.numberOfBoxes=parseInt(s):this.editedItem.numberOfBoxes="0",this.validate(!1)},setIndividualInputToZero(s){s!=""?this.editedItem.singles=parseInt(s):this.editedItem.singles="0",this.validate(!1)},save(){this.loading=!0,this.editedItem.total=this.getRowTotalBySingles;const s={inventory:[{skuId:this.skuModel.skuId,singles:parseInt(this.editedItem.singles)+this.editedItem.numberOfBoxes*this.skuModel.defaultItemsPerBox,boxes:[]}],stockId:this.user.id,username:this.user.username,timestamp:this.timestamp};this.postUserTrunkStock(s).then(i=>{this.loading=!1,this.editedItem.expectedTotal=this.editedItem.total;const f=this.editedItem.total==0;i.status==200&&(this.editedItem.modified.isModified=!0,this.editedIndex==-1?(this.editedItem.skuModel=this.skuModel,this.allItems.push(this.editedItem)):f?this.allItems.splice(this.editedIndex,1):Object.assign(this.allItems[this.editedIndex],this.editedItem),this.editedItem.modified.transaction="Updated",this.$store.dispatch("app/setSnackbar",{message:f?"Item removed":"Item saved"})),this.reset()}),this.dialogCRUD=!1,this.dialogDEL=!1},processItemsData(s){this.timestamp=s.timestamp;const i=24*60*60*1e3;this.allItems=s.inventory.flatMap(m=>{const a=this.skusById[m.skuId],d=new Date(m.lastCountTime).getTime()>=new Date().getTime()-3*i;return a&&{skuModel:a,sku:a.sku,skuId:m.skuId,description:a.description,size:a.size,numberPerBox:a.defaultItemsPerBox,numberOfBoxes:parseInt(m.estimated.total/a.defaultItemsPerBox),singles:m.estimated.total%a.defaultItemsPerBox,expectedTotal:m.estimated.total,total:m.estimated.total,modified:{isModified:!!d,transaction:d?"Updated":""}}}),this.kioskSkus=this.kioskSkus.filter(m=>!m.deprecated||this.allItems.find(a=>a&&a.skuId==m.skuId));const f=this.allItems.filter(m=>m!=null);this.allItems=Object.assign([],f)},cancel(){this.$refs&&this.$refs.form&&this.$refs.form.resetValidation(),this.dialogCRUD=!1,this.dialogDEL=!1,this.$store.dispatch("app/setSnackbar",{message:"Canceled",color:"error"}),this.reset()},reset(){this.skuExists=!1,setTimeout(()=>{this.editedItem=Object.assign({},this.defaultItem),this.editedIndex=-1,this.skuModel={}},300)},expandRow(s){if(this.expanded[0]===s.skuModel.sku){this.expanded=[];return}this.expanded=[],this.expanded.push(s.skuModel.sku)},skuChanged(s){this.skuExists=!1;let i=s&&this.items.find(f=>f.skuModel.skuId===(s==null?void 0:s.skuId));i?(this.editedIndex=this.allItems.indexOf(i),this.editedItem=i,this.skuExists=!0):(this.$refs.form&&this.$refs.form.resetValidation(),this.editedIndex=-1,this.editedItem=Object.assign({},this.defaultItem))},setOn(){this.$refs.form&&this.$refs.form.resetValidation(),this.editedIndex==-1&&(this.editedItem=Object.assign({},this.defaultItem)),this.dialogCRUD=!0},async loadInitialData(){this.loading=!0;try{const s=[];s.push(this.$store.dispatch("inventory/loadSKUs")),this.getUserTrunkStock.length===0&&s.push(this.$store.dispatch("user/loadUserTrunkStock")),await Promise.all(s),this.kioskSkus=this.getSKUs,this.processItemsData(this.getUserTrunkStock),this.loading=!1}catch{this.$store.dispatch("app/setSnackbar",{message:"Failed to load data, refresh page to try again.",color:"error",timeout:-1}),this.loading=!1}}}},c=s=>(te("data-v-49931630"),s=s(),se(),s);const ie=c(()=>o("div",{class:"flex-grow-1"},null,-1)),ae=c(()=>o("span",{class:"text-h5"},"Delete Item?",-1)),de={class:"text-h6"},oe=c(()=>o("div",{class:"text-caption"}," All quantities will be set to 0 ",-1)),ne={class:"text-h5"},re=c(()=>o("p",{class:"text-warning font-weight-bold"}," Item already exists in trunk ",-1)),ue=c(()=>o("div",{class:"label"}," Qty. Per Box ",-1)),me={key:0},ce=c(()=>o("div",{class:"label"}," Box Totals ",-1)),fe=c(()=>o("div",{class:"label"}," Total ",-1)),he=c(()=>o("div",{class:"label"}," Expected ",-1)),ge=["v-model"],pe=c(()=>o("div",{class:"label"}," Difference ",-1)),ke=["v-model"],_e=c(()=>o("div",{class:"flex-grow-1"},null,-1)),Ie=c(()=>o("div",{class:"flex-grow-1"},null,-1)),xe={key:0},be={class:"font-weight-medium"},ve={key:0},ye={key:0},Te={class:"font-weight-black"},Ce={class:"text-primary-lighten-3"},Ve=["colspan"],Me={class:"pa-3 bg-surface-bright"};function Be(s,i,f,m,a,d){const v=_("VBtnSecondary"),y=_("VBtnPrimary"),E=_("CatalogMenu"),P=_("ItemSize"),z=_("ProductImage"),R=_("MeruDataTable"),L=_("DefaultLayout");return h(),x(L,null,{default:e(()=>[t(k,null,{default:e(()=>[t(r,{cols:"12"},{default:e(()=>[t(R,{expanded:a.expanded,"onUpdate:expanded":i[14]||(i[14]=l=>a.expanded=l),headers:a.headers,items:d.items,"items-per-page":"15",loading:a.loading,"loading-text":"Loading... Please wait",search:a.searchTrunkTable,class:"mb-10","fixed-header":"","show-expand":"",hover:"","single-expand":a.singleExpand,"item-value":"skuModel.sku","expand-icon":"$vuetify.icons.angleDown","mobile-breakpoint":700,"header-props":{sortIcon:"$vuetify.icons.arrowUp"}},{top:e(()=>[t(B,{color:"surface"},{default:e(()=>[g("",!0),t(q,{modelValue:a.toggle_filters_global,"onUpdate:modelValue":i[0]||(i[0]=l=>a.toggle_filters_global=l),mandatory:"force",disabled:a.loading},{default:e(()=>[t(p,{value:"ALL",variant:"text",size:"small"},{default:e(()=>[n(" All ")]),_:1}),t(p,{value:"KE",variant:"text",size:"small"},{default:e(()=>[n(" Keys ")]),_:1}),t(p,{value:"TG",variant:"text",size:"small"},{default:e(()=>[n(" Tags ")]),_:1}),t(p,{value:"Other",variant:"text",size:"small"},{default:e(()=>[n(" Other ")]),_:1})]),_:1},8,["modelValue","disabled"]),ie,t(S,{modelValue:a.dialogDEL,"onUpdate:modelValue":i[1]||(i[1]=l=>a.dialogDEL=l),"max-width":"700px",persistent:""},{default:e(()=>[t(w,null,{default:e(()=>[t(D,null,{default:e(()=>[ae]),_:1}),t(U,null,{default:e(()=>[t(O,null,{default:e(()=>[t(k,null,{default:e(()=>[t(r,{cols:"12",align:"center"},{default:e(()=>[o("div",de,u(a.editedItem.skuModel.allSearchableFields),1),oe]),_:1})]),_:1}),t(k,null,{default:e(()=>[t(r,{align:"end"},{default:e(()=>[t(v,{onClick:d.cancel},{default:e(()=>[n(" Cancel ")]),_:1},8,["onClick"])]),_:1}),t(r,null,{default:e(()=>[t(y,{onClick:d.save},{default:e(()=>[n(" Yes ")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(S,{modelValue:a.dialogCRUD,"onUpdate:modelValue":i[12]||(i[12]=l=>a.dialogCRUD=l),"max-width":"700px",persistent:"",fullscreen:s.$vuetify.display.smAndDown},{activator:e(({props:l})=>[t(y,X({class:"mb-2",loading:d.isSnackbarActive||a.loading,disabled:d.isSnackbarActive||a.loading},l,{onClick:d.setOn}),{default:e(()=>[n(" New Item ")]),_:2},1040,["loading","disabled","onClick"])]),default:e(()=>[t(w,null,{default:e(()=>[t(D,null,{default:e(()=>[o("span",ne,u(d.formTitle),1)]),_:1}),t(U,null,{default:e(()=>[t(O,null,{default:e(()=>[t(Z,{ref:"form",modelValue:a.valid,"onUpdate:modelValue":i[9]||(i[9]=l=>a.valid=l),class:"pb-6"},{default:e(()=>[t(k,null,{default:e(()=>[t(r,{cols:"12",sm:"12",md:"12"},{default:e(()=>[t(E,{modelValue:a.skuModel,"onUpdate:modelValue":[i[2]||(i[2]=l=>a.skuModel=l),d.skuChanged],"product-classes":d.catalogMenuProductClasses,rules:a.skuSearchRules,"excluded-product-classes":d.excludedCatalogMenuProductClasses},$({_:2},[a.skuExists?{name:"details",fn:e(()=>[re]),key:"0"}:void 0]),1032,["modelValue","product-classes","rules","excluded-product-classes","onUpdate:modelValue"])]),_:1})]),_:1}),t(k,null,{default:e(()=>[t(r,{cols:"12",sm:"2",md:"2",lg:"2"},{default:e(()=>{var l;return[ue,(l=a.skuModel)!=null&&l.defaultItemsPerBox?(h(),b("div",me,u(a.skuModel.defaultItemsPerBox),1)):g("",!0)]}),_:1}),t(r,{cols:"12",sm:"3",md:"3",lg:"3"},{default:e(()=>[t(V,{modelValue:a.editedItem.numberOfBoxes,"onUpdate:modelValue":[i[3]||(i[3]=l=>a.editedItem.numberOfBoxes=l),d.setBoxInputToZero],label:"Num. of Boxes",type:"number",min:"0",disabled:!d.hasSkuModel,rules:d.validateQty(),onChange:i[4]||(i[4]=l=>d.validate(!1)),onFocus:i[5]||(i[5]=l=>l.target.select())},null,8,["modelValue","disabled","rules","onUpdate:modelValue"])]),_:1}),s.$vuetify.display.smAndDown?g("",!0):(h(),x(r,{key:0,cols:"12",sm:"1",md:"1",lg:"1",align:"center","align-self":"center"},{default:e(()=>[n(" = ")]),_:1})),t(r,{cols:"12",sm:"2",md:"2",lg:"2"},{default:e(()=>[ce,o("div",null,u(d.getTotalFromBox),1)]),_:1})]),_:1}),t(k,null,{default:e(()=>[t(r,{cols:"12",sm:"2",md:"2",lg:"2"},{default:e(()=>[t(V,{modelValue:a.editedItem.singles,"onUpdate:modelValue":[i[6]||(i[6]=l=>a.editedItem.singles=l),d.setIndividualInputToZero],label:"Singles",type:"number",min:"0",disabled:!d.hasSkuModel,rules:d.validateQty(),onChange:i[7]||(i[7]=l=>d.validate(!1)),onFocus:i[8]||(i[8]=l=>l.target.select())},null,8,["modelValue","disabled","rules","onUpdate:modelValue"])]),_:1}),t(r,{cols:"12",sm:"10",md:"10",lg:"10","justify-self":"end",justify:"end"},{default:e(()=>[t(k,{"no-gutters":"","justify-self":"end",justify:"end"},{default:e(()=>[t(r,{sm:"2",md:"2",lg:"2"},{default:e(()=>[fe,o("div",null,u(d.getRowTotalBySingles===0?"":d.getRowTotalBySingles),1)]),_:1}),t(r,{sm:"2",md:"2",lg:"2"},{default:e(()=>[he,o("div",{"v-model":a.editedItem.expectedTotal},u(d.getExpected),9,ge)]),_:1}),t(r,{sm:"2",md:"2",lg:"2"},{default:e(()=>[pe,o("div",{"v-model":d.getDifference},u(d.getDifference),9,ke)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),s.$vuetify.display.smAndDown?g("",!0):(h(),x(J,{key:0},{default:e(()=>[t(v,{onClick:d.cancel},{default:e(()=>[n(" Cancel ")]),_:1},8,["onClick"]),_e,t(y,{disabled:!a.valid,onClick:i[10]||(i[10]=l=>d.validate(!0))},{default:e(()=>[n(" Save ")]),_:1},8,["disabled"])]),_:1}))]),_:1}),s.$vuetify.display.smAndDown?(h(),x(W,{key:0,height:"64"},{default:e(()=>[t(v,{onClick:d.cancel},{default:e(()=>[n(" Cancel ")]),_:1},8,["onClick"]),Ie,t(p,{color:"primary",disabled:!a.valid,onClick:i[11]||(i[11]=l=>d.validate(!0))},{default:e(()=>[n(" Save ")]),_:1},8,["disabled"])]),_:1})):g("",!0)]),_:1},8,["modelValue","fullscreen"])]),_:1}),t(B,{color:"surface"},{default:e(()=>[t(V,{modelValue:a.searchTrunkTable,"onUpdate:modelValue":i[13]||(i[13]=l=>a.searchTrunkTable=l),"append-inner-icon":"$vuetify.icons.search",label:"search","single-line":"","hide-details":"",clearable:"",disabled:a.loading,"clear-icon":"$vuetify.icons.times","persistent-hint":""},null,8,["modelValue","disabled"])]),_:1})]),["header.size"]:e(({column:l})=>[o("tr",null,[a.toggle_filters_global=="TG"?(h(),b("th",xe,[o("span",be,u(l.title),1)])):g("",!0)])]),["item.data-table-expand"]:e(({item:l})=>[t(p,{icon:"",class:ee({"v-data-table__expand-icon--active":a.expanded[0]===l.skuModel.sku}),variant:"flat",onClick:I=>d.expandRow(l)},{default:e(()=>[t(M,null,{default:e(()=>[n(" $angleDown ")]),_:1})]),_:2},1032,["class","onClick"])]),["item.sku"]:e(({item:l})=>[n(u(l.skuModel.sku),1)]),["item.description"]:e(({item:l})=>[n(u(l.skuModel.description),1)]),["item.modified.transaction"]:e(({item:l})=>[l.modified.isModified?(h(),b("div",ve,[t(Y,{color:"surface-bright",size:"x-small",variant:"flat"},{default:e(()=>[t(M,{start:"",size:"x-small",color:"success",icon:"$vuetify.icons.check"}),n(" "+u(l.modified.transaction),1)]),_:2},1024)])):g("",!0)]),["item.size"]:e(({item:l})=>[a.toggle_filters_global=="TG"?(h(),b("div",ye,[t(P,{"selected-size":l.skuModel.size},null,8,["selected-size"])])):g("",!0)]),["item.numberOfBoxes"]:e(({item:l})=>[o("span",Te,u(l.numberOfBoxes),1),o("span",Ce,"of "+u(l.numberPerBox),1)]),["item.diff"]:e(({item:l})=>[n(u(d.getRowDiff(l.expectedTotal,l.total)),1)]),["item.actions"]:e(({item:l})=>[t(p,{color:"info",icon:"$vuetify.icons.edit",size:"x-small",class:"mr-3",onClick:I=>d.editItem(l)},null,8,["onClick"]),t(M,{size:"small",color:"error-lighten-2",onClick:I=>d.deleteItem(l)},{default:e(()=>[n(" $vuetify.icons.trash ")]),_:2},1032,["onClick"])]),"expanded-row":e(({columns:l,item:I})=>[o("td",{colspan:l.length},[o("div",Me,[t(z,{sku:I.skuModel.sku,"product-type":I.skuModel.productClass,width:"250"},null,8,["sku","product-type"])]),t(H)],8,Ve)]),_:2},1032,["expanded","headers","items","loading","search","single-expand","header-props"])]),_:1})]),_:1})]),_:1})}const Je=Q(le,[["render",Be],["__scopeId","data-v-49931630"]]);export{Je as default};
