import b from"./CurrencyInput-CGI9Mz8R.js";import k from"./FullScreenLayout-C65u71bY.js";import{_ as x,r as L}from"./index-LK9MQE2L.js";import{n as N,m as F,u as C,t as I,P as f,x as h,f as O,l as T,i as B,ar as E,A as z,w as y,ah as D}from"./vuetify-BgnNF2O3.js";import{C as d,i as t,e as o,s as J,b as m,J as c,g as M,F as V,_ as u,H as U,A as s}from"./@vue-DNrUJgob.js";import"./vue-currency-input-D7Z-DvZH.js";import"./vuex-D3TwipD2.js";import"./date-fns-2ylUqVpG.js";import"./@babel-BTTPuEuv.js";import"./vue-component-docs-plugin-BnqcuvvC.js";import"./vue-router-BVOKdCCq.js";import"./axios-xsH4HHeE.js";import"./axios-cache-interceptor-DgAMPFM2.js";import"./cache-parser-DXYp_BCq.js";import"./fast-defer-9MI9za_P.js";import"./object-code-SBtdq8jY.js";import"./@fortawesome-BWcQmPY7.js";import"./@awesome.me-Btqfd-fw.js";const q={components:{CurrencyInput:b,FullScreenLayout:k},beforeRouteEnter(i,e,g){g(p=>{e.name==="pricingModelIndex"&&(p.pricingModelIndexLink=e)})},data(){return{isPricingGroupLoading:!0,isStandingOffersLoading:!0,isPricingModelLoading:!0,isSaving:!1,isValid:!1,pricingModelIndexLink:{name:"pricingModelIndex"},pricingModel:{},standingOffers:[]}},computed:{isNew(){return this.$route.name==="newPricingModel"},title(){return this.isNew?"New Pricing Model":"Edit: "+this.pricingModel.name}},created(){this.initializePricingData()},methods:{async initializePricingData(){this.isNew?await this.initializeNewPricingModel():await this.fetchPricingModel(),await this.fetchStandingOffers()},async fetchPricingModel(){try{this.isPricingModelLoading=!0;const i=await this.$store.dispatch("inventory/getPricingModel",this.$route.params.pricingModelId);this.pricingModel=JSON.parse(JSON.stringify(i))}catch(i){console.error("Error getting pricing model:",i),this.$store.dispatch("app/setSnackbar",{message:"Failed to get pricing model: "+i.message,color:"error"})}finally{this.isPricingModelLoading=!1}},async initializeNewPricingModel(){try{this.isPricingModelLoading=!0;const i=await this.$store.dispatch("inventory/getPricingGroupsByPricingModelType",this.$route.params.type),e=JSON.parse(JSON.stringify(i));this.pricingModel={type:this.$route.params.type,prices:e.reduce((g,{name:p})=>({...g,[p]:0}),{}),promotions:[]}}catch(i){console.error("Error setting new pricing model:",i),this.$store.dispatch("app/setSnackbar",{message:"Failed to set new pricing model: "+i.message,color:"error"})}finally{this.isPricingModelLoading=!1}},async fetchStandingOffers(){try{this.standingOffers=await this.$store.dispatch("inventory/getStandingOffers",this.pricingModel.type)}catch(i){console.error("Error getting standing offers:",i),this.$store.dispatch("app/setSnackbar",{message:"Failed to get standing offers: "+i.message,color:"error"})}},async save(){try{this.isSaving=!0,this.isNew?await this.$store.dispatch("inventory/postPricingModel",this.pricingModel):await this.$store.dispatch("inventory/putPricingModel",this.pricingModel),this.navigateToPricingModelIndex(),this.$store.dispatch("app/setSnackbar",{message:"Pricing model saved",color:"success"})}catch(i){console.error("Error saving pricing model:",i),this.$store.dispatch("app/setSnackbar",{message:"Failed to save pricing model: "+i.message,color:"error"})}finally{this.isSaving=!1}},required:L,autoSelectPriceField(i){i.target.select()},navigateToPricingModelIndex(i){i?this.$router.replace(this.pricingModelIndexLink):this.$router.push(this.pricingModelIndexLink)}}},G={key:2};function A(i,e,g,p,r,a){const P=u("CurrencyInput"),S=u("VBtnSecondary"),v=u("VBtnPrimary"),_=u("FullScreenLayout");return s(),d(_,null,{header:t(()=>[o(z,null,{title:t(()=>[c(U(a.title),1)]),_:1})]),footer:t(()=>[o(E,null,{default:t(()=>[o(S,{loading:r.isSaving,class:"mr-4",onClick:e[3]||(e[3]=n=>a.navigateToPricingModelIndex())},{default:t(()=>e[7]||(e[7]=[c(" Cancel ")])),_:1,__:[7]},8,["loading"]),o(B),o(v,{loading:r.isSaving,onClick:e[4]||(e[4]=n=>a.save())},{default:t(()=>e[8]||(e[8]=[c(" Save ")])),_:1,__:[8]},8,["loading"])]),_:1})]),default:t(()=>[o(T,{loading:r.isPricingModelLoading||r.isSaving},{default:t(()=>[o(N,{modelValue:r.isValid,"onUpdate:modelValue":e[2]||(e[2]=n=>r.isValid=n),disabled:r.isSaving,"validate-on":"blur"},{default:t(()=>[o(F,null,{default:t(()=>[o(C,{modelValue:r.pricingModel.name,"onUpdate:modelValue":e[0]||(e[0]=n=>r.pricingModel.name=n),label:"Name",autofocus:a.isNew},null,8,["modelValue","autofocus"])]),_:1}),o(I,null,{default:t(()=>[o(f,{class:"pl-0"},{default:t(()=>e[5]||(e[5]=[c(" Prices ")])),_:1,__:[5]}),r.isPricingModelLoading?J("",!0):(s(),d(h,{key:0},{default:t(()=>[(s(!0),m(V,null,M(r.pricingModel.prices,(n,l)=>(s(),d(y,{key:l,cols:"12",sm:"4",lg:"3"},{default:t(()=>[o(P,{modelValue:r.pricingModel.prices[l],"onUpdate:modelValue":w=>r.pricingModel.prices[l]=w,modelModifiers:{lazy:!0},label:l,density:"compact",rules:[a.required],onFocus:a.autoSelectPriceField},null,8,["modelValue","onUpdate:modelValue","label","rules","onFocus"])]),_:2},1024))),128))]),_:1})),o(O),o(f,{class:"pl-0"},{default:t(()=>e[6]||(e[6]=[c(" Promotions ")])),_:1,__:[6]}),r.standingOffers.length?(s(),d(h,{key:1},{default:t(()=>[(s(!0),m(V,null,M(r.standingOffers,n=>(s(),d(y,{key:n.code,cols:"12",sm:"4",lg:"3"},{default:t(()=>[o(D,{modelValue:r.pricingModel.promotions,"onUpdate:modelValue":e[1]||(e[1]=l=>r.pricingModel.promotions=l),density:"compact","hide-details":"","true-icon":"$vuetify.icons.checkSquare","false-icon":"$vuetify.icons.square",label:n.name,value:n.code},null,8,["modelValue","label","value"])]),_:2},1024))),128))]),_:1})):(s(),m("p",G," No Promotions "))]),_:1})]),_:1},8,["modelValue","disabled"])]),_:1},8,["loading"])]),_:1})}const le=x(q,[["render",A]]);export{le as default};
