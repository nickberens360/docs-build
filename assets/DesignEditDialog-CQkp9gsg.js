import{_ as w,r as x,i as p}from"./index-AG15HfzG.js";import A from"./DesignHeader-DxQyvDuv.js";import O from"./DesignTranslationsTable-B-BXYwaY.js";import v from"./KeySkuTable-8Zvi_ZtI.js";import G from"./CarKeyInfo-CIkUm2Pi.js";import{t as m,am as N,n as k,p as c,l as f,x as U,w as I,an as Q,ao as R,ap as H,aq as j,ar as E,i as q,k as L}from"./vuetify-BymGJ7fC.js";import{u as _,m as M,p as W,d as F,i as D,c as h}from"./lodash-es-DUD2eztn.js";import{C as u,i as l,e as n,s as y,b,H as z,_ as g,J as C,A as o}from"./@vue-mGKKYCuj.js";import"./vuex-BwOdvJvI.js";import"./date-fns-Cq_iz7V_.js";import"./@babel-BTTPuEuv.js";import"./vue-component-docs-plugin-CX_tIU2Y.js";import"./vue-router-CgUA7A7W.js";import"./axios-xsH4HHeE.js";import"./axios-cache-interceptor-DgAMPFM2.js";import"./cache-parser-DXYp_BCq.js";import"./fast-defer-9MI9za_P.js";import"./object-code-SBtdq8jY.js";import"./@fortawesome-C0fAH5tI.js";import"./@awesome.me-Btqfd-fw.js";import"./MeruDataTable-C8d00s6p.js";import"./ImageUploader-tWA3Fz_T.js";import"./CurrencyInput-4-NewSrM.js";import"./vue-currency-input-B1SuAzjl.js";import"./ProductImage-CHQgULCi.js";const J=["CK"],X={components:{DesignHeader:A,DesignTranslationsTable:O,KeySkuTable:v,CarKeyInfo:G},props:{dialogOpen:Boolean,design:{type:Object,default:()=>({})},isNew:Boolean,productClasses:{type:Object,default:()=>({})},existingDesignCodes:{type:Array,default:()=>[]},selectedProductClass:{type:Object,default:()=>({})}},emits:["update"],data:()=>({inputsAreValid:void 0,editableDesign:void 0,dbDesign:void 0,initialDesign:void 0,loading:!0,processing:!1,pricingGroupOptions:[],designGroupOptions:[],machineTypes:[],valid:{nameAndDesignCode:!1,pricingGroup:!1,productClass:!1}}),computed:{isCarKey(){return this.design&&this.design.productClass==="CK"},changesMade(){return!D(this.initialDesign,this.editableDesign)},isUncommitted(){return this.isNew||!this.editableDesign.id||!this.design.skus},existsInDatabase(){return this.editableDesign.id!==void 0},allowedProductClasses(){return Object.entries(this.productClasses).filter(([e])=>!J.includes(e))},productClass(){return this.editableDesign&&this.editableDesign.productClass}},watch:{productClass(){this.productClass&&!this.isCarKey&&this.editableDesign&&(p.getPricingGroupsByProductClass(this.editableDesign.productClass).then(({data:e})=>this.pricingGroupOptions=e),p.getMachineTypes(this.editableDesign.productClass).then(({data:e})=>this.machineTypes=e))},dialogOpen(e){if(!e){this.editableDesign=this.dbDesign=this.initialDesign=void 0;return}if(this.processing=!1,this.isNew){this.editableDesign={designCode:"",pricingGroup:null,productClass:this.allowedProductClasses.find(([s])=>s===this.selectedProductClass.productClasses[0])[0],dateAdded:new Date().toISOString().substring(0,10),size:null,shape:null,thickness:null,price:null,groups:[],names:[{locale:"en",name:""}],skus:[]},this.loading=!1;return}if(this.loading=!0,this.design.id)p.getDesign(this.design.id).then(({data:s})=>{this.dbDesign=h(s);const t=this.mergeDesigns(s,this.design);this.editableDesign={...t,skus:t.skus.map(i=>({...i,primaryQty:i.fullBoxIsPrimary?i.itemsPerBox:i.itemsPerHalfBox,secondaryQty:i.fullBoxIsPrimary?i.itemsPerHalfBox:i.itemsPerBox}))},this.initialDesign=h(this.editableDesign)}).finally(()=>this.loading=!1);else{const s=h(this.design);this.editableDesign={...s,skus:s.skus.map(t=>({...t,primaryQty:t.fullBoxIsPrimary?t.itemsPerBox:t.itemsPerHalfBox,secondaryQty:t.fullBoxIsPrimary?t.itemsPerHalfBox:t.itemsPerBox}))},this.loading=!1}}},created(){p.getAllDesignGroups().then(({data:e})=>this.designGroupOptions=e)},methods:{required:x,generatePatch(e,s){if(!s)return e;let t=W(e,(i,d)=>["id","designCode"].includes(d)||!D(i,s[d]));t.carKeyDesign&&(t.carKeyDesign={blacklisted:t.carKeyDesign.blacklisted,id:t.carKeyDesign.id});for(const i of Object.keys(t))Array.isArray(t[i])&&(t[i]=F(t[i],s[i],D));return t},saveDesign(){if(!Object.values(this.$refs).reduce(async(i,d)=>{const{valid:a}=await d.validate();return!d||a&&i},!0))return;this.editableDesign.designCode=this.editableDesign.designCode.toUpperCase(),this.editableDesign.name=this.editableDesign.name||this.editableDesign.names.find(i=>i.locale==="en").name;const s=this.editableDesign.skus[0]||{};this.editableDesign.firstSku=(s.imgData!==void 0?"tmp/":"")+s.sku,this.editableDesign.deprecated=this.editableDesign.skus.reduce((i,d)=>i&&d.deprecated,!0),this.editableDesign.skus.forEach(i=>{i.secondaryQty||(i.secondaryQty=0),[i.itemsPerBox,i.itemsPerHalfBox,i.fullBoxIsPrimary]=i.primaryQty>=i.secondaryQty?[i.primaryQty,i.secondaryQty,!0]:[i.secondaryQty,i.primaryQty,!1],delete i.primaryQty,delete i.secondaryQty});const t=this.generatePatch(this.editableDesign,this.dbDesign);this.$emit("update",t),this.processing=!0},selectAll(e,s=!0){s&&e.target.select()},mergeDesigns(e,s){return M(e,s,(t,i,d)=>Array.isArray(t)?this.designUnion(d,i,t):void 0)},designUnion(e,s,t){return _(s,t,(i,d)=>{switch(e){case"names":return i.locale===d.locale;case"skus":return i.sku===d.sku;default:return}})},handleResetSkuImage(e){const s=this.editableDesign.skus.findIndex(t=>t.sku===e);s!==-1&&(this.editableDesign.skus[s].imgData=void 0)},handleOnNewImage(e){const s=e.file,t=e.sku,i=this.editableDesign.skus.findIndex(a=>a.sku===t),d=this.editableDesign.skus[i];this.editableDesign.skus.splice(i,1,{...d,imgData:{previewURL:URL.createObjectURL(s),file:s}})},handleAddNewSku(e){this.editableDesign.skus.push(e)},handleDeleteSku(e){this.editableDesign.skus.splice(this.editableDesign.skus.indexOf(e),1)},handleCarKeyImageReplaced(e){this.editableDesign.skus.splice(0,1,{...this.editableDesign.skus[0],imgData:e})},handleDeleteTranslation(e){this.editableDesign.names.splice(this.editableDesign.names.indexOf(e),1)},handleAddTranslation(e){this.editableDesign.names.push({...e.newTranslation,designId:e.designId})},deprecateCarKey(e){this.isCarKey&&this.editableDesign.skus.length>0&&(this.editableDesign.skus[0].deprecated=e)},toggleHopKeyDeprecationStatus(e){const s=(this.editableDesign.skus||[]).find(t=>t.skuId===e.skuId);s&&(s.deprecated=!s.deprecated)}}},Y={key:0,class:"text-center py-4"},Z={key:1,class:"text-center text-h6 py-4"},$={key:2,class:"py-4 text-center"};function ee(e,s,t,i,d,a){const P=g("DesignHeader"),V=g("DesignTranslationsTable"),S=g("CarKeyInfo"),T=g("KeySkuTable"),K=g("VBtnSecondary"),B=g("VBtnPrimary");return o(),u(L,{fullscreen:"","model-value":t.dialogOpen,onAfterLeave:s[8]||(s[8]=r=>e.$emit("update",!1))},{default:l(()=>[n(f,{class:"pt-4",flat:"",rounded:"0"},{default:l(()=>[e.loading?(o(),u(m,{key:0},{default:l(()=>[n(N,{type:"heading, table-heading, card, table"})]),_:1})):e.editableDesign?(o(),u(m,{key:1,class:"pb-16"},{default:l(()=>[a.existsInDatabase?(o(),b("div",Z,z(t.productClasses[e.editableDesign.productClass]),1)):(o(),b("div",Y,[n(k,{ref:"productClass"},{default:l(()=>[n(c,{modelValue:e.editableDesign.productClass,"onUpdate:modelValue":s[0]||(s[0]=r=>e.editableDesign.productClass=r),label:"Product Class","hide-details":"",items:a.allowedProductClasses,"item-value":"0","item-title":"1",density:"compact",rules:[a.required]},null,8,["modelValue","items","rules"])]),_:1},512)])),n(P,{ref:"header",design:e.editableDesign,"onUpdate:design":s[1]||(s[1]=r=>e.editableDesign=r),"is-new":t.isNew,"exists-in-database":a.existsInDatabase,"existing-design-codes":t.existingDesignCodes,"initial-design-code":e.initialDesign&&e.initialDesign.designCode,onUpdateDesignCode:s[2]||(s[2]=r=>e.editableDesign.designCode=r),onUpdateBlacklisted:s[3]||(s[3]=r=>e.editableDesign.carKeyDesign.blacklisted=r),onUpdateDeprecated:s[4]||(s[4]=r=>a.deprecateCarKey(r))},null,8,["design","is-new","exists-in-database","existing-design-codes","initial-design-code"]),a.isCarKey?y("",!0):(o(),u(f,{key:2,class:"my-4"},{default:l(()=>[n(m,null,{default:l(()=>[n(U,null,{default:l(()=>[n(I,{cols:"12",sm:"6"},{default:l(()=>[n(c,{modelValue:e.editableDesign.groups,"onUpdate:modelValue":s[5]||(s[5]=r=>e.editableDesign.groups=r),multiple:"",label:"Design Group",items:e.designGroupOptions,"item-title":"name","return-object":"",density:"compact"},null,8,["modelValue","items"])]),_:1}),n(I,{cols:"12",sm:"6"},{default:l(()=>[n(k,{ref:"pricingGroup"},{default:l(()=>[n(c,{modelValue:e.editableDesign.pricingGroup,"onUpdate:modelValue":s[6]||(s[6]=r=>e.editableDesign.pricingGroup=r),label:"Pricing Group","item-title":"name",items:e.pricingGroupOptions,rules:[a.required],"return-object":"",density:"compact"},null,8,["modelValue","items","rules"])]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1})),a.isCarKey?y("",!0):(o(),u(Q,{key:3,class:"my-4"},{default:l(()=>[n(R,null,{default:l(()=>[n(H,{"expand-icon":"$vuetify.icons.chevronDown"},{default:l(()=>s[9]||(s[9]=[C(" Translations ")])),_:1,__:[9]}),n(j,null,{default:l(()=>[n(V,{design:e.editableDesign,onDeleteTranslation:a.handleDeleteTranslation,onAddTranslation:a.handleAddTranslation},null,8,["design","onDeleteTranslation","onAddTranslation"])]),_:1})]),_:1})]),_:1})),n(f,{class:"my-4 pa-4"},{default:l(()=>[a.isCarKey?(o(),u(S,{key:0,design:e.editableDesign,onCarKeyImageReplaced:a.handleCarKeyImageReplaced},null,8,["design","onCarKeyImageReplaced"])):e.editableDesign.productClass==="KE"?(o(),u(T,{key:1,ref:"skus",design:e.editableDesign,"machine-types":e.machineTypes,onResetSkuImage:a.handleResetSkuImage,onNewImage:a.handleOnNewImage,onAddSku:a.handleAddNewSku,onDeleteSku:a.handleDeleteSku,onToggleDeprecationStatus:a.toggleHopKeyDeprecationStatus},null,8,["design","machine-types","onResetSkuImage","onNewImage","onAddSku","onDeleteSku","onToggleDeprecationStatus"])):(o(),b("div",$," No Additional Info for this Product Class "))]),_:1})]),_:1})):y("",!0),n(E,null,{default:l(()=>[n(K,{onClick:s[7]||(s[7]=r=>e.$emit("update",!1))},{default:l(()=>s[10]||(s[10]=[C(" Cancel ")])),_:1,__:[10]}),n(q),n(B,{loading:e.processing,disabled:!a.changesMade,onClick:a.saveDesign},{default:l(()=>s[11]||(s[11]=[C(" Save ")])),_:1,__:[11]},8,["loading","disabled","onClick"])]),_:1})]),_:1})]),_:1},8,["model-value"])}const Te=w(X,[["render",ee]]);export{Te as default};
