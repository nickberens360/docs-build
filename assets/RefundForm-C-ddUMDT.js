import{c as M,b as U,m as O}from"./vuex-BwOdvJvI.js";import{_ as B,P as z,S as N,C as j,l as L}from"./index-AG15HfzG.js";import G from"./RefundFormItem-CA5bStfH.js";import{C as y,i as r,e as o,s as h,J as d,b as f,g as _,F as R,B as i,H as m,_ as b,x as C,N as Y,O as Z,A as l}from"./@vue-mGKKYCuj.js";import{m as H,n as T,F as J,E as v,p as Q,q as K,t as S,i as I,aj as W,w as p,Q as X,x as w,r as $,Y as ee,f as te,d as D,u as se,b as oe,D as re,l as ne}from"./vuetify-BymGJ7fC.js";import"./date-fns-Cq_iz7V_.js";import"./@babel-BTTPuEuv.js";import"./vue-component-docs-plugin-CX_tIU2Y.js";import"./vue-router-CgUA7A7W.js";import"./axios-xsH4HHeE.js";import"./axios-cache-interceptor-DgAMPFM2.js";import"./cache-parser-DXYp_BCq.js";import"./fast-defer-9MI9za_P.js";import"./object-code-SBtdq8jY.js";import"./@fortawesome-C0fAH5tI.js";import"./@awesome.me-Btqfd-fw.js";const ie={components:{CardItem:j,SuccessAnimation:N,RefundFormItem:G,PaymentType:z},emits:["refunded"],data(){return{isRefundFormValid:!1,isEmailFormValid:!1,selectRules:[t=>!!t||"Reason required"],textareaRules:[t=>!!t||"Description required"],emailRules:[t=>!t||/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(t)||"Invalid email"],activeReason:"sameReason",includeShipping:!1,isFormShown:!0,isConfirmationShown:!1,isSuccessAnimationShown:!1,isFormProcessing:!1,reasonOptions:L,errorMessage:null,isEportError:null,formData:{items:[],reason:null,notes:null,email:null,mailRefund:!1,zoneOffset:"-06:00"}}},computed:{...O({order:"order/orderDetails",selectedItems:"order/selectedItems",refundableItems:"order/getRefundableItems",orderShipping:"order/getOrderShipping",isShippingRefundable:"order/getIsShippingRefundable"}),refundDiscountTotal(){let t=0;return this.formData.items.forEach(e=>{var s;const u=((s=this.order.items.find(({itemId:a})=>a===e.itemId))==null?void 0:s.discountTotal)||0,c=e.quantity||0;t+=u*c}),Math.round(t*100)/100},refundShippingCost(){return this.includeShipping&&this.order.payment.shippingTotal||0},refundSubtotal(){let t=0;return this.formData.items.forEach(e=>{var s;const u=((s=this.order.items.find(({itemId:a})=>a===e.itemId))==null?void 0:s.price)||0,c=e.quantity||0;t+=u*c}),Math.round(t*100)/100},refundTaxTotal(){let t=0;return this.formData.items.forEach(e=>{var s;const u=((s=this.order.items.find(({itemId:a})=>a===e.itemId))==null?void 0:s.tax)||0,c=e.quantity||0;t+=u*c}),this.includeShipping&&(t+=(this.order.payment.shippingTotal||0)*(this.order.payment.shippingTaxRate||0)),Math.round(t*100)/100},refundTotal(){let t=this.order.payment.couponTotal?this.refundDiscountTotal:0,e=this.refundTaxTotal+this.refundSubtotal+this.refundShippingCost-t;return Math.round(e*100)/100}},watch:{selectedItems:{handler(t){const e=this.formData.items.filter(({itemId:u})=>!!t.find(c=>c.itemId===u));t.forEach(u=>{this.formData.items.findIndex(({itemId:s})=>s===u.itemId)<0&&e.push({itemId:u.itemId,notes:null,reason:null,quantity:u.quantity,amount:u.total})}),this.formData.items=e},immediate:!0,deep:!0}},mounted(){var t,e;this.includeShipping=this.isShippingRefundable,this.formData.email=((e=(t=this.order)==null?void 0:t.customer)==null?void 0:e.email)||null},methods:{...U("order",["submitOrderRefund","refreshOrderDetailsAndOrders"]),...M("order",["setSelectedItems"]),triggerConfirmation(){this.isFormShown=!1,this.isConfirmationShown=!0},handleCancelConfirmation(){this.isConfirmationShown=!1,this.isFormShown=!0},async handleRefundConfirm(){if(!this.isFormProcessing){this.isFormProcessing=!0,this.includeShipping&&this.formData.items.push({itemId:this.orderShipping.itemId,amount:this.orderShipping.total,reason:"Shipping Refund"});try{await this.submitOrderRefund({sessionId:this.order.session.sessionId,formData:this.formData}),this.isSuccessAnimationShown=!0,this.$emit("refunded",this.refundTotal)}catch(t){t.response.status===403?this.errorMessage="Something went wrong, this user is not authorized to perform this action. Please try again, or contact support.":t.response.status===404?this.errorMessage="Something went wrong, this order was not found. Please try again, or contact support.":t.response.status===503?this.order.payment.card.processor==="Eport"?this.isEportError=!0:this.errorMessage="Something went wrong. Please try again, or contact support.":this.errorMessage="Something went wrong. Please try again, or contact support."}await this.refreshOrderDetailsAndOrders(),this.isFormProcessing=!1,this.isConfirmationShown=!1}}}},ae={key:0,class:"mt-4"},le={key:0,class:"ml-2 font-weight-bold"},de={class:"px-6"},ue={key:0,class:"d-flex flex-column align-center justify-center position-relative"},me={class:"d-flex flex-column align-center pb-30"},fe={class:"mx-auto"},pe={class:"px-0 mb-4"},ce={class:"font-weight-bold"},he={class:"text-right"},ge={class:"pa-0 ma-0",style:{"list-style":"none"}},ye={key:0},be={class:"font-weight-bold"},Se={class:"font-weight-bold"},we={class:"mt-2"},Ve={class:"font-weight-bold text-body-2"},xe={class:"confirm-footer text-right py-4 px-8 elevation-3 bg-surface-light"},_e={class:"text-center pt-6"},Re={key:0},Ce={key:1},Te={class:"font-weight-bold mb-6 text-body-3 text-primary"};function ve(t,e,u,c,s,a){const k=b("RefundFormItem"),F=b("PaymentType"),E=b("CardItem"),P=b("VBtnPrimary"),q=b("SuccessAnimation"),A=b("VBtnSecondary");return l(),y(ne,{color:"surface-light",class:"rounded-0 elevation-0 allow-card-overflow d-flex flex-column"},{default:r(()=>[o(H,{class:"detail-form-header bg-primary mb-0 elevation-3"},{default:r(()=>e[7]||(e[7]=[d(" Refund ")])),_:1,__:[7]}),s.isFormShown?(l(),y(T,{key:0,modelValue:s.isRefundFormValid,"onUpdate:modelValue":e[4]||(e[4]=n=>s.isRefundFormValid=n),class:"d-flex flex-column flex-grow-1 justify-space-between"},{default:r(()=>[t.selectedItems.length>1?(l(),y(J,{key:0,modelValue:s.activeReason,"onUpdate:modelValue":e[0]||(e[0]=n=>s.activeReason=n),"hide-details":"",height:"32",class:"detail-form-radio-group pl-9 pt-4 ma-0"},{default:r(()=>[o(v,{value:"sameReason",class:"mr-8",label:"Reason is same for all"}),o(v,{value:"differentReason",class:"mr-8",label:"Different reasons"})]),_:1},8,["modelValue"])):h("",!0),o(S,{class:"px-8 py-6"},{default:r(()=>[(l(!0),f(R,null,_(s.formData.items,n=>(l(),f("div",{key:n.itemId},[o(k,{quantity:n.quantity,"onUpdate:quantity":g=>n.quantity=g,reason:n.reason,"onUpdate:reason":g=>n.reason=g,notes:n.notes,"onUpdate:notes":g=>n.notes=g,amount:n.amount,"item-id":n.itemId,"show-reason":s.activeReason==="differentReason",class:"mb-4"},null,8,["quantity","onUpdate:quantity","reason","onUpdate:reason","notes","onUpdate:notes","amount","item-id","show-reason"])]))),128)),s.activeReason==="sameReason"?(l(),f("div",ae,[o(Q,{modelValue:s.formData.reason,"onUpdate:modelValue":e[1]||(e[1]=n=>s.formData.reason=n),rules:s.selectRules,items:s.reasonOptions,label:"Reason",variant:"outlined",density:"compact","bg-color":"surface",color:"primary-lighten-2"},null,8,["modelValue","rules","items"]),s.formData.reason==="Other"?(l(),y(K,{key:0,modelValue:s.formData.notes,"onUpdate:modelValue":e[2]||(e[2]=n=>s.formData.notes=n),rules:s.textareaRules,autofocus:"","bg-color":"white",rows:"3"},null,8,["modelValue","rules"])):h("",!0)])):h("",!0)]),_:1}),o(I),o($,{class:"detail-form-footer d-block bg-surface-light elevation-3"},{default:r(()=>[o(W,{class:"d-flex pt-0"},{default:r(()=>[o(p,{cols:"6",class:"d-flex flex-column align-start pl-3"},{default:r(()=>[t.isShippingRefundable?(l(),y(X,{key:0,modelValue:s.includeShipping,"onUpdate:modelValue":e[3]||(e[3]=n=>s.includeShipping=n),color:"primary",density:"compact","hide-details":"",ripple:!1,class:"ml-n1"},{label:r(()=>[e[8]||(e[8]=i("span",{class:"on-surface-high-contrast-text text-subtitle-2"},"Include Shipping:",-1)),s.includeShipping?(l(),f("span",le,m(t.$filters.currency(a.refundShippingCost)),1)):h("",!0)]),_:1},8,["modelValue"])):h("",!0),o(I),o(E,{title:"Payment",class:"pa-0"},{itemContent:r(()=>[o(F,{"card-number":t.order.payment.card.pan,"card-type":t.order.payment.card.issuer,"payment-type":t.order.payment.type},null,8,["card-number","card-type","payment-type"])]),_:1})]),_:1}),o(p,{cols:"6",class:"d-flex flex-column text-no-wrap on-surface-high-contrast-text text-subtitle-2"},{default:r(()=>[o(w,{"no-gutters":""},{default:r(()=>[o(p,{cols:"5"},{default:r(()=>e[9]||(e[9]=[d(" Subtotal: ")])),_:1,__:[9]}),o(p,{cols:"5",offset:"2",class:"text-right font-weight-bold"},{default:r(()=>[d(m(t.$filters.currency(a.refundSubtotal||0)),1)]),_:1})]),_:1}),o(w,{"no-gutters":""},{default:r(()=>[o(p,{cols:"5"},{default:r(()=>e[10]||(e[10]=[d(" Taxes: ")])),_:1,__:[10]}),o(p,{cols:"5",offset:"2",class:"text-right font-weight-bold"},{default:r(()=>[d(m(t.$filters.currency(a.refundTaxTotal)),1)]),_:1})]),_:1}),o(w,{"no-gutters":""},{default:r(()=>[o(p,{cols:"5"},{default:r(()=>e[11]||(e[11]=[d(" Discounts: ")])),_:1,__:[11]}),o(p,{cols:"5",offset:"2",class:C(["text-right font-weight-bold",a.refundDiscountTotal?"text-error":"on-surface-high-contrast-text"])},{default:r(()=>[d(m(t.$filters.currency(a.refundDiscountTotal)),1)]),_:1},8,["class"])]),_:1}),o(w,{"no-gutters":"",class:"mt-2 text-body-2 font-weight-medium"},{default:r(()=>[o(p,{cols:"5"},{default:r(()=>e[12]||(e[12]=[d(" Total: ")])),_:1,__:[12]}),o(p,{cols:"6",offset:"1",class:"text-right font-weight-bold"},{default:r(()=>[d(m(t.$filters.currency(a.refundTotal)),1)]),_:1})]),_:1})]),_:1})]),_:1}),i("div",de,[o(P,{block:"",density:"comfortable",class:"mb-2",disabled:!s.isRefundFormValid||s.isFormProcessing,size:"large",onClick:a.triggerConfirmation},{default:r(()=>e[13]||(e[13]=[d(" Submit ")])),_:1,__:[13]},8,["disabled","onClick"])])]),_:1})]),_:1},8,["modelValue"])):h("",!0),o(re,null,{default:r(()=>[s.isConfirmationShown?(l(),y(S,{key:"confirmation",class:"rounded-0 h-100 pa-0",color:"transparent"},{default:r(()=>[s.isFormProcessing?(l(),f("div",ue,[o(ee,{class:"position-absolute w-100 top-0"})])):h("",!0),o(S,{class:C(["pt-6 mx-auto",{"form-is-processing":s.isFormProcessing}]),style:{"max-width":"400px"}},{default:r(()=>[i("div",me,[o(q,{class:"w-100","use-success-check-icon":!1},{icon:r(()=>[o(D,{size:"124",class:"icon-duotone-eye"},{default:r(()=>e[14]||(e[14]=[d(" $duoToneEye ")])),_:1,__:[14]})]),heading:r(()=>e[15]||(e[15]=[i("p",{class:"font-weight-bold mb-6 text-body-3 text-primary"}," Looking Good? ",-1)])),message:r(()=>[i("div",fe,[i("ul",pe,[(l(!0),f(R,null,_(t.selectedItems,n=>(l(),f("li",{key:n.itemId,class:"d-flex justify-space-between mb-2"},[i("span",null,m(n.description),1),i("span",ce,m(t.$filters.currency(n.total)),1)]))),128))]),o(te,{class:"mb-4"}),i("div",he,[i("ul",ge,[s.includeShipping?(l(),f("li",ye,[e[16]||(e[16]=i("span",{class:"mr-11"},"Shipping:",-1)),i("span",be,m(t.$filters.currency(a.refundShippingCost)),1)])):h("",!0),i("li",null,[e[17]||(e[17]=i("span",{class:"mr-11"},"Taxes:",-1)),i("span",Se,m(t.$filters.currency(a.refundTaxTotal)),1)]),i("li",we,[e[18]||(e[18]=i("span",{class:"mr-4 font-weight-medium text-body-2"},"Total:",-1)),i("span",Ve,m(t.$filters.currency(a.refundTotal)),1)])])])])]),_:1})])]),_:1},8,["class"]),i("div",xe,[o(T,{modelValue:s.isEmailFormValid,"onUpdate:modelValue":e[6]||(e[6]=n=>s.isEmailFormValid=n),class:"text-left mb-3"},{default:r(()=>[e[19]||(e[19]=i("label",{for:"email",class:"on-surface-low-contrast-text text-caption-2 mb-1 d-block"},"Enter Email Address for Receipt: (optional) ",-1)),o(se,{id:"email",modelValue:s.formData.email,"onUpdate:modelValue":e[5]||(e[5]=n=>s.formData.email=n),rules:s.emailRules,variant:"solo",density:"compact",class:"pt-0","hide-details":""},null,8,["modelValue","rules"])]),_:1,__:[19]},8,["modelValue"]),i("div",null,[o(A,{class:"mr-2",onClick:a.handleCancelConfirmation},{default:r(()=>e[20]||(e[20]=[d(" Cancel ")])),_:1,__:[20]},8,["onClick"]),o(oe,{color:"primary",disabled:!s.isEmailFormValid,onClick:a.handleRefundConfirm},{default:r(()=>e[21]||(e[21]=[d(" Yes, Refund ")])),_:1,__:[21]},8,["disabled","onClick"])])])]),_:1})):s.errorMessage||s.isEportError?(l(),y(S,{key:"error-message",class:"rounded-0 fill-height pa-0",color:"transparent"},{default:r(()=>{var n,g,V,x;return[i("div",_e,[s.isEportError?(l(),f("div",Ce,[o(D,{size:"134",class:"mb-8 icon-duotone-eye-warning"},{default:r(()=>e[22]||(e[22]=[d(" $duoToneEye ")])),_:1,__:[22]}),i("div",Te,[e[23]||(e[23]=i("div",{class:"text-warning mb-6"}," Must go to SeedLive to process refund ",-1)),i("div",null," Device Trans Id: "+m(((g=(n=t.order)==null?void 0:n.payment)==null?void 0:g.eportTransactionId)||""),1),Y(i("div",null," Device Serial Number: "+m(t.order.payment.serialNumber),513),[[Z,((x=(V=t.order)==null?void 0:V.payment)==null?void 0:x.serialNumber)||!1]])])])):(l(),f("p",Re,m(s.errorMessage),1))])]}),_:1})):h("",!0)]),_:1})]),_:1})}const Ge=B(ie,[["render",ve],["__scopeId","data-v-fe293264"]]);export{Ge as default};
