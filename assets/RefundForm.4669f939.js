import{a as A,b as B,c as O}from"./vuex.0eb68a2c.js";import{C as z,S as N,P as j,l as L,_ as G}from"./index.8a58b007.js";import Z from"./RefundFormItem.141f44e7.js";import{S as b,e as l,x as y,k as o,g as s,J as d,z as h,f as c,j as R,G as v,I as m,B as I,E as a,L as J,M as Y,aj as H,ak as K}from"./@vue.ee679632.js";import{k as Q,l as C,F as W,E as T,n as X,o as $,t as S,i as D,aj as ee,w as f,P as te,x as w,p as se,a1 as oe,c as k,f as ne,u as re,d as ae,D as ie,q as le}from"./vuetify.65d833ec.js";import"./date-fns.d38e1d55.js";import"./vue-atomic-docs.4f3653eb.js";import"./vue-router.ec64e966.js";import"./axios.eca6faa7.js";import"./axios-cache-interceptor.0956cad0.js";import"./cache-parser.124ebbb8.js";import"./fast-defer.b34f24de.js";import"./object-code.c2755e43.js";import"./@fortawesome.2cecc5e3.js";import"./@awesome.me.7dae7d79.js";const de={components:{CardItem:z,SuccessAnimation:N,RefundFormItem:Z,PaymentType:j},emits:["refunded"],data(){return{isRefundFormValid:!1,isEmailFormValid:!1,selectRules:[e=>!!e||"Reason required"],textareaRules:[e=>!!e||"Description required"],emailRules:[e=>!e||/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)||"Invalid email"],activeReason:"sameReason",includeShipping:!1,isFormShown:!0,isConfirmationShown:!1,isSuccessAnimationShown:!1,isFormProcessing:!1,reasonOptions:L,errorMessage:null,isEportError:null,formData:{items:[],reason:null,notes:null,email:null,mailRefund:!1,zoneOffset:"-06:00"}}},computed:{...A({order:"order/orderDetails",selectedItems:"order/selectedItems",refundableItems:"order/getRefundableItems",orderShipping:"order/getOrderShipping",isShippingRefundable:"order/getIsShippingRefundable"}),refundDiscountTotal(){let e=0;return this.formData.items.forEach(n=>{var t;const u=((t=this.order.items.find(({itemId:i})=>i===n.itemId))==null?void 0:t.discountTotal)||0,p=n.quantity||0;e+=u*p}),Math.round(e*100)/100},refundShippingCost(){return this.includeShipping&&this.order.payment.shippingTotal||0},refundSubtotal(){let e=0;return this.formData.items.forEach(n=>{var t;const u=((t=this.order.items.find(({itemId:i})=>i===n.itemId))==null?void 0:t.price)||0,p=n.quantity||0;e+=u*p}),Math.round(e*100)/100},refundTaxTotal(){let e=0;return this.formData.items.forEach(n=>{var t;const u=((t=this.order.items.find(({itemId:i})=>i===n.itemId))==null?void 0:t.tax)||0,p=n.quantity||0;e+=u*p}),this.includeShipping&&(e+=(this.order.payment.shippingTotal||0)*(this.order.payment.shippingTaxRate||0)),Math.round(e*100)/100},refundTotal(){let e=this.order.payment.couponTotal?this.refundDiscountTotal:0,n=this.refundTaxTotal+this.refundSubtotal+this.refundShippingCost-e;return Math.round(n*100)/100}},watch:{selectedItems:{handler(e){const n=this.formData.items.filter(({itemId:u})=>!!e.find(p=>p.itemId===u));e.forEach(u=>{this.formData.items.findIndex(({itemId:t})=>t===u.itemId)<0&&n.push({itemId:u.itemId,notes:null,reason:null,quantity:u.quantity,amount:u.total})}),this.formData.items=n},immediate:!0,deep:!0}},mounted(){var e,n;this.includeShipping=this.isShippingRefundable,this.formData.email=((n=(e=this.order)==null?void 0:e.customer)==null?void 0:n.email)||null},methods:{...B("order",["submitOrderRefund","refreshOrderDetailsAndOrders"]),...O("order",["setSelectedItems"]),triggerConfirmation(){this.isFormShown=!1,this.isConfirmationShown=!0},handleCancelConfirmation(){this.isConfirmationShown=!1,this.isFormShown=!0},async handleRefundConfirm(){if(!this.isFormProcessing){this.isFormProcessing=!0,this.includeShipping&&this.formData.items.push({itemId:this.orderShipping.itemId,amount:this.orderShipping.total,reason:"Shipping Refund"});try{await this.submitOrderRefund({sessionId:this.order.session.sessionId,formData:this.formData}),this.isSuccessAnimationShown=!0,this.$emit("refunded",this.refundTotal)}catch(e){e.response.status===403?this.errorMessage="Something went wrong, this user is not authorized to perform this action. Please try again, or contact support.":e.response.status===404?this.errorMessage="Something went wrong, this order was not found. Please try again, or contact support.":e.response.status===503?this.order.payment.card.processor==="Eport"?this.isEportError=!0:this.errorMessage="Something went wrong. Please try again, or contact support.":this.errorMessage="Something went wrong. Please try again, or contact support."}await this.refreshOrderDetailsAndOrders(),this.isFormProcessing=!1,this.isConfirmationShown=!1}}}},_=e=>(H("data-v-fe293264"),e=e(),K(),e),ue={key:0,class:"mt-4"},me=_(()=>a("span",{class:"on-surface-high-contrast-text text-subtitle-2"},"Include Shipping:",-1)),ce={key:0,class:"ml-2 font-weight-bold"},fe={class:"px-6"},pe={key:0,class:"d-flex flex-column align-center justify-center position-relative"},he={class:"d-flex flex-column align-center pb-30"},ge=_(()=>a("p",{class:"font-weight-bold mb-6 text-body-3 text-primary"}," Looking Good? ",-1)),ye={class:"mx-auto"},_e={class:"px-0 mb-4"},be={class:"font-weight-bold"},Se={class:"text-right"},we={class:"pa-0 ma-0",style:{"list-style":"none"}},xe={key:0},Ve=_(()=>a("span",{class:"mr-11"},"Shipping:",-1)),Re={class:"font-weight-bold"},ve=_(()=>a("span",{class:"mr-11"},"Taxes:",-1)),Ie={class:"font-weight-bold"},Ce={class:"mt-2"},Te=_(()=>a("span",{class:"mr-4 font-weight-medium text-body-2"},"Total:",-1)),De={class:"font-weight-bold text-body-2"},ke={class:"confirm-footer text-right py-4 px-8 elevation-3 bg-surface-light"},Fe=_(()=>a("label",{for:"email",class:"on-surface-low-contrast-text text-caption-2 mb-1 d-block"},"Enter Email Address for Receipt: (optional) ",-1)),Ee={class:"text-center pt-6"},Pe={key:0},qe={key:1},Me={class:"font-weight-bold mb-6 text-body-3 text-primary"},Ue=_(()=>a("div",{class:"text-warning mb-6"}," Must go to SeedLive to process refund ",-1));function Ae(e,n,u,p,t,i){const F=b("RefundFormItem"),E=b("PaymentType"),P=b("CardItem"),q=b("VBtnPrimary"),M=b("SuccessAnimation"),U=b("VBtnSecondary");return l(),y(le,{color:"surface-light",class:"rounded-0 elevation-0 allow-card-overflow d-flex flex-column"},{default:o(()=>[s(Q,{class:"detail-form-header bg-primary mb-0 elevation-3"},{default:o(()=>[d(" Refund ")]),_:1}),t.isFormShown?(l(),y(C,{key:0,modelValue:t.isRefundFormValid,"onUpdate:modelValue":n[4]||(n[4]=r=>t.isRefundFormValid=r),class:"d-flex flex-column flex-grow-1 justify-space-between"},{default:o(()=>[e.selectedItems.length>1?(l(),y(W,{key:0,modelValue:t.activeReason,"onUpdate:modelValue":n[0]||(n[0]=r=>t.activeReason=r),"hide-details":"",height:"32",class:"detail-form-radio-group pl-9 pt-4 ma-0"},{default:o(()=>[s(T,{value:"sameReason",class:"mr-8",label:"Reason is same for all"}),s(T,{value:"differentReason",class:"mr-8",label:"Different reasons"})]),_:1},8,["modelValue"])):h("",!0),s(S,{class:"px-8 py-6"},{default:o(()=>[(l(!0),c(v,null,R(t.formData.items,r=>(l(),c("div",{key:r.itemId},[s(F,{quantity:r.quantity,"onUpdate:quantity":g=>r.quantity=g,reason:r.reason,"onUpdate:reason":g=>r.reason=g,notes:r.notes,"onUpdate:notes":g=>r.notes=g,amount:r.amount,"item-id":r.itemId,"show-reason":t.activeReason==="differentReason",class:"mb-4"},null,8,["quantity","onUpdate:quantity","reason","onUpdate:reason","notes","onUpdate:notes","amount","item-id","show-reason"])]))),128)),t.activeReason==="sameReason"?(l(),c("div",ue,[s(X,{modelValue:t.formData.reason,"onUpdate:modelValue":n[1]||(n[1]=r=>t.formData.reason=r),rules:t.selectRules,items:t.reasonOptions,label:"Reason",variant:"outlined",density:"compact","bg-color":"surface",color:"primary-lighten-2"},null,8,["modelValue","rules","items"]),t.formData.reason==="Other"?(l(),y($,{key:0,modelValue:t.formData.notes,"onUpdate:modelValue":n[2]||(n[2]=r=>t.formData.notes=r),rules:t.textareaRules,autofocus:"","bg-color":"white",rows:"3"},null,8,["modelValue","rules"])):h("",!0)])):h("",!0)]),_:1}),s(D),s(se,{class:"detail-form-footer d-block bg-surface-light elevation-3"},{default:o(()=>[s(ee,{class:"d-flex pt-0"},{default:o(()=>[s(f,{cols:"6",class:"d-flex flex-column align-start pl-3"},{default:o(()=>[e.isShippingRefundable?(l(),y(te,{key:0,modelValue:t.includeShipping,"onUpdate:modelValue":n[3]||(n[3]=r=>t.includeShipping=r),color:"primary",density:"compact","hide-details":"",ripple:!1,class:"ml-n1"},{label:o(()=>[me,t.includeShipping?(l(),c("span",ce,m(e.$filters.currency(i.refundShippingCost)),1)):h("",!0)]),_:1},8,["modelValue"])):h("",!0),s(D),s(P,{title:"Payment",class:"pa-0"},{itemContent:o(()=>[s(E,{"card-number":e.order.payment.card.pan,"card-type":e.order.payment.card.issuer,"payment-type":e.order.payment.type},null,8,["card-number","card-type","payment-type"])]),_:1})]),_:1}),s(f,{cols:"6",class:"d-flex flex-column text-no-wrap on-surface-high-contrast-text text-subtitle-2"},{default:o(()=>[s(w,{"no-gutters":""},{default:o(()=>[s(f,{cols:"5"},{default:o(()=>[d(" Subtotal: ")]),_:1}),s(f,{cols:"5",offset:"2",class:"text-right font-weight-bold"},{default:o(()=>[d(m(e.$filters.currency(i.refundSubtotal||0)),1)]),_:1})]),_:1}),s(w,{"no-gutters":""},{default:o(()=>[s(f,{cols:"5"},{default:o(()=>[d(" Taxes: ")]),_:1}),s(f,{cols:"5",offset:"2",class:"text-right font-weight-bold"},{default:o(()=>[d(m(e.$filters.currency(i.refundTaxTotal)),1)]),_:1})]),_:1}),s(w,{"no-gutters":""},{default:o(()=>[s(f,{cols:"5"},{default:o(()=>[d(" Discounts: ")]),_:1}),s(f,{cols:"5",offset:"2",class:I(["text-right font-weight-bold",i.refundDiscountTotal?"text-error":"on-surface-high-contrast-text"])},{default:o(()=>[d(m(e.$filters.currency(i.refundDiscountTotal)),1)]),_:1},8,["class"])]),_:1}),s(w,{"no-gutters":"",class:"mt-2 text-body-2 font-weight-medium"},{default:o(()=>[s(f,{cols:"5"},{default:o(()=>[d(" Total: ")]),_:1}),s(f,{cols:"6",offset:"1",class:"text-right font-weight-bold"},{default:o(()=>[d(m(e.$filters.currency(i.refundTotal)),1)]),_:1})]),_:1})]),_:1})]),_:1}),a("div",fe,[s(q,{block:"",density:"comfortable",class:"mb-2",disabled:!t.isRefundFormValid||t.isFormProcessing,size:"large",onClick:i.triggerConfirmation},{default:o(()=>[d(" Submit ")]),_:1},8,["disabled","onClick"])])]),_:1})]),_:1},8,["modelValue"])):h("",!0),s(ie,null,{default:o(()=>[t.isConfirmationShown?(l(),y(S,{key:"confirmation",class:"rounded-0 h-100 pa-0",color:"transparent"},{default:o(()=>[t.isFormProcessing?(l(),c("div",pe,[s(oe,{class:"position-absolute w-100 top-0"})])):h("",!0),s(S,{class:I(["pt-6 mx-auto",{"form-is-processing":t.isFormProcessing}]),style:{"max-width":"400px"}},{default:o(()=>[a("div",he,[s(M,{class:"w-100","use-success-check-icon":!1},{icon:o(()=>[s(k,{size:"124",class:"icon-duotone-eye"},{default:o(()=>[d(" $duoToneEye ")]),_:1})]),heading:o(()=>[ge]),message:o(()=>[a("div",ye,[a("ul",_e,[(l(!0),c(v,null,R(e.selectedItems,r=>(l(),c("li",{key:r.itemId,class:"d-flex justify-space-between mb-2"},[a("span",null,m(r.description),1),a("span",be,m(e.$filters.currency(r.total)),1)]))),128))]),s(ne,{class:"mb-4"}),a("div",Se,[a("ul",we,[t.includeShipping?(l(),c("li",xe,[Ve,a("span",Re,m(e.$filters.currency(i.refundShippingCost)),1)])):h("",!0),a("li",null,[ve,a("span",Ie,m(e.$filters.currency(i.refundTaxTotal)),1)]),a("li",Ce,[Te,a("span",De,m(e.$filters.currency(i.refundTotal)),1)])])])])]),_:1})])]),_:1},8,["class"]),a("div",ke,[s(C,{modelValue:t.isEmailFormValid,"onUpdate:modelValue":n[6]||(n[6]=r=>t.isEmailFormValid=r),class:"text-left mb-3"},{default:o(()=>[Fe,s(re,{id:"email",modelValue:t.formData.email,"onUpdate:modelValue":n[5]||(n[5]=r=>t.formData.email=r),rules:t.emailRules,variant:"solo",density:"compact",class:"pt-0","hide-details":""},null,8,["modelValue","rules"])]),_:1},8,["modelValue"]),a("div",null,[s(U,{class:"mr-2",onClick:i.handleCancelConfirmation},{default:o(()=>[d(" Cancel ")]),_:1},8,["onClick"]),s(ae,{color:"primary",disabled:!t.isEmailFormValid,onClick:i.handleRefundConfirm},{default:o(()=>[d(" Yes, Refund ")]),_:1},8,["disabled","onClick"])])])]),_:1})):t.errorMessage||t.isEportError?(l(),y(S,{key:"error-message",class:"rounded-0 fill-height pa-0",color:"transparent"},{default:o(()=>{var r,g,x,V;return[a("div",Ee,[t.isEportError?(l(),c("div",qe,[s(k,{size:"134",class:"mb-8 icon-duotone-eye-warning"},{default:o(()=>[d(" $duoToneEye ")]),_:1}),a("div",Me,[Ue,a("div",null," Device Trans Id: "+m(((g=(r=e.order)==null?void 0:r.payment)==null?void 0:g.eportTransactionId)||""),1),J(a("div",null," Device Serial Number: "+m(e.order.payment.serialNumber),513),[[Y,((V=(x=e.order)==null?void 0:x.payment)==null?void 0:V.serialNumber)||!1]])])])):(l(),c("p",Pe,m(t.errorMessage),1))])]}),_:1})):h("",!0)]),_:1})]),_:1})}const $e=G(de,[["render",Ae],["__scopeId","data-v-fe293264"]]);export{$e as default};
