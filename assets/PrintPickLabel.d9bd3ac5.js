import P from"./ConfirmDialog.060a100c.js";import b from"./PrintTeleporter.0f903a0b.js";import S from"./PickLabel.e8c579b7.js";import{m as C,c as T}from"./vuex.0eb68a2c.js";import{_ as k}from"./index.8a58b007.js";import{ae as y}from"./vuetify.65d833ec.js";import{S as a,e as l,f as m,g as c,k as p,G as I,j as _,z as x,J as w,I as B,i as $,E as O,x as L}from"./@vue.ee679632.js";import"./date-fns.d38e1d55.js";import"./vue-atomic-docs.4f3653eb.js";import"./vue-router.ec64e966.js";import"./axios.eca6faa7.js";import"./axios-cache-interceptor.0956cad0.js";import"./cache-parser.124ebbb8.js";import"./fast-defer.b34f24de.js";import"./object-code.c2755e43.js";import"./@fortawesome.2cecc5e3.js";import"./@awesome.me.7dae7d79.js";import"./BarcodeGenerator.39689fa5.js";import"./bwip-js.88a7b0d7.js";const A={components:{PrintTeleporter:b,PickLabel:S,ConfirmDialog:P},props:{orders:{type:[Array,Object],required:!0},isReprintable:{type:Boolean,default:!1}},emits:["print-process-complete","print-canceled"],data(){return{confirmAction:"print"}},computed:{...C("orders",["skipInitialPrintConfirmation"]),printBtnLabel(){const t=this.ordersToPrint.length>1?this.ordersToPrint.length:" ";return this.isReprintable&&!this.isPendingPrintStage?`RePrint ${t} ${this.formattedStrings.label}`:`Print ${t} ${this.formattedStrings.label}`},ordersToPrint(){return Array.isArray(this.orders)?this.orders:[this.orders]},isPendingPrintStage(){var t;return((t=this.ordersToPrint[0])==null?void 0:t.stage)==="pending-print"},formattedStrings(){const t=this.ordersToPrint.length>1;return{label:t?"labels":"label",has:t?"have":"has"}},toggleSkipInitialPrintConfirmation:{get(){return this.skipInitialPrintConfirmation},set(t){this.setSkipInitialPrintConfirmation(t)}}},methods:{...T("orders",["setSkipInitialPrintConfirmation"]),async showPrintConfirmationDialog(){const t={rePrintableInitial:{title:"Label Already Printed",message:"This label has already been printed. Are you sure you want to reprint?",supportingMessage:this.skipInitialPrintConfirmation?void 0:"NOTE: You must confirm the label has printed after printing to transition to the next stage.",confirmBtnText:"Yes, Reprint",cancelBtnText:"Cancel"},defaultInitial:{title:"ATTENTION",message:`You must confirm the ${this.formattedStrings.label} ${this.formattedStrings.has} printed after printing to transition to the next stage.`,confirmBtnText:"I Understand, Print",cancelBtnText:"Cancel"},final:{title:`Confirm the ${this.formattedStrings.label} Printed`,message:`Did the ${this.formattedStrings.label} print successfully?`,confirmBtnText:"Yes, submit",cancelBtnText:"No, cancel"}};let e;this.confirmAction==="print"?this.isPendingPrintStage?e=t.defaultInitial:e=t.rePrintableInitial:e=t.final;const r={confirmBtnText:e.confirmBtnText,cancelBtnText:e.cancelBtnText,supportingMessage:e.supportingMessage,width:400,color:"error",titleIcon:"$exclamationTriangle",zIndex:2410};return await this.$refs.confirm.open(e.title,e.message,r)},async handlePrintBtnClick(){this.confirmAction="print",this.isPendingPrintStage&&this.skipInitialPrintConfirmation||await this.showPrintConfirmationDialog()?this.printLabels():this.$emit("print-canceled")},async submitPrintedLabels(){const t=await this.postOrderPrinted(this.ordersToPrint),e=this.getSubmissionResultType(t);return this.showSubmissionResultsSnackbar(t,e),{failedOrders:t.failed,result:e}},async postOrderPrinted(t){const e=async n=>{var i;const s=n.sessionId||((i=n.session)==null?void 0:i.sessionId);try{return await this.$store.dispatch("order/postOrderPrinted",s),n}catch(o){throw{order:n,error:o}}};return(await Promise.allSettled(t.map(e))).reduce((n,s)=>(s.status==="rejected"?n.failed.push({order:s.reason.order,error:s.reason.error.message}):n.successful.push(s.value),n),{successful:[],failed:[]})},getSubmissionResultType(t){const{successful:e,failed:r}=t;return e.length>0&&r.length===0?"successful":e.length===0&&r.length>0?"failed":e.length>0&&r.length>0?"partial":"noOrders"},showSubmissionResultsSnackbar(t,e){const{successful:r,failed:n}=t,s=r.length>1?"orders":"order",i=n.length>1?"orders":"order",o={successful:{message:`Successfully submitted ${r.length} ${s} as printed`},failed:{color:"error",message:`Failed to submit ${n.length} ${i} as printed.`},partial:{color:"warning",message:`Successfully submitted ${r.length} ${s} as printed, but failed to submit ${n.length} ${i}`},noOrders:{color:"info",message:"No data submitted"}};this.$store.dispatch("app/setSnackbar",{...o[e]})},printLabels(){this.$refs.printTeleporter.print()},async handlePrintComplete(){if(this.confirmAction="submit",await this.showPrintConfirmationDialog()){const e=await this.submitPrintedLabels();this.$emit("print-process-complete",e)}}}},V={class:"print-pick-label"},D={key:0},N={class:"d-flex justify-end px-4"};function R(t,e,r,n,s,i){const o=a("PickLabel"),u=a("PrintTeleporter"),h=a("VBtnSecondary"),g=a("ConfirmDialog");return l(),m("div",V,[c(u,{ref:"printTeleporter",onPrintingComplete:i.handlePrintComplete},{default:p(({isPrinting:d})=>[d?(l(),m("div",D,[(l(!0),m(I,null,_(i.ordersToPrint,f=>(l(),L(o,{key:f.transactionId,order:f},null,8,["order"]))),128))])):x("",!0)]),_:1},8,["onPrintingComplete"]),c(h,{disabled:i.ordersToPrint.length===0,"prepend-icon":"$print",onClick:i.handlePrintBtnClick},{default:p(()=>[w(B(i.printBtnLabel),1)]),_:1},8,["disabled","onClick"]),c(g,{ref:"confirm",persistent:"",class:"d-print-none"},$({_:2},[s.confirmAction==="print"&&i.isPendingPrintStage?{name:"below-actions",fn:p(()=>[O("div",N,[c(y,{modelValue:i.toggleSkipInitialPrintConfirmation,"onUpdate:modelValue":e[0]||(e[0]=d=>i.toggleSkipInitialPrintConfirmation=d),label:"Do not show again","hide-details":""},null,8,["modelValue"])])]),key:"0"}:void 0]),1536)])}const it=k(A,[["render",R]]);export{it as default};
