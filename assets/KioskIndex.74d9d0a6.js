import S from"./SearchFormActions.9b387442.js";import F from"./SearchFormFieldset.2aa0dec9.js";import M from"./SearchFormInput.b84ad1fe.js";import C from"./SearchFormRow.bc300fb2.js";import K from"./TableDownloadContainer.aeb10662.js";import w from"./SearchForm.eb63e990.js";import A from"./KiosksTable.f02c5a61.js";import{d as N}from"./KioskStatusIcon.83d6f8f8.js";import{m as b,a as f,b as h}from"./vuex.0eb68a2c.js";import O from"./DefaultLayout.61d229e4.js";import{_ as U}from"./index.8a58b007.js";import{am as L,aj as R}from"./vuetify.65d833ec.js";import{S as m,e as u,x as c,k as n,g as r,z as y,f as z}from"./@vue.ee679632.js";import"./date-fns.d38e1d55.js";import"./vue-atomic-docs.4f3653eb.js";import"./vue-router.ec64e966.js";import"./axios.eca6faa7.js";import"./axios-cache-interceptor.0956cad0.js";import"./cache-parser.124ebbb8.js";import"./fast-defer.b34f24de.js";import"./object-code.c2755e43.js";import"./@fortawesome.2cecc5e3.js";import"./@awesome.me.7dae7d79.js";import"./DatePicker.55087c86.js";import"./@vuepic.604267a2.js";import"./@babel.5574241f.js";import"./ResultsLimitMenu.e0b88f86.js";import"./PrintTeleporter.0f903a0b.js";import"./GradeTag.7a870790.js";import"./MeruDataTable.80a372ee.js";const E=[{name:"Alabama",abbreviation:"AL"},{name:"Alaska",abbreviation:"AK"},{name:"Arizona",abbreviation:"AZ"},{name:"Arkansas",abbreviation:"AR"},{name:"California",abbreviation:"CA"},{name:"Colorado",abbreviation:"CO"},{name:"Connecticut",abbreviation:"CT"},{name:"Delaware",abbreviation:"DE"},{name:"District Of Columbia",abbreviation:"DC"},{name:"Florida",abbreviation:"FL"},{name:"Georgia",abbreviation:"GA"},{name:"Hawaii",abbreviation:"HI"},{name:"Idaho",abbreviation:"ID"},{name:"Illinois",abbreviation:"IL"},{name:"Indiana",abbreviation:"IN"},{name:"Iowa",abbreviation:"IA"},{name:"Kansas",abbreviation:"KS"},{name:"Kentucky",abbreviation:"KY"},{name:"Louisiana",abbreviation:"LA"},{name:"Maine",abbreviation:"ME"},{name:"Maryland",abbreviation:"MD"},{name:"Massachusetts",abbreviation:"MA"},{name:"Michigan",abbreviation:"MI"},{name:"Minnesota",abbreviation:"MN"},{name:"Mississippi",abbreviation:"MS"},{name:"Missouri",abbreviation:"MO"},{name:"Montana",abbreviation:"MT"},{name:"Nebraska",abbreviation:"NE"},{name:"Nevada",abbreviation:"NV"},{name:"New Hampshire",abbreviation:"NH"},{name:"New Jersey",abbreviation:"NJ"},{name:"New Mexico",abbreviation:"NM"},{name:"New York",abbreviation:"NY"},{name:"North Carolina",abbreviation:"NC"},{name:"North Dakota",abbreviation:"ND"},{name:"Ohio",abbreviation:"OH"},{name:"Oklahoma",abbreviation:"OK"},{name:"Oregon",abbreviation:"OR"},{name:"Pennsylvania",abbreviation:"PA"},{name:"Rhode Island",abbreviation:"RI"},{name:"South Carolina",abbreviation:"SC"},{name:"South Dakota",abbreviation:"SD"},{name:"Tennessee",abbreviation:"TN"},{name:"Texas",abbreviation:"TX"},{name:"Utah",abbreviation:"UT"},{name:"Vermont",abbreviation:"VT"},{name:"Virginia",abbreviation:"VA"},{name:"Washington",abbreviation:"WA"},{name:"West Virginia",abbreviation:"WV"},{name:"Wisconsin",abbreviation:"WI"},{name:"Wyoming",abbreviation:"WY"}],x={components:{SearchFormActions:S,TableDownloadContainer:K,KiosksTable:A,SearchFormInput:M,SearchFormFieldset:F,SearchFormRow:C,SearchForm:w,DefaultLayout:O},data(){return{formData:{serialNumber:void 0,status:void 0,machineType:[],marketManager:void 0,kioskTech:void 0,banner:void 0,locationCode:void 0,address:void 0,city:void 0,state:void 0,zipCode:void 0},sortBy:[{key:"lastService",order:"desc"}],isValid:!1,isLoadingKiosks:!1,isInitializingOptions:!1,usStates:E,errorMessages:[],kioskStatusItems:[{title:"All",value:"All"},{title:"OK",value:"OK"},{title:"Out of Order",value:"OOO"},{title:"Offline",value:"Offline"}],csvHeaders:[{title:"Kiosk #",key:"serialNumber"},{title:"Machine Type",key:"machineType"},{title:"Machine Health",key:"machineHealth"},{title:"Connection Status",key:"connectionStatus"},{title:"Last Connected",key:"lastConnectedTimestamp"},{title:"Grade",key:"grade"},{title:"Avg Daily Revenue",key:"avgDailyRev"},{title:"Last Service",key:"lastService"},{title:"Location Code",key:"locationCode"},{title:"Banner",key:"name"},{title:"City",key:"city"},{title:"State",key:"state"}]}},computed:{...b("kiosk",["userKiosks","kiosks","machineTypes"]),...f("kiosk",{banners:"alphabetizedBanners"}),...b("territories",["territoryUsers"]),...f("territories",["territoryFieldUsers","territoryManagers"]),...b("user",["user"]),...f("user",["checkUserPermissions"]),loggedInKioskTechManagersId(){var t;return(t=this.user.manager)==null?void 0:t.id},loggedInKioskTechId(){var t,e,i,l,a;return(a=(l=(i=(t=this.territoryUsers)==null?void 0:t.fieldUsers)==null?void 0:i[(e=this.user)==null?void 0:e.username])==null?void 0:l.userId)!=null?a:0},loggedInMarketManagerId(){var t,e,i,l,a;return(a=(l=(i=(t=this.territoryUsers)==null?void 0:t.managers)==null?void 0:i[(e=this.user)==null?void 0:e.username])==null?void 0:l.userId)!=null?a:0},kioskTypeItems(){return this.machineTypes.map(t=>({code:t.code,desc:`${t.code} - ${t.desc}`}))},csvItems(){return this.kiosks.map(t=>this.csvHeaders.map(e=>{let i=t[e.key]||"";return e.key==="avgDailyRev"&&i!==""&&(i=`${this.$filters.currency(i)}`),e.key==="lastService"&&i!==""&&(i=`${i} days ago`),e.key==="lastConnectedTimestamp"&&i!==""&&(i=`${N(i)} days ago`),i}))},isFormEmpty(){return!Object.values(this.formData).some(t=>Array.isArray(t)?t.length:t)}},async mounted(){await this.initializeFormOptions(),this.initializeFormData(),this.submitForm()},methods:{...h("kiosk",["fetchKiosks","fetchBanners","fetchMachineTypes"]),...h("territories",["loadTerritoryUsers"]),initializeFormData(){const t=this.$route.query;if(Object.keys(t).length){for(const e in t)if(e in t){let i=t[e];(e==="kioskTech"||e==="marketManager")&&(i=parseInt(i)),this.formData[e]=i}}else this.loggedInKioskTechId&&(this.formData.kioskTech=this.loggedInKioskTechId),this.loggedInMarketManagerId?this.formData.marketManager=this.loggedInMarketManagerId:this.loggedInKioskTechManagersId&&(this.formData.marketManager=this.loggedInKioskTechManagersId)},async initializeFormOptions(){this.isInitializingOptions=!0;let t=[];const e=[];this.banners.length||t.push(this.fetchBanners().catch(i=>{throw console.error("Error fetching banners:",i),e.push("banners"),i})),this.machineTypes.length||t.push(this.fetchMachineTypes().catch(i=>{throw console.error("Error fetching machine types:",i),e.push("machine types"),i})),(!this.territoryUsers.managers||!this.territoryUsers.fieldUsers)&&t.push(this.loadTerritoryUsers().catch(i=>{throw console.error("Error loading territory users:",i),e.push("territory users"),i}));try{await Promise.all(t)}catch{this.showErrorSnackbar(`Error fetching ${e.join(", ")}`)}finally{this.isInitializingOptions=!1}},async submitForm(){if(!this.isFormEmpty){this.isLoadingKiosks=!0;try{let t=JSON.parse(JSON.stringify(this.formData));for(const e in t)t[e]||delete t[e];this.updateQueryString(t),await this.fetchKiosks(t)}catch{this.showErrorSnackbar("Failed to load kiosks")}this.isLoadingKiosks=!1}},async resetForm(){this.$refs.kioskSearchForm.resetForm(),this.formData={serialNumber:void 0,machineType:[],status:void 0,marketManager:void 0,kioskTech:void 0,banner:void 0,locationCode:void 0,address:void 0,city:void 0,state:void 0,zipCode:void 0}},handleKioskRowClicked(t){const i=/[/.]{1}k2\./.test(window.location.origin)?"k2":"testk2";window.open(`https://${i}.minutekey.com/kiosk/${t.serialNumber}`,"_blank")},showErrorSnackbar(t){this.$store.dispatch("app/setSnackbar",{message:t,color:"error",location:"top"})},updateQueryString(t){this.$router.replace({path:this.$route.path,query:{...t}})}}},B={key:0,class:"text-right text-error px-6"};function H(t,e,i,l,a,d){const s=m("SearchFormInput"),p=m("SearchFormFieldset"),k=m("SearchFormRow"),v=m("SearchFormActions"),g=m("SearchForm"),V=m("KiosksTable"),D=m("TableDownloadContainer"),T=m("DefaultLayout");return u(),c(T,{"no-content-padding":"",class:"kiosk-index"},{default:n(()=>[t.checkUserPermissions("FilterKiosks")?(u(),c(g,{key:0,ref:"kioskSearchForm","form-data":a.formData,"onUpdate:formData":e[11]||(e[11]=o=>a.formData=o),disabled:a.isInitializingOptions,class:"mb-4",onValid:e[12]||(e[12]=o=>a.isValid=o)},{default:n(()=>[r(k,null,{default:n(()=>[r(p,{"col-props":{cols:6}},{default:n(()=>[r(s,{modelValue:a.formData.serialNumber,"onUpdate:modelValue":e[0]||(e[0]=o=>a.formData.serialNumber=o),"input-type":"VTextField",label:"Kiosk Number","col-props":{cols:4}},null,8,["modelValue"]),r(s,{modelValue:a.formData.machineType,"onUpdate:modelValue":e[1]||(e[1]=o=>a.formData.machineType=o),"input-type":"VAutocomplete",label:"Kiosk Type","item-title":"desc","item-value":"code",items:d.kioskTypeItems,"col-props":{cols:4},multiple:""},null,8,["modelValue","items"]),r(s,{modelValue:a.formData.status,"onUpdate:modelValue":e[2]||(e[2]=o=>a.formData.status=o),"input-type":"VSelect",label:"Kiosk Status","item-title":"title","item-value":"value",items:a.kioskStatusItems,"col-props":{cols:4}},null,8,["modelValue","items"])]),_:1}),r(p,{"col-props":{cols:6}},{default:n(()=>[r(s,{modelValue:a.formData.marketManager,"onUpdate:modelValue":e[3]||(e[3]=o=>a.formData.marketManager=o),"input-type":"VAutocomplete",label:"Market Manager","prepend-icon":"$user","item-title":"name","item-value":"userId",items:t.territoryManagers,"col-props":{cols:6}},null,8,["modelValue","items"]),r(s,{modelValue:a.formData.kioskTech,"onUpdate:modelValue":e[4]||(e[4]=o=>a.formData.kioskTech=o),"input-type":"VAutocomplete",label:"Kiosk Tech","item-title":"name","item-value":"userId",items:t.territoryFieldUsers,"col-props":{cols:6}},null,8,["modelValue","items"])]),_:1})]),_:1}),r(k,null,{"end-of-row":n(()=>[r(v,{disabled:!a.isValid||d.isFormEmpty||a.isLoadingKiosks,onReset:d.resetForm,onSubmit:d.submitForm},null,8,["disabled","onReset","onSubmit"])]),default:n(()=>[r(p,{"col-props":{cols:5}},{default:n(()=>[r(s,{modelValue:a.formData.banner,"onUpdate:modelValue":e[5]||(e[5]=o=>a.formData.banner=o),"input-type":"VAutocomplete",label:"Banner","prepend-icon":"$building","item-title":"name","item-value":"name","col-props":{cols:7},items:t.banners},null,8,["modelValue","items"]),r(s,{modelValue:a.formData.locationCode,"onUpdate:modelValue":e[6]||(e[6]=o=>a.formData.locationCode=o),"input-type":"VTextField",label:"Location Code","col-props":{cols:5}},null,8,["modelValue"])]),_:1}),r(p,{"col-props":{cols:7}},{default:n(()=>[r(s,{modelValue:a.formData.address,"onUpdate:modelValue":e[7]||(e[7]=o=>a.formData.address=o),"input-type":"VTextField",label:"Address","prepend-icon":"$mapMarkerAlt","col-props":{cols:4}},null,8,["modelValue"]),r(s,{modelValue:a.formData.city,"onUpdate:modelValue":e[8]||(e[8]=o=>a.formData.city=o),"input-type":"VTextField",label:"City","col-props":{cols:3}},null,8,["modelValue"]),r(s,{modelValue:a.formData.state,"onUpdate:modelValue":e[9]||(e[9]=o=>a.formData.state=o),"input-type":"VAutocomplete",label:"State","item-title":"abbreviation","item-value":"abbreviation",items:a.usStates,"col-props":{cols:3}},null,8,["modelValue","items"]),r(s,{modelValue:a.formData.zipCode,"onUpdate:modelValue":e[10]||(e[10]=o=>a.formData.zipCode=o),"input-type":"VTextField",label:"Zip","col-props":{cols:2}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["form-data","disabled"])):y("",!0),r(R,{fluid:""},{default:n(()=>[d.isFormEmpty?(u(),z("p",B," * Select at least one filter to search ")):y("",!0),a.isLoadingKiosks?(u(),c(L,{key:2,type:"table"})):(u(),c(D,{key:1,"csv-headers":a.csvHeaders,"csv-items":d.csvItems},{default:n(({isPrinting:o})=>[r(V,{"sort-by":a.sortBy,"onUpdate:sortBy":e[13]||(e[13]=I=>a.sortBy=I),kiosks:t.kiosks,"items-per-page":o?-1:10,"no-results-text":"No kiosks found",class:"d-print-table","hide-default-footer":o,onKioskRowClicked:d.handleKioskRowClicked},null,8,["sort-by","kiosks","items-per-page","hide-default-footer","onKioskRowClicked"])]),_:1},8,["csv-headers","csv-items"]))]),_:1})]),_:1})}const ye=U(x,[["render",H]]);export{ye as default};
