import{_ as x,b as p,r as w}from"./index.8a58b007.js";import O from"./DesignHeader.6c26595d.js";import A from"./DesignTranslationsTable.f0057ebc.js";import v from"./KeySkuTable.3aca98d2.js";import G from"./CarKeyInfo.689cfd0c.js";import{i as c,c as m,p as N,d as U,m as Q,u as R}from"./lodash-es.d99d4c8c.js";import{t as f,am as H,l as k,n as D,q as h,x as j,w as I,an as E,ao as q,ap as L,aq as M,ar as W,i as _,r as z}from"./vuetify.65d833ec.js";import{S as g,e as o,x as u,k as l,g as n,f as y,I as F,z as b,J as C}from"./@vue.ee679632.js";import"./vuex.0eb68a2c.js";import"./date-fns.d38e1d55.js";import"./vue-atomic-docs.4f3653eb.js";import"./vue-router.ec64e966.js";import"./axios.eca6faa7.js";import"./axios-cache-interceptor.0956cad0.js";import"./cache-parser.124ebbb8.js";import"./fast-defer.b34f24de.js";import"./object-code.c2755e43.js";import"./@fortawesome.2cecc5e3.js";import"./@awesome.me.7dae7d79.js";import"./MeruDataTable.80a372ee.js";import"./ImageUploader.2bd27848.js";import"./CurrencyInput.68661cc8.js";import"./vue-currency-input.92e6c86a.js";import"./ProductImage.3e5aeb25.js";const J=["CK"],X={components:{DesignHeader:O,DesignTranslationsTable:A,KeySkuTable:v,CarKeyInfo:G},props:{dialogOpen:Boolean,design:{type:Object,default:()=>({})},isNew:Boolean,productClasses:{type:Object,default:()=>({})},existingDesignCodes:{type:Array,default:()=>[]},selectedProductClass:{type:Object,default:()=>({})}},emits:["update"],data:()=>({inputsAreValid:void 0,editableDesign:void 0,dbDesign:void 0,initialDesign:void 0,loading:!0,processing:!1,pricingGroupOptions:[],designGroupOptions:[],machineTypes:[],valid:{nameAndDesignCode:!1,pricingGroup:!1,productClass:!1}}),computed:{isCarKey(){return this.design&&this.design.productClass==="CK"},changesMade(){return!c(this.initialDesign,this.editableDesign)},isUncommitted(){return this.isNew||!this.editableDesign.id||!this.design.skus},existsInDatabase(){return this.editableDesign.id!==void 0},allowedProductClasses(){return Object.entries(this.productClasses).filter(([e])=>!J.includes(e))},productClass(){return this.editableDesign&&this.editableDesign.productClass}},watch:{productClass(){this.productClass&&!this.isCarKey&&this.editableDesign&&(p.getPricingGroupsByProductClass(this.editableDesign.productClass).then(({data:e})=>this.pricingGroupOptions=e),p.getMachineTypes(this.editableDesign.productClass).then(({data:e})=>this.machineTypes=e))},dialogOpen(e){if(!e){this.editableDesign=this.dbDesign=this.initialDesign=void 0;return}if(this.processing=!1,this.isNew){this.editableDesign={designCode:"",pricingGroup:null,productClass:this.allowedProductClasses.find(([s])=>s===this.selectedProductClass.productClasses[0])[0],dateAdded:new Date().toISOString().substring(0,10),size:null,shape:null,thickness:null,price:null,groups:[],names:[{locale:"en",name:""}],skus:[]},this.loading=!1;return}if(this.loading=!0,this.design.id)p.getDesign(this.design.id).then(({data:s})=>{this.dbDesign=m(s);const t=this.mergeDesigns(s,this.design);this.editableDesign={...t,skus:t.skus.map(i=>({...i,primaryQty:i.fullBoxIsPrimary?i.itemsPerBox:i.itemsPerHalfBox,secondaryQty:i.fullBoxIsPrimary?i.itemsPerHalfBox:i.itemsPerBox}))},this.initialDesign=m(this.editableDesign)}).finally(()=>this.loading=!1);else{const s=m(this.design);this.editableDesign={...s,skus:s.skus.map(t=>({...t,primaryQty:t.fullBoxIsPrimary?t.itemsPerBox:t.itemsPerHalfBox,secondaryQty:t.fullBoxIsPrimary?t.itemsPerHalfBox:t.itemsPerBox}))},this.loading=!1}}},created(){p.getAllDesignGroups().then(({data:e})=>this.designGroupOptions=e)},methods:{required:w,generatePatch(e,s){if(!s)return e;let t=N(e,(i,d)=>["id","designCode"].includes(d)||!c(i,s[d]));t.carKeyDesign&&(t.carKeyDesign={blacklisted:t.carKeyDesign.blacklisted,id:t.carKeyDesign.id});for(const i of Object.keys(t))Array.isArray(t[i])&&(t[i]=U(t[i],s[i],c));return t},saveDesign(){if(!Object.values(this.$refs).reduce(async(i,d)=>{const{valid:a}=await d.validate();return!d||a&&i},!0))return;this.editableDesign.designCode=this.editableDesign.designCode.toUpperCase(),this.editableDesign.name=this.editableDesign.name||this.editableDesign.names.find(i=>i.locale==="en").name;const s=this.editableDesign.skus[0]||{};this.editableDesign.firstSku=(s.imgData!==void 0?"tmp/":"")+s.sku,this.editableDesign.deprecated=this.editableDesign.skus.reduce((i,d)=>i&&d.deprecated,!0),this.editableDesign.skus.forEach(i=>{i.secondaryQty||(i.secondaryQty=0),[i.itemsPerBox,i.itemsPerHalfBox,i.fullBoxIsPrimary]=i.primaryQty>=i.secondaryQty?[i.primaryQty,i.secondaryQty,!0]:[i.secondaryQty,i.primaryQty,!1],delete i.primaryQty,delete i.secondaryQty});const t=this.generatePatch(this.editableDesign,this.dbDesign);this.$emit("update",t),this.processing=!0},selectAll(e,s=!0){s&&e.target.select()},mergeDesigns(e,s){return Q(e,s,(t,i,d)=>Array.isArray(t)?this.designUnion(d,i,t):void 0)},designUnion(e,s,t){return R(s,t,(i,d)=>{switch(e){case"names":return i.locale===d.locale;case"skus":return i.sku===d.sku;default:return}})},handleResetSkuImage(e){const s=this.editableDesign.skus.findIndex(t=>t.sku===e);s!==-1&&(this.editableDesign.skus[s].imgData=void 0)},handleOnNewImage(e){const s=e.file,t=e.sku,i=this.editableDesign.skus.findIndex(a=>a.sku===t),d=this.editableDesign.skus[i];this.editableDesign.skus.splice(i,1,{...d,imgData:{previewURL:URL.createObjectURL(s),file:s}})},handleAddNewSku(e){this.editableDesign.skus.push(e)},handleDeleteSku(e){this.editableDesign.skus.splice(this.editableDesign.skus.indexOf(e),1)},handleCarKeyImageReplaced(e){this.editableDesign.skus.splice(0,1,{...this.editableDesign.skus[0],imgData:e})},handleDeleteTranslation(e){this.editableDesign.names.splice(this.editableDesign.names.indexOf(e),1)},handleAddTranslation(e){this.editableDesign.names.push({...e.newTranslation,designId:e.designId})},deprecateCarKey(e){this.isCarKey&&this.editableDesign.skus.length>0&&(this.editableDesign.skus[0].deprecated=e)},toggleHopKeyDeprecationStatus(e){const s=(this.editableDesign.skus||[]).find(t=>t.skuId===e.skuId);s&&(s.deprecated=!s.deprecated)}}},Y={key:0,class:"text-center py-4"},Z={key:1,class:"text-center text-h6 py-4"},$={key:2,class:"py-4 text-center"};function ee(e,s,t,i,d,a){const P=g("DesignHeader"),S=g("DesignTranslationsTable"),V=g("CarKeyInfo"),T=g("KeySkuTable"),K=g("VBtnSecondary"),B=g("VBtnPrimary");return o(),u(z,{fullscreen:"","model-value":t.dialogOpen,onAfterLeave:s[8]||(s[8]=r=>e.$emit("update",!1))},{default:l(()=>[n(h,{class:"pt-4",flat:"",rounded:"0"},{default:l(()=>[e.loading?(o(),u(f,{key:0},{default:l(()=>[n(H,{type:"heading, table-heading, card, table"})]),_:1})):e.editableDesign?(o(),u(f,{key:1,class:"pb-16"},{default:l(()=>[a.existsInDatabase?(o(),y("div",Z,F(t.productClasses[e.editableDesign.productClass]),1)):(o(),y("div",Y,[n(k,{ref:"productClass"},{default:l(()=>[n(D,{modelValue:e.editableDesign.productClass,"onUpdate:modelValue":s[0]||(s[0]=r=>e.editableDesign.productClass=r),label:"Product Class","hide-details":"",items:a.allowedProductClasses,"item-value":"0","item-title":"1",density:"compact",rules:[a.required]},null,8,["modelValue","items","rules"])]),_:1},512)])),n(P,{ref:"header",design:e.editableDesign,"onUpdate:design":s[1]||(s[1]=r=>e.editableDesign=r),"is-new":t.isNew,"exists-in-database":a.existsInDatabase,"existing-design-codes":t.existingDesignCodes,"initial-design-code":e.initialDesign&&e.initialDesign.designCode,onUpdateDesignCode:s[2]||(s[2]=r=>e.editableDesign.designCode=r),onUpdateBlacklisted:s[3]||(s[3]=r=>e.editableDesign.carKeyDesign.blacklisted=r),onUpdateDeprecated:s[4]||(s[4]=r=>a.deprecateCarKey(r))},null,8,["design","is-new","exists-in-database","existing-design-codes","initial-design-code"]),a.isCarKey?b("",!0):(o(),u(h,{key:2,class:"my-4"},{default:l(()=>[n(f,null,{default:l(()=>[n(j,null,{default:l(()=>[n(I,{cols:"12",sm:"6"},{default:l(()=>[n(D,{modelValue:e.editableDesign.groups,"onUpdate:modelValue":s[5]||(s[5]=r=>e.editableDesign.groups=r),multiple:"",label:"Design Group",items:e.designGroupOptions,"item-title":"name","return-object":"",density:"compact"},null,8,["modelValue","items"])]),_:1}),n(I,{cols:"12",sm:"6"},{default:l(()=>[n(k,{ref:"pricingGroup"},{default:l(()=>[n(D,{modelValue:e.editableDesign.pricingGroup,"onUpdate:modelValue":s[6]||(s[6]=r=>e.editableDesign.pricingGroup=r),label:"Pricing Group","item-title":"name",items:e.pricingGroupOptions,rules:[a.required],"return-object":"",density:"compact"},null,8,["modelValue","items","rules"])]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1})),a.isCarKey?b("",!0):(o(),u(E,{key:3,class:"my-4"},{default:l(()=>[n(q,null,{default:l(()=>[n(L,{"expand-icon":"$vuetify.icons.chevronDown"},{default:l(()=>[C(" Translations ")]),_:1}),n(M,null,{default:l(()=>[n(S,{design:e.editableDesign,onDeleteTranslation:a.handleDeleteTranslation,onAddTranslation:a.handleAddTranslation},null,8,["design","onDeleteTranslation","onAddTranslation"])]),_:1})]),_:1})]),_:1})),n(h,{class:"my-4 pa-4"},{default:l(()=>[a.isCarKey?(o(),u(V,{key:0,design:e.editableDesign,onCarKeyImageReplaced:a.handleCarKeyImageReplaced},null,8,["design","onCarKeyImageReplaced"])):e.editableDesign.productClass==="KE"?(o(),u(T,{key:1,ref:"skus",design:e.editableDesign,"machine-types":e.machineTypes,onResetSkuImage:a.handleResetSkuImage,onNewImage:a.handleOnNewImage,onAddSku:a.handleAddNewSku,onDeleteSku:a.handleDeleteSku,onToggleDeprecationStatus:a.toggleHopKeyDeprecationStatus},null,8,["design","machine-types","onResetSkuImage","onNewImage","onAddSku","onDeleteSku","onToggleDeprecationStatus"])):(o(),y("div",$," No Additional Info for this Product Class "))]),_:1})]),_:1})):b("",!0),n(W,null,{default:l(()=>[n(K,{onClick:s[7]||(s[7]=r=>e.$emit("update",!1))},{default:l(()=>[C(" Cancel ")]),_:1}),n(_),n(B,{loading:e.processing,disabled:!a.changesMade,onClick:a.saveDesign},{default:l(()=>[C(" Save ")]),_:1},8,["loading","disabled","onClick"])]),_:1})]),_:1})]),_:1},8,["model-value"])}const Ve=x(X,[["render",ee]]);export{Ve as default};
