import{m as K}from"./vuex.0eb68a2c.js";import L from"./S3Image.32e445d0.js";import{A as m,_ as $}from"./index.8a58b007.js";import{S as N,e as u,x as D,k as a,g as t,J as l,I as y,f as p,z as g,F as U,H as q,E as r,L as h,M as v,s as R,D as B,aj as W,ak as F}from"./@vue.ee679632.js";import{t as b,v as Y,a0 as H,W as J,a as G,V as X,c,e as Z,a7 as Q,d,a6 as _,a2 as ee,x as te,w as A,f as ae,n as oe,s as x,r as T,q as V,k as S,p as P,i as j,u as se,$ as ie}from"./vuetify.65d833ec.js";const O="/kiosk-stats",C="/kiosk-images",Te=({serialNumber:e,files:o,imageCategory:n})=>{let w=new FormData;for(let s of o)w.append("images[]",s);const I={headers:{"Content-Type":"multipart/form-data"}};return m().post(`kiosks/${e}/images/${n}`,w,I)},Se=e=>m().get(`kiosks/${e}/images`),Pe=({KioskImageId:e},o,n)=>m().put(`${C}/${e}`,{action:o,approvalDesc:n}),le=({KioskImageId:e},o)=>m().put(`${C}/${e}`,{action:"ROTATE",rotationDirection:o}),je=({KioskImageId:e},o)=>m().put(`${C}/${e}`,{action:"RECATEGORIZE",imageCategory:o}),Oe=({KioskImageId:e})=>m().delete(`${C}/${e}`),Me=()=>m().get(O+"/image-totals"),Ee=()=>m().get(O+"/unapproved-images");const ne={components:{S3Image:L},props:{image:{type:Object,default:()=>({})},categories:{type:Array,default:()=>[]},hasApprovalPermission:Boolean},emits:["recat","rotate","delete","approvalChange"],data:()=>({isContextMenuShown:!1,contextMenuPosition:{x:void 0,y:void 0},rejectionDialogOpen:!1,deleteDialogOpen:!1,placeholders:["image is too blurry","kiosk is too far away","lighting is too dim","wrong orientation","resolution too low"],newApprovalDesc:"",relativeRotation:0,rotationRequestInProgress:!1,imgKey:0,initialAspectRatio:void 0}),computed:{...K("user",["user"]),normalizedRotation(){return this.relativeRotation%360},objectKey(){return`${this.image.serialNumber}/${this.image.imageFilename+(this.image.version?`?v=${this.image.version}`:"")}`},imageHeight(){return this.isInitialAspectRatio?void 0:this.$el.clientWidth},isInitialAspectRatio(){return this.relativeRotation%180===0},hasEditPermission(){return this.hasApprovalPermission||this.image.userId===this.user.id},thisCategory:{get(){return this.categories.find(e=>e.code===this.image.imageCategory)},set(e){this.$emit("recat",{kioskImage:this.image,imageCategory:e})}},specificCategories(){return this.categories.filter(e=>e.code!=="A")},randomPlaceholder(){return this.placeholders[Math.floor(Math.random()*this.placeholders.length)]},isRotating(){return this.relativeRotation%360!==0},approvalStatus(){switch(this.image.approvalType){case"A":return{abbr:"A",name:"Approved",color:"success"};case"R":return{abbr:"R",name:"Needs Retake",color:"error"};default:return{abbr:"U",name:"New",color:"warning"}}}},created(){this.newApprovalDesc=this.image.approvalDesc},methods:{showContextMenu(e){this.isContextMenuShown=!1,this.contextMenuPosition={x:e.clientX,y:e.clientY},this.$nextTick(()=>this.isContextMenuShown=!0)},imageLoaded(e){const{clientWidth:o,clientHeight:n}=e;this.initialAspectRatio=o/n},rotate(e){const o=e?90:-90;this.relativeRotation+=o},confirmRotation(){if(this.normalizedRotation===0)return;let e="";switch(this.normalizedRotation){case 90:case-270:e="Right";break;case 180:case-180:e="UpsideDown";break;case 270:case-90:e="Left";break}this.rotationRequestInProgress=!0,le(this.image,e).then(({data:o})=>{this.relativeRotation=0,this.rotationRequestInProgress=!1,this.$emit("rotate",{newVersion:o,kioskImageId:this.image.KioskImageId})})},confirmDelete(){this.deleteDialogOpen=!1,this.$emit("delete",this.image)},approvalChange(e){this.rejectionDialogOpen=!1,e==="APPROVE"&&(this.newApprovalDesc=""),this.$emit("approvalChange",{action:e,kioskImage:this.image,approvalDesc:this.newApprovalDesc})},cancelReject(){this.newApprovalDesc=this.image.approvalDesc,this.rejectionDialogOpen=!1}}},f=e=>(W("data-v-4baa4367"),e=e(),F(),e),re={key:0,class:"text-warning font-weight-bold"},de={key:1,class:"text-error font-weight-bold"},ue={key:2,class:"text-success font-weight-bold"},me={class:"position-absolute top-0 left-0 w-100 h-100"},ce={class:"d-flex flex-column align-center justify-center h-100"},pe={key:1,class:"actions"},ge={key:2,class:"actions"},fe={class:"d-flex align-start justify-space-between"},he={key:0,style:{"min-width":"68px"}},ve=f(()=>r("div",{class:"text-center text-caption"}," Approval ",-1)),ke=f(()=>r("span",null,"Request Retake",-1)),ye=f(()=>r("span",null,"Approve",-1)),be=f(()=>r("p",null,"Are you sure you want to delete this image?",-1)),_e=f(()=>r("p",null,[l(" This operation "),r("b",null,"CANNOT"),l(" be undone. The file will be deleted "),r("b",null,"IMMEDIATELY"),l(" upon clicking the red button. ")],-1)),Ce=f(()=>r("p",null,"Why do you want to reject this image?",-1));function we(e,o,n,w,I,s){const M=N("S3Image");return u(),D(ie,null,{default:a(({isHovering:k,props:E})=>[t(V,R(E,{height:"100%",class:"d-flex flex-column justify-space-between"}),{default:a(()=>[t(b,{class:"pb-0 status-msg"},{default:a(()=>[t(Y,{label:"",class:"status-msg__chip font-weight-bold mb-2",size:"small",color:s.approvalStatus.color},{default:a(()=>[l(y(s.approvalStatus.name),1)]),_:1},8,["color"]),n.image.approvalType==="U"?(u(),p("p",re," Hang tight! Pending review. ")):g("",!0),n.image.approvalType==="R"?(u(),p("p",de,y(n.image.approvalDesc||"[ No Issue Description ]"),1)):g("",!0),n.image.approvalType==="A"?(u(),p("p",ue," Congrats! Image approved. ")):g("",!0)]),_:1}),t(H,{"aspect-ratio":e.$vuetify.display.smAndDown?void 0:3/4,class:"responsive-container",onContextmenu:U(s.showContextMenu,["prevent"])},{default:a(()=>[t(M,{height:s.imageHeight,blob:n.image.blob,bucket:"minutekey-kiosk-images","object-key":s.objectKey,"lazy-key":"samples/loadingimage.png","v-img-style":`opacity:${s.isRotating||e.rotationRequestInProgress?.7:1};transition:opacity 0.2s ease;transform: rotate(${e.relativeRotation}deg);transition: transform 0.2s ease;`,onLoad:s.imageLoaded},null,8,["height","blob","object-key","v-img-style","onLoad"]),n.image.imageFilename?(u(),D(J,{key:0,modelValue:e.isContextMenuShown,"onUpdate:modelValue":o[0]||(o[0]=i=>e.isContextMenuShown=i),style:q(`top: ${e.contextMenuPosition.y}px; left: ${e.contextMenuPosition.x}px;`),class:"position-absolute"},{default:a(()=>[t(G,{density:"compact"},{default:a(()=>[t(X,{target:"_blank",href:`https://minutekey-kiosk-images.s3.amazonaws.com/${s.objectKey}`},{append:a(()=>[t(c,{size:"small"},{default:a(()=>[l(" $vuetify.icons.externalLink ")]),_:1})]),default:a(()=>[t(Z,null,{default:a(()=>[l("View Image")]),_:1})]),_:1},8,["href"])]),_:1})]),_:1},8,["modelValue","style"])):g("",!0),r("div",me,[r("div",ce,[t(Q,null,{default:a(()=>[h(t(d,{loading:e.rotationRequestInProgress,size:"large",onClick:s.confirmRotation},{default:a(()=>[l(" Apply "),t(c,{end:""},{default:a(()=>[l(" $vuetify.icons.save ")]),_:1})]),_:1},8,["loading","onClick"]),[[v,s.isRotating]])]),_:1})])]),s.hasEditPermission&&!e.rotationRequestInProgress?(u(),p("div",pe,[r("div",null,[t(_,null,{default:a(()=>[h(t(d,{size:"x-small",icon:"",onClick:o[1]||(o[1]=i=>s.rotate(!1))},{default:a(()=>[t(c,null,{default:a(()=>[l("$vuetify.icons.rotateCCW")]),_:1})]),_:2},1536),[[v,k]])]),_:2},1024),t(_,null,{default:a(()=>[h(t(d,{size:"x-small",icon:"",onClick:o[2]||(o[2]=i=>s.rotate(!0))},{default:a(()=>[t(c,null,{default:a(()=>[l("$vuetify.icons.rotateCW")]),_:1})]),_:2},1536),[[v,k]])]),_:2},1024)]),t(_,null,{default:a(()=>[h(t(d,{size:"x-small",icon:"",onClick:o[3]||(o[3]=i=>e.deleteDialogOpen=!0)},{default:a(()=>[t(c,null,{default:a(()=>[l("$trash")]),_:1})]),_:2},1536),[[v,k]])]),_:2},1024)])):s.hasEditPermission?g("",!0):(u(),p("div",ge,[t(_,null,{default:a(()=>[h(t(ee,{color:"surface",width:"100%",icon:"$vuetify.icons.lock"},{default:a(()=>[l(" Not Your Image ")]),_:2},1536),[[v,k]])]),_:2},1024)]))]),_:2},1032,["aspect-ratio","onContextmenu"]),t(b,{class:"pb-0"},{default:a(()=>[t(te,{class:"text-subtitle-2 mx-0 mb-0 w-100 justify-space-between"},{default:a(()=>[t(A,{class:"pa-0"},{default:a(()=>[l(y(new Date(n.image.uploadTimestampUTC).toLocaleDateString()),1)]),_:1}),t(A,{class:"pa-0 text-right"},{default:a(()=>[l(y(new Date(n.image.uploadTimestampUTC).toLocaleTimeString()),1)]),_:1})]),_:1}),t(ae,{class:"my-2"}),r("div",fe,[t(oe,{modelValue:s.thisCategory,"onUpdate:modelValue":o[4]||(o[4]=i=>s.thisCategory=i),style:{flex:"4"},label:"Category",class:"mt-4 mr-4",disabled:!s.hasEditPermission,density:"compact",items:s.specificCategories,"item-title":i=>i.name,"item-value":i=>i},null,8,["modelValue","disabled","items","item-title","item-value"]),n.hasApprovalPermission?(u(),p("div",he,[ve,t(x,{location:"bottom"},{activator:a(({props:i})=>[t(d,R(i,{size:"x-small",icon:"",elevation:0,rounded:"0",color:s.approvalStatus.abbr==="R"?"error":"",onClick:o[5]||(o[5]=z=>e.rejectionDialogOpen=!0)}),{default:a(()=>[t(c,null,{default:a(()=>[l("$thumbsDown")]),_:1})]),_:2},1040,["color"])]),default:a(()=>[ke]),_:1}),t(x,{location:"bottom"},{activator:a(({props:i})=>[t(d,R(i,{size:"x-small",icon:"",elevation:0,rounded:"0",color:s.approvalStatus.abbr==="A"?"success":"",onClick:o[6]||(o[6]=z=>s.approvalChange("APPROVE"))}),{default:a(()=>[t(c,null,{default:a(()=>[l("$thumbsUp")]),_:1})]),_:2},1040,["color"])]),default:a(()=>[ye]),_:1})])):g("",!0)])]),_:1}),t(T,{modelValue:e.deleteDialogOpen,"onUpdate:modelValue":o[8]||(o[8]=i=>e.deleteDialogOpen=i),"max-width":400,"onClick:outside":o[9]||(o[9]=i=>e.deleteDialogOpen=!1)},{default:a(()=>[t(V,null,{default:a(()=>[t(S,null,{default:a(()=>[l("Confirm Delete")]),_:1}),t(b,null,{default:a(()=>[be,_e]),_:1}),t(P,{class:"align-baseline"},{default:a(()=>[t(j),t(d,{variant:"text",onClick:o[7]||(o[7]=i=>e.deleteDialogOpen=!1)},{default:a(()=>[l(" Cancel ")]),_:1}),t(d,{class:"mr-4 mb-2",color:"error",variant:"flat",onClick:s.confirmDelete},{default:a(()=>[l(" Destroy Image ")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(T,{modelValue:e.rejectionDialogOpen,"onUpdate:modelValue":o[13]||(o[13]=i=>e.rejectionDialogOpen=i),"max-width":400,"onClick:outside":s.cancelReject},{default:a(()=>[t(V,null,{default:a(()=>[t(S,null,{default:a(()=>[l("Provide Reason")]),_:1}),t(b,null,{default:a(()=>[Ce,t(se,{modelValue:e.newApprovalDesc,"onUpdate:modelValue":o[10]||(o[10]=i=>e.newApprovalDesc=i),autofocus:"",counter:50,label:"Reason",placeholder:s.randomPlaceholder,maxlength:"50",onKeypress:o[11]||(o[11]=B(i=>s.approvalChange("REJECT"),["enter"]))},null,8,["modelValue","placeholder"])]),_:1}),t(P,null,{default:a(()=>[t(j),t(d,{variant:"text",onClick:s.cancelReject},{default:a(()=>[l(" Cancel ")]),_:1},8,["onClick"]),t(d,{class:"mr-4 mb-2",color:"error",variant:"flat",onClick:o[12]||(o[12]=i=>s.approvalChange("REJECT"))},{default:a(()=>[l(" Request Retake ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","onClick:outside"])]),_:2},1040)]),_:1})}const Re=$(ne,[["render",we],["__scopeId","data-v-4baa4367"]]),ze=Object.freeze(Object.defineProperty({__proto__:null,default:Re},Symbol.toStringTag,{value:"Module"}));export{Re as K,Me as a,Ee as b,Te as c,Oe as d,ze as e,Se as g,je as r,Pe as u};
