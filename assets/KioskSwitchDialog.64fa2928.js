import{m as _,b as C}from"./vuex.0eb68a2c.js";import{S as c,e as d,x as m,k as s,g as t,J as n,f as k,z as p,s as S,j as x,G as F,F as I,D as T,I as U}from"./@vue.ee679632.js";import{_ as M}from"./index.8a58b007.js";import{c as B,d as K,k as N,T as O,U as g,f as y,t as P,a8 as A,a9 as V,F as D,a2 as b,l as R,x as h,w as f,u as X,p as j,q,r as z}from"./vuetify.65d833ec.js";import"./date-fns.d38e1d55.js";import"./vue-atomic-docs.4f3653eb.js";import"./vue-router.ec64e966.js";import"./axios.eca6faa7.js";import"./axios-cache-interceptor.0956cad0.js";import"./cache-parser.124ebbb8.js";import"./fast-defer.b34f24de.js";import"./object-code.c2755e43.js";import"./@fortawesome.2cecc5e3.js";import"./@awesome.me.7dae7d79.js";const G={props:{tagMachinesOnly:{type:Boolean,default:!1},disableAutoOpen:{type:Boolean,default:!1}},data(){return{selectedKiosk:"",dialog:!1,tab:null,kioskId:"",valid:!1,notFound:!1,validMachineTypes:["PX","ID","FS","FJ","TX","KX","QZ","PS"],warningMessages:{notFound:"Kiosk not found, review the serial number and try again.",notAllowed:"Kiosk type not allowed"},message:""}},computed:{..._("kiosk",["userKiosks","loading"]),color(){return!this.disableAutoOpen&&Object.keys(this.selectedKiosk).length===0?"error":"primary-lighten-2"},filteredUserKiosks(){let i=this.tagMachinesOnly?this.userKiosks.filter(e=>this.validMachineTypes.indexOf(e.machineType)>-1):this.userKiosks;return i.sort(function(e,l){var r=e.serialNumber.toUpperCase(),o=l.serialNumber.toUpperCase();return r<o?-1:r>o?1:0}),i},hasKiosk(){return this.filteredUserKiosks.length>0}},watch:{selectedKiosk:function(i){this.setSelectedKiosk(i),this.dialog=!1;const e=this.$route.params.kiosk,l=this.$route.path,o=(e?l.replace(/\/[^/]*$/,""):l)+"/"+i.serialNumber;o!=l&&this.$router.push({path:o})},$route(i){const e=i.params.kiosk;e!=this.selectedKiosk.serialNumber&&this.loadKiosk(e)},dialog:function(){this.dialog==!1&&(this.valid=!0,this.tab=0,this.kioskId="",this.notFound=!1)}},beforeMount(){const i=this.$route.params.kiosk;i&&this.loadKiosk(i)},mounted(){!!!this.$route.params.kiosk&&!this.disableAutoOpen&&(this.dialog=!0)},methods:{...C("kiosk",["setCurrentSelectedKioskCC"]),setSelectedKiosk(i){this.setCurrentSelectedKioskCC(i)},async loadKiosk(i){let l=(await this.userKiosksPromise()).find(r=>r.serialNumber==i);if(l)this.selectedKiosk=l;else{let r;try{r=await this.fetchKiosk(i),r&&(this.selectedKiosk=r.data)}catch{this.dialog=!0,this.message=this.warningMessages.notFound,this.notFound=!0,this.tab=1,this.kioskId=this.$route.params.kiosk}}},async fetchKiosk(i){return await this.$store.dispatch("kiosk/loadOtherKiosk",{serialNumber:i})},userKiosksPromise(){return this.userKiosks.length>0?Promise.resolve(this.userKiosks):new Promise(i=>{const e=this.$watch("userKiosks",l=>{i(l),e()})})},async getKioskById(){const i=await this.$refs.form.validate();if(this.valid&&i.valid){let e;try{e=await this.fetchKiosk(this.kioskId)}catch{this.message=this.warningMessages.notFound,this.notFound=!0}e&&(!this.tagMachinesOnly||this.validMachineTypes.indexOf(e.data.machineType)>-1?(this.selectedKiosk=e.data,this.valid=!0,this.tab=0,this.kioskId=""):(this.notFound=!0,this.message=this.warningMessages.notAllowed))}}}},J={key:0},W={key:1};function E(i,e,l,r,o,u){const v=c("VRadioSmall"),w=c("VBtnSecondary");return d(),m(z,{modelValue:o.dialog,"onUpdate:modelValue":e[7]||(e[7]=a=>o.dialog=a),scrollable:"","max-width":"400px"},{activator:s(({props:a})=>[t(K,S({variant:"text",color:u.color,class:"ml-2"},a),{default:s(()=>[t(B,{size:"small",start:""},{default:s(()=>[n(" $vuetify.icons.exchange ")]),_:1}),i.$vuetify.display.smAndUp?(d(),k("span",J,"Select Kiosk")):p("",!0)]),_:2},1040,["color"])]),default:s(()=>[t(q,null,{default:s(()=>[t(N,null,{default:s(()=>[n("Select Kiosk")]),_:1}),t(O,{modelValue:o.tab,"onUpdate:modelValue":e[0]||(e[0]=a=>o.tab=a),color:"primary",class:"text-primary-darken-3","show-arrows":""},{default:s(()=>[t(g,{key:"mine"},{default:s(()=>[n(" My Kiosk ")]),_:1}),t(g,{key:"other"},{default:s(()=>[n(" Other Kiosks ")]),_:1})]),_:1},8,["modelValue"]),t(y),t(P,{style:{height:"300px"},class:"mb-3"},{default:s(()=>[t(A,{modelValue:o.tab,"onUpdate:modelValue":e[5]||(e[5]=a=>o.tab=a)},{default:s(()=>[t(V,null,{default:s(()=>[u.hasKiosk?(d(),m(D,{key:0,modelValue:o.selectedKiosk,"onUpdate:modelValue":e[1]||(e[1]=a=>o.selectedKiosk=a),inline:!1},{default:s(()=>[(d(!0),k(F,null,x(u.filteredUserKiosks,a=>(d(),m(v,{key:a.id,label:a.serialNumber,value:a},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):(d(),k("div",W,[t(b,{type:"error",icon:"$vuetify.icons.exclamationTriangle",variant:"outlined",border:"start",align:"center"},{default:s(()=>[n(" You don't have any assigned kiosks ")]),_:1})]))]),_:1}),t(V,null,{default:s(()=>[t(R,{ref:"form",modelValue:o.valid,"onUpdate:modelValue":e[3]||(e[3]=a=>o.valid=a),onSubmit:e[4]||(e[4]=I(()=>{},["prevent"]))},{default:s(()=>[t(h,null,{default:s(()=>[t(f,null,{default:s(()=>[t(X,{modelValue:o.kioskId,"onUpdate:modelValue":e[2]||(e[2]=a=>o.kioskId=a),label:"Kiosk Serial Number",rules:[a=>!!a.toString()||"Required"],onKeypress:T(u.getKioskById,["enter"])},null,8,["modelValue","rules","onKeypress"])]),_:1})]),_:1}),t(h,null,{default:s(()=>[t(f,{align:"center"},{default:s(()=>[t(K,{color:"primary",onClick:u.getKioskById},{default:s(()=>[n(" find ")]),_:1},8,["onClick"])]),_:1})]),_:1}),t(h,null,{default:s(()=>[t(f,null,{default:s(()=>[o.notFound?(d(),m(b,{key:0,type:"warning",icon:"$vuetify.icons.exclamationTriangle",variant:"outlined",border:"start",align:"center"},{default:s(()=>[n(U(o.message),1)]),_:1})):p("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(y),t(j,{class:"align-self-center"},{default:s(()=>[t(w,{onClick:e[6]||(e[6]=a=>o.dialog=!1)},{default:s(()=>[n(" Cancel ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])}const ne=M(G,[["render",E]]);export{ne as default};
