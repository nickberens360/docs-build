import T from"./ConfirmDialog-BdnzEXkJ.js";import B from"./DatePicker-BuTbACp2.js";import A from"./MeruDataTable-jf3gvfqw.js";import P from"./CatalogMenu-DMu3teF5.js";import j from"./FullScreenLayout-C65u71bY.js";import{_ as q,r as U}from"./index-LK9MQE2L.js";import{b as z,m as H,a as W}from"./vuex-D3TwipD2.js";import{t as y,X as J,aj as v,n as w,x as V,w as S,u as k,d as Z,ai as K,s as N,b as F,k as G,l as D,m as X,r as Y,ar as M,h as Q,i as $,A as ee}from"./vuetify-BgnNF2O3.js";import{C as g,i as l,e as s,B as o,_ as p,p as C,s as x,J as h,H as _,f as te,A as I}from"./@vue-DNrUJgob.js";import"./date-fns-2ylUqVpG.js";import"./@babel-BTTPuEuv.js";import"./vue-component-docs-plugin-BnqcuvvC.js";import"./vue-router-BVOKdCCq.js";import"./axios-xsH4HHeE.js";import"./axios-cache-interceptor-DgAMPFM2.js";import"./cache-parser-DXYp_BCq.js";import"./fast-defer-9MI9za_P.js";import"./object-code-SBtdq8jY.js";import"./@fortawesome-BWcQmPY7.js";import"./@awesome.me-Btqfd-fw.js";import"./@vuepic-Coh5ezXU.js";import"./ProductImage-CvO1b8Ha.js";const ie={components:{MeruDataTable:A,ConfirmDialog:T,DatePicker:B,CatalogMenu:P,FullScreenLayout:j},props:{backRoute:{type:String,default:"partial"}},emits:["shipment-saved"],data(){return{isLoadingInitialData:!0,isShipmentItemDialogOpen:!1,isShipmentItemFormValid:!1,isShipmentFormValid:!1,hasReceivedItems:!1,hasModifiedShipmentItems:!1,processingSubmit:!1,skuModel:void 0,skuSearchRules:[t=>Object.keys(t||{}).length!==0||"SKU is required"],skuExists:!1,SKUHeaders:[{sortable:!1,title:"SKU",key:"sku"},{sortable:!1,title:"Whole Boxes",key:"whole"},{sortable:!1,title:"Half Boxes",key:"half"},{sortable:!1,title:"Singles",key:"singles"},{sortable:!1,title:"Actions",key:"action",align:"right"}],SKUItems:[],editedSKUItem:{skuModel:{},sku:"",whole:"",half:"",singles:""},defaultSKUItem:{skuModel:{},sku:"",whole:"",half:"",singles:""},pickNumber:"",pickNumberExists:!1,fromShip:null,toShip:null,receiving:!1,date:new Date().toISOString().substring(0,10),editedShipment:{id:0,pickNumber:"",toUserId:"",fromUserId:"",shipDate:this.date,transferSkus:[]},defaultEditedShipment:{id:0,pickNumber:"",toUserId:"",fromUserId:"",shipDate:this.date,transferSkus:[]},quantityRules:[t=>Number.isNaN(parseInt(t))||parseInt(t)<1e7||"Too many",t=>Number.isNaN(parseInt(t))||parseInt(t)>=0||"0 or more",t=>Number.isNaN(parseInt(t))||parseInt(t)===parseFloat(t)||"Whole #"],shipmentFormMode:"create",hasLoadingError:!1}},computed:{...W("inventory",["skusById"]),...H({currentUser:"user/user",shippableUsers:"user/getShippableUsers",allSkus:"inventory/getSKUs"}),catalogMenuItems(){return this.SKUItems.map(t=>t.sku)},shipmentFormTitle(){return this.isLoading?"Loading...":this.hasLoadingError?`Error loading shipment ${this.$route.params.pickNumber}`:this.shipmentFormMode==="create"?"New Shipment":this.receiving?`Receive Shipment ${this.editedShipment.pickNumber}`:`Edit Shipment ${this.editedShipment.pickNumber}`},editedSKUItemNonZero:function(){return 0<parseInt(this.editedSKUItem.whole||0)+parseInt(this.editedSKUItem.half||0)+parseInt(this.editedSKUItem.singles||0)},isShipmentValid(){return this.isShipmentFormValid&&this.SKUItems.length>0&&this.dateFormatted},currentItem:function(){return this.SKUItems.find(t=>t.sku==this.editedSKUItem.sku)},dateFormatted(){let t=new Date(this.date);return t.toString()!=="Invalid Date"?t.toISOString().substring(0,10):void 0},shipmentFormRules(){return{pickNumber:[U,t=>t&&!!t.toString().trim()||"Required"],fromShip:[U,t=>{var e;return(t==null?void 0:t.id)!==((e=this.toShip)==null?void 0:e.id)||"Can't ship from same user"}],toShip:[U,t=>{var e;return(t==null?void 0:t.id)!==((e=this.fromShip)==null?void 0:e.id)||"Can't ship to same user"}]}},isLoadingCatalog(){return!this.allSkus.length},isLoading(){return this.isLoadingCatalog||this.isLoadingInitialData}},watch:{async pickNumberExists(){this.editedShipment.pickNumber&&await this.$refs.newShipmentForm.validate()},allSkus:{handler(t){t.length&&this.loadInitialData()},deep:!0,immediate:!0}},methods:{...z("shipments",["postSentShipment","postModifiedShipment","postReceivedShipment"]),skuChanged(t){var u;this.skuExists=!1;const e=t&&this.SKUItems.find(f=>this.skuModel&&f.sku===this.skuModel.sku);e?(this.editedSKUItem=e,this.skuExists=!0):(this.editedSKUItem=Object.assign({},this.defaultSKUItem),this.editedSKUItem.sku=(u=this.skuModel)==null?void 0:u.sku,this.editedSKUItem.skuModel=this.skuModel)},addShipmentItem(){this.editedSKUItem=Object.assign({},this.defaultSKUItem),this.skuModel=void 0,this.isShipmentItemDialogOpen=!0,this.$refs.shipmentItemForm&&this.$refs.shipmentItemForm.resetValidation()},editShipmentItem(t){this.editedSKUItem=Object.assign({},t),this.skuModel=t.skuModel,this.isShipmentItemDialogOpen=!0,this.$refs.shipmentItemForm&&this.$refs.shipmentItemForm.resetValidation()},async deleteShipmentItem(t){await this.$refs.confirm.open("Delete "+t.skuModel.sku,"Are you sure?",{color:"error-lighten-1",zIndex:2410})&&(this.SKUItems=this.SKUItems.filter(u=>u.skuModel.skuId!==t.skuModel.skuId),this.hasModifiedShipmentItems=!0,this.$store.dispatch("app/setSnackbar",{message:"Item Deleted"}))},cancelShipment(){this.pickNumberExists=!1,this.$refs.newShipmentForm&&this.$refs.newShipmentForm.resetValidation(),this.$refs.shipmentItemForm&&this.$refs.shipmentItemForm.resetValidation(),this.$router.push({name:"shipments",query:{status:this.backRoute}})},receiveFullShipment(){this.SKUItems.forEach(t=>{t.whole=t.expectedWhole,t.half=t.expectedHalf,t.singles=t.expectedSingles})},async handleOverStock(){const{expectedWhole:t,expectedHalf:e,expectedSingles:u,whole:f,half:i,singles:n}=this.editedSKUItem;if(f>t||i>e||n>u)return!await this.$refs.confirm.open(this.editedSKUItem.sku,"You are receiving more than what was shipped, are you sure?",{color:"warning-lighten-1",zIndex:2410})},async saveShipmentItem(){if(!await this.handleOverStock()){const e=this.currentItem;this.editedSKUItem.skuModel=this.skuModel,this.editedSKUItem.sku=this.skuModel.sku,this.isShipmentItemDialogOpen=!1,e?(e.whole=this.editedSKUItem.whole||0,e.half=this.editedSKUItem.half||0,e.singles=this.editedSKUItem.singles||0):(this.editedSKUItem.whole=this.editedSKUItem.whole||0,this.editedSKUItem.half=this.editedSKUItem.half||0,this.editedSKUItem.singles=this.editedSKUItem.singles||0,this.SKUItems.push(this.editedSKUItem)),this.hasModifiedShipmentItems=!0}},async saveShipment(){this.processingSubmit=!0;const t={id:this.editedShipment.id,pickNumber:this.editedShipment.pickNumber.trim(),toUser:this.toShip,fromUser:this.fromShip,toUserId:this.toShip.id,fromUserId:this.fromShip.id,shipDate:this.receiving?void 0:this.dateFormatted,receiveDate:this.receiving?this.dateFormatted:void 0,transferSkus:this.SKUItems.map(e=>({skuId:e.skuModel.skuId,boxes:parseInt(e.whole)||0,halfBoxes:parseInt(e.half)||0,individualItems:parseInt(e.singles)||0}))};try{this.receiving?await this.postReceivedShipment(t):t.id!==0?await this.postModifiedShipment(t):await this.postSentShipment(t),this.pickNumberExists=!1,this.pickNumber="",this.$refs.newShipmentForm&&this.$refs.newShipmentForm.resetValidation(),this.$store.dispatch("app/setSnackbar",{message:"Shipment saved"}),this.$emit("shipment-saved"),this.goToShipmentIndex()}catch(e){e.response.status===400&&e.response.data==="Pick Number already exists!"?this.$store.dispatch("app/setSnackbar",{message:"Pick Number already exists!",color:"error"}):this.$store.dispatch("app/setSnackbar",{message:"Failed to save shipment",color:"error"})}finally{this.processingSubmit=!1}},initializeNewShipment(){this.$refs.newShipmentForm&&this.$refs.newShipmentForm.resetValidation(),this.shipmentFormMode="create",this.editedShipment=JSON.parse(JSON.stringify(this.defaultEditedShipment)),this.fromShip=this.formatUser(this.currentUser),this.toShip=null,this.date=new Date().toISOString().substring(0,10),this.SKUItems=[]},formatUser(t){const e=`${t.person.firstName} ${t.person.lastName}`;return Object.assign({},{...t,fullName:e})},async loadInitialData(){if(this.isLoadingInitialData=!0,this.shippableUsers.length===0)try{await this.$store.dispatch("user/loadShippableUsers")}catch{this.hasLoadingError=!0}this.$route.name==="newShipment"?this.initializeNewShipment():await this.initializeEditShipment(this.$route.params.pickNumber),this.isLoadingInitialData=!1},initializeEditShipment(t){return this.$store.dispatch("shipments/loadShipment",{pickNumber:t}).then(e=>{var n;const u=this.shippableUsers.find(a=>a.id===e.sent.fromUser.id),f=this.shippableUsers.find(a=>a.id===e.sent.toUser.id);this.fromShip=this.formatUser(u),this.toShip=this.formatUser(f),this.receiving=((n=this.toShip)==null?void 0:n.id)===this.currentUser.id,this.shipmentFormMode="update";const i=e.sent.pickNumber;if(this.editedShipment=JSON.parse(JSON.stringify(this.defaultEditedShipment)),this.editedShipment.id=this.receiving?0:e.sent.id,this.editedShipment.pickNumber=i,this.date=this.receiving?"":e.sent.shipDate,this.SKUItems=e.sent.transferSkus.map(a=>{const d=this.skusById[a.skuId];return d&&{skuModel:d,sku:d.sku,skuId:d.skuId,whole:this.receiving?void 0:a.boxes,half:this.receiving?void 0:a.halfBoxes,singles:this.receiving?void 0:a.individualItems,expectedWhole:this.receiving?a.boxes:void 0,expectedHalf:this.receiving?a.halfBoxes:void 0,expectedSingles:this.receiving?a.individualItems:void 0}}),this.receiving)for(const a of e.received){a.transferSkus.length&&(this.hasReceivedItems=!0);for(const d of a.transferSkus)if(!this.SKUItems.find(m=>m.skuId===d.skuId)){const m=this.skusById[d.skuId];this.SKUItems.push({skuModel:m,sku:m.sku,skuId:m.skuId})}}}).catch(e=>{console.error("An error occurred while dispatching the shipment/loadShipment action:",e),this.$store.dispatch("app/setSnackbar",{message:"Failed to load shipment",color:"error"}),this.hasLoadingError=!0,this.goToShipmentIndex()})},goToShipmentIndex(){this.$router.push({name:"shipments",query:{status:this.backRoute}})}}},se={class:"d-flex"},le={class:"text-center"},ne={class:"text-h5"};function re(t,e,u,f,i,n){const a=p("DatePicker"),d=p("MeruDataTable"),m=p("VBtnPrimary"),c=p("VBtnSecondary"),L=p("CatalogMenu"),E=p("ConfirmDialog"),O=p("FullScreenLayout");return I(),g(O,{class:"shipment-details"},{header:l(()=>[s(ee,{elevation:"4",color:"surface-light"},{default:l(()=>[s(Q,{class:"tertiary--text font-weight-light"},{default:l(()=>[h(_(n.shipmentFormTitle),1)]),_:1}),s($)]),_:1})]),footer:l(()=>[s(M,null,{default:l(()=>[s(c,{disabled:i.processingSubmit,onClick:n.cancelShipment},{default:l(()=>e[26]||(e[26]=[h(" Cancel ")])),_:1,__:[26]},8,["disabled","onClick"]),e[28]||(e[28]=o("div",{class:"flex-grow-1"},null,-1)),s(m,{loading:i.processingSubmit,disabled:n.isLoading||!n.isShipmentValid,onClick:n.saveShipment},{default:l(()=>e[27]||(e[27]=[h(" Save ")])),_:1,__:[27]},8,["loading","disabled","onClick"])]),_:1,__:[28]})]),default:l(()=>[s(D,null,{default:l(()=>[s(y,null,{default:l(()=>[s(J,{color:"surface-bright"},{default:l(()=>[s(v,null,{default:l(()=>[s(w,{ref:"newShipmentForm",modelValue:i.isShipmentFormValid,"onUpdate:modelValue":e[5]||(e[5]=r=>i.isShipmentFormValid=r),class:"pb-6"},{default:l(()=>[s(V,null,{default:l(()=>[s(S,{cols:"12",lg:"6",sm:"6",md:"6"},{default:l(()=>[o("div",null,[s(k,{modelValue:i.editedShipment.pickNumber,"onUpdate:modelValue":e[0]||(e[0]=r=>i.editedShipment.pickNumber=r),label:"Pick Number",type:"text",disabled:i.shipmentFormMode==="update"||n.isLoading,rules:n.shipmentFormRules.pickNumber,onFocus:e[1]||(e[1]=r=>i.pickNumberExists=!1)},null,8,["modelValue","disabled","rules"])]),o("div",se,[o("span",null,[e[14]||(e[14]=o("label",{for:"inputField",class:"text-primary-darken-3"}," Date ",-1)),s(Z,{class:"ml-1 mt-2",color:"primary-darken-3",icon:"fal fa-calendar"})]),s(a,{modelValue:i.date,"onUpdate:modelValue":e[2]||(e[2]=r=>i.date=r),class:"date-picker",clearable:!1,"input-font-size":"16px","input-height":"51px","auto-apply":"",disabled:n.isLoading,"max-date":new Date},null,8,["modelValue","disabled","max-date"])])]),_:1}),s(S,{cols:"12",lg:"6",sm:"6",md:"6"},{default:l(()=>[o("div",null,[s(K,{modelValue:i.fromShip,"onUpdate:modelValue":e[3]||(e[3]=r=>i.fromShip=r),label:"From",items:t.shippableUsers,"return-object":"","item-title":"fullName",disabled:i.receiving||n.isLoading,rules:n.shipmentFormRules.fromShip},null,8,["modelValue","items","disabled","rules"])]),o("div",null,[s(K,{modelValue:i.toShip,"onUpdate:modelValue":e[4]||(e[4]=r=>i.toShip=r),label:"To",items:t.shippableUsers,"return-object":"","item-title":"fullName",disabled:i.receiving||n.isLoading,rules:n.shipmentFormRules.toShip},null,8,["modelValue","items","disabled","rules"])])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),s(d,{headers:i.SKUHeaders,items:i.SKUItems,density:"compact",class:"mb-12",hover:"",loading:n.isLoading,"loading-text":"Loading... Please wait"},{"item.action":l(({item:r})=>[s(N,{location:"bottom"},{activator:l(({props:b})=>[s(F,C({color:"info",variant:"text",icon:"$edit",size:"x-small",class:"mr-4"},b,{onClick:R=>n.editShipmentItem(r)}),null,16,["onClick"])]),default:l(()=>[e[15]||(e[15]=o("span",null,"Edit",-1))]),_:2,__:[15]},1024),s(N,{location:"bottom"},{activator:l(({props:b})=>[s(F,C({color:"error",variant:"text",icon:"$trash",size:"x-small",class:"mr-4"},b,{onClick:R=>n.deleteShipmentItem(r)}),null,16,["onClick"])]),default:l(()=>[e[16]||(e[16]=o("span",null,"Delete",-1))]),_:2,__:[16]},1024)]),_:2},1032,["headers","items","loading"]),o("div",le,[s(m,{loading:n.isLoading,onClick:n.addShipmentItem},{default:l(()=>e[17]||(e[17]=[h(" Add ")])),_:1,__:[17]},8,["loading","onClick"]),!i.hasModifiedShipmentItems&&i.receiving&&!i.hasReceivedItems?(I(),g(c,{key:0,loading:n.isLoading,class:"ml-4",onClick:n.receiveFullShipment},{default:l(()=>e[18]||(e[18]=[h(" Receive All ")])),_:1,__:[18]},8,["loading","onClick"])):x("",!0)]),s(G,{modelValue:i.isShipmentItemDialogOpen,"onUpdate:modelValue":e[13]||(e[13]=r=>i.isShipmentItemDialogOpen=r),"max-width":"700px"},{default:l(()=>[s(D,null,{default:l(()=>[s(X,null,{default:l(()=>[o("span",ne,_(n.currentItem?"Edit Item":"New Item"),1)]),_:1}),s(y,null,{default:l(()=>[s(v,null,{default:l(()=>[s(w,{ref:"shipmentItemForm",modelValue:i.isShipmentItemFormValid,"onUpdate:modelValue":e[10]||(e[10]=r=>i.isShipmentItemFormValid=r),class:"pb-6"},{default:l(()=>[s(V,null,{default:l(()=>[s(S,{cols:"12",sm:"12",md:"12"},{default:l(()=>[s(L,{modelValue:i.skuModel,"onUpdate:modelValue":[e[6]||(e[6]=r=>i.skuModel=r),n.skuChanged],"show-deprecated":n.catalogMenuItems,rules:i.skuSearchRules},te({_:2},[i.skuExists?{name:"details",fn:l(()=>[e[19]||(e[19]=o("p",{class:"text-warning font-weight-bold"}," SKU already exists ",-1))]),key:"0"}:void 0]),1032,["modelValue","show-deprecated","rules","onUpdate:modelValue"])]),_:1})]),_:1}),s(V,null,{default:l(()=>[s(S,null,{default:l(()=>[s(k,{modelValue:i.editedSKUItem.whole,"onUpdate:modelValue":e[7]||(e[7]=r=>i.editedSKUItem.whole=r),label:"Whole",type:"number",min:"0",rules:i.quantityRules},null,8,["modelValue","rules"])]),_:1}),s(S,null,{default:l(()=>[s(k,{modelValue:i.editedSKUItem.half,"onUpdate:modelValue":e[8]||(e[8]=r=>i.editedSKUItem.half=r),label:"Half",type:"number",min:"0",rules:i.quantityRules},null,8,["modelValue","rules"])]),_:1}),s(S,null,{default:l(()=>[s(k,{modelValue:i.editedSKUItem.singles,"onUpdate:modelValue":e[9]||(e[9]=r=>i.editedSKUItem.singles=r),label:"Singles",type:"number",min:"0",rules:i.quantityRules},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),t.$vuetify.display.smAndDown?x("",!0):(I(),g(Y,{key:0},{default:l(()=>[s(c,{onClick:e[11]||(e[11]=r=>i.isShipmentItemDialogOpen=!1)},{default:l(()=>e[20]||(e[20]=[h(" Cancel ")])),_:1,__:[20]}),e[22]||(e[22]=o("div",{class:"flex-grow-1"},null,-1)),s(m,{disabled:Object.keys(i.skuModel||{}).length==0||!n.editedSKUItemNonZero||!i.isShipmentItemFormValid,onClick:n.saveShipmentItem},{default:l(()=>e[21]||(e[21]=[h(" Save ")])),_:1,__:[21]},8,["disabled","onClick"])]),_:1,__:[22]}))]),_:1}),t.$vuetify.display.smAndDown?(I(),g(M,{key:0},{default:l(()=>[s(c,{onClick:e[12]||(e[12]=r=>i.isShipmentItemDialogOpen=!1)},{default:l(()=>e[23]||(e[23]=[h(" Cancel ")])),_:1,__:[23]}),e[25]||(e[25]=o("div",{class:"flex-grow-1"},null,-1)),s(m,{onClick:n.saveShipmentItem},{default:l(()=>e[24]||(e[24]=[h(" Save ")])),_:1,__:[24]},8,["onClick"])]),_:1,__:[25]})):x("",!0)]),_:1},8,["modelValue"])]),_:1})]),_:1}),s(E,{ref:"confirm"},null,512)]),_:1})}const Fe=q(ie,[["render",re]]);export{Fe as default};
