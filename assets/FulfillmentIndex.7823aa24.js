import B from"./SearchFormFieldset.2aa0dec9.js";import A from"./SearchFormInput.b84ad1fe.js";import L from"./SearchFormRow.bc300fb2.js";import M from"./MeruDataTable.80a372ee.js";import K from"./SearchForm.eb63e990.js";import q from"./DefaultLayout.61d229e4.js";import E from"./PrintPickLabel.d9bd3ac5.js";import N from"./StageChip.18205d71.js";import{u as O}from"./tableQueryParams.321c6e4c.js";import{_ as Q,w as R,e as j,c as z,o as G}from"./index.8a58b007.js";import{m as J,c as W}from"./vuex.0eb68a2c.js";import{f as b,p as P}from"./date-fns.d38e1d55.js";import{aA as Y,a1 as H,A as X,i as Z,d as $,O as T,ab as ee,c as te}from"./vuetify.65d833ec.js";import{S as m,e as c,x as h,k as i,g as r,E as o,z as S,B as se,I as p,J as k,f as I,j as ae,G as re,aj as ie,ak as oe}from"./@vue.ee679632.js";import"./vue-atomic-docs.4f3653eb.js";import"./vue-router.ec64e966.js";import"./axios.eca6faa7.js";import"./axios-cache-interceptor.0956cad0.js";import"./cache-parser.124ebbb8.js";import"./fast-defer.b34f24de.js";import"./object-code.c2755e43.js";import"./@fortawesome.2cecc5e3.js";import"./@awesome.me.7dae7d79.js";import"./DatePicker.55087c86.js";import"./@vuepic.604267a2.js";import"./@babel.5574241f.js";import"./ResultsLimitMenu.e0b88f86.js";import"./ConfirmDialog.060a100c.js";import"./PrintTeleporter.0f903a0b.js";import"./PickLabel.e8c579b7.js";import"./BarcodeGenerator.39689fa5.js";import"./bwip-js.88a7b0d7.js";const le={components:{PrintPickLabel:E,MeruDataTable:M,SearchForm:K,SearchFormFieldset:B,SearchFormInput:A,SearchFormRow:L,StageChip:N,DefaultLayout:q},setup(){const{filters:e,sortBy:t,pagination:l}=O({initialSortBy:[{key:"timestamp",order:"desc"}],initialFilters:{transactionId:"",carKeys:!0,endlessAisle:!0,stages:[]},initialPagination:{itemsPerPage:10,page:1}}),{mdAndDown:a,smAndUp:n}=Y();return{sortBy:t,filters:e,pagination:l,mdAndDown:a,smAndUp:n}},data(){return{isSearching:!1,tickets:[],selectedTicketsToPrint:[],selectableStage:"pending-print",headers:[{title:"Stage",value:"stage",sortable:!0},{title:"Transaction ID",value:"transactionId",sortable:!0},{title:"Received",value:"timestamp",sortable:!0},{title:"Category",value:"category"},{title:"SKU",value:"sku"},{title:"QTY",value:"quantity"},{title:"Ships To",value:"shipToCustomer"},{title:"",value:"actions"}],stageItems:R}},computed:{...J("orders",["skipInitialPrintConfirmation"]),formattedTickets(){return this.tickets.map(e=>(e.hasMultipleSkus=e.items.length>1,e.formattedDate=this.getFormattedDate(e.timestamp),e.formattedTime=this.getFormattedTime(e.timestamp),e.totalQuantity=this.getQuantity(e),e.category=this.getCategory(e),e.categoryImageUrl=this.getCategoryImageSource(e.category),e.displayedSku=this.getDisplayedSku(e),e.selectable=this.getIsPendingPrintTicket(e),e))},filteredTickets(){let e=[],t=this.formattedTickets;return this.filters.carKeys&&e.push("car-key"),this.filters.endlessAisle&&e.push("endless-aisle-key"),t=t.filter(l=>l.items.some(a=>e.includes(a.category))),this.filters.transactionId&&(t=t.filter(l=>l.transactionId.toLowerCase().includes(this.filters.transactionId.toLowerCase()))),this.filters.stages.length&&(t=t.filter(l=>this.filters.stages.includes(l.stage))),t},filteredStageItems(){return this.stageItems.filter(e=>this.tickets.some(t=>t.stage===e.value))},hasPendingPrintTickets(){return this.tickets.some(e=>this.getIsPendingPrintTicket(e))}},mounted(){this.searchTickets()},methods:{...W("orders",["setSkipInitialPrintConfirmation"]),getOrderStageName:j,getOrderStageColor:z,async searchTickets(){this.isSearching=!0;try{const{data:e}=await G.fetchOrdersNeedingFulfillment();this.tickets=e}catch{this.$store.dispatch("app/setSnackbar",{message:"Failed to load fulfillment tickets",color:"error"})}finally{this.isSearching=!1}},getCategory(e){var t;return(t=e.items[0])==null?void 0:t.category},getDisplayedSku(e){var t;return e.hasMultipleSkus?"Multiple SKUs":(t=e.items[0])==null?void 0:t.hillmanSku},getIsPendingPrintTicket(e){return e.stage===this.selectableStage},getQuantity(e){var t;return e.hasMultipleSkus?e.items.reduce((l,a)=>l+a.quantity,0):(t=e.items[0])==null?void 0:t.quantity},getFormattedDate(e){return b(P(e),"EEE, MMM dd, yyyy")},getFormattedTime(e){return b(P(e),"h:mm a")},getCategoryImageSource(e){return e==="car-key"?new URL("/assets/car-key.456582cb.svg",self.location).href:new URL("/assets/endless-aisle-key.554b06d2.svg",self.location).href},async handlePrintConfirmation(e){await this.searchTickets(),e.result==="successful"?this.selectedTicketsToPrint=[]:this.selectedTicketsToPrint=e.failedOrders.map(t=>t.order)}}},_=e=>(ie("data-v-82d54938"),e=e(),oe(),e),ne={class:"px-4"},me=_(()=>o("p",{class:"px-4 text-caption font-italic font-weight-medium text-primary"}," * Select pending print orders to print labels ",-1)),de={class:"item-category__image-container"},ce={class:"font-weight-bold"},pe=["colspan"],ue=_(()=>o("td",{colspan:"3",class:"expanded-row__place-holder"},null,-1)),ge={class:"item-category__image-container"},fe=_(()=>o("td",{colspan:"3",class:"expanded-row__place-holder"},null,-1));function he(e,t,l,a,n,d){const g=m("SearchFormInput"),y=m("SearchFormFieldset"),w=m("SearchFormRow"),x=m("SearchForm"),C=m("PrintPickLabel"),V=m("StageChip"),v=m("VBtnPrimary"),F=m("MeruDataTable"),D=m("DefaultLayout");return c(),h(D,{"no-content-padding":"",class:"fulfillment-index"},{default:i(()=>[r(H,{indeterminate:"",active:n.isSearching,absolute:"","rounded-bar":"",color:"primary-darken-1"},null,8,["active"]),r(x,{"form-data":a.filters},{default:i(()=>[r(w,null,{default:i(()=>[r(y,{"col-props":{cols:12,sm:6,lg:3},"show-border-bottom":a.mdAndDown},{default:i(()=>[r(g,{modelValue:a.filters.transactionId,"onUpdate:modelValue":t[0]||(t[0]=s=>a.filters.transactionId=s),"prepend-icon":a.smAndUp?"filter":void 0,"col-props":{cols:12},"input-type":"VTextField",label:"Transaction ID"},null,8,["modelValue","prepend-icon"])]),_:1},8,["show-border-bottom"]),r(y,{"col-props":{cols:12,sm:6,lg:4},"show-border-bottom":a.mdAndDown},{default:i(()=>[r(g,{modelValue:a.filters.stages,"onUpdate:modelValue":t[1]||(t[1]=s=>a.filters.stages=s),"input-type":"VSelect",label:"Stage",items:d.filteredStageItems,multiple:""},null,8,["modelValue","items"])]),_:1},8,["show-border-bottom"]),r(y,{class:"d-flex align-center justify-start","col-props":{cols:12,sm:8,md:10,lg:3},"row-props":{class:"flex-nowrap"}},{default:i(()=>[r(g,{modelValue:a.filters.carKeys,"onUpdate:modelValue":t[2]||(t[2]=s=>a.filters.carKeys=s),label:"Car Key","input-type":"VCheckbox",color:"primary-darken-1","hide-details":"",density:"compact",class:"d-inline-block flex-grow-0 mr-4"},null,8,["modelValue"]),r(g,{modelValue:a.filters.endlessAisle,"onUpdate:modelValue":t[3]||(t[3]=s=>a.filters.endlessAisle=s),"input-type":"VCheckbox",label:"Endless Aisle",color:"primary-darken-1","hide-details":"",density:"compact",class:"d-inline-block flex-grow-0"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["form-data"]),o("div",ne,[d.hasPendingPrintTickets?(c(),h(X,{key:0,color:"blue-grey-lighten-5",class:"px-4 mt-4"},{default:i(()=>[me,r(Z),r(C,{orders:n.selectedTicketsToPrint,onPrintProcessComplete:d.handlePrintConfirmation,onPrintCanceled:t[4]||(t[4]=s=>n.selectedTicketsToPrint=[])},null,8,["orders","onPrintProcessComplete"])]),_:1})):S("",!0)]),r(F,{"sort-by":a.sortBy,"onUpdate:sortBy":t[5]||(t[5]=s=>a.sortBy=s),"items-per-page":a.pagination.itemsPerPage,"onUpdate:itemsPerPage":t[6]||(t[6]=s=>a.pagination.itemsPerPage=s),page:a.pagination.page,"onUpdate:page":t[7]||(t[7]=s=>a.pagination.page=s),modelValue:n.selectedTicketsToPrint,"onUpdate:modelValue":t[8]||(t[8]=s=>n.selectedTicketsToPrint=s),"return-object":"","item-value":"transactionId",headers:n.headers,items:d.filteredTickets,loading:n.isSearching,"loading-text":"Loading Tickets",class:"elevation-0 on-surface-high-contrast-text","expand-icon":"$vuetify.icons.angleDown","show-expand":"","is-using-query-params":"","item-selectable":"selectable","show-select":d.hasPendingPrintTickets},{["item.data-table-expand"]:i(({item:s,isExpanded:u,internalItem:f,toggleExpand:U})=>[s.hasMultipleSkus?(c(),h($,{key:0,color:"primary-lighten-2",icon:"$angleDown",class:se({"v-data-table__expand-icon--active":u(f)}),variant:"text",onClick:ye=>U(f)},null,8,["class","onClick"])):S("",!0)]),["item.stage"]:i(({item:s})=>[r(V,{stage:s.stage},null,8,["stage"])]),["item.category"]:i(({item:s})=>[o("div",de,[r(T,{src:s.categoryImageUrl,class:"d-block","max-width":"100%"},null,8,["src"])])]),["item.sku"]:i(({item:s})=>[o("span",null,p(s.displayedSku),1),s.hasMultipleSkus?(c(),h(ee,{key:0,color:"primary",content:s.items.length,class:"ml-2",inline:""},null,8,["content"])):S("",!0)]),["item.quantity"]:i(({item:s})=>[k(p(s.totalQuantity),1)]),["item.timestamp"]:i(({item:s})=>[o("span",ce,p(s.formattedDate),1),k(),o("span",null,p(s.formattedTime),1)]),["item.shipToCustomer"]:i(({item:s})=>[r(te,{color:"primary-darken-1",icon:s.shipToCustomer?"$user":"$personWrenchSolid"},null,8,["icon"])]),["item.actions"]:i(({item:s})=>[r(v,{to:{name:"fulfillmentDetails",params:{sessionId:s.sessionId}}},{default:i(()=>[k(" Details ")]),_:2},1032,["to"])]),["expanded-row"]:i(({item:s})=>[(c(!0),I(re,null,ae(s.items,(u,f)=>(c(),I("tr",{key:f,colspan:n.headers.length},[ue,o("td",null,[o("div",ge,[r(T,{src:d.getCategoryImageSource(u.category),class:"d-block","max-width":"100%"},null,8,["src"])])]),o("td",null,p(u.hillmanSku),1),o("td",null,p(u.quantity),1),fe],8,pe))),128))]),_:2},1032,["sort-by","items-per-page","page","modelValue","headers","items","loading","show-select"])]),_:1})}const He=Q(le,[["render",he],["__scopeId","data-v-82d54938"]]);export{He as default};
