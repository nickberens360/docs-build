import{a as z}from"./vuex-D3TwipD2.js";import K from"./S3Image-3hbLJhu3.js";import{A as m,_ as N}from"./index-LK9MQE2L.js";import{C as _,i as o,e as a,b as g,s as f,J as l,H as h,E as $,B as r,_ as L,G as U,N as v,O as c,p as R,D as q,A as d}from"./@vue-DNrUJgob.js";import{t as y,v as B,a0 as W,W as F,e as Y,V as G,a as H,d as p,a7 as J,b as u,a6 as b,a2 as X,x as Z,w as I,f as Q,p as ee,s as A,k as x,l as V,m as T,r as P,i as S,u as te,$ as ae}from"./vuetify-BgnNF2O3.js";const O="/kiosk-stats",C="/kiosk-images",Ce=({serialNumber:t,files:e,imageCategory:n})=>{let w=new FormData;for(let s of e)w.append("images[]",s);const D={headers:{"Content-Type":"multipart/form-data"}};return m().post(`kiosks/${t}/images/${n}`,w,D)},we=t=>m().get(`kiosks/${t}/images`),Re=({KioskImageId:t},e,n)=>m().put(`${C}/${t}`,{action:e,approvalDesc:n}),oe=({KioskImageId:t},e)=>m().put(`${C}/${t}`,{action:"ROTATE",rotationDirection:e}),Ve=({KioskImageId:t},e)=>m().put(`${C}/${t}`,{action:"RECATEGORIZE",imageCategory:e}),De=({KioskImageId:t})=>m().delete(`${C}/${t}`),_e=()=>m().get(O+"/image-totals"),Ie=()=>m().get(O+"/unapproved-images"),se={components:{S3Image:K},props:{image:{type:Object,default:()=>({})},categories:{type:Array,default:()=>[]},hasApprovalPermission:Boolean},emits:["recat","rotate","delete","approvalChange"],data:()=>({isContextMenuShown:!1,contextMenuPosition:{x:void 0,y:void 0},rejectionDialogOpen:!1,deleteDialogOpen:!1,placeholders:["image is too blurry","kiosk is too far away","lighting is too dim","wrong orientation","resolution too low"],newApprovalDesc:"",relativeRotation:0,rotationRequestInProgress:!1,imgKey:0,initialAspectRatio:void 0}),computed:{...z("user",["user"]),normalizedRotation(){return this.relativeRotation%360},objectKey(){return`${this.image.serialNumber}/${this.image.imageFilename+(this.image.version?`?v=${this.image.version}`:"")}`},imageHeight(){return this.isInitialAspectRatio?void 0:this.$el.clientWidth},isInitialAspectRatio(){return this.relativeRotation%180===0},hasEditPermission(){return this.hasApprovalPermission||this.image.userId===this.user.id},thisCategory:{get(){return this.categories.find(t=>t.code===this.image.imageCategory)},set(t){this.$emit("recat",{kioskImage:this.image,imageCategory:t})}},specificCategories(){return this.categories.filter(t=>t.code!=="A")},randomPlaceholder(){return this.placeholders[Math.floor(Math.random()*this.placeholders.length)]},isRotating(){return this.relativeRotation%360!==0},approvalStatus(){switch(this.image.approvalType){case"A":return{abbr:"A",name:"Approved",color:"success"};case"R":return{abbr:"R",name:"Needs Retake",color:"error"};default:return{abbr:"U",name:"New",color:"warning"}}}},created(){this.newApprovalDesc=this.image.approvalDesc},methods:{showContextMenu(t){this.isContextMenuShown=!1,this.contextMenuPosition={x:t.clientX,y:t.clientY},this.$nextTick(()=>this.isContextMenuShown=!0)},imageLoaded(t){const{clientWidth:e,clientHeight:n}=t;this.initialAspectRatio=e/n},rotate(t){const e=t?90:-90;this.relativeRotation+=e},confirmRotation(){if(this.normalizedRotation===0)return;let t="";switch(this.normalizedRotation){case 90:case-270:t="Right";break;case 180:case-180:t="UpsideDown";break;case 270:case-90:t="Left";break}this.rotationRequestInProgress=!0,oe(this.image,t).then(({data:e})=>{this.relativeRotation=0,this.rotationRequestInProgress=!1,this.$emit("rotate",{newVersion:e,kioskImageId:this.image.KioskImageId})})},confirmDelete(){this.deleteDialogOpen=!1,this.$emit("delete",this.image)},approvalChange(t){this.rejectionDialogOpen=!1,t==="APPROVE"&&(this.newApprovalDesc=""),this.$emit("approvalChange",{action:t,kioskImage:this.image,approvalDesc:this.newApprovalDesc})},cancelReject(){this.newApprovalDesc=this.image.approvalDesc,this.rejectionDialogOpen=!1}}},ie={key:0,class:"text-warning font-weight-bold"},le={key:1,class:"text-error font-weight-bold"},ne={key:2,class:"text-success font-weight-bold"},re={class:"position-absolute top-0 left-0 w-100 h-100"},ue={class:"d-flex flex-column align-center justify-center h-100"},de={key:1,class:"actions"},me={key:2,class:"actions"},pe={class:"d-flex align-start justify-space-between"},ge={key:0,style:{"min-width":"68px"}};function fe(t,e,n,w,D,s){const j=L("S3Image");return d(),_(ae,null,{default:o(({isHovering:k,props:E})=>[a(V,R(E,{height:"100%",class:"d-flex flex-column justify-space-between"}),{default:o(()=>[a(y,{class:"pb-0 status-msg"},{default:o(()=>[a(B,{label:"",class:"status-msg__chip font-weight-bold mb-2",size:"small",color:s.approvalStatus.color},{default:o(()=>[l(h(s.approvalStatus.name),1)]),_:1},8,["color"]),n.image.approvalType==="U"?(d(),g("p",ie," Hang tight! Pending review. ")):f("",!0),n.image.approvalType==="R"?(d(),g("p",le,h(n.image.approvalDesc||"[ No Issue Description ]"),1)):f("",!0),n.image.approvalType==="A"?(d(),g("p",ne," Congrats! Image approved. ")):f("",!0)]),_:1}),a(W,{"aspect-ratio":t.$vuetify.display.smAndDown?void 0:3/4,class:"responsive-container",onContextmenu:$(s.showContextMenu,["prevent"])},{default:o(()=>[a(j,{height:s.imageHeight,blob:n.image.blob,bucket:"minutekey-kiosk-images","object-key":s.objectKey,"lazy-key":"samples/loadingimage.png","v-img-style":`opacity:${s.isRotating||t.rotationRequestInProgress?.7:1};transition:opacity 0.2s ease;transform: rotate(${t.relativeRotation}deg);transition: transform 0.2s ease;`,onLoad:s.imageLoaded},null,8,["height","blob","object-key","v-img-style","onLoad"]),n.image.imageFilename?(d(),_(F,{key:0,modelValue:t.isContextMenuShown,"onUpdate:modelValue":e[0]||(e[0]=i=>t.isContextMenuShown=i),style:U(`top: ${t.contextMenuPosition.y}px; left: ${t.contextMenuPosition.x}px;`),class:"position-absolute"},{default:o(()=>[a(Y,{density:"compact"},{default:o(()=>[a(G,{target:"_blank",href:`https://minutekey-kiosk-images.s3.amazonaws.com/${s.objectKey}`},{append:o(()=>[a(p,{size:"small"},{default:o(()=>e[15]||(e[15]=[l(" $vuetify.icons.externalLink ")])),_:1,__:[15]})]),default:o(()=>[a(H,null,{default:o(()=>e[14]||(e[14]=[l("View Image")])),_:1,__:[14]})]),_:1},8,["href"])]),_:1})]),_:1},8,["modelValue","style"])):f("",!0),r("div",re,[r("div",ue,[a(J,null,{default:o(()=>[v(a(u,{loading:t.rotationRequestInProgress,size:"large",onClick:s.confirmRotation},{default:o(()=>[e[17]||(e[17]=l(" Apply ")),a(p,{end:""},{default:o(()=>e[16]||(e[16]=[l(" $vuetify.icons.save ")])),_:1,__:[16]})]),_:1,__:[17]},8,["loading","onClick"]),[[c,s.isRotating]])]),_:1})])]),s.hasEditPermission&&!t.rotationRequestInProgress?(d(),g("div",de,[r("div",null,[a(b,null,{default:o(()=>[v(a(u,{size:"x-small",icon:"",onClick:e[1]||(e[1]=i=>s.rotate(!1))},{default:o(()=>[a(p,null,{default:o(()=>e[18]||(e[18]=[l("$vuetify.icons.rotateCCW")])),_:1,__:[18]})]),_:2},1536),[[c,k]])]),_:2},1024),a(b,null,{default:o(()=>[v(a(u,{size:"x-small",icon:"",onClick:e[2]||(e[2]=i=>s.rotate(!0))},{default:o(()=>[a(p,null,{default:o(()=>e[19]||(e[19]=[l("$vuetify.icons.rotateCW")])),_:1,__:[19]})]),_:2},1536),[[c,k]])]),_:2},1024)]),a(b,null,{default:o(()=>[v(a(u,{size:"x-small",icon:"",onClick:e[3]||(e[3]=i=>t.deleteDialogOpen=!0)},{default:o(()=>[a(p,null,{default:o(()=>e[20]||(e[20]=[l("$trash")])),_:1,__:[20]})]),_:2},1536),[[c,k]])]),_:2},1024)])):s.hasEditPermission?f("",!0):(d(),g("div",me,[a(b,null,{default:o(()=>[v(a(X,{color:"surface",width:"100%",icon:"$vuetify.icons.lock"},{default:o(()=>e[21]||(e[21]=[l(" Not Your Image ")])),_:2,__:[21]},1536),[[c,k]])]),_:2},1024)]))]),_:2},1032,["aspect-ratio","onContextmenu"]),a(y,{class:"pb-0"},{default:o(()=>[a(Z,{class:"text-subtitle-2 mx-0 mb-0 w-100 justify-space-between"},{default:o(()=>[a(I,{class:"pa-0"},{default:o(()=>[l(h(new Date(n.image.uploadTimestampUTC).toLocaleDateString()),1)]),_:1}),a(I,{class:"pa-0 text-right"},{default:o(()=>[l(h(new Date(n.image.uploadTimestampUTC).toLocaleTimeString()),1)]),_:1})]),_:1}),a(Q,{class:"my-2"}),r("div",pe,[a(ee,{modelValue:s.thisCategory,"onUpdate:modelValue":e[4]||(e[4]=i=>s.thisCategory=i),style:{flex:"4"},label:"Category",class:"mt-4 mr-4",disabled:!s.hasEditPermission,density:"compact",items:s.specificCategories,"item-title":i=>i.name,"item-value":i=>i},null,8,["modelValue","disabled","items","item-title","item-value"]),n.hasApprovalPermission?(d(),g("div",ge,[e[26]||(e[26]=r("div",{class:"text-center text-caption"}," Approval ",-1)),a(A,{location:"bottom"},{activator:o(({props:i})=>[a(u,R(i,{size:"x-small",icon:"",elevation:0,rounded:"0",color:s.approvalStatus.abbr==="R"?"error":"",onClick:e[5]||(e[5]=M=>t.rejectionDialogOpen=!0)}),{default:o(()=>[a(p,null,{default:o(()=>e[22]||(e[22]=[l("$thumbsDown")])),_:1,__:[22]})]),_:2},1040,["color"])]),default:o(()=>[e[23]||(e[23]=r("span",null,"Request Retake",-1))]),_:1,__:[23]}),a(A,{location:"bottom"},{activator:o(({props:i})=>[a(u,R(i,{size:"x-small",icon:"",elevation:0,rounded:"0",color:s.approvalStatus.abbr==="A"?"success":"",onClick:e[6]||(e[6]=M=>s.approvalChange("APPROVE"))}),{default:o(()=>[a(p,null,{default:o(()=>e[24]||(e[24]=[l("$thumbsUp")])),_:1,__:[24]})]),_:2},1040,["color"])]),default:o(()=>[e[25]||(e[25]=r("span",null,"Approve",-1))]),_:1,__:[25]})])):f("",!0)])]),_:1}),a(x,{modelValue:t.deleteDialogOpen,"onUpdate:modelValue":e[8]||(e[8]=i=>t.deleteDialogOpen=i),"max-width":400,"onClick:outside":e[9]||(e[9]=i=>t.deleteDialogOpen=!1)},{default:o(()=>[a(V,null,{default:o(()=>[a(T,null,{default:o(()=>e[27]||(e[27]=[l("Confirm Delete")])),_:1,__:[27]}),a(y,null,{default:o(()=>e[28]||(e[28]=[r("p",null,"Are you sure you want to delete this image?",-1),r("p",null,[l(" This operation "),r("b",null,"CANNOT"),l(" be undone. The file will be deleted "),r("b",null,"IMMEDIATELY"),l(" upon clicking the red button. ")],-1)])),_:1,__:[28]}),a(P,{class:"align-baseline"},{default:o(()=>[a(S),a(u,{variant:"text",onClick:e[7]||(e[7]=i=>t.deleteDialogOpen=!1)},{default:o(()=>e[29]||(e[29]=[l(" Cancel ")])),_:1,__:[29]}),a(u,{class:"mr-4 mb-2",color:"error",variant:"flat",onClick:s.confirmDelete},{default:o(()=>e[30]||(e[30]=[l(" Destroy Image ")])),_:1,__:[30]},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(x,{modelValue:t.rejectionDialogOpen,"onUpdate:modelValue":e[13]||(e[13]=i=>t.rejectionDialogOpen=i),"max-width":400,"onClick:outside":s.cancelReject},{default:o(()=>[a(V,null,{default:o(()=>[a(T,null,{default:o(()=>e[31]||(e[31]=[l("Provide Reason")])),_:1,__:[31]}),a(y,null,{default:o(()=>[e[32]||(e[32]=r("p",null,"Why do you want to reject this image?",-1)),a(te,{modelValue:t.newApprovalDesc,"onUpdate:modelValue":e[10]||(e[10]=i=>t.newApprovalDesc=i),autofocus:"",counter:50,label:"Reason",placeholder:s.randomPlaceholder,maxlength:"50",onKeypress:e[11]||(e[11]=q(i=>s.approvalChange("REJECT"),["enter"]))},null,8,["modelValue","placeholder"])]),_:1,__:[32]}),a(P,null,{default:o(()=>[a(S),a(u,{variant:"text",onClick:s.cancelReject},{default:o(()=>e[33]||(e[33]=[l(" Cancel ")])),_:1,__:[33]},8,["onClick"]),a(u,{class:"mr-4 mb-2",color:"error",variant:"flat",onClick:e[12]||(e[12]=i=>s.approvalChange("REJECT"))},{default:o(()=>e[34]||(e[34]=[l(" Request Retake ")])),_:1,__:[34]})]),_:1})]),_:1})]),_:1},8,["modelValue","onClick:outside"])]),_:2},1040)]),_:1})}const ve=N(se,[["render",fe],["__scopeId","data-v-4baa4367"]]),Ae=Object.freeze(Object.defineProperty({__proto__:null,default:ve},Symbol.toStringTag,{value:"Module"}));export{ve as K,Ce as a,_e as b,we as c,De as d,Ae as e,Ie as g,Ve as r,Re as u};
