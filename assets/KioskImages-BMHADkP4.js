import G from"./MeruDataTable-jf3gvfqw.js";import{c as F,a as W,m as J}from"./vuex-D3TwipD2.js";import{K as H,a as X,g as Y,b as Q,c as Z,u as ee,d as te,r as ae}from"./KioskImage-DB3Ym9UG.js";import se from"./ImageUpload-CMLkCDTb.js";import oe from"./KioskSwitchToolbar-egSwMDXj.js";import le from"./KioskSwitchDialog-CMvPHDmg.js";import ie from"./CategoryPicker-CjmxUKw-.js";import re from"./S3Image-3hbLJhu3.js";import ne from"./DefaultLayout-DdfUBm6-.js";import{C as h,i as a,s as de,e as s,B as l,_ as p,J as r,H as d,p as y,f as _,E as I,G as N,N as w,O as T,ac as me,b as U,g as D,F as V,x as $,A as u}from"./@vue-DNrUJgob.js";import{_ as pe}from"./index-LK9MQE2L.js";import{aj as x,i as ue,A as ge,w as k,l as g,d as m,f as S,s as v,x as A,m as P,t as R,b as z,v as fe,r as ce,k as he,av as ke,D as ye,aw as ve}from"./vuetify-BgnNF2O3.js";import"./date-fns-2ylUqVpG.js";import"./@babel-BTTPuEuv.js";import"./vue-component-docs-plugin-BnqcuvvC.js";import"./vue-router-BVOKdCCq.js";import"./axios-xsH4HHeE.js";import"./axios-cache-interceptor-DgAMPFM2.js";import"./cache-parser-DXYp_BCq.js";import"./fast-defer-9MI9za_P.js";import"./object-code-SBtdq8jY.js";import"./@fortawesome-BWcQmPY7.js";import"./@awesome.me-Btqfd-fw.js";const K=[{code:"A",name:"View All"},{code:"F",name:"Front of Store",desc:"Street view of the outside of the hosting store",qty:1},{code:"S",name:"Wide Shots",desc:"Two photos that clearly show the kiosk location in the store (two different angles)",qty:2},{code:"W",name:"In Store",desc:"Photo of the entire front of the kiosk",qty:1},{code:"G",name:"GUI",desc:"Close-up photo of the GUI screen",qty:1},{code:"C",name:"Window",desc:"Close-up photo of the window exposing the inside of the machine",qty:1},{code:"U",name:"In Use",desc:"Two photos of a customer or customers using the kiosk (two different angles)",qty:2}],Ce={components:{MeruDataTable:G,KioskImage:H,ImageUpload:se,KioskSwitchToolbar:oe,KioskSwitchDialog:le,CategoryPicker:ie,S3Image:re,DefaultLayout:ne},beforeRouteUpdate(e,t,n){this.loadImages(e.params.kiosk),this.selectedCategory=K[0],e.path==="/kiosk-images"&&this.checkPermissionsAndLoadContent(),n()},data:()=>({machineImages:[],uploading:!1,selectedCategory:K[0],sampleExpanded:!1,errorModal:!1,categories:K,kiosksInNeedOfApproval:[],imageTotals:{fullyApproved:"...",needReview:"...",totalKiosks:"..."}}),computed:{...J("kiosk",["getCurrentSelectedKioskCC","getMachineTypeChute","selectedKioskInfo"]),...W("user",["permissions","user"]),hasApprovalPermission(){return this.permissions&&this.permissions.includes("ApproveKioskImages")},selectedCategoryImages(){return this.isAllSelected?this.sortedMachineImages:this.sortedMachineImages.filter(e=>e.imageCategory===this.selectedCategory.code)},sortedMachineImages(){return[...this.machineImages].sort((e,t)=>t.approvalType.charCodeAt(0)-e.approvalType.charCodeAt(0)||e.uploadTimestampUTC-t.uploadTimestampUTC)},isAllSelected(){return this.selectedCategory.name==="View All"},isSpecificKioskSelected(){return this.$route.params.kiosk!==void 0}},watch:{permissions(){this.checkPermissionsAndLoadContent()}},created(){this.$route.params.kiosk?this.loadImages(this.$route.params.kiosk):this.checkPermissionsAndLoadContent()},methods:{...F("app",["setUploadModal"]),updateRotation({newVersion:e,kioskImageId:t}){this.machineImages.find(n=>n.KioskImageId===t).version=e},recategorizeImage({kioskImage:e,imageCategory:t}){ae(e,t.code);let n=this.machineImages.find(f=>f.KioskImageId===e.KioskImageId);n.imageCategory=t.code},onDragOver({dataTransfer:e}){for(let t of e.items)if(t.type!=="image/jpeg"&&t.type!=="image/png")return;this.isAllSelected?this.errorModal=!0:this.setUploadModal(!0)},categoryChange(e){this.selectedCategory=e},deleteImage(e){te(e),this.machineImages=this.machineImages.filter(t=>t.KioskImageId!==e.KioskImageId)},approvalChange({kioskImage:e,action:t,approvalDesc:n}){ee(e,t,n),e.approvalType=t==="APPROVE"?"A":"R",e.approvalDesc=n},loadImages(e=this.$route.params.kiosk){Z(e).then(t=>{this.machineImages=t.data.map(this.withJsDate)})},checkPermissionsAndLoadContent(){this.hasApprovalPermission&&(this.loadKiosksThatNeedApproval(),Q().then(({data:e})=>{this.imageTotals=e}))},loadKiosksThatNeedApproval(){Y().then(({data:e})=>{this.kiosksInNeedOfApproval=e})},withJsDate(e){const t=n=>new Date(n);return{...e,uploadTimestampUTC:e.uploadTimestampUTC&&t(e.uploadTimestampUTC)||null,approvalTimestampUTC:e.approvalTimestampUTC&&t(e.approvalTimestampUTC)||null}},handleNewImage({files:e,blobs:t}){this.uploading=!0;const n=new Date,f=this.selectedCategory.code;X({serialNumber:this.selectedKioskInfo.serialNumber,files:e,imageCategory:f}).then(({data:c})=>{const i=c.map((C,b)=>({KioskImageId:C,approvalType:"U",approvalDesc:null,approvalTimestampUTC:null,imageCategory:f,kioskId:this.getCurrentSelectedKioskCC.kioskId,serialNumber:this.selectedKioskInfo.serialNumber,uploadTimestampUTC:n,userId:this.user.id,blob:t[b]}));this.machineImages=[...this.machineImages,...i],this.uploading=!1}).catch(c=>{this.uploading=!1,this.machineImages=[...this.machineImages,...c.response.data],console.error("Some of the files were not able to be uploaded",c)})}}},be={class:"text-subtitle-1 font-weight-bold"},Ie={style:{"font-size":"1.8em"}},we={class:"text-subtitle-1; font-weight-bold"},Te={style:{"font-size":"1.8em"}},Se={class:"text-subtitle-1; font-weight-bold"},Ae={style:{"font-size":"1.8em"}},Ke={style:{"max-width":"50px",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap"}},_e={class:"px-4 no-images text-center text-primary-lighten-3"},Ne={class:"font-weight-bold"};function Ue(e,t,n,f,c,i){const C=p("KioskSwitchDialog"),b=p("MeruDataTable"),M=p("KioskSwitchToolbar"),E=p("VBtnSecondary"),q=p("CategoryPicker"),B=p("ImageUpload"),O=p("KioskImage"),L=p("S3Image"),j=p("DefaultLayout");return u(),h(j,null,{default:a(()=>[i.hasApprovalPermission&&!i.isSpecificKioskSelected?(u(),h(x,{key:0},{default:a(()=>[s(ge,{color:"surface-light",class:"pl-4"},{default:a(()=>[t[6]||(t[6]=l("span",null,"Approval Dashboard",-1)),s(ue),s(C,{"disable-auto-open":""})]),_:1,__:[6]}),s(A,{class:"my-2 align-stretch"},{default:a(()=>[s(k,{class:"py-2",cols:12,sm:6,md:4,xl:3},{default:a(()=>[s(g,{color:"info",class:"font-weight-bold pa-4 d-flex align-center"},{default:a(()=>[s(m,{class:"position-relative",style:{bottom:"2px"},theme:"dark"},{default:a(()=>t[7]||(t[7]=[r(" $save ")])),_:1,__:[7]}),s(S,{theme:"dark",vertical:"",class:"mx-4"}),l("div",null,[l("div",be,[t[9]||(t[9]=r(" Kiosks Submitted ")),s(v,{location:"top"},{activator:a(({props:o})=>[s(m,y({size:"small",theme:"dark",end:"",class:"position-relative",style:{bottom:"3px"}},o),{default:a(()=>t[8]||(t[8]=[r(" $questionCircle ")])),_:2,__:[8]},1040)]),default:a(()=>[l("span",null,d(e.$filters.localeNumber(e.imageTotals.totalKiosks))+" kiosks have images submitted",1)]),_:1})]),l("div",Ie,d(e.$filters.localeNumber(e.imageTotals.totalKiosks)),1)])]),_:1})]),_:1}),s(k,{class:"py-2",cols:12,sm:6,md:4,xl:3},{default:a(()=>[s(g,{color:"success",class:"font-weight-bold pa-4 d-flex align-center h-100"},{default:a(()=>[s(m,{class:"position-relative",style:{bottom:"2px"},theme:"dark"},{default:a(()=>t[10]||(t[10]=[r(" $thumbsUp ")])),_:1,__:[10]}),s(S,{theme:"dark",vertical:"",class:"mx-4"}),l("div",null,[l("div",we,[t[12]||(t[12]=r(" Kiosks Approved ")),s(v,{location:"top"},{activator:a(({props:o})=>[s(m,y({size:"small",theme:"dark",end:"",class:"position-relative",style:{bottom:"3px"}},o),{default:a(()=>t[11]||(t[11]=[r(" $questionCircle ")])),_:2,__:[11]},1040)]),default:a(()=>[l("span",null,d(e.$filters.localeNumber(e.imageTotals.fullyApproved))+" kiosks have all images approved",1)]),_:1})]),l("div",Te,d(e.$filters.localeNumber(e.imageTotals.fullyApproved)),1)])]),_:1})]),_:1}),s(k,{class:"py-2",cols:12,sm:6,md:4,xl:3},{default:a(()=>[s(g,{color:"warning",class:"font-weight-bold pa-4 d-flex align-center h-100"},{default:a(()=>[s(m,{class:"position-relative",style:{bottom:"2px"},theme:"dark"},{default:a(()=>t[13]||(t[13]=[r(" $gavel ")])),_:1,__:[13]}),s(S,{theme:"dark",vertical:"",class:"mx-4"}),l("div",null,[l("div",Se,[t[15]||(t[15]=r(" Kiosks Need Review ")),s(v,{location:"top"},{activator:a(({props:o})=>[s(m,y({size:"small",theme:"dark",end:"",class:"position-relative",style:{bottom:"3px"}},o),{default:a(()=>t[14]||(t[14]=[r(" $questionCircle ")])),_:2,__:[14]},1040)]),default:a(()=>[l("span",null,d(e.$filters.localeNumber(e.imageTotals.needReview))+" kiosks have images needing review",1)]),_:1})]),l("div",Ae,d(e.$filters.localeNumber(e.imageTotals.needReview)),1)])]),_:1})]),_:1})]),_:1}),s(g,{class:"my-2 pb-4",width:"100%"},{default:a(()=>[s(P,null,{default:a(()=>t[16]||(t[16]=[r("Unapproved Images")])),_:1,__:[16]}),s(R,null,{default:a(()=>t[17]||(t[17]=[r("Please review the unapproved images on each of the following kiosks.")])),_:1,__:[17]}),s(b,{headers:[{title:"Kiosk",key:"serialNumber",sortable:!0,width:"10%"},{title:"FSR",key:"name",sortable:!0},{title:"Images",key:"count",sortable:!0,align:"center",width:80},{title:" ",key:"goto",sortable:!1,align:"end"}],items:e.kiosksInNeedOfApproval,hover:"","mobile-breakpoint":1,"no-data-text":"All images are approved! No action necessary.","item-key":"serialNumber"},_({"item.count":a(({value:o})=>[s(fe,{size:"small",class:"font-weight-bold",theme:"dark",color:"warning"},{default:a(()=>[r(d(o),1)]),_:2},1024)]),"item.goto":a(({item:o})=>[s(z,{icon:"",color:"info",theme:"dark",to:{name:"kioskImage",params:{kiosk:o.serialNumber}}},{default:a(()=>[s(m,null,{default:a(()=>t[18]||(t[18]=[r("$vuetify.icons.chevronCircleRight")])),_:1,__:[18]})]),_:2},1032,["to"])]),_:2},[e.$vuetify.display.smAndDown?{name:"item.serialNumber",fn:a(({value:o})=>[l("div",Ke,d(o),1)]),key:"0"}:void 0]),1032,["items"])]),_:1})]),_:1})):i.isSpecificKioskSelected||i.hasApprovalPermission===!1?(u(),h(x,{key:1,style:N(`${e.$vuetify.display.smAndUp?"min-height: 85vh;":""} margin-bottom: ${e.$vuetify.display.xsOnly?110:50}px;`),onDragover:I(i.onDragOver,["prevent"]),onDrop:t[5]||(t[5]=I(()=>{},["prevent"]))},{default:a(()=>[s(M,null,_({_:2},[i.hasApprovalPermission?{name:"fab",fn:a(()=>[s(v,{location:"bottom"},{activator:a(({props:o})=>[s(z,y({icon:"",size:"small",theme:"dark",color:"info",style:{position:"absolute",top:"-15px",left:"-15px","z-index":"1"},to:{name:"kioskImages"}},o),{default:a(()=>[s(m,{style:{transform:"rotate(180deg)"}},{default:a(()=>t[19]||(t[19]=[r(" $vuetify.icons.chevronCircleRight ")])),_:1,__:[19]})]),_:2},1040)]),default:a(()=>[t[20]||(t[20]=l("span",null,"Back to Dashboard",-1))]),_:1,__:[20]})]),key:"0"}:void 0]),1024),s(he,{modelValue:e.errorModal,"onUpdate:modelValue":t[1]||(t[1]=o=>e.errorModal=o),"max-width":400},{default:a(()=>[s(g,{align:"center"},{default:a(()=>[s(P,{class:"justify-center"},{default:a(()=>t[21]||(t[21]=[r(" Not so Fast! ")])),_:1,__:[21]}),s(R,null,{default:a(()=>t[22]||(t[22]=[r("You have to pick an image category before uploading.")])),_:1,__:[22]}),s(ce,{class:"justify-center"},{default:a(()=>[s(E,{class:"mx-4 mb-2",onClick:t[0]||(t[0]=o=>e.errorModal=!1)},{default:a(()=>t[23]||(t[23]=[r(" Ok, Sorry ")])),_:1,__:[23]})]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(q,{categories:e.categories,"selected-category":e.selectedCategory,onChange:i.categoryChange},null,8,["categories","selected-category","onChange"]),s(B,{show:!i.isAllSelected,loading:e.uploading,"selected-category":e.selectedCategory,onUpload:i.handleNewImage},null,8,["show","loading","selected-category","onUpload"]),s(ke,null,{default:a(()=>[w(l("div",_e,[s(m,{class:"mb-4",size:"x-large"},{default:a(()=>t[24]||(t[24]=[r(" $vuetify.icons.image ")])),_:1,__:[24]}),l("p",null,d(e.selectedCategory.code==="A"?"No photos for this kiosk yet. Upload one now by selecting a view above.":"No photos for this view of the kiosk yet. Upload one now."),1)],512),[[T,!i.selectedCategoryImages.length]])]),_:1}),s(A,null,{default:a(()=>[s(me,{name:"sort-list"},{default:a(()=>[(u(!0),U(V,null,D(i.selectedCategoryImages,o=>(u(),h(k,{key:o.KioskImageId,cols:"12",sm:"6",md:"4",lg:"3"},{default:a(()=>[s(O,{categories:e.categories,image:o,"has-approval-permission":i.hasApprovalPermission,onApprovalChange:i.approvalChange,onRecat:i.recategorizeImage,onDelete:i.deleteImage,onRotate:i.updateRotation},null,8,["categories","image","has-approval-permission","onApprovalChange","onRecat","onDelete","onRotate"])]),_:2},1024))),128))]),_:1})]),_:1}),s(ve,{ref:"sheet",inset:"","model-value":!i.isAllSelected,"retain-focus":!1,scrim:e.sampleExpanded,persistent:"","no-click-animation":"",style:{"max-width":"600px"},"scroll-strategy":"none","onClick:outside":t[4]||(t[4]=o=>e.sampleExpanded=!1)},{default:a(()=>[s(g,{hover:"",style:N(`cursor: ${e.sampleExpanded?"default":"pointer"}`),class:$("text-center px-4 py-2"),onClick:t[3]||(t[3]=o=>e.sampleExpanded=!0)},{default:a(()=>[l("div",{width:"100%",style:{cursor:"pointer"},text:"",onClick:t[2]||(t[2]=I(o=>e.sampleExpanded=!e.sampleExpanded,["stop"]))},[s(m,{class:$(e.sampleExpanded?"flip-icon":"")},{default:a(()=>t[25]||(t[25]=[r(" $vuetify.icons.expand ")])),_:1,__:[25]},8,["class"])]),l("div",Ne,d(e.sampleExpanded?e.selectedCategory.name:`See ${e.selectedCategory.qty>1?"Samples":"a Sample"}`),1),w(l("p",{class:"mt-2 text-subtitle-2"},d(e.selectedCategory.desc),513),[[T,e.sampleExpanded]]),s(ye,null,{default:a(()=>[w(s(A,null,{default:a(()=>[(u(!0),U(V,null,D(e.selectedCategory.qty,o=>(u(),h(k,{key:o,cols:e.selectedCategory.qty>1?6:12},{default:a(()=>[s(L,{bucket:"minutekey-kiosk-images","object-key":`samples/${e.selectedCategory.code}${o}.jpg`,"lazy-key":"samples/loadingimage.png",class:"mb-2",width:"100%","aspect-ratio":e.selectedCategory.qty>1?3/4:4/3},null,8,["object-key","aspect-ratio"])]),_:2},1032,["cols"]))),128))]),_:1},512),[[T,e.sampleExpanded]])]),_:1})]),_:1},8,["style"])]),_:1},8,["model-value","scrim"])]),_:1},8,["style","onDragover"])):de("",!0)]),_:1})}const et=pe(Ce,[["render",Ue],["__scopeId","data-v-64ff219a"]]);export{et as default};
