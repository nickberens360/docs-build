import g from"./MeruDataTable.80a372ee.js";import{m as x}from"./vuex.0eb68a2c.js";import{_ as y}from"./index.8a58b007.js";import{v as I,s as u,d as v,aj as _}from"./vuetify.65d833ec.js";import{S as R,e as m,x as h,k as n,g as d,E as c,J as w,I as B,s as f,z as b,aj as $,ak as T}from"./@vue.ee679632.js";import"./date-fns.d38e1d55.js";import"./vue-atomic-docs.4f3653eb.js";import"./vue-router.ec64e966.js";import"./axios.eca6faa7.js";import"./axios-cache-interceptor.0956cad0.js";import"./cache-parser.124ebbb8.js";import"./fast-defer.b34f24de.js";import"./object-code.c2755e43.js";import"./@fortawesome.2cecc5e3.js";import"./@awesome.me.7dae7d79.js";const C={components:{MeruDataTable:g},props:{shipmentStatus:{type:String,required:!0,validator:e=>["in-transit","partial","received","all"].includes(e)},search:{type:String,default:""}},emits:["edit","receive","close","void","remind","clear","error"],exposes:["loadShipments"],data(){return{isLoadingShipments:!0,expandedLoading:!1,expandedRows:[],sortBy:[{key:"shipDate",order:"desc"}],expandedShipmentTableHeaders:[{sortable:!0,title:"SKU",key:"sku"},{sortable:!0,title:"Description",key:"description"},{sortable:!1,title:"Whole Boxes",key:"boxes"},{sortable:!1,title:"Whole Boxes Received",key:"boxesReceived"},{sortable:!1,title:"Half Boxes",key:"halfBoxes"},{sortable:!1,title:"Half Boxes Received",key:"halfBoxesReceived"},{sortable:!1,title:"Singles",key:"individualItems"},{sortable:!1,title:"Singles Received",key:"individualItemsReceived"}],expandedShipmentTableItems:[],expandedShipment:{},baseHeaders:[{title:"Status",value:"status.title",sortable:!0,width:150},{title:"Pick Number",key:"pickNumber"},{title:"Ship Date",key:"shipDate"},{title:"From",key:"from"},{title:"To",key:"to"},{sortable:!1,align:"end",title:"Actions",key:"availableActions",width:150}]}},computed:{...x("inventory",["skusById"]),...x("user",["user"]),...x("shipments",{pendingShipments:"pending",partiallyReceivedShipments:"partiallyReceived",receivedShipments:"received"}),tableHeaders(){let e=[...this.baseHeaders];return this.shipmentStatus==="received"&&e.splice(2,0,{sortable:!0,title:"Received Date",key:"receiveDate"}),e},tableItems(){let e=[];switch(this.shipmentStatus){case"in-transit":e=this.formatShipmentTableItems(this.pendingShipments,"in-transit");break;case"partial":e=this.formatShipmentTableItems(this.partiallyReceivedShipments,"partial");break;case"received":e=this.formatShipmentTableItems(this.receivedShipments,"received");break;case"all":e=[...this.formatShipmentTableItems(this.pendingShipments,"in-transit"),...this.formatShipmentTableItems(this.partiallyReceivedShipments,"partial"),...this.formatShipmentTableItems(this.receivedShipments,"received")];break}return e},expandedPickNumber(){return this.expandedRows[0]}},watch:{shipmentStatus(){this.loadShipments()}},mounted(){this.loadShipments()},methods:{getFormattedExpandedShipmentItems(e){let t=e.sent.transferSkus;for(const s of e.received)for(const i of s.transferSkus)this.expandedShipmentTableItems.find(o=>o.skuId===i.skuId)||this.expandedShipmentTableItems.push({...i,boxes:0,halfBoxes:0,individualItems:0});return t.map(s=>{const i=this.getSku(s),o=this.getReceived(s);return{...s,sku:(i==null?void 0:i.sku)||"",description:i?i.description:"",boxesReceived:o.boxes||0,halfBoxesReceived:o.halfBoxes||0,individualItemsReceived:o.individualItems||0}})},toggleSingleExpand(){this.expandedRows=this.expandedRows.slice(-1)},async toggleShipmentDetails(){this.toggleSingleExpand(),await this.loadExpandedShipment()},async loadExpandedShipment(e){var o,p;let t=!1,s=this.expandedPickNumber,i=s===((p=(o=this.expandedShipment)==null?void 0:o.sent)==null?void 0:p.pickNumber);if(!(!s||i&&!e)){this.expandedLoading=!0,this.expandedShipmentTableItems=[];try{const l=await this.$store.dispatch("shipments/loadShipment",{pickNumber:s});await this.skusPromise(),t=s!==this.expandedPickNumber,t||(this.expandedShipment=l,this.expandedShipmentTableItems=this.getFormattedExpandedShipmentItems(l))}catch{this.$emit("error",`Failed to load shipment: ${s}`),this.expandedShipment=void 0}(!t||!this.expandedPickNumber)&&(this.expandedLoading=!1)}},isReceiving(e){return e.toUser.id===this.user.id},getSku(e){return this.skusById[e.skuId]},getReceived(e){const t=this.expandedShipment;function s(i){return(o,p)=>{const l=p.transferSkus.find(a=>a.skuId===e.skuId);return l?o+l[i]:o}}return t.sent?{boxes:t.received.reduce(s("boxes"),0),halfBoxes:t.received.reduce(s("halfBoxes"),0),individualItems:t.received.reduce(s("individualItems"),0)}:{}},skusPromise(){return Object.entries(this.skusById).length>0?Promise.resolve(this.skusById):new Promise(e=>{const t=this.$watch("skusById",s=>{e(s),t()})})},async loadShipments(){this.isLoadingShipments=!0;let e="",t=Promise.resolve();switch(await this.loadExpandedShipment(!0),this.shipmentStatus){case"in-transit":e="pending",t=this.$store.dispatch("shipments/loadPending");break;case"partial":e="partially received",t=this.$store.dispatch("shipments/loadPartiallyReceived");break;case"received":e="received",t=this.$store.dispatch("shipments/loadReceived");break}return t.catch(s=>{console.error(s),this.$emit("error",`Failed to load ${e} shipments`)}).finally(()=>{this.isLoadingShipments=!1})},formatShipmentTableItems(e,t){const s={"in-transit":{title:"In-transit",color:"error"},received:{title:"Received",color:"success"},partial:{title:"Partially Received",color:"warning"}};return e.map(i=>({...i,to:`${i.toUser.person.firstName} ${i.toUser.person.lastName}`,from:`${i.fromUser.person.firstName} ${i.fromUser.person.lastName}`,availableActions:{edit:!this.isReceiving(i),receive:this.isReceiving(i),close:!this.isReceiving(i)&&t==="partial",void:!this.isReceiving(i)&&t==="in-transit",remind:!this.isReceiving(i)&&t!=="received",clear:!this.isReceiving(i)&&t==="received"},status:{value:t,...s[t]}}))}}},S=e=>($("data-v-b8c9f2aa"),e=e(),T(),e),N={class:"bg-primary-lighten-4"},P=["colspan"],D=S(()=>c("span",null,"Edit",-1)),L=S(()=>c("span",null,"Receive",-1)),A=S(()=>c("span",null,"Remind",-1)),U=S(()=>c("span",null,"Close",-1)),E=S(()=>c("span",null,"Clear",-1)),H=S(()=>c("span",null,"Void",-1));function V(e,t,s,i,o,p){const l=R("MeruDataTable");return m(),h(_,null,{default:n(()=>[d(l,{expanded:o.expandedRows,"onUpdate:expanded":[t[0]||(t[0]=a=>o.expandedRows=a),p.toggleShipmentDetails],"sort-by":o.sortBy,"onUpdate:sortBy":t[1]||(t[1]=a=>o.sortBy=a),search:s.search,headers:p.tableHeaders,items:p.tableItems,"show-expand":"","item-value":"pickNumber",hover:"",loading:o.isLoadingShipments,"loading-text":"Loading... Please wait","sort-asc-icon":"$vuetify.icons.arrowUp","sort-desc-icon":"$vuetify.icons.arrowDown"},{"expanded-row":n(({columns:a})=>[c("tr",N,[c("td",{colspan:a.length,class:"pa-1"},[c("div",null,[d(l,{headers:o.expandedShipmentTableHeaders,items:o.expandedShipmentTableItems,density:"compact",hover:"",loading:o.expandedLoading,"loading-text":"Loading... Please wait"},null,8,["headers","items","loading"])])],8,P)])]),["item.status.title"]:n(({item:a})=>[d(I,{color:a.status.color,size:"small","text-color":"white",class:"font-weight-bold"},{default:n(()=>[w(B(a.status.title),1)]),_:2},1032,["color"])]),["item.availableActions"]:n(({item:a})=>[d(u,{location:"bottom"},{activator:n(({props:r})=>[a.availableActions.edit?(m(),h(v,f({key:0,color:"success",icon:"$vuetify.icons.edit",size:"x-small"},r,{class:"mr-1",onClick:k=>e.$emit("edit",a)}),null,16,["onClick"])):b("",!0)]),default:n(()=>[D]),_:2},1024),d(u,{location:"bottom"},{activator:n(({props:r})=>[a.availableActions.receive?(m(),h(v,f({key:0,color:"success",icon:"$vuetify.icons.handHoldingBox",size:"x-small"},r,{class:"mr-1",onClick:k=>e.$emit("receive",a)}),null,16,["onClick"])):b("",!0)]),default:n(()=>[L]),_:2},1024),d(u,{location:"bottom"},{activator:n(({props:r})=>[a.availableActions.remind?(m(),h(v,f({key:0,color:"info",icon:"$vuetify.icons.alarmClock",size:"x-small"},r,{class:"mr-1",onClick:k=>e.$emit("remind",a)}),null,16,["onClick"])):b("",!0)]),default:n(()=>[A]),_:2},1024),d(u,{location:"bottom"},{activator:n(({props:r})=>[a.availableActions.close?(m(),h(v,f({key:0,color:"primary-lighten-3",icon:"$vuetify.icons.doorClosed",size:"x-small"},r,{class:"mr-1",onClick:k=>e.$emit("close",a)}),null,16,["onClick"])):b("",!0)]),default:n(()=>[U]),_:2},1024),d(u,{location:"bottom"},{activator:n(({props:r})=>[a.availableActions.clear?(m(),h(v,f({key:0,color:"white",icon:"$vuetify.icons.eraser",size:"x-small"},r,{class:"mr-1",onClick:k=>e.$emit("clear",a)}),null,16,["onClick"])):b("",!0)]),default:n(()=>[E]),_:2},1024),d(u,{location:"bottom"},{activator:n(({props:r})=>[a.availableActions.void?(m(),h(v,f({key:0,color:"error-lighten-2",icon:"$vuetify.icons.trash",size:"x-small"},r,{class:"mr-1",onClick:k=>e.$emit("void",a)}),null,16,["onClick"])):b("",!0)]),default:n(()=>[H]),_:2},1024)]),_:2},1032,["expanded","sort-by","search","headers","items","loading","onUpdate:expanded"])]),_:1})}const te=y(C,[["render",V],["__scopeId","data-v-b8c9f2aa"]]);export{te as default};
