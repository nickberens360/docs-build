import x from"./MeruDataTable-C8d00s6p.js";import{a as S}from"./vuex-BwOdvJvI.js";import{_ as g}from"./index-AG15HfzG.js";import{s as u,b as v,v as y,aj as I}from"./vuetify-BymGJ7fC.js";import{C as m,i as n,e as d,B as c,s as f,p as b,J as R,H as w,_ as B,A as h}from"./@vue-mGKKYCuj.js";import"./date-fns-Cq_iz7V_.js";import"./@babel-BTTPuEuv.js";import"./vue-component-docs-plugin-CX_tIU2Y.js";import"./vue-router-CgUA7A7W.js";import"./axios-xsH4HHeE.js";import"./axios-cache-interceptor-DgAMPFM2.js";import"./cache-parser-DXYp_BCq.js";import"./fast-defer-9MI9za_P.js";import"./object-code-SBtdq8jY.js";import"./@fortawesome-C0fAH5tI.js";import"./@awesome.me-Btqfd-fw.js";const $={components:{MeruDataTable:x},props:{shipmentStatus:{type:String,required:!0,validator:t=>["in-transit","partial","received","all"].includes(t)},search:{type:String,default:""}},emits:["edit","receive","close","void","remind","clear","error"],exposes:["loadShipments"],data(){return{isLoadingShipments:!0,expandedLoading:!1,expandedRows:[],sortBy:[{key:"shipDate",order:"desc"}],expandedShipmentTableHeaders:[{sortable:!0,title:"SKU",key:"sku"},{sortable:!0,title:"Description",key:"description"},{sortable:!1,title:"Whole Boxes",key:"boxes"},{sortable:!1,title:"Whole Boxes Received",key:"boxesReceived"},{sortable:!1,title:"Half Boxes",key:"halfBoxes"},{sortable:!1,title:"Half Boxes Received",key:"halfBoxesReceived"},{sortable:!1,title:"Singles",key:"individualItems"},{sortable:!1,title:"Singles Received",key:"individualItemsReceived"}],expandedShipmentTableItems:[],expandedShipment:{},baseHeaders:[{title:"Status",value:"status.title",sortable:!0,width:150},{title:"Pick Number",key:"pickNumber"},{title:"Ship Date",key:"shipDate"},{title:"From",key:"from"},{title:"To",key:"to"},{sortable:!1,align:"end",title:"Actions",key:"availableActions",width:150}]}},computed:{...S("inventory",["skusById"]),...S("user",["user"]),...S("shipments",{pendingShipments:"pending",partiallyReceivedShipments:"partiallyReceived",receivedShipments:"received"}),tableHeaders(){let t=[...this.baseHeaders];return this.shipmentStatus==="received"&&t.splice(2,0,{sortable:!0,title:"Received Date",key:"receiveDate"}),t},tableItems(){let t=[];switch(this.shipmentStatus){case"in-transit":t=this.formatShipmentTableItems(this.pendingShipments,"in-transit");break;case"partial":t=this.formatShipmentTableItems(this.partiallyReceivedShipments,"partial");break;case"received":t=this.formatShipmentTableItems(this.receivedShipments,"received");break;case"all":t=[...this.formatShipmentTableItems(this.pendingShipments,"in-transit"),...this.formatShipmentTableItems(this.partiallyReceivedShipments,"partial"),...this.formatShipmentTableItems(this.receivedShipments,"received")];break}return t},expandedPickNumber(){return this.expandedRows[0]}},watch:{shipmentStatus(){this.loadShipments()}},mounted(){this.loadShipments()},methods:{getFormattedExpandedShipmentItems(t){let e=t.sent.transferSkus;for(const s of t.received)for(const i of s.transferSkus)this.expandedShipmentTableItems.find(r=>r.skuId===i.skuId)||this.expandedShipmentTableItems.push({...i,boxes:0,halfBoxes:0,individualItems:0});return e.map(s=>{const i=this.getSku(s),r=this.getReceived(s);return{...s,sku:(i==null?void 0:i.sku)||"",description:i?i.description:"",boxesReceived:r.boxes||0,halfBoxesReceived:r.halfBoxes||0,individualItemsReceived:r.individualItems||0}})},toggleSingleExpand(){this.expandedRows=this.expandedRows.slice(-1)},async toggleShipmentDetails(){this.toggleSingleExpand(),await this.loadExpandedShipment()},async loadExpandedShipment(t){var r,p;let e=!1,s=this.expandedPickNumber,i=s===((p=(r=this.expandedShipment)==null?void 0:r.sent)==null?void 0:p.pickNumber);if(!(!s||i&&!t)){this.expandedLoading=!0,this.expandedShipmentTableItems=[];try{const l=await this.$store.dispatch("shipments/loadShipment",{pickNumber:s});await this.skusPromise(),e=s!==this.expandedPickNumber,e||(this.expandedShipment=l,this.expandedShipmentTableItems=this.getFormattedExpandedShipmentItems(l))}catch{this.$emit("error",`Failed to load shipment: ${s}`),this.expandedShipment=void 0}(!e||!this.expandedPickNumber)&&(this.expandedLoading=!1)}},isReceiving(t){return t.toUser.id===this.user.id},getSku(t){return this.skusById[t.skuId]},getReceived(t){const e=this.expandedShipment;function s(i){return(r,p)=>{const l=p.transferSkus.find(a=>a.skuId===t.skuId);return l?r+l[i]:r}}return e.sent?{boxes:e.received.reduce(s("boxes"),0),halfBoxes:e.received.reduce(s("halfBoxes"),0),individualItems:e.received.reduce(s("individualItems"),0)}:{}},skusPromise(){return Object.entries(this.skusById).length>0?Promise.resolve(this.skusById):new Promise(t=>{const e=this.$watch("skusById",s=>{t(s),e()})})},async loadShipments(){this.isLoadingShipments=!0;let t="",e=Promise.resolve();switch(await this.loadExpandedShipment(!0),this.shipmentStatus){case"in-transit":t="pending",e=this.$store.dispatch("shipments/loadPending");break;case"partial":t="partially received",e=this.$store.dispatch("shipments/loadPartiallyReceived");break;case"received":t="received",e=this.$store.dispatch("shipments/loadReceived");break}return e.catch(s=>{console.error(s),this.$emit("error",`Failed to load ${t} shipments`)}).finally(()=>{this.isLoadingShipments=!1})},formatShipmentTableItems(t,e){const s={"in-transit":{title:"In-transit",color:"error"},received:{title:"Received",color:"success"},partial:{title:"Partially Received",color:"warning"}};return t.map(i=>({...i,to:`${i.toUser.person.firstName} ${i.toUser.person.lastName}`,from:`${i.fromUser.person.firstName} ${i.fromUser.person.lastName}`,availableActions:{edit:!this.isReceiving(i),receive:this.isReceiving(i),close:!this.isReceiving(i)&&e==="partial",void:!this.isReceiving(i)&&e==="in-transit",remind:!this.isReceiving(i)&&e!=="received",clear:!this.isReceiving(i)&&e==="received"},status:{value:e,...s[e]}}))}}},C={class:"bg-primary-lighten-4"},T=["colspan"];function N(t,e,s,i,r,p){const l=B("MeruDataTable");return h(),m(I,null,{default:n(()=>[d(l,{expanded:r.expandedRows,"onUpdate:expanded":[e[0]||(e[0]=a=>r.expandedRows=a),p.toggleShipmentDetails],"sort-by":r.sortBy,"onUpdate:sortBy":e[1]||(e[1]=a=>r.sortBy=a),search:s.search,headers:p.tableHeaders,items:p.tableItems,"show-expand":"","item-value":"pickNumber",hover:"",loading:r.isLoadingShipments,"loading-text":"Loading... Please wait","sort-asc-icon":"$vuetify.icons.arrowUp","sort-desc-icon":"$vuetify.icons.arrowDown"},{"expanded-row":n(({columns:a})=>[c("tr",C,[c("td",{colspan:a.length,class:"pa-1"},[c("div",null,[d(l,{headers:r.expandedShipmentTableHeaders,items:r.expandedShipmentTableItems,density:"compact",hover:"",loading:r.expandedLoading,"loading-text":"Loading... Please wait"},null,8,["headers","items","loading"])])],8,T)])]),"item.status.title":n(({item:a})=>[d(y,{color:a.status.color,size:"small","text-color":"white",class:"font-weight-bold"},{default:n(()=>[R(w(a.status.title),1)]),_:2},1032,["color"])]),"item.availableActions":n(({item:a})=>[d(u,{location:"bottom"},{activator:n(({props:o})=>[a.availableActions.edit?(h(),m(v,b({key:0,color:"success",icon:"$vuetify.icons.edit",size:"x-small"},o,{class:"mr-1",onClick:k=>t.$emit("edit",a)}),null,16,["onClick"])):f("",!0)]),default:n(()=>[e[2]||(e[2]=c("span",null,"Edit",-1))]),_:2,__:[2]},1024),d(u,{location:"bottom"},{activator:n(({props:o})=>[a.availableActions.receive?(h(),m(v,b({key:0,color:"success",icon:"$vuetify.icons.handHoldingBox",size:"x-small"},o,{class:"mr-1",onClick:k=>t.$emit("receive",a)}),null,16,["onClick"])):f("",!0)]),default:n(()=>[e[3]||(e[3]=c("span",null,"Receive",-1))]),_:2,__:[3]},1024),d(u,{location:"bottom"},{activator:n(({props:o})=>[a.availableActions.remind?(h(),m(v,b({key:0,color:"info",icon:"$vuetify.icons.alarmClock",size:"x-small"},o,{class:"mr-1",onClick:k=>t.$emit("remind",a)}),null,16,["onClick"])):f("",!0)]),default:n(()=>[e[4]||(e[4]=c("span",null,"Remind",-1))]),_:2,__:[4]},1024),d(u,{location:"bottom"},{activator:n(({props:o})=>[a.availableActions.close?(h(),m(v,b({key:0,color:"primary-lighten-3",icon:"$vuetify.icons.doorClosed",size:"x-small"},o,{class:"mr-1",onClick:k=>t.$emit("close",a)}),null,16,["onClick"])):f("",!0)]),default:n(()=>[e[5]||(e[5]=c("span",null,"Close",-1))]),_:2,__:[5]},1024),d(u,{location:"bottom"},{activator:n(({props:o})=>[a.availableActions.clear?(h(),m(v,b({key:0,color:"white",icon:"$vuetify.icons.eraser",size:"x-small"},o,{class:"mr-1",onClick:k=>t.$emit("clear",a)}),null,16,["onClick"])):f("",!0)]),default:n(()=>[e[6]||(e[6]=c("span",null,"Clear",-1))]),_:2,__:[6]},1024),d(u,{location:"bottom"},{activator:n(({props:o})=>[a.availableActions.void?(h(),m(v,b({key:0,color:"error-lighten-2",icon:"$vuetify.icons.trash",size:"x-small"},o,{class:"mr-1",onClick:k=>t.$emit("void",a)}),null,16,["onClick"])):f("",!0)]),default:n(()=>[e[7]||(e[7]=c("span",null,"Void",-1))]),_:2,__:[7]},1024)]),_:2},1032,["expanded","sort-by","search","headers","items","loading","onUpdate:expanded"])]),_:1})}const K=g($,[["render",N],["__scopeId","data-v-b8c9f2aa"]]);export{K as default};
