import F from"./MeruDataTable.80a372ee.js";import{a as W,m as J,c as H}from"./vuex.0eb68a2c.js";import{K as X,r as Y,d as Q,u as Z,g as ee,a as ae,b as te,c as se}from"./KioskImage.ce19e0d4.js";import oe from"./ImageUpload.02029310.js";import le from"./KioskSwitchToolbar.b32bcaa6.js";import ie from"./KioskSwitchDialog.64fa2928.js";import re from"./CategoryPicker.4b4c3eb6.js";import ne from"./S3Image.32e445d0.js";import de from"./DefaultLayout.61d229e4.js";import{S as p,e as c,x as f,k as a,g as t,J as r,E as l,s as y,I as d,i as K,H as U,F as b,L as w,M as T,aa as me,f as N,j as D,G as V,B as x,z as pe,aj as ce,ak as ue}from"./@vue.ee679632.js";import{_ as ge}from"./index.8a58b007.js";import{aj as $,i as he,A as fe,w as k,q as u,c as m,f as _,s as v,x as S,k as P,t as z,v as ke,d as M,p as ye,r as ve,av as Ce,D as Ie,aw as be}from"./vuetify.65d833ec.js";import"./date-fns.d38e1d55.js";import"./vue-atomic-docs.4f3653eb.js";import"./vue-router.ec64e966.js";import"./axios.eca6faa7.js";import"./axios-cache-interceptor.0956cad0.js";import"./cache-parser.124ebbb8.js";import"./fast-defer.b34f24de.js";import"./object-code.c2755e43.js";import"./@fortawesome.2cecc5e3.js";import"./@awesome.me.7dae7d79.js";const A=[{code:"A",name:"View All"},{code:"F",name:"Front of Store",desc:"Street view of the outside of the hosting store",qty:1},{code:"S",name:"Wide Shots",desc:"Two photos that clearly show the kiosk location in the store (two different angles)",qty:2},{code:"W",name:"In Store",desc:"Photo of the entire front of the kiosk",qty:1},{code:"G",name:"GUI",desc:"Close-up photo of the GUI screen",qty:1},{code:"C",name:"Window",desc:"Close-up photo of the window exposing the inside of the machine",qty:1},{code:"U",name:"In Use",desc:"Two photos of a customer or customers using the kiosk (two different angles)",qty:2}],we={components:{MeruDataTable:F,KioskImage:X,ImageUpload:oe,KioskSwitchToolbar:le,KioskSwitchDialog:ie,CategoryPicker:re,S3Image:ne,DefaultLayout:de},beforeRouteUpdate(e,s,n){this.loadImages(e.params.kiosk),this.selectedCategory=A[0],e.path==="/kiosk-images"&&this.checkPermissionsAndLoadContent(),n()},data:()=>({machineImages:[],uploading:!1,selectedCategory:A[0],sampleExpanded:!1,errorModal:!1,categories:A,kiosksInNeedOfApproval:[],imageTotals:{fullyApproved:"...",needReview:"...",totalKiosks:"..."}}),computed:{...W("kiosk",["getCurrentSelectedKioskCC","getMachineTypeChute","selectedKioskInfo"]),...J("user",["permissions","user"]),hasApprovalPermission(){return this.permissions&&this.permissions.includes("ApproveKioskImages")},selectedCategoryImages(){return this.isAllSelected?this.sortedMachineImages:this.sortedMachineImages.filter(e=>e.imageCategory===this.selectedCategory.code)},sortedMachineImages(){return[...this.machineImages].sort((e,s)=>s.approvalType.charCodeAt(0)-e.approvalType.charCodeAt(0)||e.uploadTimestampUTC-s.uploadTimestampUTC)},isAllSelected(){return this.selectedCategory.name==="View All"},isSpecificKioskSelected(){return this.$route.params.kiosk!==void 0}},watch:{permissions(){this.checkPermissionsAndLoadContent()}},created(){this.$route.params.kiosk?this.loadImages(this.$route.params.kiosk):this.checkPermissionsAndLoadContent()},methods:{...H("app",["setUploadModal"]),updateRotation({newVersion:e,kioskImageId:s}){this.machineImages.find(n=>n.KioskImageId===s).version=e},recategorizeImage({kioskImage:e,imageCategory:s}){Y(e,s.code);let n=this.machineImages.find(g=>g.KioskImageId===e.KioskImageId);n.imageCategory=s.code},onDragOver({dataTransfer:e}){for(let s of e.items)if(s.type!=="image/jpeg"&&s.type!=="image/png")return;this.isAllSelected?this.errorModal=!0:this.setUploadModal(!0)},categoryChange(e){this.selectedCategory=e},deleteImage(e){Q(e),this.machineImages=this.machineImages.filter(s=>s.KioskImageId!==e.KioskImageId)},approvalChange({kioskImage:e,action:s,approvalDesc:n}){Z(e,s,n),e.approvalType=s==="APPROVE"?"A":"R",e.approvalDesc=n},loadImages(e=this.$route.params.kiosk){ee(e).then(s=>{this.machineImages=s.data.map(this.withJsDate)})},checkPermissionsAndLoadContent(){this.hasApprovalPermission&&(this.loadKiosksThatNeedApproval(),ae().then(({data:e})=>{this.imageTotals=e}))},loadKiosksThatNeedApproval(){te().then(({data:e})=>{this.kiosksInNeedOfApproval=e})},withJsDate(e){const s=n=>new Date(n);return{...e,uploadTimestampUTC:e.uploadTimestampUTC&&s(e.uploadTimestampUTC)||null,approvalTimestampUTC:e.approvalTimestampUTC&&s(e.approvalTimestampUTC)||null}},handleNewImage({files:e,blobs:s}){this.uploading=!0;const n=new Date,g=this.selectedCategory.code;se({serialNumber:this.selectedKioskInfo.serialNumber,files:e,imageCategory:g}).then(({data:h})=>{const i=h.map((C,I)=>({KioskImageId:C,approvalType:"U",approvalDesc:null,approvalTimestampUTC:null,imageCategory:g,kioskId:this.getCurrentSelectedKioskCC.kioskId,serialNumber:this.selectedKioskInfo.serialNumber,uploadTimestampUTC:n,userId:this.user.id,blob:s[I]}));this.machineImages=[...this.machineImages,...i],this.uploading=!1}).catch(h=>{this.uploading=!1,this.machineImages=[...this.machineImages,...h.response.data],console.error("Some of the files were not able to be uploaded",h)})}}},R=e=>(ce("data-v-64ff219a"),e=e(),ue(),e),Te=R(()=>l("span",null,"Approval Dashboard",-1)),_e={class:"text-subtitle-1 font-weight-bold"},Se={style:{"font-size":"1.8em"}},Ae={class:"text-subtitle-1; font-weight-bold"},Ke={style:{"font-size":"1.8em"}},Ue={class:"text-subtitle-1; font-weight-bold"},Ne={style:{"font-size":"1.8em"}},De={style:{"max-width":"50px",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap"}},Ve=R(()=>l("span",null,"Back to Dashboard",-1)),xe={class:"px-4 no-images text-center text-primary-lighten-3"},$e={class:"font-weight-bold"};function Pe(e,s,n,g,h,i){const C=p("KioskSwitchDialog"),I=p("MeruDataTable"),E=p("KioskSwitchToolbar"),q=p("VBtnSecondary"),B=p("CategoryPicker"),j=p("ImageUpload"),L=p("KioskImage"),O=p("S3Image"),G=p("DefaultLayout");return c(),f(G,null,{default:a(()=>[i.hasApprovalPermission&&!i.isSpecificKioskSelected?(c(),f($,{key:0},{default:a(()=>[t(fe,{color:"surface-light",class:"pl-4"},{default:a(()=>[Te,t(he),t(C,{"disable-auto-open":""})]),_:1}),t(S,{class:"my-2 align-stretch"},{default:a(()=>[t(k,{class:"py-2",cols:12,sm:6,md:4,xl:3},{default:a(()=>[t(u,{color:"info",class:"font-weight-bold pa-4 d-flex align-center"},{default:a(()=>[t(m,{class:"position-relative",style:{bottom:"2px"},theme:"dark"},{default:a(()=>[r(" $save ")]),_:1}),t(_,{theme:"dark",vertical:"",class:"mx-4"}),l("div",null,[l("div",_e,[r(" Kiosks Submitted "),t(v,{location:"top"},{activator:a(({props:o})=>[t(m,y({size:"small",theme:"dark",end:"",class:"position-relative",style:{bottom:"3px"}},o),{default:a(()=>[r(" $questionCircle ")]),_:2},1040)]),default:a(()=>[l("span",null,d(e.$filters.localeNumber(e.imageTotals.totalKiosks))+" kiosks have images submitted",1)]),_:1})]),l("div",Se,d(e.$filters.localeNumber(e.imageTotals.totalKiosks)),1)])]),_:1})]),_:1}),t(k,{class:"py-2",cols:12,sm:6,md:4,xl:3},{default:a(()=>[t(u,{color:"success",class:"font-weight-bold pa-4 d-flex align-center h-100"},{default:a(()=>[t(m,{class:"position-relative",style:{bottom:"2px"},theme:"dark"},{default:a(()=>[r(" $thumbsUp ")]),_:1}),t(_,{theme:"dark",vertical:"",class:"mx-4"}),l("div",null,[l("div",Ae,[r(" Kiosks Approved "),t(v,{location:"top"},{activator:a(({props:o})=>[t(m,y({size:"small",theme:"dark",end:"",class:"position-relative",style:{bottom:"3px"}},o),{default:a(()=>[r(" $questionCircle ")]),_:2},1040)]),default:a(()=>[l("span",null,d(e.$filters.localeNumber(e.imageTotals.fullyApproved))+" kiosks have all images approved",1)]),_:1})]),l("div",Ke,d(e.$filters.localeNumber(e.imageTotals.fullyApproved)),1)])]),_:1})]),_:1}),t(k,{class:"py-2",cols:12,sm:6,md:4,xl:3},{default:a(()=>[t(u,{color:"warning",class:"font-weight-bold pa-4 d-flex align-center h-100"},{default:a(()=>[t(m,{class:"position-relative",style:{bottom:"2px"},theme:"dark"},{default:a(()=>[r(" $gavel ")]),_:1}),t(_,{theme:"dark",vertical:"",class:"mx-4"}),l("div",null,[l("div",Ue,[r(" Kiosks Need Review "),t(v,{location:"top"},{activator:a(({props:o})=>[t(m,y({size:"small",theme:"dark",end:"",class:"position-relative",style:{bottom:"3px"}},o),{default:a(()=>[r(" $questionCircle ")]),_:2},1040)]),default:a(()=>[l("span",null,d(e.$filters.localeNumber(e.imageTotals.needReview))+" kiosks have images needing review",1)]),_:1})]),l("div",Ne,d(e.$filters.localeNumber(e.imageTotals.needReview)),1)])]),_:1})]),_:1})]),_:1}),t(u,{class:"my-2 pb-4",width:"100%"},{default:a(()=>[t(P,null,{default:a(()=>[r("Unapproved Images")]),_:1}),t(z,null,{default:a(()=>[r("Please review the unapproved images on each of the following kiosks.")]),_:1}),t(I,{headers:[{title:"Kiosk",key:"serialNumber",sortable:!0,width:"10%"},{title:"FSR",key:"name",sortable:!0},{title:"Images",key:"count",sortable:!0,align:"center",width:80},{title:" ",key:"goto",sortable:!1,align:"end"}],items:e.kiosksInNeedOfApproval,hover:"","mobile-breakpoint":1,"no-data-text":"All images are approved! No action necessary.","item-key":"serialNumber"},K({["item.count"]:a(({value:o})=>[t(ke,{size:"small",class:"font-weight-bold",theme:"dark",color:"warning"},{default:a(()=>[r(d(o),1)]),_:2},1024)]),["item.goto"]:a(({item:o})=>[t(M,{icon:"",color:"info",theme:"dark",to:{name:"kioskImage",params:{kiosk:o.serialNumber}}},{default:a(()=>[t(m,null,{default:a(()=>[r("$vuetify.icons.chevronCircleRight")]),_:1})]),_:2},1032,["to"])]),_:2},[e.$vuetify.display.smAndDown?{name:"item.serialNumber",fn:a(({value:o})=>[l("div",De,d(o),1)]),key:"0"}:void 0]),1032,["items"])]),_:1})]),_:1})):i.isSpecificKioskSelected||i.hasApprovalPermission===!1?(c(),f($,{key:1,style:U(`${e.$vuetify.display.smAndUp?"min-height: 85vh;":""} margin-bottom: ${e.$vuetify.display.xsOnly?110:50}px;`),onDragover:b(i.onDragOver,["prevent"]),onDrop:s[5]||(s[5]=b(()=>{},["prevent"]))},{default:a(()=>[t(E,null,K({_:2},[i.hasApprovalPermission?{name:"fab",fn:a(()=>[t(v,{location:"bottom"},{activator:a(({props:o})=>[t(M,y({icon:"",size:"small",theme:"dark",color:"info",style:{position:"absolute",top:"-15px",left:"-15px","z-index":"1"},to:{name:"kioskImages"}},o),{default:a(()=>[t(m,{style:{transform:"rotate(180deg)"}},{default:a(()=>[r(" $vuetify.icons.chevronCircleRight ")]),_:1})]),_:2},1040)]),default:a(()=>[Ve]),_:1})]),key:"0"}:void 0]),1024),t(ve,{modelValue:e.errorModal,"onUpdate:modelValue":s[1]||(s[1]=o=>e.errorModal=o),"max-width":400},{default:a(()=>[t(u,{align:"center"},{default:a(()=>[t(P,{class:"justify-center"},{default:a(()=>[r(" Not so Fast! ")]),_:1}),t(z,null,{default:a(()=>[r("You have to pick an image category before uploading.")]),_:1}),t(ye,{class:"justify-center"},{default:a(()=>[t(q,{class:"mx-4 mb-2",onClick:s[0]||(s[0]=o=>e.errorModal=!1)},{default:a(()=>[r(" Ok, Sorry ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(B,{categories:e.categories,"selected-category":e.selectedCategory,onChange:i.categoryChange},null,8,["categories","selected-category","onChange"]),t(j,{show:!i.isAllSelected,loading:e.uploading,"selected-category":e.selectedCategory,onUpload:i.handleNewImage},null,8,["show","loading","selected-category","onUpload"]),t(Ce,null,{default:a(()=>[w(l("div",xe,[t(m,{class:"mb-4",size:"x-large"},{default:a(()=>[r(" $vuetify.icons.image ")]),_:1}),l("p",null,d(e.selectedCategory.code==="A"?"No photos for this kiosk yet. Upload one now by selecting a view above.":"No photos for this view of the kiosk yet. Upload one now."),1)],512),[[T,!i.selectedCategoryImages.length]])]),_:1}),t(S,null,{default:a(()=>[t(me,{name:"sort-list"},{default:a(()=>[(c(!0),N(V,null,D(i.selectedCategoryImages,o=>(c(),f(k,{key:o.KioskImageId,cols:"12",sm:"6",md:"4",lg:"3"},{default:a(()=>[t(L,{categories:e.categories,image:o,"has-approval-permission":i.hasApprovalPermission,onApprovalChange:i.approvalChange,onRecat:i.recategorizeImage,onDelete:i.deleteImage,onRotate:i.updateRotation},null,8,["categories","image","has-approval-permission","onApprovalChange","onRecat","onDelete","onRotate"])]),_:2},1024))),128))]),_:1})]),_:1}),t(be,{ref:"sheet",inset:"","model-value":!i.isAllSelected,"retain-focus":!1,scrim:e.sampleExpanded,persistent:"","no-click-animation":"",style:{"max-width":"600px"},"scroll-strategy":"none","onClick:outside":s[4]||(s[4]=o=>e.sampleExpanded=!1)},{default:a(()=>[t(u,{hover:"",style:U(`cursor: ${e.sampleExpanded?"default":"pointer"}`),class:x("text-center px-4 py-2"),onClick:s[3]||(s[3]=o=>e.sampleExpanded=!0)},{default:a(()=>[l("div",{width:"100%",style:{cursor:"pointer"},text:"",onClick:s[2]||(s[2]=b(o=>e.sampleExpanded=!e.sampleExpanded,["stop"]))},[t(m,{class:x(e.sampleExpanded?"flip-icon":"")},{default:a(()=>[r(" $vuetify.icons.expand ")]),_:1},8,["class"])]),l("div",$e,d(e.sampleExpanded?e.selectedCategory.name:`See ${e.selectedCategory.qty>1?"Samples":"a Sample"}`),1),w(l("p",{class:"mt-2 text-subtitle-2"},d(e.selectedCategory.desc),513),[[T,e.sampleExpanded]]),t(Ie,null,{default:a(()=>[w(t(S,null,{default:a(()=>[(c(!0),N(V,null,D(e.selectedCategory.qty,o=>(c(),f(k,{key:o,cols:e.selectedCategory.qty>1?6:12},{default:a(()=>[t(O,{bucket:"minutekey-kiosk-images","object-key":`samples/${e.selectedCategory.code}${o}.jpg`,"lazy-key":"samples/loadingimage.png",class:"mb-2",width:"100%","aspect-ratio":e.selectedCategory.qty>1?3/4:4/3},null,8,["object-key","aspect-ratio"])]),_:2},1032,["cols"]))),128))]),_:1},512),[[T,e.sampleExpanded]])]),_:1})]),_:1},8,["style"])]),_:1},8,["model-value","scrim"])]),_:1},8,["style","onDragover"])):pe("",!0)]),_:1})}const oa=ge(we,[["render",Pe],["__scopeId","data-v-64ff219a"]]);export{oa as default};
