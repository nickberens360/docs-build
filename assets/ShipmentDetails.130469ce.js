import T from"./ConfirmDialog.060a100c.js";import B from"./DatePicker.55087c86.js";import A from"./MeruDataTable.80a372ee.js";import q from"./CatalogMenu.55226b4b.js";import z from"./FullScreenLayout.0d0fe126.js";import{_ as P,r as U}from"./index.8a58b007.js";import{m as j,a as H,b as W}from"./vuex.0eb68a2c.js";import{h as J,i as Z,A as G,ar as y,t as v,X,aj as w,l as K,x as V,w as c,u as k,c as Y,ad as N,s as F,d as _,r as Q,q as D,k as $,p as ee}from"./vuetify.65d833ec.js";import{S as p,e as g,x as I,k as l,g as s,J as u,I as M,E as o,s as C,z as x,i as te}from"./@vue.ee679632.js";import"./date-fns.d38e1d55.js";import"./vue-atomic-docs.4f3653eb.js";import"./vue-router.ec64e966.js";import"./axios.eca6faa7.js";import"./axios-cache-interceptor.0956cad0.js";import"./cache-parser.124ebbb8.js";import"./fast-defer.b34f24de.js";import"./object-code.c2755e43.js";import"./@fortawesome.2cecc5e3.js";import"./@awesome.me.7dae7d79.js";import"./@vuepic.604267a2.js";import"./@babel.5574241f.js";import"./ProductImage.3e5aeb25.js";const ie={components:{MeruDataTable:A,ConfirmDialog:T,DatePicker:B,CatalogMenu:q,FullScreenLayout:z},props:{backRoute:{type:String,default:"partial"}},emits:["shipment-saved"],data(){return{isLoadingInitialData:!0,isShipmentItemDialogOpen:!1,isShipmentItemFormValid:!1,isShipmentFormValid:!1,hasReceivedItems:!1,hasModifiedShipmentItems:!1,processingSubmit:!1,skuModel:void 0,skuSearchRules:[e=>Object.keys(e||{}).length!==0||"SKU is required"],skuExists:!1,SKUHeaders:[{sortable:!1,title:"SKU",key:"sku"},{sortable:!1,title:"Whole Boxes",key:"whole"},{sortable:!1,title:"Half Boxes",key:"half"},{sortable:!1,title:"Singles",key:"singles"},{sortable:!1,title:"Actions",key:"action",align:"right"}],SKUItems:[],editedSKUItem:{skuModel:{},sku:"",whole:"",half:"",singles:""},defaultSKUItem:{skuModel:{},sku:"",whole:"",half:"",singles:""},pickNumber:"",pickNumberExists:!1,fromShip:null,toShip:null,receiving:!1,date:new Date().toISOString().substring(0,10),editedShipment:{id:0,pickNumber:"",toUserId:"",fromUserId:"",shipDate:this.date,transferSkus:[]},defaultEditedShipment:{id:0,pickNumber:"",toUserId:"",fromUserId:"",shipDate:this.date,transferSkus:[]},quantityRules:[e=>Number.isNaN(parseInt(e))||parseInt(e)<1e7||"Too many",e=>Number.isNaN(parseInt(e))||parseInt(e)>=0||"0 or more",e=>Number.isNaN(parseInt(e))||parseInt(e)===parseFloat(e)||"Whole #"],shipmentFormMode:"create",hasLoadingError:!1}},computed:{...j("inventory",["skusById"]),...H({currentUser:"user/user",shippableUsers:"user/getShippableUsers",allSkus:"inventory/getSKUs"}),catalogMenuItems(){return this.SKUItems.map(e=>e.sku)},shipmentFormTitle(){return this.isLoading?"Loading...":this.hasLoadingError?`Error loading shipment ${this.$route.params.pickNumber}`:this.shipmentFormMode==="create"?"New Shipment":this.receiving?`Receive Shipment ${this.editedShipment.pickNumber}`:`Edit Shipment ${this.editedShipment.pickNumber}`},editedSKUItemNonZero:function(){return 0<parseInt(this.editedSKUItem.whole||0)+parseInt(this.editedSKUItem.half||0)+parseInt(this.editedSKUItem.singles||0)},isShipmentValid(){return this.isShipmentFormValid&&this.SKUItems.length>0&&this.dateFormatted},currentItem:function(){return this.SKUItems.find(e=>e.sku==this.editedSKUItem.sku)},dateFormatted(){let e=new Date(this.date);return e.toString()!=="Invalid Date"?e.toISOString().substring(0,10):void 0},shipmentFormRules(){return{pickNumber:[U,e=>e&&!!e.toString().trim()||"Required"],fromShip:[U,e=>{var t;return(e==null?void 0:e.id)!==((t=this.toShip)==null?void 0:t.id)||"Can't ship from same user"}],toShip:[U,e=>{var t;return(e==null?void 0:e.id)!==((t=this.fromShip)==null?void 0:t.id)||"Can't ship to same user"}]}},isLoadingCatalog(){return!this.allSkus.length},isLoading(){return this.isLoadingCatalog||this.isLoadingInitialData}},watch:{async pickNumberExists(){this.editedShipment.pickNumber&&await this.$refs.newShipmentForm.validate()},allSkus:{handler(e){e.length&&this.loadInitialData()},deep:!0,immediate:!0}},methods:{...W("shipments",["postSentShipment","postModifiedShipment","postReceivedShipment"]),skuChanged(e){var h;this.skuExists=!1;const t=e&&this.SKUItems.find(f=>this.skuModel&&f.sku===this.skuModel.sku);t?(this.editedSKUItem=t,this.skuExists=!0):(this.editedSKUItem=Object.assign({},this.defaultSKUItem),this.editedSKUItem.sku=(h=this.skuModel)==null?void 0:h.sku,this.editedSKUItem.skuModel=this.skuModel)},addShipmentItem(){this.editedSKUItem=Object.assign({},this.defaultSKUItem),this.skuModel=void 0,this.isShipmentItemDialogOpen=!0,this.$refs.shipmentItemForm&&this.$refs.shipmentItemForm.resetValidation()},editShipmentItem(e){this.editedSKUItem=Object.assign({},e),this.skuModel=e.skuModel,this.isShipmentItemDialogOpen=!0,this.$refs.shipmentItemForm&&this.$refs.shipmentItemForm.resetValidation()},async deleteShipmentItem(e){await this.$refs.confirm.open("Delete "+e.skuModel.sku,"Are you sure?",{color:"error-lighten-1",zIndex:2410})&&(this.SKUItems=this.SKUItems.filter(h=>h.skuModel.skuId!==e.skuModel.skuId),this.hasModifiedShipmentItems=!0,this.$store.dispatch("app/setSnackbar",{message:"Item Deleted"}))},cancelShipment(){this.pickNumberExists=!1,this.$refs.newShipmentForm&&this.$refs.newShipmentForm.resetValidation(),this.$refs.shipmentItemForm&&this.$refs.shipmentItemForm.resetValidation(),this.$router.push({name:"shipments",query:{status:this.backRoute}})},receiveFullShipment(){this.SKUItems.forEach(e=>{e.whole=e.expectedWhole,e.half=e.expectedHalf,e.singles=e.expectedSingles})},async handleOverStock(){const{expectedWhole:e,expectedHalf:t,expectedSingles:h,whole:f,half:i,singles:n}=this.editedSKUItem;if(f>e||i>t||n>h){const r="You are receiving more than what was shipped, are you sure?";return!await this.$refs.confirm.open(this.editedSKUItem.sku,r,{color:"warning-lighten-1",zIndex:2410})}},async saveShipmentItem(){if(!await this.handleOverStock()){const t=this.currentItem;this.editedSKUItem.skuModel=this.skuModel,this.editedSKUItem.sku=this.skuModel.sku,this.isShipmentItemDialogOpen=!1,t?(t.whole=this.editedSKUItem.whole||0,t.half=this.editedSKUItem.half||0,t.singles=this.editedSKUItem.singles||0):(this.editedSKUItem.whole=this.editedSKUItem.whole||0,this.editedSKUItem.half=this.editedSKUItem.half||0,this.editedSKUItem.singles=this.editedSKUItem.singles||0,this.SKUItems.push(this.editedSKUItem)),this.hasModifiedShipmentItems=!0}},async saveShipment(){this.processingSubmit=!0;const e={id:this.editedShipment.id,pickNumber:this.editedShipment.pickNumber.trim(),toUser:this.toShip,fromUser:this.fromShip,toUserId:this.toShip.id,fromUserId:this.fromShip.id,shipDate:this.receiving?void 0:this.dateFormatted,receiveDate:this.receiving?this.dateFormatted:void 0,transferSkus:this.SKUItems.map(t=>({skuId:t.skuModel.skuId,boxes:parseInt(t.whole)||0,halfBoxes:parseInt(t.half)||0,individualItems:parseInt(t.singles)||0}))};try{this.receiving?await this.postReceivedShipment(e):e.id!==0?await this.postModifiedShipment(e):await this.postSentShipment(e),this.pickNumberExists=!1,this.pickNumber="",this.$refs.newShipmentForm&&this.$refs.newShipmentForm.resetValidation(),this.$store.dispatch("app/setSnackbar",{message:"Shipment saved"}),this.$emit("shipment-saved"),this.goToShipmentIndex()}catch(t){t.response.status===400&&t.response.data==="Pick Number already exists!"?this.$store.dispatch("app/setSnackbar",{message:"Pick Number already exists!",color:"error"}):this.$store.dispatch("app/setSnackbar",{message:"Failed to save shipment",color:"error"})}finally{this.processingSubmit=!1}},initializeNewShipment(){this.$refs.newShipmentForm&&this.$refs.newShipmentForm.resetValidation(),this.shipmentFormMode="create",this.editedShipment=JSON.parse(JSON.stringify(this.defaultEditedShipment)),this.fromShip=this.formatUser(this.currentUser),this.toShip=null,this.date=new Date().toISOString().substring(0,10),this.SKUItems=[]},formatUser(e){const t=`${e.person.firstName} ${e.person.lastName}`;return Object.assign({},{...e,fullName:t})},async loadInitialData(){if(this.isLoadingInitialData=!0,this.shippableUsers.length===0)try{await this.$store.dispatch("user/loadShippableUsers")}catch{this.hasLoadingError=!0}this.$route.name==="newShipment"?this.initializeNewShipment():await this.initializeEditShipment(this.$route.params.pickNumber),this.isLoadingInitialData=!1},initializeEditShipment(e){return this.$store.dispatch("shipments/loadShipment",{pickNumber:e}).then(t=>{var n;const h=this.shippableUsers.find(r=>r.id===t.sent.fromUser.id),f=this.shippableUsers.find(r=>r.id===t.sent.toUser.id);this.fromShip=this.formatUser(h),this.toShip=this.formatUser(f),this.receiving=((n=this.toShip)==null?void 0:n.id)===this.currentUser.id,this.shipmentFormMode="update";const i=t.sent.pickNumber;if(this.editedShipment=JSON.parse(JSON.stringify(this.defaultEditedShipment)),this.editedShipment.id=this.receiving?0:t.sent.id,this.editedShipment.pickNumber=i,this.date=this.receiving?"":t.sent.shipDate,this.SKUItems=t.sent.transferSkus.map(r=>{const d=this.skusById[r.skuId];return d&&{skuModel:d,sku:d.sku,skuId:d.skuId,whole:this.receiving?void 0:r.boxes,half:this.receiving?void 0:r.halfBoxes,singles:this.receiving?void 0:r.individualItems,expectedWhole:this.receiving?r.boxes:void 0,expectedHalf:this.receiving?r.halfBoxes:void 0,expectedSingles:this.receiving?r.individualItems:void 0}}),this.receiving)for(const r of t.received){r.transferSkus.length&&(this.hasReceivedItems=!0);for(const d of r.transferSkus)if(!this.SKUItems.find(m=>m.skuId===d.skuId)){const m=this.skusById[d.skuId];this.SKUItems.push({skuModel:m,sku:m.sku,skuId:m.skuId})}}}).catch(t=>{console.error("An error occurred while dispatching the shipment/loadShipment action:",t),this.$store.dispatch("app/setSnackbar",{message:"Failed to load shipment",color:"error"}),this.hasLoadingError=!0,this.goToShipmentIndex()})},goToShipmentIndex(){this.$router.push({name:"shipments",query:{status:this.backRoute}})}}},se={class:"d-flex"},le=o("label",{for:"inputField",class:"text-primary-darken-3"}," Date ",-1),ne=o("span",null,"Edit",-1),ae=o("span",null,"Delete",-1),re={class:"text-center"},oe={class:"text-h5"},de=o("p",{class:"text-warning font-weight-bold"}," SKU already exists ",-1),me=o("div",{class:"flex-grow-1"},null,-1),he=o("div",{class:"flex-grow-1"},null,-1),ue=o("div",{class:"flex-grow-1"},null,-1);function pe(e,t,h,f,i,n){const r=p("DatePicker"),d=p("MeruDataTable"),m=p("VBtnPrimary"),S=p("VBtnSecondary"),E=p("CatalogMenu"),L=p("ConfirmDialog"),O=p("FullScreenLayout");return g(),I(O,{class:"shipment-details"},{header:l(()=>[s(G,{elevation:"4",color:"surface-light"},{default:l(()=>[s(J,{class:"tertiary--text font-weight-light"},{default:l(()=>[u(M(n.shipmentFormTitle),1)]),_:1}),s(Z)]),_:1})]),footer:l(()=>[s(y,null,{default:l(()=>[s(S,{disabled:i.processingSubmit,onClick:n.cancelShipment},{default:l(()=>[u(" Cancel ")]),_:1},8,["disabled","onClick"]),ue,s(m,{loading:i.processingSubmit,disabled:n.isLoading||!n.isShipmentValid,onClick:n.saveShipment},{default:l(()=>[u(" Save ")]),_:1},8,["loading","disabled","onClick"])]),_:1})]),default:l(()=>[s(D,null,{default:l(()=>[s(v,null,{default:l(()=>[s(X,{color:"surface-bright"},{default:l(()=>[s(w,null,{default:l(()=>[s(K,{ref:"newShipmentForm",modelValue:i.isShipmentFormValid,"onUpdate:modelValue":t[5]||(t[5]=a=>i.isShipmentFormValid=a),class:"pb-6"},{default:l(()=>[s(V,null,{default:l(()=>[s(c,{cols:"12",lg:"6",sm:"6",md:"6"},{default:l(()=>[o("div",null,[s(k,{modelValue:i.editedShipment.pickNumber,"onUpdate:modelValue":t[0]||(t[0]=a=>i.editedShipment.pickNumber=a),label:"Pick Number",type:"text",disabled:i.shipmentFormMode==="update"||n.isLoading,rules:n.shipmentFormRules.pickNumber,onFocus:t[1]||(t[1]=a=>i.pickNumberExists=!1)},null,8,["modelValue","disabled","rules"])]),o("div",se,[o("span",null,[le,s(Y,{class:"ml-1 mt-2",color:"primary-darken-3",icon:"fal fa-calendar"})]),s(r,{modelValue:i.date,"onUpdate:modelValue":t[2]||(t[2]=a=>i.date=a),class:"date-picker",clearable:!1,"input-font-size":"16px","input-height":"51px","auto-apply":"",disabled:n.isLoading,"max-date":new Date},null,8,["modelValue","disabled","max-date"])])]),_:1}),s(c,{cols:"12",lg:"6",sm:"6",md:"6"},{default:l(()=>[o("div",null,[s(N,{modelValue:i.fromShip,"onUpdate:modelValue":t[3]||(t[3]=a=>i.fromShip=a),label:"From",items:e.shippableUsers,"return-object":"","item-title":"fullName",disabled:i.receiving||n.isLoading,rules:n.shipmentFormRules.fromShip},null,8,["modelValue","items","disabled","rules"])]),o("div",null,[s(N,{modelValue:i.toShip,"onUpdate:modelValue":t[4]||(t[4]=a=>i.toShip=a),label:"To",items:e.shippableUsers,"return-object":"","item-title":"fullName",disabled:i.receiving||n.isLoading,rules:n.shipmentFormRules.toShip},null,8,["modelValue","items","disabled","rules"])])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),s(d,{headers:i.SKUHeaders,items:i.SKUItems,density:"compact",class:"mb-12",hover:"",loading:n.isLoading,"loading-text":"Loading... Please wait"},{["item.action"]:l(({item:a})=>[s(F,{location:"bottom"},{activator:l(({props:b})=>[s(_,C({color:"info",variant:"text",icon:"$edit",size:"x-small",class:"mr-4"},b,{onClick:R=>n.editShipmentItem(a)}),null,16,["onClick"])]),default:l(()=>[ne]),_:2},1024),s(F,{location:"bottom"},{activator:l(({props:b})=>[s(_,C({color:"error",variant:"text",icon:"$trash",size:"x-small",class:"mr-4"},b,{onClick:R=>n.deleteShipmentItem(a)}),null,16,["onClick"])]),default:l(()=>[ae]),_:2},1024)]),_:2},1032,["headers","items","loading"]),o("div",re,[s(m,{loading:n.isLoading,onClick:n.addShipmentItem},{default:l(()=>[u(" Add ")]),_:1},8,["loading","onClick"]),!i.hasModifiedShipmentItems&&i.receiving&&!i.hasReceivedItems?(g(),I(S,{key:0,loading:n.isLoading,class:"ml-4",onClick:n.receiveFullShipment},{default:l(()=>[u(" Receive All ")]),_:1},8,["loading","onClick"])):x("",!0)]),s(Q,{modelValue:i.isShipmentItemDialogOpen,"onUpdate:modelValue":t[13]||(t[13]=a=>i.isShipmentItemDialogOpen=a),"max-width":"700px"},{default:l(()=>[s(D,null,{default:l(()=>[s($,null,{default:l(()=>[o("span",oe,M(n.currentItem?"Edit Item":"New Item"),1)]),_:1}),s(v,null,{default:l(()=>[s(w,null,{default:l(()=>[s(K,{ref:"shipmentItemForm",modelValue:i.isShipmentItemFormValid,"onUpdate:modelValue":t[10]||(t[10]=a=>i.isShipmentItemFormValid=a),class:"pb-6"},{default:l(()=>[s(V,null,{default:l(()=>[s(c,{cols:"12",sm:"12",md:"12"},{default:l(()=>[s(E,{modelValue:i.skuModel,"onUpdate:modelValue":[t[6]||(t[6]=a=>i.skuModel=a),n.skuChanged],"show-deprecated":n.catalogMenuItems,rules:i.skuSearchRules},te({_:2},[i.skuExists?{name:"details",fn:l(()=>[de]),key:"0"}:void 0]),1032,["modelValue","show-deprecated","rules","onUpdate:modelValue"])]),_:1})]),_:1}),s(V,null,{default:l(()=>[s(c,null,{default:l(()=>[s(k,{modelValue:i.editedSKUItem.whole,"onUpdate:modelValue":t[7]||(t[7]=a=>i.editedSKUItem.whole=a),label:"Whole",type:"number",min:"0",rules:i.quantityRules},null,8,["modelValue","rules"])]),_:1}),s(c,null,{default:l(()=>[s(k,{modelValue:i.editedSKUItem.half,"onUpdate:modelValue":t[8]||(t[8]=a=>i.editedSKUItem.half=a),label:"Half",type:"number",min:"0",rules:i.quantityRules},null,8,["modelValue","rules"])]),_:1}),s(c,null,{default:l(()=>[s(k,{modelValue:i.editedSKUItem.singles,"onUpdate:modelValue":t[9]||(t[9]=a=>i.editedSKUItem.singles=a),label:"Singles",type:"number",min:"0",rules:i.quantityRules},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e.$vuetify.display.smAndDown?x("",!0):(g(),I(ee,{key:0},{default:l(()=>[s(S,{onClick:t[11]||(t[11]=a=>i.isShipmentItemDialogOpen=!1)},{default:l(()=>[u(" Cancel ")]),_:1}),me,s(m,{disabled:Object.keys(i.skuModel||{}).length==0||!n.editedSKUItemNonZero||!i.isShipmentItemFormValid,onClick:n.saveShipmentItem},{default:l(()=>[u(" Save ")]),_:1},8,["disabled","onClick"])]),_:1}))]),_:1}),e.$vuetify.display.smAndDown?(g(),I(y,{key:0},{default:l(()=>[s(S,{onClick:t[12]||(t[12]=a=>i.isShipmentItemDialogOpen=!1)},{default:l(()=>[u(" Cancel ")]),_:1}),he,s(m,{onClick:n.saveShipmentItem},{default:l(()=>[u(" Save ")]),_:1},8,["onClick"])]),_:1})):x("",!0)]),_:1},8,["modelValue"])]),_:1})]),_:1}),s(L,{ref:"confirm"},null,512)]),_:1})}const Oe=P(ie,[["render",pe]]);export{Oe as default};
