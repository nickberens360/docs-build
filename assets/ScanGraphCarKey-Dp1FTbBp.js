import{_ as g,o as y}from"./index-LK9MQE2L.js";import{C,r as D,s as S,w as k,x as I,y as b,z as _}from"./chart.js-DhSGZZEs.js";import{L as x}from"./vue-chartjs-DmBR38zn.js";import{a as M}from"./chartjs-plugin-annotation-DYYg84GY.js";import{N as O,b as h,B as c,e as d,C as V,s as v,i as L,_ as T,A as l,Y as w}from"./@vue-DNrUJgob.js";import{a as W}from"./lodash-es-Bp4BxrA1.js";import{at as A,p,am as P}from"./vuetify-BgnNF2O3.js";import"./vuex-D3TwipD2.js";import"./date-fns-2ylUqVpG.js";import"./@babel-BTTPuEuv.js";import"./vue-component-docs-plugin-BnqcuvvC.js";import"./vue-router-BVOKdCCq.js";import"./axios-xsH4HHeE.js";import"./axios-cache-interceptor-DgAMPFM2.js";import"./cache-parser-DXYp_BCq.js";import"./fast-defer-9MI9za_P.js";import"./object-code-SBtdq8jY.js";import"./@fortawesome-BWcQmPY7.js";import"./@awesome.me-Btqfd-fw.js";import"./@kurkle-D8fDXNIl.js";C.register(D,S,k,I,b,_,M);const u={components:{LineChart:x},props:{icCards:{type:Array,default:()=>[],required:!1},preferredCards:{type:Array,default:()=>[],required:!1},scanId:{type:String,required:!0}},data:()=>({chartInnerHeight:"200px",chartInnerWidth:"500px",chartInnerLeft:"14px",chartInnerTop:"0px",dragTarget:"tip",imageHeight:574,imageWidth:1937,isLoadingScanData:!1,isTrackingMouse:!1,keySide:"left",scanData:void 0,selectedIcCard:void 0,shoulderOffset:0,tipOffset:0}),computed:{chartData(){return{labels:this.scanData[this.keySide].profile.x,datasets:[{data:this.scanData[this.keySide].profile.y}]}},chartOptions(){const e=this.currentIcCard.axes.map(t=>this.formIcCardAnnotations(t)).flat();return{onResize:this.onChartResize,aspectRatio:this.imageWidth/this.imageHeight,elements:{line:{borderWidth:3,borderColor:"#00bcd4",tension:0},point:{pointStyle:!1}},scales:{x:{type:"linear",min:0,max:this.imageWidth,ticks:{stepSize:2}},y:{min:0,max:this.imageHeight,ticks:{stepSize:1}}},plugins:{title:{display:!1},legend:{display:!1},tooltip:{enabled:!1},annotation:{annotations:[{id:"shoulder_pos",type:"line",scaleID:"x",value:this.shoulderPosition,endValue:this.shoulderPosition,borderColor:"red",label:{position:"start",content:"Shoulder",display:!0}},{id:"end_of_key_pos",type:"line",scaleID:"x",value:this.tipPosition,endValue:this.tipPosition,borderColor:"red",label:{position:"start",content:"Tip",display:!0}},...e]}}}},currentIcCard:{get(){return this.selectedIcCard||this.icCardOptions[0]},set(e){this.selectedIcCard=e}},icCardOptions(){let e=[...this.preferredCards];return this.icCards.forEach(t=>{e.find(({cardNumber:n})=>n===t.cardNumber)||e.push(t)}),e},shoulderPosition(){return this.shoulderOffset+Math.max(this.scanData[this.keySide].datums.shoulder,0)},tipPosition(){return this.tipOffset+this.scanData[this.keySide].datums.tip}},mounted(){this.fetchScan()},methods:{async fetchScan(){this.isLoadingScanData=!0,this.scanData=void 0;try{const{data:e}=await y.fetchAlignedScans(this.scanId);this.scanData=e}catch(e){console.log(e)}this.isLoadingScanData=!1},formIcCardAnnotations(e){let t="bottom";e.verticalDatum==="left"?t="top":e.verticalDatum==="center"&&(t="centerLine");let i=this.scanData[this.keySide].datums[t],n=this.currentIcCard.horizontalDatum==="tip",o=n?this.tipPosition:this.shoulderPosition;return[...e.positions.map((a,r)=>{var s;return{id:`depth_pos_${r+1}`,type:"line",borderColor:"red",borderWidth:1,xMax:n?o-a:o+a,xMin:n?o-a:o+a,xScaleID:"x",yMin:this.scanData[this.keySide].datums.top+45,yMax:Math.min(...Object.values(e.depths))+i,yScaleID:"y",label:{position:"start",content:((s=e.directCode)==null?void 0:s.split("")[r])||"",display:!0}}}),...Object.entries(e.depths).map(([a,r])=>({id:`depths_${a}`,type:"line",borderColor:"red",borderWidth:1,xMax:Math.min(this.tipPosition+25,this.imageWidth),xMin:0,xScaleID:"x",yMin:r+i,yMax:r+i,yScaleID:"y",label:{position:"end",content:a,display:!0,backgroundColor:"rgba(0, 0, 0, 0)"}}))]},endDrag(){this.isTrackingMouse=!1},startDrag(){this.isTrackingMouse=!0},resetOffsets(){this.tipOffset=0,this.shoulderOffset=0},handleMouseDrag(e){if(this.isTrackingMouse){const t=this.imageWidth/parseFloat(this.chartInnerWidth),i=e.movementX*t;this.dragTarget==="tip"?this.tipOffset+=i:this.dragTarget==="shoulder"&&(this.shoulderOffset+=i)}},onChartResize(e){e.chartArea&&this.$nextTick(()=>{this.chartInnerHeight=e.chartArea.height+"px",this.chartInnerWidth=e.chartArea.width+"px",this.chartInnerLeft=e.chartArea.left+"px",this.chartInnerTop=e.chartArea.top+"px"})},onResize:W(function(){var e,t;(t=(e=this.$refs.lineChart)==null?void 0:e.chart)==null||t.resize()},300),setGraphAxes(){let e=new Image;e.src=this.scanData[this.keySide].images.front,this.imageWidth=e.width,this.imageHeight=e.height}}},m=()=>{w(e=>({"75fa166f":e.chartInnerHeight,"7ada4104":e.chartInnerWidth,dab65162:e.chartInnerLeft,"3647810d":e.chartInnerTop}))},f=u.setup;u.setup=f?(e,t)=>(m(),f(e,t)):m;const z={class:"scan-graph-car-key"},R={class:"scan-graph-car-key__side-selection"},H={key:0,class:"scan-graph-car-key__loader-container"},N=["src"];function j(e,t,i,n,o,a){const r=T("LineChart");return O((l(),h("div",z,[c("div",R,[d(p,{modelValue:e.dragTarget,"onUpdate:modelValue":t[0]||(t[0]=s=>e.dragTarget=s),class:"flex-grow-0",items:["tip","shoulder"],label:"Drag Target",width:"100"},null,8,["modelValue"]),d(p,{modelValue:e.keySide,"onUpdate:modelValue":[t[1]||(t[1]=s=>e.keySide=s),a.resetOffsets],class:"flex-grow-0 ml-6",items:["left","right"],label:"Key Side",width:"100"},null,8,["modelValue","onUpdate:modelValue"]),a.icCardOptions.length?(l(),V(p,{key:0,modelValue:a.currentIcCard,"onUpdate:modelValue":t[2]||(t[2]=s=>a.currentIcCard=s),class:"flex-grow-0 ml-6",items:a.icCardOptions,"item-title":"cardNumber",label:"IC Card","return-object":"",width:"100"},null,8,["modelValue","items"])):v("",!0)]),e.isLoadingScanData||!e.scanData?(l(),h("div",H,[d(P,{type:"ossein",loading:e.isLoadingScanData,class:"scan-graph-car-key__loader"},{default:L(()=>t[8]||(t[8]=[c("div",{class:"w-100 text-center"}," Failed to load scan data ",-1)])),_:1,__:[8]},8,["loading"])])):(l(),h("div",{key:1,class:"scan-graph-car-key__chart-container",onMousedown:t[4]||(t[4]=(...s)=>a.startDrag&&a.startDrag(...s)),onMousemove:t[5]||(t[5]=(...s)=>a.handleMouseDrag&&a.handleMouseDrag(...s)),onMouseleave:t[6]||(t[6]=(...s)=>a.endDrag&&a.endDrag(...s)),onMouseup:t[7]||(t[7]=(...s)=>a.endDrag&&a.endDrag(...s))},[c("img",{class:"scan-graph-car-key__key-image",src:e.scanData[e.keySide].images.front,onLoad:t[3]||(t[3]=(...s)=>a.setGraphAxes&&a.setGraphAxes(...s))},null,40,N),d(r,{ref:"lineChart",class:"scan-graph-car-key__line-chart",data:a.chartData,options:a.chartOptions},null,8,["data","options"])],32))])),[[A,a.onResize,void 0,{quiet:!0}]])}const oe=g(u,[["render",j],["__scopeId","data-v-13d63526"]]);export{oe as default};
